{"version":3,"sources":["assets/img/profile_light.png","assets/img/logo.png","partials/video.jsx","partials/layout.jsx","partials/modal.jsx","views/verified.jsx","views/resetpassword.jsx","components/modal_about.jsx","components/btn_fullscreen.jsx","partials/title.jsx","partials/nav.jsx","components/badge_forward.jsx","views/room.jsx","components/modal_recovery.jsx","components/modal_register.jsx","views/login.jsx","components/modal_create_room.jsx","assets/img/TeenyiconsPasswordOutline.svg","components/modal_room_password.jsx","views/lobby.jsx","views/wizard.jsx","components/modal_leave_room.jsx","components/modal_wizard.jsx","components/modal_users.jsx","components/modal_chat.jsx","components/btngrp_stream.jsx","views/App.jsx","utils/ctx_rooms.jsx","utils/forms.js","components/modal_profile.jsx","utils/md.jsx","utils/ctx_authentication.jsx","pages lazy /^/.*/.jsx$/ groupOptions: {} namespace object","reportWebVitals.js","serviceWorkerRegistration.js","index.js","../lib/bra/rtcClient.js","../lib/bra/lobbyClient.js","../lib/bra/mediaAdapter.js","../lib/bra/index.js","../lib/bra/dummyStream.js","utils/http.js","utils/ctx_mediadevices.jsx","utils/ctx_streaming.jsx"],"names":["id","stream","onClick","isLocal","props","ref","useRef","useState","audio","status","setStatus","useEffect","current","srcObject","className","variant","disabled","autoPlay","playsInline","muted","window","toast","error","message","options","console","trace","success","log","loading","custom","children","position","reverseOrder","toastOptions","duration","style","background","color","basename","process","REACT_APP_BASE","property","content","REACT_APP_OG_TYPE","envREACT_APP_OG_IMAGE","component","App","exact","path","Verified","ResetPass","to","title","show","setShow","buttons","callback","closeButton","centered","keyboard","onHide","dialogClassName","Header","Title","Body","Footer","map","v","k","a","history","useHistory","push","size","backdrop","token","useParams","formRef","undefined","validated","setValidated","formErrors","formvalues","setFormValues","e","preventDefault","toastId","password","http","post","data","then","description","setTimeout","warn","catch","err","isValid","key","indexOf","validateForm","onSubmit","placement","overlay","type","controlId","label","Control","required","name","placeholder","onChange","value","check","test","validateField","target","defaultValue","useReducer","o","n","proposalEvent","proposal","dispatch","onBeforeInstallPrompt","state","prompt","userChoice","outcome","addEventListener","removeEventListener","setState","f","s","screenfull","on","off","isEnabled","toggle","document","fullscreen","rooms","useContext","RoomsContext","width","height","src","logo","Nav","zIndex","Item","icon","appendclass","Button","button","callId","isForwardCall","wrtc","StreamContext","fetching","setFetching","getLiveCall","mediaHubCallId","submit","forwardingCallId","mediaHubtarget","callUser","response","calleeId","callerId","forwardCall","Spinner","as","animation","role","Badge","padding","pill","bg","callHangup","onKeyDown","keyCode","FloatingLabel","Form","Room","roomId","carouselRef","auth","AuthContext","media","MediaContext","selected","setSelected","useLayoutEffect","imInRoom","ready","callAllUsers","callHangupAll","replaceStream","localStream","Row","Col","xs","Object","entries","local","streams","getUserId","imMaster","user","username","master","isMediahubCall","isSelected","handleSubmit","email","toLowerCase","OverlayTrigger","Tooltip","isConnected","length","handleUserInput","values","testImage","url","timeoutT","Promise","resolve","reject","timer","timeout","img","Image","onerror","onabort","clearTimeout","onload","Gravatar","r","d","gravatar","confirm","checked","avatar","surname","birthdate","profile_img","hasError","JSON","stringify","Card","roundedCircle","Group","password2","htmlFor","cookies","get","remember","login","app_token","set","Img","Text","Switch","defaultChecked","Array","from","elements","roomname","hidden","createRoom","room","tabIndex","RoomTile","secured","users","joinRoom","margin","lock","filter","onKeyPress","list","sm","span","offset","lg","xl","pages","page","setPage","views","setViews","onKeyPressed","vs","p","default","onSwipeLeft","onSwipeRight","leaveRoom","_title","canvasRef","isAudioEnabled","setAudioEnabled","audiotracks","getAudioTracks","every","enabled","settings","ctx","getContext","globalAlpha","requestAnimationFrame","draw","clearRect","canvas","x0","y0","x1","y1","r1","gradient","createRadialGradient","addColorStop","fillStyle","fillRect","cancelAnimationFrame","marginTop","marginBottom","track","view","location","pathname","container","isLogged","Container","fluid","createContext","setRooms","setReady","setCurrent","isUserInRoom","roomName","onRoomCreated","BRA","getRooms","onGetRooms","onRoomDeleted","onGuestLeft","getRoom","onGetRoom","u","onGuestJoin","rs","onUserRejoined","GuestLeftRoom","GuestJoinedRoom","RoomCreated","RoomDeleted","UserRejoined","m1","m2","store","event","finally","Provider","logout","align","ButtonGroup","replaceAll","remarkPlugins","remarkGfm","remarkBreaks","rehypePlugins","rehypeRaw","setUser","setToken","setLogged","app","rtc","setConnected","toast_app","toast_rtc","toast_usr","retries","setRetries","access_token","flat","msg","dismiss","unregister","disconnect","headers","Authorization","onUnload","onAppConnect","onRtcConnect","onAppDisconnect","onRtcDisconnect","ClientConnected","ClientDisconnected","connect","Infinity","getUserInfo","t","setTimer","interval_id","setInterval","Math","max","clearInterval","register","webpackAsyncContext","req","__webpack_require__","Error","code","ids","all","slice","keys","module","exports","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","render","StrictMode","Suspense","fallback","ProgressBar","animated","now","getElementById","URL","href","origin","fetch","contentType","reload","checkValidServiceWorker","serviceWorkerRegistration","RTCEvent","IncomingCall","CallAccepted","CallCanceled","CallOpened","CallClosed","UserHangup","RTCCall","connection","candidates","channels","initiator","getStats","callStats","stats","pairStats","forEach","report","localCandidateId","localType","candidateType","localAddress","address","ip","localPort","port","localProtocol","protocol","remoteCandidateId","remoteType","remoteAddress","remotePort","remoteProtocol","bind","peerConnection","isInitiator","RTCPeerConnection","channel","close","getState","iceConnectionState","addCandidate","candidate","addIceCandidate","gatherPendingCandidates","setRemoteDescription","setBandwidth","bandwidth","senders","getSenders","i","sender","parameters","getParameters","encodings","maxBitrate","setParameters","getRemoteAudioTrack","index","receivers","getReceivers","tracks","receiver","kind","getRemoteVideoTrack","getRemoteStream","MediaStream","addTrack","replaceLocalAudioTrack","audioSenders","replaceTrack","replaceLocalVideoTrack","videoSenders","openChannel","createDataChannel","closeChannel","onDataChannel","onChannelOpen","onopen","onChannelClose","onChannelError","onChannelMessage","onmessage","sendData","readyState","send","LobbyEvent","UserOnline","UserOffline","MediaEvent","GotDevices","ErrorDevices","GotResolutions","GotStream","ErrorStream","SilenceStream","audioContext","AudioContext","gainNode","createGain","oscillatorNode","createOscillator","destination","createMediaStreamDestination","gain","setValueAtTime","currentTime","start","BlackStream","createElement","context","interval","captureStream","DEBUG","appClient","assign","debug","debugStyle","pingPeriod","responses","events","socket","keepAliveTimeout","emit","args","call","arguments","listeners","apply","this","onOpen","startKeepAlive","onClose","stopKeepAlive","onMessage","parse","uuid","sendMessage","WebSocket","OPEN","ping","uuidv4","replace","c","crypto","getRandomValues","Uint8Array","toString","listener","splice","accessToken","onclose","mediaAdapter","audioStream","videoStream","mediaStream","audioDevices","videoDevices","resolutions","audioConstraints","deviceId","videoConstraints","video","frameRate","ideal","resolution","previousAudioConstraints","previousVideoConstraints","mediaDevices","enumerateDevices","mixStreams","getUserMedia","findDevices","getDevices","gotDevices","errorDevices","deviceInfos","deviceInfo","getAudioStream","stopStream","gotAudioStream","errorAudioStream","getVideoStream","gotVideoStream","errorVideoStream","audioTrack","videoTrack","getVideoTracks","videoTrackSettings","getSettings","sort","b","Number","NEGATIVE_INFINITY","reduce","errorStream","clone","audioTracks","videoTracks","getTracks","stop","object","setAudio","device","setVideo","dummyStream","_blackCanvas","_silenceStream","_blackStream","_silenceTrack","_blackTrack","createSilenceTrack","createBlackTrack","_stream","getAudioTrack","getVideoTrack","getStream","rtcClient","defaultSettings","defaultStream","calls","userId","rtcConfiguration","iceServers","handleRegisterResponse","handleUnregisterResponse","handleCallResponse","handleIncomingCall","handleCallAccepted","handleCallCanceled","handleRemoteOffer","handleRemoteAnswer","handleRemoteCandidate","handleUserHangup","closeCall","hangup","oniceconnectionstatechange","other","handleIceConnectionStateChange","onicecandidate","onnegotiationneeded","createOffer","sdp","setLocalDescription","offer","createAnswer","answer","getCall","getCalls","CLOSED","acceptCall","cancelCall","APPEvent","method","json","body","init_evts","videoRef","devices","setDevices","setSettings","setResolutions","newvalue","setLocalStream","onGotResolutions","onGotDevices","onGotStream","localStorage","setItem","onError","getItem","onStream","init","setStreams","liveCalls","setLiveCalls","onIncomingCall","onCallOpened","forward_stream","videotrack","audiotrack","onCallClosed","manageLiveCallClosed","onUserHangup","result","mId","fId","source","find"],"mappings":"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","file":"static/js/main.ac2ae07a.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/profile_light.7c82d8ab.png\";","export default __webpack_public_path__ + \"static/media/logo.f23962e9.png\";","import {Button} from 'react-bootstrap'\r\nimport { useEffect, useState, useRef } from 'react'\r\n\r\nexport default ({id, stream, onClick, isLocal = false, ...props})=>{\r\n    let ref = useRef(null);\r\n    const [status, setStatus] = useState({audio:true});\r\n\r\n    useEffect(()=>{\r\n        if(stream && ref.current){\r\n            ref.current.srcObject = stream;\r\n            //ref.current.play();\r\n        }\r\n    },[stream]);\r\n\r\n    function handleClick(){\r\n        setStatus({...status, audio:!status.audio});\r\n    }\r\n    \r\n    return <>\r\n    <div className={`Video ${props.className??\"\"}`} >\r\n        <div className=\"stream-status position-absolute bottom-0 start-0\">\r\n            <span   className=\"status-user\"> {id} </span>\r\n            <Button className=\"status-audio\" variant=\"link\" disabled={isLocal} onClick={handleClick}>\r\n                {isLocal? <i className={`bi bi-mic${!(isLocal||!status?.audio) ? \"\" : \"-mute\"}`} />\r\n                :<i className={`fs-4 bi bi-volume${!(isLocal||!status?.audio) ? \"-down\" : \"-mute\"}`} />}\r\n            </Button>\r\n        </div>\r\n        <video autoPlay playsInline muted={isLocal || !status?.audio} ref={ref} {...{onClick}}/>\r\n    </div>\r\n    <style global jsx>{`\r\n        @import 'src/variables.scss';\r\n\r\n        .Video{\r\n            position: relative;\r\n            margin:1px;\r\n            padding:0;\r\n            border:1px solid $secondary;\r\n            transition:all .2s ease-in-out;\r\n\r\n            &:hover, .selected{\r\n                border:1px solid $primary;\r\n            }\r\n\r\n            .stream-status{ \r\n                color:white !important;\r\n                z-index:1000;\r\n                .status-user{\r\n                    padding: 0rem 0.5rem;\r\n                    padding-right:0;\r\n                }\r\n                .status-audio{\r\n                    color:white !important;\r\n                    cursor:pointer;\r\n                    padding:0;\r\n                    margin-bottom: -1.2rem;\r\n                    margin-top: -1.4rem;\r\n                    margin-left: -0.2rem;                    \r\n                }\r\n            }\r\n\r\n            video{\r\n                width:100%;\r\n                height:100%;\r\n                object-fit: cover;\r\n                margin-bottom: -4px;\r\n            }\r\n        }\r\n\r\n    `}</style>\r\n    </>;\r\n}","import { Helmet } from \"react-helmet\"\r\nimport toast, { Toaster } from 'react-hot-toast'\r\nimport { BrowserRouter as Router, Switch, Route, Redirect } from \"react-router-dom\"\r\n\r\nimport App from 'views/App'\r\nimport Verified from 'views/verified'\r\nimport ResetPass from 'views/resetpassword'\r\nimport AboutModal from 'components/modal_about'\r\nimport ProfileModal from 'components/modal_profile'\r\nimport FullScreenBTN from 'components/btn_fullscreen'\r\nimport Title from 'partials/title'\r\n\r\nimport 'bootstrap/dist/js/bootstrap.bundle.min.js';\r\nimport 'style.scss'\r\n\r\nimport RoomsContext  from 'utils/ctx_rooms'\r\nimport StreamContext from 'utils/ctx_streaming'\r\nimport MediaContext from 'utils/ctx_mediadevices'\r\nimport AuthContext  from 'utils/ctx_authentication'\r\n\r\nwindow.toast  = toast;\r\nconst error   = toast.error;   toast.error   = (message, options) => { console.trace(message); return   error(message, options); }\r\nconst success = toast.success; toast.success = (message, options) => { console.log(message);   return success(message, options); }\r\nconst loading = toast.loading; toast.loading = (message, options) => { console.log(message);   return loading(message, options); }\r\nconst custom  = toast.custom;  toast.custom  = (message, options) => { console.log(message);   return  custom(message, options); }\r\n\r\nexport default ({ children, ...props }) => {\r\n  return <div id=\"layout\" className=\"\" {...props}>\r\n    <Toaster\r\n      id=\"toaster\"\r\n      position=\"bottom-right\"\r\n      reverseOrder={true}\r\n      toastOptions={{\r\n        duration: 2000,\r\n        style: {\r\n          background: '#333',\r\n          color: '#fff',\r\n        },\r\n      }}\r\n    />\r\n    <Router basename={process.env.REACT_APP_BASE}>\r\n    <AuthContext>\r\n    <RoomsContext>\r\n    <MediaContext>\r\n    <StreamContext>\r\n    \r\n    <Helmet>\r\n      <title>{process.env.REACT_APP_NAME}</title>\r\n      <meta property=\"og:url\" content={process.env.REACT_APP_OG_URL} />\r\n      <meta property=\"og:type\" content={process.env.REACT_APP_OG_TYPE} />\r\n      <meta property=\"og:title\" content={process.env.REACT_APP_OG_TITLE} />\r\n      <meta property=\"og:description\" content={process.env.REACT_APP_OG_DESC} />\r\n      <meta property=\"og:image\" content={process.envREACT_APP_OG_IMAGE} />\r\n    </Helmet>\r\n\r\n    <Title/>\r\n\r\n    <div className=\"z-top d-flex m-2 position-absolute top-0 end-0\">\r\n      <ProfileModal />\r\n      <AboutModal />\r\n      <FullScreenBTN />\r\n    </div>\r\n\r\n    <Switch>\r\n        <Route component={App}       exact path={[\"/\", \"/settings\", \"/about\", \"/users\", \"/chat\", \"/profile\", \"/room/:roomId\", \"/room/:roomId/chat\", \"/room/:roomId/guests\"]} />\r\n        <Route component={Verified}  exact path=\"/verify/:token\"/>\r\n        <Route component={ResetPass} exact path=\"/reset-password/:token\"/>\r\n        <Route> <Redirect to='/'/> </Route>\r\n    </Switch>\r\n    \r\n    </StreamContext>\r\n    </MediaContext>\r\n    </RoomsContext>\r\n    </AuthContext>\r\n    </Router>\r\n\r\n    <style global jsx>{`\r\n      @import \"src/variables.scss\";\r\n\r\n      #layout {\r\n        text-align:center;\r\n        background:$background;\r\n      }  \r\n\r\n      #title {\r\n        color:$text;\r\n        filter: invert(.5) brightness(0.5);\r\n        mix-blend-mode: luminosity;\r\n      }\r\n\r\n      .z-top{\r\n        z-index:1000;\r\n      }\r\n      \r\n    `}</style>\r\n  </div>\r\n}","import React from 'react';\r\nimport { Modal, Button } from 'react-bootstrap';\r\n\r\nexport default ({title, children, show, setShow, callback, buttons, closeButton, ...props}) => {\r\n    return <>\r\n        <Modal\r\n            centered\r\n            show={show}\r\n            keyboard={true}\r\n            //backdrop={closeButton?\"\":\"static\"}\r\n            onHide={() => setShow(false)}\r\n            dialogClassName=\"modal-partial modal-shadow-lg\"\r\n            {...props}\r\n        >\r\n            {(closeButton && title) && <Modal.Header closeButton={closeButton} >\r\n                <Modal.Title className=\"user-select-none\">{title}</Modal.Title>\r\n            </Modal.Header>}\r\n            \r\n            <Modal.Body>\r\n                {children}\r\n            </Modal.Body>\r\n\r\n            { (buttons || closeButton) && <Modal.Footer>\r\n                {buttons && buttons.map( (v,k,a) => <div key={k}>{v}</div> )}\r\n                {closeButton && <Button variant=\"outline-secondary\" onClick={() => setShow(false)}> Close</Button>}\r\n            </Modal.Footer>} \r\n        </Modal>\r\n\r\n        <style global jsx>{`\r\n            @import 'src/variables.scss';\r\n\r\n            .modal-dialog{\r\n                max-height: calc(100vh - 1rem);\r\n            }\r\n            .modal-partial.modal-shadow-lg.modal-md.modal-dialog-centered:focus-visible {\r\n                outline: none;\r\n            }\r\n\r\n            .modal-partial {\r\n                .modal-title {\r\n                    font-weight: lighter;\r\n                    font-family: $header-font;\r\n\r\n                    h1,h2,h3,h4,h5,h6 {padding:0; margin:0}\r\n                }\r\n\r\n                .modal-header{\r\n                    padding-bottom: .2em;\r\n                }\r\n\r\n                .modal-footer{\r\n                    padding: 0 0.75rem;\r\n                }\r\n            }\r\n            \r\n\r\n            /* -----------------------------------------\r\n                Wearables\r\n            ----------------------------------------- */\r\n\r\n            /* ----------- Moto 360 Watch ----------- */\r\n            @media (max-device-width: 218px)and (max-device-height: 281px) { \r\n\r\n            }\r\n\r\n            /* ----------- Non-Retina Screens ----------- */\r\n            @media screen \r\n            and (min-device-width: 1200px) \r\n            and (max-device-width: 1600px) \r\n            and (-webkit-min-device-pixel-ratio: 1) { \r\n            }\r\n\r\n            /* ----------- Retina Screens ----------- */\r\n            @media screen \r\n            and (min-device-width: 1200px) \r\n            and (max-device-width: 1600px) \r\n            and (-webkit-min-device-pixel-ratio: 2)\r\n            and (min-resolution: 192dpi) { \r\n            }\r\n\r\n            /* Smartphones (landscape) ———– */\r\n            @media only screen\r\n            and (min-width : 321px) {\r\n            /* Styles */\r\n            }\r\n\r\n            /* Large Desktop and Laptop Screens (devices and browsers) */\r\n            @media only screen and (min-width: 1824px) {}\r\n\r\n            /* Tablet Devices, Desktop and Laptop Screens */\r\n            @media only screen and (max-width: 768px) {}\r\n\r\n            /* iPads (portrait and landscape) */\r\n            @media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {}\r\n\r\n            /* Smartphones (portrait and landscape) */\r\n            @media only screen and (min-device-width: 320px) and (max-device-width: 480px) {}\r\n\r\n            /* iPhone 4 */\r\n            @media only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen and (min-device-pixel-ratio: 1.5) {}\r\n\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {\r\n                .modal-content{\r\n                    //max-width: 38rem !important;\r\n                    //margin-right: 6.5rem !important;\r\n                }\r\n                .modal-md{\r\n                    max-width: 800px !important;\r\n                }\r\n                  /* Tablet Devices, Desktop and Laptop Screens */\r\n                @media only screen and (max-width: 674px) {\r\n                    .modal-dialog{\r\n                    //max-width: 38rem !important;\r\n                    margin-right: 6.5rem !important;\r\n                }\r\n                }\r\n            }\r\n            @media only screen and (orientation: portrait){\r\n\r\n            }      \r\n        `}</style>\r\n    </>;\r\n}","import {Button} from 'react-bootstrap'\r\nimport { useHistory } from 'react-router-dom'\r\n\r\nimport MD from 'utils/md';\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default ()=>{\r\n    const history = useHistory();\r\n    function onHide(){\r\n        history.push('/') \r\n    }\r\n    return <>\r\n        <Modal size=\"md\" show={true} \r\n            title={<h2 className=\"user-select-none\">User verified!🎉🎉</h2>}\r\n            closeButton\r\n            backdrop=\"static\"\r\n            onHide={ onHide }\r\n            buttons={[<Button onClick={onHide} >Return to Loggin</Button>]}\r\n        >\r\n            <MD className=\"user-select-none\">{`Account verified successfully in the system. You can now login on the application.`}</MD>\r\n        </Modal> \r\n    </>\r\n}","import toast from 'react-hot-toast'\r\nimport { useState, useEffect, useRef } from 'react'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport { Form, FloatingLabel, OverlayTrigger, Tooltip, Button} from 'react-bootstrap'\r\n\r\nimport http from 'utils/http'\r\nimport MD from 'utils/md'\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default ()=>{\r\n    let { token } = useParams();\r\n    const history = useHistory();\r\n\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated] = useState(undefined);\r\n    const [formvalues, setFormValues] = useState({formErrors:{}});\r\n\r\n    function handleUserInput (e) {\r\n        const name = e.target.name;\r\n        const value = e.target.value;\r\n        validateField(name, value);\r\n    }\r\n\r\n    function validateField(name, value){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(name){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                const pass_re =  /^[a-zA-Z]+(.){7,20}$/;\r\n                check = pass_re.test(value);\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default: console.warn(\"Invalid field name: \", name);\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n    \r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error?.length? '' : 'has-error');\r\n    }\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        const toastId = toast.loading('Resetting password...');\r\n        const password = formvalues.password;\r\n        await http.post(`${process.env.REACT_APP_API_URL}/reset-password/${token}`, {data:{password}})\r\n        .then( ({status, description, message }) => {\r\n            switch (status) {\r\n                case 'ok':\r\n                    toast.success('Success', {id: toastId});\r\n                    setTimeout( ()=>history.push(`/`), 1000);\r\n                    break;\r\n                case 400: toast.error(message, {id: toastId}); break;\r\n                case 'error': toast.error(description, {id: toastId}); break;\r\n                default: toast.warn(description, {id: toastId});\r\n            }\r\n        })\r\n        .catch(err => {\r\n            toast.error(`Error: ${err}`, {id: toastId});\r\n        });\r\n    }\r\n\r\n    return <>\r\n        <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n        <Modal closeButton show={true} \r\n            onHide={() => history.push(\"/\")} \r\n            title={<h2 className=\"user-select-none\">Reset password</h2>}\r\n            buttons={[\r\n                <OverlayTrigger placement=\"bottom\"\r\n                overlay={\r\n                    <Tooltip className={`${validated?\"d-none\":\"\"} mt-2`}  id={`tooltip-bottom`}>\r\n                        Check form errors\r\n                    </Tooltip>\r\n                }\r\n                >\r\n                    <Button type=\"submit\" disabled={!validated} > Proceed </Button>\r\n                </OverlayTrigger>\r\n            ]}\r\n        >\r\n            <MD className=\"user-select-none\">{ \"Please enter your new password.\"}</MD>\r\n            \r\n            <FloatingLabel controlId=\"floatingPassword\" label=\"New Password\">\r\n                <Form.Control required name=\"password\" type=\"password\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.password??\"\"}/>\r\n            </FloatingLabel>\r\n\r\n        </Modal> \r\n        </Form>\r\n    </>\r\n}","import React, {useEffect, useState, useReducer} from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\n\r\nexport default () => {\r\n    const [show, setShow] = useState(false);\r\n    const [proposal, dispatch] = useReducer((o,n)=>n, {proposalEvent : undefined});\r\n    useEffect(() => { \r\n            window.addEventListener('beforeinstallprompt',onBeforeInstallPrompt, 0);\r\n        return () => { \r\n            window.removeEventListener('beforeinstallprompt',onBeforeInstallPrompt, 0);\r\n        }\r\n    },[]);\r\n\r\n    function onBeforeInstallPrompt(e) \r\n    {\r\n        debugger;\r\n        e.preventDefault();\r\n        dispatch(state => ({...state, e}));\r\n    }\r\n\r\n    async function promptInstall()\r\n    {\r\n        if(!proposal?.proposalEvent) \r\n            return;\r\n\r\n        proposal.proposalEvent.prompt();\r\n        const { outcome } = await proposal.proposalEvent.userChoice;\r\n        if (outcome === 'accepted') {\r\n            dispatch(state => ({ ...state, proposalEvent: undefined }));\r\n        }\r\n    }\r\n\r\n    return <>\r\n        <Button variant=\"link\" onClick={ ()=>setShow(1) }>About</Button>\r\n        <Modal closeButton size=\"md\" {...{show, setShow}} title={<span>{process.env.REACT_APP_NAME} - Offline capable <Button variant={`${proposal.proposalEvent?\"outline-primary\":\"outline-secondary\"}`}size=\"sm\" onClick={promptInstall} disabled={!proposal.proposalEvent}> {`${proposal.proposalEvent? \"Install PWA\" : \"Not available\"}`}</Button></span>}>\r\n        <MD>{`\r\n        An offline-capable AdMiRe version is available, wich is a [Progressive Web App](https://docs.microsoft.com/en-us/microsoft-edge/progressive-web-apps-chromium/).\r\n\r\n        The app serves the following features:\r\n        - Offline-capable (with [Service Workers](https://developers.google.com/web/fundamentals/primers/service-workers/))\r\n        - \"Add to Home Screen\" feature on Android and iOS supported devices to launch the app from the home screen.\r\n        - Dark Mode.\r\n        - Privacy-focused - We don't collect any personal data.\r\n        - Lightweight - The app is only ~5MB.\r\n\r\n        Hope you liked using this app 😉\r\n\r\n        <div align=\"center\" className=\"fw-bolder\">Made with ❤️ by <a href=\"https://www.upf.edu/web/gti\"> UPF-GTI</a> </div>\r\n        `}</MD>\r\n        </Modal>\r\n    </>;\r\n}\r\n//<Button onClick={handleClick}>Install {import.meta.env.NAME}</Button>","import screenfull from 'screenfull'\r\nimport { Button } from 'react-bootstrap'\r\nimport { useState, useEffect } from 'react'\r\n\r\n\r\nexport default () => {  \r\n    let [state, setState] = useState(0);//eslint-disable-line\r\n\r\n    useEffect(()=>{\r\n        const f = () => setState(s => ++s);\r\n        screenfull.on('change', f);\r\n    return ()=>{\r\n        screenfull.off('change', f);\r\n    }},[])\r\n    \r\n    return <div id=\"btn_fullscreen\">\r\n        { screenfull.isEnabled && \r\n            <Button \r\n            onClick={screenfull.toggle} variant=\"link\"> \r\n                {  document.fullscreen && <i className=\"bi bi-fullscreen-exit\"/> }\r\n                { !document.fullscreen && <i className=\"bi bi-fullscreen\"/> }\r\n            </Button>    \r\n        }\r\n    </div>;\r\n}","import {useContext} from 'react'\r\nimport {Image} from 'react-bootstrap'\r\nimport logo from \"assets/img/logo.png\"\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\nexport default () => {\r\n    const rooms    = useContext(RoomsContext);\r\n\r\n    return <>\r\n        <div id=\"title\" variant=\"none\" className=\"d-flex m-3 position-absolute top-0 start-0 user-select-none\">\r\n            <Image className=\"me-2\" width={32} height={32} src={logo} />\r\n            <h1 className=\"fs-3\">{process.env.REACT_APP_NAME}</h1>\r\n            {rooms?.current && <h1 className=\"fs-3\">: #{rooms?.current?.name}</h1>}\r\n        </div>\r\n    </>\r\n}","function Nav({children}){\r\n\r\n    return <>\r\n\r\n        <div className=\"nav-partial px-3 mb-1 d-flex justify-content-evenly align-items-center position-absolute bottom-0 start-50 translate-middle-x shadow rounded-5 bg-light\" style={{ zIndex: 1100}}>\r\n            { children.map( (v,k) => v && <div key={'nav-i-'+k}>{v}</div>) }\r\n        </div>\r\n\r\n        <style global jsx>{`\r\n            @import \"node_modules/bootstrap/scss/_functions.scss\";\r\n            @import \"node_modules/bootstrap/scss/_variables.scss\";\r\n            @import \"src/variables.scss\";\r\n\r\n            .rounded-5{\r\n                border-radius: .5em;\r\n            }\r\n            .nav-partial{\r\n                min-width: 1rem;\r\n                min-height: 1rem;\r\n                transition: all .2s ease-in-out;\r\n            }\r\n            .nav-button, .nav-item{\r\n                color: $secondary;\r\n                cursor: pointer;\r\n                height: 100%;\r\n                width: auto;\r\n                user-select: none;\r\n                transition: all .2s ease-in-out;\r\n\r\n                & i{\r\n                    transform: scale(1.5);\r\n                    width: 50px;\r\n                    overflow: hidden;\r\n                    padding:0;\r\n                    margin:0;\r\n                    user-select: none;\r\n                    text-transform: capitalize;\r\n\r\n                }\r\n                &:hover{\r\n                    color:  lighten($danger,15%);\r\n                }\r\n            }\r\n\r\n            .nav-item{\r\n                height: 44px;\r\n            }\r\n\r\n            .nav-item-active{\r\n                color: red !important;\r\n            }\r\n\r\n            .nav-item-disabled{\r\n                opacity: .35;\r\n                user-select: none !important;\r\n                pointer-events:none;\r\n                cursor: not-allowed;\r\n                &:hover{\r\n                    opacity: .35;\r\n                }\r\n            }\r\n\r\n\r\n            .nav-button{\r\n                color: black !important;\r\n                height: 3.5rem;\r\n                width: 3.5rem;\r\n                line-height: 3rem;\r\n                margin-top: -1.5rem;\r\n                margin-bottom: 1.5rem;\r\n\r\n                &:hover{\r\n                    color:  lighten($danger,50%) !important;\r\n                }\r\n            }\r\n\r\n            .dark-mode{\r\n                &.navpartial, .nav-partial{\r\n                    background-color: transparent !important;\r\n                    border: 1px solid rgba(255,255,255, .25);\r\n\r\n                    .nav-item{\r\n                        color: invert($secondary,50%);\r\n                        &:hover{\r\n                            color:  lighten($danger,15%);\r\n                            filter: saturate(120%) drop-shadow(0 0 .1rem $danger);\r\n                        }\r\n                    }\r\n\r\n                    .nav-button{\r\n                        filter: saturate(80%);\r\n                        background: $color1 !important;\r\n                        line-height: 2.8rem;\r\n                        border: 2px solid $danger;\r\n                        color: $danger !important;\r\n\r\n                        &:hover{\r\n                            filter: saturate(120%) drop-shadow(0 0 .1rem $danger);\r\n                            color:  $danger !important;\r\n                            border: 2px solid $danger;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n                .nav-partial{\r\n                    flex-direction: column;\r\n                    //top: 50%;\r\n                    left: 100% !important;\r\n                    transform: translate(-100%, 0%) !important;\r\n                    margin-left: -1.1rem;\r\n                    padding:1.251rem 0 !important;\r\n\r\n                    .nav-button{\r\n                        margin:0;\r\n                        margin-left: -1.5rem;\r\n                        margin-right: 1.5rem;\r\n                    }\r\n                }\r\n            }\r\n            @media only screen and (orientation: portrait){\r\n\r\n            } \r\n        `}</style>\r\n    </>\r\n}\r\n\r\n\r\nNav.Item = function({children, icon, disabled, to, ...props}){\r\n    return <div to={to??\"/\"} className={`nav-item ${disabled?\"nav-item-disabled\":\"\"} ${props.appendclass??\"\"}`} {...props}>\r\n        <div className={`d-flex flex-column fs-6 fw-lighter`} >{children}</div>\r\n    </div>\r\n}\r\n\r\nNav.Button = function({children,...props}){\r\n    return <div className={`nav-button ${props.appendclass??\"\"}`} {...props}>\r\n        <div className=\" pt-1 fs-1 fw-lighter\">{children}</div>\r\n    </div>\r\n}\r\n\r\nexport default Nav;","import toast from 'react-hot-toast';\r\nimport {useState, useContext, useRef} from 'react'\r\nimport {Badge, Button, Form, FloatingLabel, Spinner} from 'react-bootstrap'\r\n\r\nimport Modal from 'partials/modal'\r\nimport { StreamContext } from 'utils/ctx_streaming'\r\n\r\n\r\nexport default ({callId, isForwardCall})=>{\r\n    const wrtc     = useContext(StreamContext);\r\n    const ref = useRef(null);\r\n    const [show, setShow] = useState(null);\r\n    const [fetching, setFetching] = useState(0);//0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n\r\n    let [mediaHubCallId, forwardedCallId] = wrtc.getLiveCall(callId); //eslint-disable-line\r\n    \r\nfunction submit() {\r\n\r\n        if ( !ref?.current || !show )\r\n            return setShow(false);\r\n\r\n        setFetching(true);            \r\n\r\n        const [forwardingCallId, mediaHubtarget] = [callId, ref.current.value];\r\n\r\n        function callback(response) {\r\n            const {callId, calleeId, callerId, status, description}=response;\r\n            if(status === \"error\")\r\n            {                \r\n                setFetching(3);           \r\n                setTimeout( () => { setFetching(0); } , 2000);\r\n                toast.error(`Mediahub Call response error: ${description}`, {duration: 5000});\r\n            }\r\n            else {\r\n                setFetching(2);   \r\n                setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n                //callback(callId, forwardingCallId);\r\n                wrtc.forwardCall(forwardingCallId, callId);\r\n            }\r\n        }\r\n\r\n        if(!wrtc.callUser(mediaHubtarget, callback))\r\n        {\r\n            setFetching(3);   \r\n            toast.error(`call missed to backend`);\r\n            setTimeout( () => { setFetching(0); } , 2000);\r\n        }\r\n    }\r\n\r\n    function onKeyDown(e){\r\n        if(e.keyCode === 13)\r\n        submit()\r\n    }\r\n\r\n    let button;\r\n    switch(fetching){\r\n        case 1:  button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2:  button = <Button variant=\"outline-success\" > ✔️ Succeed! </Button>; break;\r\n        case 3:  button = <Button variant=\"outline-danger\"  > ❌ Error </Button>; break;\r\n        default: button = <Button variant=\"outline-primary\" onClick={submit} >Proceed!</Button>;\r\n    }\r\n\r\n    return <>\r\n        {isForwardCall ? <Badge style={{padding:\".44em .45em\"}} pill bg=\"danger\" onClick={() => wrtc.callHangup( mediaHubCallId )}><i className=\"bi bi-x\"></i></Badge>\r\n        :                <Badge style={{padding:\".44em .45em\"}} pill bg=\"danger\" onClick={() => setShow( callId )} className=\"cursor-pointer\"><i className=\"bi bi-cast\"></i></Badge>}\r\n        <Modal {...{show,setShow}}  buttons={[button]}  closeButton title=\"Ready to forward?\" onKeyDown={onKeyDown}>\r\n            Enter the destination ID you want to forward to\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"targetId\" className=\"mb-3\">\r\n                <Form.Control ref={ref} name=\"targetId\" type=\"text\" placeholder=\"mediahub target id\"/>\r\n            </FloatingLabel>\r\n        </Modal>\r\n    </>;\r\n}\r\n\r\n//{ imMaster && (!isForwardCall && id !== roomInfo?.master && id !== user.id) && <Badge pill bg=\"danger\" onClick={() => setShowModal( callId )}><i class=\"bi bi-cast\"></i></Badge> }","//import { useEffect } from 'react';\r\nimport { useParams } from \"react-router-dom\"\r\nimport { Row, Col, Badge } from 'react-bootstrap'\r\nimport { useContext, useLayoutEffect, useEffect, useState, useRef } from 'react'\r\nimport * as BRA from 'lib_bra'\r\n\r\nimport Video from 'partials/video'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport { StreamContext } from 'utils/ctx_streaming'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport BadgeForwardCall from 'components/badge_forward'\r\n\r\n\r\nexport default function Room({ ...props }){\r\n    const {roomId}    = useParams();\r\n    const carouselRef = useRef();\r\n    const auth        = useContext(AuthContext);\r\n    const rooms       = useContext(RoomsContext);\r\n    const media       = useContext(MediaContext);\r\n    const wrtc        = useContext(StreamContext);\r\n    const [selected, setSelected] = useState(null);\r\n\r\n    useLayoutEffect(()=>{//Constructor\r\n        if(!rooms.imInRoom(roomId) || !rooms.ready || !media.ready) \r\n            return;\r\n\r\n        wrtc.callAllUsers();\r\n    return ()=>{//Destructor\r\n        wrtc.callHangupAll();\r\n    }},[rooms.ready, media.ready]);\r\n\r\n    useEffect( ()=>{\r\n        wrtc.replaceStream(media.localStream);\r\n    },[media.localStream]);\r\n\r\n    return <div id=\"room\" className=\"overflow-hidden m-auto\" style={{zIndex:1000}}>\r\n        <Row  id=\"content-row\" className=\"g-2\" style={{ height:\"100%\" }}>\r\n            <Col xs=\"auto\" id=\"carousel-col\" ref={carouselRef}>\r\n                <div id=\"carousel\" className=\"d-flex flex-column\" >\r\n                {  Object.entries({local:media.localStream, ...wrtc.streams}).map(([callId, stream], k)=>{\r\n\r\n                    let id = wrtc.getUserId(callId);\r\n                    let imMaster = auth.user.username === rooms.current?.master.username;\r\n                    let [mediaHubCallId, forwardedCallId] = wrtc.getLiveCall(callId); //eslint-disable-line\r\n                    let isForwardCall = !!forwardedCallId;\r\n                    let isMediahubCall = mediaHubCallId === callId;\r\n                    let isSelected = selected === callId || (!selected && k === 0);\r\n\r\n                    return <div key={k}>\r\n                        <div className=\"stream-forward\">\r\n                            { imMaster && <BadgeForwardCall callId={callId} isForwardCall={isForwardCall}/> }\r\n                            { isSelected && <Badge pill bg=\"primary\"><i className=\"bi bi-eye active\"/></Badge> }\r\n                        </div>\r\n                        {!isMediahubCall && <Video isLocal={id === auth.user.username} key={callId} id={id} stream={stream} className={!isSelected?\"cursor-pointer\":\"\"} onClick={()=>{setSelected(callId)}}/>}\r\n                    </div>\r\n                })}\r\n                </div>\r\n            </Col>\r\n            <Col id=\"main-col\">\r\n                <Video isLocal={wrtc.getUserId(selected) === auth.user.username} className=\"main-video\" id={wrtc.getUserId(selected)} stream={wrtc.streams[selected]??media.localStream} />\r\n            </Col>\r\n        </Row>\r\n\r\n        <style global jsx>{`\r\n            @import \"src/variables.scss\";\r\n\r\n            #room{\r\n                height:calc(100vh - 3rem - 4.5rem);\r\n\r\n                #main-col {\r\n                    height: 100%;\r\n                    overflow: hidden;\r\n\r\n                    .Video\r\n                    {\r\n                        width:100%;\r\n                        height:100%;\r\n                        object-fit: cover;\r\n                    }\r\n                }\r\n\r\n                #carousel-col {\r\n                    height: 100%;\r\n                    width:166px;\r\n                    overflow-x: hidden;\r\n                    overflow-y: scroll;\r\n\r\n                    #carousel{\r\n                        height:100%;\r\n                        .Video{\r\n                            padding-right: 1px;\r\n                            padding-bottom: 2px;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                .stream-forward{\r\n                    height:1.9rem;\r\n                    position:relative;\r\n                    margin-bottom:-1.9rem;\r\n                    text-align:left;\r\n                    padding:3px 6px;\r\n                    z-index:1000;\r\n                }\r\n\r\n                .stream-controls{\r\n                    margin-bottom: 5.5rem;\r\n                }\r\n            }\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n                #room{\r\n                    height:calc(100vh - 2rem);\r\n                }\r\n                \r\n                .stream-controls{\r\n                    margin-bottom: .5rem !important;\r\n                }\r\n        \r\n            }\r\n\r\n            @media only screen and (orientation: portrait){\r\n                .stream-controls{\r\n                    margin-bottom: 5.5rem !important;\r\n                }\r\n\r\n                #content-row{ flex-direction: column; }\r\n                #carousel-col{\r\n                    overflow-x: scroll;\r\n                    overflow-y: hidden;\r\n                    height: 126px !important;\r\n                    width: 100% !important;\r\n                    #carousel{\r\n                        flex-direction: row !important;\r\n                        border:none;\r\n                        .Video, .Video video{ \r\n                            width: 166px; \r\n                            height:124px; \r\n                            object-fit: cover;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </div>;\r\n}\r\n\r\n","import React, {useState, useContext, useEffect, useRef  } from 'react';\r\nimport { Button, Form, FloatingLabel, OverlayTrigger, Tooltip } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport toast from 'react-hot-toast';\r\nimport http from 'utils/http'\r\n\r\nexport default () => {\r\n    const formRef = useRef(null);\r\n    const [show, setShow] = useState(false);\r\n    const auth = useContext(AuthContext);\r\n\r\n    const [formvalues, setFormValues] = useState({formErrors:{}});\r\n    const [validated, setValidated] = useState(undefined);\r\n   \r\n    function handleUserInput (e) {\r\n        const name = e.target.name;\r\n        const value = e.target.value;\r\n        validateField(name, value);\r\n    }\r\n\r\n    function validateField(name, value){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(name){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default: console.warn(\"Invalid field name: \", name);\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n\r\n\r\n    useEffect(()=>{\r\n        function validateForm(){\r\n            let isValid = true;\r\n            for( let key in formvalues ){\r\n                if( key.indexOf('_check') !== -1 )\r\n                    isValid &= formvalues[key];\r\n            }\r\n            setValidated( isValid?true:false );\r\n        }\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        const email = formvalues.email.toLowerCase();\r\n        const toastId = toast.loading('Resetting password...');\r\n        debugger;\r\n        await http.post(`${process.env.REACT_APP_API_URL}/forgot-password`, { data: {email} })\r\n        .then(({error, message, status}) => {\r\n            if (error) {\r\n                return toast.error(`onSubmitRecovery: ${message}`, { id: toastId });\r\n            }\r\n            setShow(false);\r\n            toast.success('Success', { id: toastId });\r\n        })\r\n        .catch(err => {\r\n            toast.error(`onSubmitRecovery: ${err}`, { id: toastId });\r\n        });\r\n    }\r\n\r\n    function hasError(error){\r\n        if(!error) return \"\";\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n    const button =  <OverlayTrigger placement=\"bottom\"\r\n    overlay={\r\n        <Tooltip className={`${validated?\"d-none\":\"\"}`}  id={`tooltip-bottom`}>\r\n            {Object.entries(formvalues.formErrors).map(([key, value]) => { return <span>{key}: {value}</span> }) }\r\n        </Tooltip>\r\n    }\r\n    >\r\n        <span style={{padding:\"10px 0\"}}>\r\n            <Button type=\"submit\" onClick={handleSubmit} disabled={!validated && auth.isConnected} > Send password reset email </Button>\r\n        </span>\r\n    </OverlayTrigger>\r\n\r\n    return <>\r\n        <Button size=\"sm\" className=\"mt-4\" variant=\"link\" onClick={ ()=>setShow(1) }><i className=\"bi bi-lock\"></i>Forgot password?</Button>\r\n        <Modal size=\"md\" closeButton {...{show, setShow}} \r\n        buttons={[button]} \r\n        title={<h2 className=\"user-select-none\">Forgot Password</h2>} \r\n        >\r\n            <MD className=\"user-select-none\">{`Enter your email adress, on a couple of minutes you will receive an email with a link to reset your password.`}</MD>\r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingInput\" label=\"Email address\" className=\"mb-3\">\r\n                    <Form.Control required className={ hasError(formvalues.formErrors?.email)} name=\"email\" type=\"email\" placeholder=\" \" onChange={handleUserInput} />\r\n                </FloatingLabel>\r\n            </Form>\r\n        </Modal>\r\n    </>;\r\n}","import Gravatar from 'gravatar'\r\nimport toast from 'react-hot-toast'\r\nimport React, {useState, useEffect, useRef  } from 'react'\r\nimport { Spinner, Button, Form, FloatingLabel, OverlayTrigger, Tooltip, Card, Image as ReactImage } from 'react-bootstrap'\r\n\r\nimport MD from 'utils/md';\r\nimport http from 'utils/http'\r\nimport Modal from 'partials/modal'\r\nimport profile_img from 'assets/img/profile_light.png'\r\n\r\n\r\nexport default () => {\r\n    const formRef = useRef(null);\r\n    const [show, setShow] = useState(false);\r\n\r\n    const [fetching, setFetching]       = useState(false);\r\n    const [validated, setValidated]     = useState(undefined);\r\n    const [formvalues, setFormValues]   = useState({formErrors:{}});\r\n   \r\n    function handleUserInput (e) {\r\n        const name  = e.target.name;\r\n        const type  = e.target.type;\r\n        const value = type===\"checkbox\"?e.target.checked:e.target.value;\r\n        validateField(name, value, type);\r\n    }\r\n\r\n    function validateField(name, value, type = \"any\"){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n        let values = {...formvalues};\r\n\r\n        function testImage(url, timeoutT) {\r\n            return new Promise(function (resolve, reject) {\r\n                var timeout = timeoutT || 5000;\r\n                var timer, img = new Image();\r\n                img.onerror = img.onabort = function () {\r\n                    clearTimeout(timer);\r\n                    reject(\"Error: the url provided is not an image\");\r\n                };\r\n                img.onload = function () {\r\n                    clearTimeout(timer);\r\n                    resolve(\"success\");\r\n                };\r\n                timer = setTimeout(function () {\r\n                    // reset .src to invalid URL so it stops previous\r\n                    // loading, but doesn't trigger new load\r\n                    img.src = \"//!!!!/test.jpg\";\r\n                    reject(\"timeout\");\r\n                }, timeout);\r\n                img.src = url;\r\n            });\r\n        }\r\n\r\n        switch(type){\r\n            case 'email':\r\n                const email_re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = email_re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                values = { ...values, [name]:value, [`${name}_check`]:check, formErrors };\r\n                if(check){\r\n                    const url = \"https:\"+Gravatar.url(value, { s: '256', r: 'pg', d: '404' });\r\n                    testImage(url, 2000)\r\n                    .then( (v) => { \r\n                        setFormValues( { ...values, gravatar:url,  [`gravatar_check`]:check, formErrors } );\r\n                    })\r\n                    .catch((err) => {\r\n                        setFormValues( { ...values, gravatar:null,  [`gravatar_check`]:check, formErrors } );\r\n                    });\r\n                }else{\r\n                    values = { ...values, gravatar:null,  [`gravatar_check`]:check, formErrors };\r\n                }\r\n\r\n                break;\r\n\r\n            case 'password':\r\n                const pass_re =  /^[a-zA-Z]+(.){7,20}$/;\r\n                check = pass_re.test(value);\r\n                formErrors[name] = check ? '': ' is too short';\r\n\r\n                let confirm = formvalues[\"password\"] === formvalues[\"password1\"];\r\n                formErrors = {...formErrors, confirm: `${!confirm?\"Password and confirmation do not match\":\"\"}`};\r\n                values = {...values, confirm, formErrors };\r\n                break;\r\n\r\n            default:\r\n                check = true;\r\n                formErrors[name] = '';\r\n                break;\r\n        }\r\n        setFormValues( { ...values, [name]:value, [`${name}_check`]:check, formErrors } );\r\n    }\r\n\r\n\r\n\r\n\r\n    useEffect(()=>{\r\n        function validateForm(){\r\n            let isValid = true;\r\n            for( let key in formvalues ){\r\n                if( key.indexOf('_check') !== -1 )\r\n                    isValid &= formvalues[key];\r\n            }\r\n            setValidated( isValid?true:false );\r\n        }\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        let {username, email, password, avatar, gravatar, name, surname, birthdate, role} = formvalues;\r\n        avatar = avatar?.length? avatar : gravatar??profile_img;\r\n        const toastId = toast.loading('Registering...');\r\n        \r\n        await http.post(`${process.env.REACT_APP_API_URL}/register`, {data:{ username, email, password, avatar, name, surname, birthdate, role }})\r\n        .then(({ error, message, status }) => {\r\n            if(error){\r\n                return toast.error(`onRegister: ${message}`, { id: toastId });\r\n            }\r\n            toast.success('Success', { id: toastId });\r\n            setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n        })\r\n        .catch(err => {\r\n            toast.error(`Error: ${err}`, { id: toastId });\r\n        });\r\n    }\r\n\r\n    function hasError(error){\r\n        return(error?.length ? '' : 'has-error');\r\n    }\r\n\r\n    //onClick={submit}\r\n\r\n    let button = <Button onClick={handleSubmit} type=\"submit\" disabled={!validated} variant={validated?\"outline-primary\":\"outline-secondary\"}  >CREATE ACCOUNT!</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" > ✔️ Succeed! </Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\"  > ❌ Error </Button>; break;\r\n        default: break;\r\n    }\r\n\r\n    console.log(JSON.stringify(formvalues.formErrors));\r\n    return <>\r\n        <Card.Footer className=\"text-center user-select-none\" onClick={ ()=>setShow(1) }> Create an account </Card.Footer>\r\n        <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n        <Modal className=\"py-4\" closeButton {...{show, setShow}} \r\n        title={<h2 className=\"user-select-none\">Let's create your account</h2>}\r\n        backdrop=\"static\"\r\n        buttons={[\r\n            <OverlayTrigger placement=\"top\"\r\n            overlay={\r\n                <Tooltip className={`${validated?\"d-none\":\"\"}`}  id={`tooltip-top`}>\r\n                    {Object.entries(formvalues.formErrors).map(([key, value], k) => { return value.length?<p key={k}>{key}: {value}</p>:\"\" }) }\r\n                </Tooltip>\r\n            }>\r\n            <div>\r\n                {button}\r\n            </div>\r\n            </OverlayTrigger>\r\n        ]}\r\n        >\r\n            <ReactImage\r\n                id=\"avatar-img\"\r\n                src={formvalues.avatar ?? formvalues.gravatar ?? profile_img}\r\n                roundedCircle\r\n                className='position-absolute top-0 start-50 bg-danger shadow'\r\n                width=\"128\" height=\"128\"\r\n            />\r\n\r\n            <MD className=\"user-select-none\">{`Create your account. It's free and only takes a minute.`}</MD>\r\n\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"username\">     <Form.Control name='username'   className={ hasError(formvalues.formErrors?.username)}  placeholder='username'   onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['username'  ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"email\">        <Form.Control name='email'      className={ hasError(formvalues.formErrors?.email)}     placeholder='email'      onChange={handleUserInput} type=\"email\"     defaultValue={formvalues['email'     ]}     />      </FloatingLabel>} />{/*value={userEmail} onChange={event => setEmail(event.target.value)} isInvalid={!isEmailValid} /> */}\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"password\">     <Form.Control name='password'   className={ hasError(formvalues.formErrors?.password)}  placeholder='password'   onChange={handleUserInput} type=\"password\"  defaultValue={formvalues['password'  ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"confirm password\"> <Form.Control name='password2'  className={ hasError(formvalues.formErrors?.password2)} placeholder='password2'  onChange={handleUserInput} type=\"password\"  defaultValue={formvalues['password2'  ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"avatar URL\">   <Form.Control name='avatar'     className={ hasError(formvalues.formErrors?.avatar)}    placeholder='avatar URL' onChange={handleUserInput} type=\"avatar\"    defaultValue={formvalues['avatar URL']}     />      </FloatingLabel>} />{/*value={image_url !== '' ? image_url : userEmail !== '' ? gravatar_url : ''} onChange={event => setImageURL(event.target.value)} */}\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"name\">         <Form.Control name='name'       className={ hasError(formvalues.formErrors?.name)}      placeholder='name'       onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['name'      ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"surname\">      <Form.Control name='surname'    className={ hasError(formvalues.formErrors?.surname)}   placeholder='surname'    onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['surname'   ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"birthddate\">   <Form.Control name='birthdate'  className={ hasError(formvalues.formErrors?.birthdate)} placeholder='birthdate'  onChange={handleUserInput} type=\"date\"      defaultValue={formvalues['birthdate' ]}     />      </FloatingLabel>} />\r\n            \r\n            <div className=\"form-floating\">\r\n                <select className=\"form-select\" id=\"floatingSelect\" aria-label=\"Floating label select example\">\r\n                    <option value=\"0\">User</option>\r\n                    <option value=\"1\">Admin</option>\r\n                </select>\r\n                <label htmlFor=\"floatingSelect\"> User role</label>\r\n            </div>\r\n        </Modal>\r\n        </Form>\r\n        <style global jsx>{`\r\n            #avatar-img{\r\n                transform: translate(-50%,-125%) !important;\r\n            }\r\n        `}</style>\r\n    </>;\r\n}","//https://learnetto.com/blog/react-form-validation\r\n\r\nimport { useContext, useRef, useState, useEffect } from 'react';\r\nimport { Row, Col, Card,Form, FloatingLabel, Button, Spinner, OverlayTrigger, Tooltip } from \"react-bootstrap\"\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport RecoveryModal from 'components/modal_recovery'\r\nimport RegisterModal from 'components/modal_register'\r\nimport logo from 'assets/img/logo.png';\r\nimport toast from 'react-hot-toast';\r\nimport cookies from '@h3r/cookies'\r\nimport * as BRA from 'lib_bra'\r\n\r\nexport default () => {\r\n    const auth = useContext(AuthContext);\r\n\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated] = useState(undefined);\r\n    const [formvalues, setFormValues] = useState({formErrors:{}, email: cookies.get(\"admire_app_email\"), remember: !!cookies.get(\"admire_app_email\")});\r\n    const [fetching, setFetching] = useState(false);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        setFetching(true);\r\n        auth.login(formvalues.email, formvalues.password)\r\n        .then(  app_token => {\r\n            setFetching(false);\r\n            if(formvalues.remember){\r\n                cookies.set('admire_app_token', app_token, process.env.REACT_APP_COOKIES_EXPIRE_TIME);\r\n                cookies.set(\"admire_app_email\", formvalues.email, process.env.REACT_APP_COOKIES_EXPIRE_TIME);\r\n            }\r\n        })\r\n        .catch( err => {\r\n            setFetching(false);\r\n        })\r\n        ;\r\n    }\r\n\r\n    function handleUserInput (e) {\r\n        const name  = e.target.name;\r\n        const type  = e.target.type;\r\n        const value = type===\"checkbox\"?e.target.checked:e.target.value;\r\n\r\n        validateField(name, value, type);\r\n    }\r\n\r\n    function validateField(name, value, type = \"any\"){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(type){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default:\r\n                check = true;\r\n                formErrors[name] = '';\r\n                break;\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n    \r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n\r\n    return <>\r\n    <Card id=\"login\" bg=\"light\" className=\"flex-column text-center position-absolute start-50 top-50 translate-middle\" style={{ width: '24rem' }}>\r\n\r\n        <Col>\r\n            <Card.Img variant=\"top\" className=\"mt-4 user-select-none\" src={logo}/>\r\n            <h1 className=\"text-start ps-4 mb-0 mt-3 user-select-none\">{process.env.REACT_APP_NAME}</h1>\r\n            <div className=\"divider\"><span/></div>\r\n        </Col>\r\n\r\n        <Col>\r\n            <Card.Body as={Col} className=\"text-start px-4 pb-4\">\r\n\r\n            <Card.Text className=\"user-select-none\">Enter your e-mail adress and your password.</Card.Text>\r\n            \r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingInput\" label=\"Email address\" className=\"mb-3\">\r\n                    <Form.Control required name=\"email\" type=\"email\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.email??\" \"}/>\r\n                </FloatingLabel>\r\n                <FloatingLabel controlId=\"floatingPassword\" label=\"Password\">\r\n                    <Form.Control required name=\"password\" type=\"password\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.password??\"\"}/>\r\n                </FloatingLabel>\r\n\r\n                <Form.Switch id=\"remember-switch\" label=\"Remember me\" className=\"user-select-none\" name=\"remember\" onChange={handleUserInput} defaultChecked={formvalues.remember??false}/>\r\n\r\n\r\n                <OverlayTrigger placement=\"bottom\"\r\n                    overlay={\r\n                        <Tooltip className={`${validated?\"d-none\":\"\"} mt-2`}  id={`tooltip-bottom`}>\r\n                            Check form errors\r\n                        </Tooltip>\r\n                    }\r\n                    >\r\n                        <span style={{padding:\"10px 0\"}}>\r\n                            <Button size=\"sm\" className=\"mt-4\" type=\"submit\" disabled={!(validated && !fetching)} > \r\n                                {!fetching?\r\n                                <><i className=\"bi bi-box-arrow-in-left\"/> Log me in </>\r\n                                : <><Spinner as=\"span\"animation=\"grow\" size=\"sm\" role=\"status\" aria-hidden=\"true\"/> Logging in... </>\r\n                            }</Button>\r\n                        </span>\r\n                    </OverlayTrigger>\r\n                    \r\n                <RecoveryModal/>\r\n            </Form>\r\n\r\n\r\n            </Card.Body>\r\n            <RegisterModal/>\r\n        </Col>\r\n    </Card>\r\n\r\n    <style global jsx>{`\r\n        @import \"src/variables.scss\";\r\n        .divider {\r\n                border-bottom: 1px solid #FFF;\r\n                background-color: #DADADA;\r\n                height: 2px;\r\n                margin: 0.5em 0px 1.5em;\r\n\r\n                & span{\r\n                    position:relative;\r\n                    display: block;\r\n                    width: 75px;\r\n                    height: 3px;\r\n                    background-color: $color4;\r\n                    transform:translatey(-25%);\r\n                    left: 6%;\r\n                }\r\n        }\r\n\r\n        #login{\r\n            max-height: calc(100vh- 1rem);\r\n            border:none;\r\n            img {\r\n                width: 192px;\r\n                filter: \r\n                    hue-rotate(260deg)\r\n                ;\r\n            }\r\n\r\n            .card-footer{\r\n                color:$text;\r\n                background:$color4;\r\n                transition: all 0.1s ease-in-out; \r\n                &:hover{\r\n                    background:darken($color4, 10%);\r\n                    font-weight:bold;\r\n                    cursor:pointer;\r\n                }\r\n            }\r\n        } \r\n\r\n        @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n            #login{\r\n                width: 40rem !important;\r\n                flex-direction: row !important;\r\n                .col{\r\n                    align-self: end;\r\n                }\r\n            }\r\n        }\r\n        @media only screen and (orientation: portrait){\r\n\r\n        }    \r\n    `}</style>\r\n    </>;\r\n}\r\n","import toast from 'react-hot-toast'\r\nimport React, {useContext, useRef, useEffect, useState} from 'react'\r\nimport { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\n\r\nimport MD from 'utils/md'\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const ref                     = useRef(null);\r\n    const [show, setShow]         = useState(false);\r\n    const [isValid, setValid]     = useState(true);//eslint-disable-line\r\n    const [fetching, setFetching] = useState(0);               //0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n    useEffect(()=>{\r\n        function onKeyDown(e) {\r\n            if (e.keyCode === 13) {\r\n                setShow(true);\r\n            }\r\n        }\r\n            window.addEventListener('keydown', onKeyDown);\r\n        return ()=>{\r\n            window.removeEventListener('keydown', onKeyDown);\r\n        }\r\n    },[])\r\n\r\n    function submit() {\r\n        if ( !ref?.current || !show ) return;\r\n            \r\n        let [roomname, password, icon, hidden] = Array.from(ref.current.elements).map(v => v.value);\r\n        \r\n        rooms.createRoom(roomname.toLowerCase(), {password, icon, hidden})\r\n        .then( room =>{\r\n            toast.success(`Created room ${room.name}`); \r\n            setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n            setFetching(2);   \r\n        }) \r\n        .catch( err =>{\r\n            toast.error(`onCreateRoom: ${err}`); \r\n            setFetching(3);   \r\n            setTimeout( () => { setFetching(0); } , 1000);\r\n        }) \r\n    }\r\n\r\n    function handleUserInput(e){\r\n        //setValid(ref?.current?.value.length > 3);\r\n    }\r\n\r\n    let button = <Button disabled={!isValid} variant={isValid?\"outline-primary\":\"outline-secondary\"} onClick={submit} >Proceed!</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" > ✔️ Succeed! </Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\"  > ❌ Error </Button>; break;\r\n        default: break;\r\n    }\r\n\r\n\r\n    return <>\r\n        <Nav.Button onClick={()=>setShow(1)} label=\"Create room\" appendclass=\"shadow rounded-circle bg-danger\" >\r\n            <i className=\"bi bi-plus-lg\"></i> \r\n        </Nav.Button>\r\n        \r\n        <Modal size=\"sm\" onKeyDown={ (e)=> (e.keyCode === 13) && submit() } tabIndex=\"0\" buttons={[button]} closeButton {...{show, setShow}} title={<span>Let's create a room</span>}>\r\n        <MD>{``}</MD>\r\n        <Form ref={ref}>\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"roomId\" className=\"mb-3\">\r\n                <Form.Control onChange={handleUserInput} required name=\"roomId\" type=\"text\" placeholder=\"roomId\"/>\r\n            </FloatingLabel>\r\n\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"password\" className=\"mb-3\">\r\n                <Form.Control name=\"password\" type=\"password\" placeholder=\"password\"/>\r\n            </FloatingLabel>\r\n\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"icon\" className=\"mb-3\">\r\n                <Form.Control name=\"icon\" type=\"text\" placeholder=\"icon URL\"/>\r\n            </FloatingLabel>\r\n\r\n            <Form.Switch id=\"hidden-switch\" label=\"Hidden\" name=\"hidden\" defaultValue={false}/>\r\n        </Form>\r\n        </Modal>\r\n        <style global jsx>{`\r\n            #new-room-card {\r\n                cursor: pointer;\r\n                opacity: .5;\r\n                border: 2px dashed white;\r\n\r\n                .card-img-top{\r\n                    display: none;\r\n                }\r\n                .card-body{\r\n                    height: 155px;\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </>;\r\n}","export default __webpack_public_path__ + \"static/media/TeenyiconsPasswordOutline.ab4b0486.svg\";","import toast from 'react-hot-toast'\r\nimport React, {useContext, useRef, useEffect, useState} from 'react'\r\nimport { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\n\r\nimport MD from 'utils/md'\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\n\r\nexport default ({show, setShow, onSubmit, ...props}) => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const ref                     = useRef(null);\r\n    const [isValid, setValid]     = useState(true);//eslint-disable-line\r\n    const [fetching, setFetching] = useState(0);               //0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n    useEffect(()=>{\r\n        function onKeyDown(e) {\r\n            if (e.keyCode === 13) {\r\n                setShow(true);\r\n            }\r\n        }\r\n            window.addEventListener('keydown', onKeyDown);\r\n        return ()=>{\r\n            window.removeEventListener('keydown', onKeyDown);\r\n        }\r\n    },[])\r\n\r\n    function submit() {\r\n        if ( !ref?.current || !show ) return;\r\n        let [password] = Array.from(ref.current.elements).map(v => v.value);\r\n\r\n        onSubmit(password)\r\n        .then( () => setShow(false) )\r\n        .catch( () => setFetching(3) )\r\n        .finally( () => {\r\n            setTimeout( () => setFetching(0), 1000);\r\n        })\r\n    }\r\n\r\n    let button = <Button disabled={!isValid} variant={isValid?\"outline-primary\":\"outline-secondary\"} onClick={submit} >Proceed!</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" > ✔️ Succeed! </Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\"  > ❌ Error </Button>; break;\r\n        default: break;\r\n    }\r\n    debugger\r\n\r\n    return <>       \r\n        \r\n        <Modal className=\"py-4\" closeButton {...{show, setShow}} >\r\n        <MD>{``}</MD>\r\n        <Form ref={ref}>\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"password\" className=\"mb-3\">\r\n                <Form.Control name=\"password\" type=\"password\" placeholder=\"password\"/>\r\n            </FloatingLabel>\r\n        </Form>\r\n        </Modal>\r\n        <style global jsx>{`\r\n            #new-room-card {\r\n                cursor: pointer;\r\n                opacity: .5;\r\n                border: 2px dashed white;\r\n\r\n                .card-img-top{\r\n                    display: none;\r\n                }\r\n                .card-body{\r\n                    height: 155px;\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </>;\r\n}","import { useContext, useEffect, useState } from 'react'\r\nimport {useHistory} from 'react-router-dom'\r\nimport {Row, Col, Card, Badge, Button, Form, FloatingLabel, Spinner} from 'react-bootstrap'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport CreateRoomModal from 'components/modal_create_room'\r\nimport lock from 'assets/img/TeenyiconsPasswordOutline.svg'\r\nimport RoomPasswordModal from 'components/modal_room_password'\r\n\r\n\r\nfunction RoomTile({id, name,icon, hidden, master, users, secured, ...props}){\r\n    const [show, setShow] = useState(false);\r\n    const rooms = useContext(RoomsContext);\r\n\r\n    function handleClick(){\r\n        if(secured){\r\n            setShow(true);\r\n        }\r\n        else\r\n            submit();\r\n    }\r\n    function submit(password){\r\n        return rooms.joinRoom(name, password)\r\n    }\r\n\r\n    if(hidden){\r\n        return <></>\r\n    }\r\n\r\n    console.log(show);\r\n    window.setShow = setShow;\r\n    return <div onClick={handleClick}>\r\n    \r\n        <Card className=\"bg-dark text-light\" {...props}>\r\n            <Card.Img variant=\"top\" src={icon} />\r\n            <Badge style={{padding:\".44em .25em .44em .45em\", margin:\".25rem\"}} bg=\"white\" className=\"position-absolute end-0 top-0\" pill><img width=\"18\" src={lock} style={{filter:\"invert(.5)\"}}/></Badge>\r\n            <Card.Body>\r\n            <Card.Title>#{name}</Card.Title>\r\n            {/*<Card.Text></Card.Text>*/}\r\n            </Card.Body>\r\n        </Card>\r\n        <RoomPasswordModal \r\n            show={show}\r\n            setShow = { setShow } \r\n            onSubmit={submit}\r\n        />\r\n\r\n        <style global jsx>{`\r\n            @import 'src/variables.scss';\r\n\r\n            .card {\r\n                cursor: pointer;\r\n                user-select: none;\r\n                transition: all 0.075s ease-in-out;\r\n\r\n                &:hover {\r\n                    .card-body{\r\n                        background: lighten($dark,25%);\r\n                    }\r\n                        \r\n                    box-shadow: 0 0 0px 2px rgba(255, 255, 255, .5) !important;\r\n                }\r\n\r\n                .card-body{\r\n                    transition: all 0.075s ease-in-out;\r\n                    .card-title{\r\n                        margin:0;\r\n                        font-size: 1rem;\r\n                        white-space: nowrap;\r\n                    }\r\n                }\r\n\r\n                .card-img-top{\r\n                    width: 100%;\r\n                    height: 100px;\r\n                    object-fit: cover;\r\n                }\r\n            }\r\n        `}</style>\r\n    </div>\r\n}\r\n\r\nfunction onKeyPress(){\r\n}\r\n\r\nexport default ()=>{\r\n    const history = useHistory();\r\n    const rooms = useContext(RoomsContext);\r\n\r\n    useEffect( ()=>{\r\n\r\n    }, [rooms.list])\r\n\r\n\r\n    return <>\r\n        <Row onKeyPress={onKeyPress} id=\"lobby\" className=\"h-100 m-auto\">\r\n            <Col xs={12} sm={{span:10, offset:1}} >\r\n        \r\n            <h1 className=\"text-light\">Lobby</h1>    \r\n            <Row xs={2} sm={4} lg={4} xl={5} className=\"g-4\">\r\n            { [...Object.values(rooms.list)].map((v,k) => <Col key={k}>\r\n                    <RoomTile /*name={` ${v?.name || 'Room '+k}`}*/ {...v} />\r\n                </Col>\r\n            )}\r\n            </Row>\r\n\r\n            </Col>\r\n        </Row>\r\n        <style global jsx>{`\r\n            #lobby{\r\n                min-height: 19rem;\r\n            }    \r\n        `}</style>\r\n    </>\r\n}\r\n//{name:'room test'},{name:'low coverage'},{name:'volcano'},{name:'ecogreen'},{name:'weathercast'},...","import { useState, useEffect } from 'react'\r\nimport { Row, Col } from 'react-bootstrap'\r\nimport MD from 'utils/md'\r\nimport Gesture from 'rc-gesture'\r\nimport { findByDisplayValue } from '.pnpm/@testing-library+dom@8.10.1/node_modules/@testing-library/dom'\r\nimport Modal from 'partials/modal'\r\n\r\nexport default ({show, setShow, ...props}) => {\r\n    const pages = [\"Devices\",\"Battery\", \"Pose\", \"Shader\"];\r\n    const [selected, setSelected] = useState(0);\r\n    const [page, setPage] = useState(null);\r\n    const [views, setViews] = useState([]);\r\n\r\n    //use useEffect to fetch page views dynamically\r\n    useEffect(() => {\r\n        (async () => {\r\n            let vs = [];\r\n            for (let p of pages)\r\n                await import(`pages/${p}.jsx`).then(v => vs.push(<v.default />))\r\n            setViews([...vs]);\r\n            setPage(vs[selected]);\r\n        })();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        setPage(views[selected]);\r\n    }, [selected]);\r\n\r\n    function onKeyPressed(e)\r\n    {\r\n        switch(e?.keyCode)\r\n        {\r\n            case 37: return setSelected( s => (s-1 < 0)? pages.length-1 : s-1 );\r\n            case 39: return setSelected( s => (s+1)%pages.length );\r\n        }\r\n    }\r\n\r\n    useEffect(()=>{\r\n            document.addEventListener(\"keydown\", onKeyPressed)\r\n        return ()=>{\r\n            document.removeEventListener(\"keydown\", onKeyPressed)\r\n        }\r\n    }, [])\r\n\r\n    return <div>\r\n        <Gesture\r\n            onSwipeLeft={ () => setSelected( s => (s+1)%pages.length ) } \r\n            onSwipeRight={() => setSelected( s => (s-1 < 0)? pages.length-1 : s-1 ) }\r\n            \r\n        >\r\n            {/*\r\n            <Row id=\"wizard\" className=\"pt-5 h-100 m-auto\">\r\n                <Col sm={12} md={{ span: 10, offset: 1 }} lg={{ span: 8, offset: 2 }} xl={{ span: 6, offset: 3 }} className=\"pt-3 bg-light shadow-lg rounded-bottom\" style={{zIndex:1000}}>\r\n            */}\r\n                <div>\r\n                    <ul className=\"nav nav-tabs justify-content-start mb-2\">\r\n                    { pages.map( (v,k) => <li key={k} className=\"nav-item\">\r\n                            <div className={`nav-link ${selected === k?\"active\":\"\"}`} onClick={()=>setSelected(k)}>{v}</div>  \r\n                    </li>)}\r\n                </ul>\r\n\r\n                {page}\r\n                </div>\r\n            {/*\r\n                </Col>\r\n            </Row>\r\n            */}\r\n        </Gesture>\r\n        <style global jsx>{`\r\n            #wizard{\r\n                .nav-tabs{\r\n                    width: calc(100% + 24px);\r\n                    margin-left: -12px;\r\n                    margin-top: -3.6rem;\r\n                    //margin-top: -1rem;\r\n                }\r\n\r\n                .modal-content{\r\n                    margin-top: 1.5rem;\r\n                    max-height: calc( 100 - 4rem );                \r\n                }\r\n            }    \r\n        `}</style>\r\n    </div>;\r\n}\r\n\r\n//xs={12} md={{span:6, offset:3}} lg={{span:8, offset:2}}","import React, {useContext, useState} from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport Nav from 'partials/nav'\r\nimport MD from 'utils/md';\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms = useContext(RoomsContext);\r\n    const [show, setShow] = useState(false);\r\n\r\n    \r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(1)} label=\"Leave room\" >\r\n            <i className=\"bi bi-telephone-x\"></i>Leave\r\n        </Nav.Item>\r\n        <Modal buttons={[<Button size=\"lg\" onClick={()=>rooms.leaveRoom()}>Yes, leave</Button>]} closeButton size=\"md\" {...{show, setShow}} title={<span>Hey! Are you sure?</span>}>\r\n            \r\n            <MD>{`\r\n            Are you sure you want to leave this room? Any call in progress will be lost and any active stream will be stopped.\r\n            `}</MD>\r\n            \r\n        </Modal>\r\n    </>;\r\n}","import { useState } from 'react'\r\n\r\nimport Nav from 'partials/nav'\r\nimport Wizard from 'views/wizard'\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default () => {\r\n    const [show, setShow]         = useState(false);\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} ><i className=\"bi bi-magic\"/>Settings</Nav.Item>\r\n        <Modal id='wizard' tabIndex=\"0\" closeButton size=\"md\" {...{show, setShow}} _title={<span>Settings: Wizard</span>}>\r\n            <Wizard/>\r\n        </Modal>\r\n    </>;\r\n}","import React, {useContext, useEffect, useState} from 'react'\r\n\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const [show, setShow]         = useState(false);\r\n\r\n    //useEffect(() => {},[rooms.current]);// eslint-disable-line\r\n    \r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} disabled={!rooms.current} ><i className=\"bi bi-people\"/>Users</Nav.Item>\r\n        <Modal tabIndex=\"0\" closeButton size=\"md\" {...{show, setShow}} title={<span><i className=\"bi bi-people\"/> Users</span>}>\r\n            <ul>\r\n                {rooms.current?.users?.map( (v,k,a) => v && <li key={k}>{v?.username}</li> )}\r\n            </ul>            \r\n        </Modal>\r\n    </>;\r\n}","import React, {useContext, useEffect, useState} from 'react'\r\n\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const [show, setShow]         = useState(false);\r\n\r\n    //useEffect(() => {},[rooms.current]);//eslint-disable-line\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} disabled={!rooms.current}><i className=\"bi bi-chat-dots\"/>Chat</Nav.Item>\r\n        <Modal tabIndex=\"0\" closeButton size=\"md\" {...{show, setShow}} title={<span><i className=\"bi bi-chat-dots\"/> Chat</span>}>\r\n            <ul>\r\n                {rooms.current?.users?.map( (v,k,a) => v && <li key={k}>{v?.username}</li> )}\r\n            </ul>            \r\n        </Modal>\r\n    </>;\r\n}","import { useEffect, useState, useContext, useRef } from 'react'\r\n\r\nimport Nav from \"partials/nav\"\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\n\r\n\r\nexport default () => {\r\n    const canvasRef = useRef(null);\r\n    const media    = useContext(MediaContext);\r\n    const [isAudioEnabled, setAudioEnabled] = useState(false);\r\n    //const videotracks = media.localStream.getVideoTracks()??[];\r\n    //const [isVideoEnabled, setVideoEnabled] = useState(videotracks.every( v => v.enabled ));\r\n\r\n    function handleClick()\r\n    {\r\n        const audiotracks = media.localStream.getAudioTracks()??[];\r\n        const enabled = audiotracks.every(track => { track.enabled = !isAudioEnabled; return !!track.enabled;});\r\n        setAudioEnabled(enabled); \r\n    }\r\n\r\n    useEffect(() => {\r\n        const audiotracks = media.localStream.getAudioTracks()??[];\r\n        setAudioEnabled(audiotracks.every( v => v.enabled ))\r\n    } , [media.localStream, media.settings?.audio]);\r\n\r\n    useEffect(()=>{\r\n        const ctx = canvasRef?.current?.getContext('2d');\r\n        ctx.globalAlpha   = 0.5;\r\n        function draw()\r\n        {\r\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n            \r\n            const [x0, y0, r0, x1, y1, r1] = [ctx.canvas.width*.5, ctx.canvas.height * .5, 135, ctx.canvas.width*.5,ctx.canvas.height * .5,ctx.canvas.height * .5];\r\n            let gradient = ctx.createRadialGradient(x0, y0, r0, x1, y1, r1);\r\n            gradient.addColorStop(0, \"rgba(255, 255, 255, 0.0)\");\r\n            gradient.addColorStop(0.1, \"rgba(255, 255, 255, 0.5)\");\r\n            gradient.addColorStop(.5, \"rgba(255, 255, 255, 0.1)\");\r\n            gradient.addColorStop(1, \"rgba(255, 255, 255, 0.0)\");\r\n\r\n            ctx.fillStyle = gradient;\r\n            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n            requestAnimationFrame(draw)\r\n        }\r\n        const id = requestAnimationFrame(draw);\r\n        \r\n    return ()=>{\r\n        cancelAnimationFrame(id);\r\n    }\r\n    },[])\r\n\r\n    return <>\r\n    <div id='pulse-wrapper'className=\"p-4 rounded-circle\" style={{marginTop: '-4rem', marginBottom: '-4rem'}}>\r\n        <canvas width='512' height='512' ref={canvasRef} className='position-absolute top-0 rounded-circle'/>\r\n        <Nav.Button onClick={handleClick} label=\"Create room\" appendclass=\"shadow rounded-circle bg-danger\" >\r\n            <i className={isAudioEnabled?\"bi bi-mic\":\"bi bi-mic-mute\"}></i>\r\n        </Nav.Button>\r\n    </div>\r\n    \r\n    <style global jsx>{`\r\n        #pulse-wrapper {\r\n            //border: 1px dashed #ccc;\r\n            margin: -3rem -1.5rem 0rem -1.5rem !important;\r\n            overflow:hidden !important;\r\n\r\n            .nav-button{\r\n                margin-top: 0;\r\n                margin-bottom: 0;\r\n            }\r\n\r\n            canvas {\r\n                pointer-events: none;\r\n                margin-top: .35rem;\r\n                width: 5rem;\r\n                height:5rem;\r\n                transform:translate(-50%,-50%) scale(1.3) !important;\r\n            }\r\n    \r\n        }\r\n        @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n            #pulse-wrapper {\r\n                margin: -1.5rem 1rem -1.5rem -4rem !important;\r\n                .nav-button{\r\n                    margin-left: 0;\r\n                    margin-right: 0;\r\n                }\r\n                canvas {\r\n                    top: 50% !important;\r\n                    margin-top: 0rem;\r\n                }\r\n            }\r\n        }\r\n        @media only screen and (orientation: portrait){\r\n\r\n        } \r\n    \r\n    `}</style>\r\n    {/*\r\n    <Nav.Button>\r\n        <ButtonToolbar>\r\n            \r\n            <Button onClick={()=>{ \r\n                const enabled = audiotracks.every(track => { track.enabled = !isAudioEnabled; return !!track.enabled;});\r\n                setAudioEnabled(enabled); \r\n            }}><i className={isAudioEnabled?\"bi bi-mic-mute\":\"bi bi-mic-mute\"}></i></Button>\r\n            \r\n            <Button onClick={()=>{ \r\n                const enabled = videotracks.every(track => { track.enabled = !isVideoEnabled; return !!track.enabled;});\r\n                setVideoEnabled(enabled); \r\n            }}><i className={isVideoEnabled?\"bi bi-camera-video\":\"bi bi-camera-video-off\"}></i></Button>\r\n        \r\n        </ButtonToolbar>\r\n    </Nav.Button>\r\n    */}\r\n    </>\r\n}\r\n","import { useContext, useRef, useEffect } from 'react'\r\nimport { Container } from \"react-bootstrap\"\r\nimport { useHistory, Redirect } from \"react-router-dom\"\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nimport Nav from \"partials/nav\"\r\nimport Room  from 'views/room'\r\nimport Login  from 'views/login'\r\nimport Lobby  from 'views/lobby'\r\nimport Wizard from 'views/wizard'\r\nimport CreateRoomModal from 'components/modal_create_room'\r\nimport LeaveRoomModal from 'components/modal_leave_room'\r\nimport WizardModal from 'components/modal_wizard'\r\nimport UsersModal from 'components/modal_users'\r\nimport ChatModal from 'components/modal_chat'\r\nimport StreamButtons from 'components/btngrp_stream';\r\n\r\n\r\nfunction App({...props}) {\r\n  const history = useHistory();\r\n  const auth = useContext(AuthContext);\r\n  const rooms = useContext(RoomsContext);\r\n  let {current: view} = useRef();\r\n\r\n  if((/^\\/room\\/[a-zA-Z0-9]+/).test(history.location.pathname)) view = <Room container/>\r\n  if(history.location.pathname === '/'        ) view = <Lobby container/> \r\n  if(history.location.pathname === '/settings') view = <Wizard show={true} container/>\r\n  if((/^\\/room\\/[a-zA-Z0-9]+\\/chat$/).test(history.location.pathname)  ) view = <Redirect to=\"/\"/>\r\n  if((/^\\/room\\/[a-zA-Z0-9]+\\/users$/).test(history.location.pathname) ) view = <Redirect to=\"/\"/>\r\n\r\n  if(!(auth.isLogged && auth.isConnected))\r\n    return <div className=\"App\" children={<Login />}/>\r\n  else\r\n    return <>\r\n    <div className=\"App\">\r\n        \r\n      <Container fluid={view?.props?.container} id=\"content-wrapper\" > \r\n      {view}\r\n      </Container>\r\n\r\n      <Nav>\r\n          {rooms.current? <LeaveRoomModal/> : <Nav.Item><i className=\"bi bi-house\"/>Lobby</Nav.Item>}\r\n          <WizardModal/>\r\n          {rooms.current?<StreamButtons/>:<CreateRoomModal/>}\r\n          <UsersModal/>\r\n          <ChatModal/>\r\n      </Nav>\r\n \r\n \r\n    </div>\r\n    <style global jsx>{`\r\n      \r\n      html, body, .App{\r\n        overflow: hidden;\r\n        min-height:330px;\r\n      }\r\n\r\n      #content-wrapper{\r\n        height: 100%;\r\n        margin-bottom: 6rem;\r\n        margin-top: 3.5rem;\r\n        overflow-y: scroll;\r\n        overflow-x: hidden;\r\n        & .container-fluid{\r\n          margin:0 !important;\r\n        }\r\n      }\r\n\r\n      @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n          #content-wrapper{\r\n            margin-bottom: 1rem;\r\n            margin-top: 1rem;\r\n            margin-right:3rem;\r\n          }\r\n      }\r\n      @media only screen and (orientation: portrait){\r\n\r\n      }    \r\n    `}</style>\r\n  </>\r\n}\r\n\r\nexport default App;\r\n","import * as BRA from 'lib_bra'\r\nimport toast from  'react-hot-toast'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport React, { createContext, useContext, useEffect, useState } from 'react'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\n\r\n\r\nexport const RoomsContext = createContext(); \r\n\r\nexport default ({children, ...props}) => {\r\n    const auth    = useContext(AuthContext);\r\n    const history = useHistory();\r\n    \r\n    let   [rooms, setRooms]     = useState({});\r\n    const [ready, setReady]     = useState(false);\r\n    let   [current, setCurrent] = useState(null);\r\n    \r\n    useEffect( ()=>{ \r\n        if(!auth.isLogged) return;\r\n        \r\n        BRA.appClient.on(BRA.APPEvent.GuestLeftRoom,     onGuestLeft);\r\n        BRA.appClient.on(BRA.APPEvent.GuestJoinedRoom,   onGuestJoin);\r\n        BRA.appClient.on(BRA.APPEvent.RoomCreated,       onRoomCreated);\r\n        BRA.appClient.on(BRA.APPEvent.RoomDeleted,       onRoomDeleted);\r\n        BRA.appClient.on(BRA.APPEvent.UserRejoined,      onUserRejoined);\r\n\r\n        //Initial fetch of rooms\r\n        BRA.appClient.getRooms( (m1) => { onGetRooms(m1)\r\n            BRA.appClient.getRoom(  (m2) => { onGetRoom(m2); \r\n            setReady(true);\r\n        });});\r\n\r\n    return ()=>{\r\n        BRA.appClient.off(BRA.APPEvent.GuestLeftRoom,    onGuestLeft);\r\n        BRA.appClient.off(BRA.APPEvent.GuestJoinedRoom,  onGuestJoin);\r\n        BRA.appClient.off(BRA.APPEvent.RoomCreated,      onRoomCreated);\r\n        BRA.appClient.off(BRA.APPEvent.RoomDeleted,      onRoomDeleted);\r\n        BRA.appClient.off(BRA.APPEvent.UserRejoined,     onUserRejoined);\r\n\r\n    }}, [auth.isLogged]);\r\n\r\n    function isUserInRoom(username, roomName)\r\n    {\r\n        const room = {...rooms,[current?.name]:current}[roomName];\r\n        for(let user of room?.users??[]){\r\n            if(user?.username === username) \r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function imInRoom(roomName)\r\n    {\r\n        return isUserInRoom(auth.user?.username, roomName);\r\n    }\r\n\r\n    function onRoomCreated({data:{room}}){\r\n        BRA.appClient.getRooms(onGetRooms);\r\n    }\r\n\r\n    function onRoomDeleted({data:{room}}){\r\n        BRA.appClient.getRooms(onGetRooms);\r\n    }\r\n\r\n    function onGuestLeft({data:{user,room}})\r\n    {\r\n        if(current){\r\n            BRA.appClient.getRoom(onGetRoom);\r\n            toast(`User '${user.username}' left`);\r\n            setCurrent( {...current, users: current?.users??[].filter(u=>u.username!==user.username)} );\r\n        }\r\n    }    \r\n    \r\n    function onGuestJoin({data:{user,room}})\r\n    {\r\n        if(current){\r\n            BRA.appClient.getRoom(onGetRoom);\r\n            toast(`User '${user.username}' joined`);\r\n            setCurrent( {...current, users: current?.users??[].push(user)} );\r\n        }\r\n    }\r\n    \r\n    function onGetRoom({ data: {room} }){\r\n        setCurrent(room?.name?{...room}:null);\r\n\r\n        if(room?.name)\r\n        {\r\n            if(history.location.pathname !== `/room/${room?.name}`){\r\n                history.push(`/room/${room?.name}`);\r\n            }\r\n        }\r\n        else{\r\n            history.push(`/`);\r\n        }\r\n    }\r\n\r\n    function onGetRooms({data:{rooms}}){\r\n        let rs = {};\r\n        for(let room of rooms??[])\r\n            rs[room.name] = room;\r\n        setRooms(rs);\r\n    }\r\n\r\n    function onUserRejoined(){\r\n    }\r\n\r\n    function createRoom(roomName, {password, hidden, icon}){\r\n        return new Promise((resolve, reject)=>{\r\n            BRA.appClient.createRoom(roomName, password??\"\", hidden??false, icon && icon.length? icon : `https://unsplash.it/seed/test-${roomName}/160/100`, ({event, data}) => {\r\n                if(data.error) reject(data.message);\r\n                else resolve(data.room);\r\n            });\r\n        })\r\n        .then(  (room)=>{ BRA.appClient.getRoom(onGetRoom); return room; } )\r\n        //.catch( (e) => toast.error(e) );\r\n    }\r\n\r\n    function joinRoom(roomName, password){\r\n        return new Promise((resolve, reject) => {\r\n            BRA.appClient.joinRoom(roomName,password??\"\",({event, data}) => {\r\n                if(data.error) \r\n                {\r\n                    toast.error(data.message)\r\n                    reject(data.message);\r\n                }\r\n                else resolve(data.room);\r\n            });\r\n        })    \r\n        .then(  (room)=>{ BRA.appClient.getRoom(onGetRoom); return room; } )\r\n    }\r\n\r\n    function leaveRoom(){\r\n        return new Promise((resolve, reject)=>{\r\n            BRA.appClient.leaveRoom(({event, data}) => {\r\n                if(data.error) reject(data.message);\r\n                else resolve(data.room);\r\n            });\r\n        })\r\n        .finally(  (room)=>{ \r\n            BRA.appClient.getRoom(onGetRoom);\r\n            BRA.appClient.getRooms(onGetRooms); \r\n        return room; } )\r\n        //.catch( (e)=> toast.error(e) );\r\n    }\r\n\r\n\r\n    const store = window.rooms = {\r\n        joinRoom,\r\n        leaveRoom,\r\n        createRoom,\r\n        setCurrent,\r\n        imInRoom,\r\n        isUserInRoom,\r\n        ready,\r\n        current,\r\n        list: rooms,\r\n    }\r\n\r\n    return <RoomsContext.Provider value={store} children={children}/>\r\n}","import Gravatar from 'gravatar'\r\nimport {Form} from 'react-bootstrap'\r\nimport {useRef, useState, useEffect} from 'react'\r\n\r\nfunction testImageURL(url) {\r\n    return (url.match(/\\.(jpeg|jpg|gif|png)$/) != null);\r\n}\r\n\r\nfunction testImage(url, timeoutT) {\r\n    return new Promise(function (resolve, reject) {\r\n        var timeout = timeoutT || 5000;\r\n        var timer, img = new Image();\r\n        img.onerror = img.onabort = function () {\r\n            clearTimeout(timer);\r\n            reject(\"Error: the url provided is not an image\");\r\n        };\r\n        img.onload = function () {\r\n            clearTimeout(timer);\r\n            resolve(\"success\");\r\n        };\r\n        timer = setTimeout(function () {\r\n            // reset .src to invalid URL so it stops previous\r\n            // loading, but doesn't trigger new load\r\n            img.src = \"//!!!!/test.jpg\";\r\n            reject(\"timeout\");\r\n        }, timeout);\r\n        img.src = url;\r\n    });\r\n}\r\n\r\nfunction testEmail(email){\r\n    const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n    return re.test(email);\r\n}\r\n\r\nexport default function ({children, onSubmit, ...props}){\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated]     = useState(undefined);\r\n    const [formvalues, setFormValues]   = useState({formErrors:{}});\r\n\r\n    function validateField(name, value, type = \"any\"){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n        let values = {...formvalues};\r\n\r\n        switch(type){\r\n            case 'email':\r\n                check = testEmail(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n\r\n                if(check){\r\n                    const url = \"https:\"+Gravatar.url(value, { s: '256', r: 'pg', d: '404' });\r\n                    testImage(url, 2000)\r\n                    .then( (v) =>   { setFormValues( { ...values, gravatar:url,   [`gravatar_check`]:check, formErrors } ); })\r\n                    .catch((err) => { setFormValues( { ...values, gravatar:null,  [`gravatar_check`]:check, formErrors } ); });\r\n                }else{\r\n                    values = { ...values, gravatar:null,  [`gravatar_check`]:check, formErrors };\r\n                }\r\n\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default:\r\n                check = true;\r\n                formErrors[name] = '';\r\n                break;\r\n        }\r\n        setFormValues( { ...values, [name]:value, [`${name}_check`]:check, formErrors } );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        if(onSubmit) \r\n            onSubmit();\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n    return <Form validated={validated} ref={formRef} {...props}>\r\n        {children}\r\n    </Form>\r\n}","import React, {useState, useContext } from 'react';\r\nimport { Row, Col, Form, FloatingLabel, ButtonGroup, Button, Image } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\n\r\nimport profile_img from 'assets/img/profile_light.png'\r\nimport HForm from 'utils/forms'\r\n\r\nexport default () => {\r\n    const [show, setShow] = useState(false);\r\n    const auth = useContext(AuthContext);\r\n    \r\n    //introduction message to user settings panel\r\n    \r\n    function onSubmit(){\r\n        \r\n    }\r\n\r\n\r\n    if(!auth.isLogged) return <></>;\r\n    return <>\r\n        <Button variant=\"link\" onClick={ ()=>setShow(1) }>Profile</Button>\r\n        <HForm onSubmit={onSubmit}>\r\n\r\n        <Modal closeButton size=\"lg\" {...{show, setShow}} \r\n        //title={ <h2 className=\"user-select-none\">Profile</h2>}\r\n        buttons={[\r\n        <Button onClick={auth.logout}><i className=\"bi bi-power\"></i> Log me out</Button>\r\n        ,      \r\n        \r\n        <div align=\"center\" className=\"fw-bolder\">\r\n        <ButtonGroup>\r\n            <Button variant = \"outline-primary\">Save</Button>\r\n            <Button variant = \"outline-secondary\">Discard</Button>\r\n        </ButtonGroup>\r\n        </div>\r\n        ]}\r\n        >\r\n        <Row>\r\n        <Col xs={6}>\r\n            <Col xs=\"auto\" className=\"text-center mb-2\">\r\n                <Image\r\n                    id=\"avatar-img\"\r\n                    src={ auth.user?.avatar.length? auth.user?.avatar : profile_img }\r\n                    roundedCircle\r\n                    //className='position-absolute top-0 start-50 bg-danger shadow'\r\n                    width=\"128\" height=\"128\"\r\n                />\r\n            </Col>\r\n            <Col>\r\n            <MD className=\"user-select-none\">{`\r\n                # Welcome ${auth.user.username}!\r\n                This panel is where you can change your profile information. You can also change your password.\r\n                If you have any questions, please contact us.\r\n                `}</MD>\r\n            </Col>\r\n        </Col>\r\n        <Col xs={6}>\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"username\">     <Form.Control name='username'   placeholder='username'   /*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['username'  ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"email\">        <Form.Control name='email'      placeholder='email'      /*onChange={handleUserInput}*/ type=\"email\"     /*defaultValue={formvalues['email'     ]}*/     />      </FloatingLabel>} />{/*value={userEmail} onChange={event => setEmail(event.target.value)} isInvalid={!isEmailValid} /> */}\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"password\">     <Form.Control name='password'   placeholder='password'   /*onChange={handleUserInput}*/ type=\"password\"  /*defaultValue={formvalues['password'  ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"avatar URL\">   <Form.Control name='avatar'     placeholder='avatar URL' /*onChange={handleUserInput}*/ type=\"avatar\"    /*defaultValue={formvalues['avatar URL']}*/     />      </FloatingLabel>} />{/*value={image_url !== '' ? image_url : userEmail !== '' ? gravatar_url : ''} onChange={event => setImageURL(event.target.value)} */}\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"name\">         <Form.Control name='name'       placeholder='name'       /*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['name'      ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"surname\">      <Form.Control name='surname'    placeholder='surname'    /*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['surname'   ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"birthddate\">   <Form.Control name='birthdate'  placeholder='birthdate'  /*onChange={handleUserInput}*/ type=\"date\"      /*defaultValue={formvalues['birthdate' ]}*/     />      </FloatingLabel>} />\r\n        </Col>\r\n\r\n  \r\n        </Row>\r\n        </Modal>\r\n        </HForm>\r\n        <style global jsx>{`\r\n\r\n        `}</style>\r\n    </>;\r\n}","import rehypeRaw from 'rehype-raw'\r\nimport remarkGfm from 'remark-gfm'\r\nimport remarkBreaks from 'remark-breaks'\r\nimport ReactMarkdown from 'react-markdown'\r\n\r\nexport default ({children,...props}) => {\r\n    return <ReactMarkdown children={children.replaceAll(\"  \",\"\")} remarkPlugins={[remarkGfm, remarkBreaks]} rehypePlugins={[rehypeRaw]} {...props}/>\r\n}","import http from \"utils/http\"\r\nimport * as BRA from \"lib_bra\";\r\nimport cookies from '@h3r/cookies'\r\nimport toast from 'react-hot-toast'\r\nimport { createContext, useEffect, useState, useRef, } from 'react'\r\n\r\nexport const AuthContext = createContext()\r\n\r\nexport default ({children, ...props}) => {\r\n    const [ user,        setUser      ] = useState(null);\r\n    const [ token,       setToken     ] = useState(cookies.get(\"admire_app_token\"));\r\n    const [ isLogged,    setLogged    ] = useState(false);\r\n    const [ isConnected, setConnected ] = useState({app:false, rtc:false});\r\n    let   { current: toast_app }        = useRef(null);\r\n    let   { current: toast_rtc }        = useRef(null);\r\n    let   { current: toast_usr }        = useRef(null);\r\n    const [ retries, setRetries ]       = useState(0);        \r\n\r\n\r\n    useEffect( ()=>{ //Constructor\r\n        function onUnload(){\r\n            BRA.rtcClient.unregister();\r\n            BRA.rtcClient.disconnect();\r\n            BRA.appClient.disconnect(); \r\n            window.removeEventListener('unload', onUnload);\r\n        }\r\n        window.addEventListener('unload', onUnload);\r\n\r\n        function onAppConnect    (){ toast(\"App Connected\",    {id:toast_app, icon:'⚡', duration:2000}); setConnected( v => ({...v, app:true })); }\r\n        function onRtcConnect    (){ toast(\"RTC Connected\",    {id:toast_rtc, icon:'⚡', duration:2000}); setConnected( v => ({...v, rtc:true })); }\r\n        function onAppDisconnect (){ toast(\"App Disconnected\", {id:toast_app, icon:'⚠️', duration:2000}); setConnected( v => ({...v, app:false})); }\r\n        function onRtcDisconnect (){ toast(\"RTC Disconnected\", {id:toast_rtc, icon:'⚠️', duration:2000}); setConnected( v => ({...v, rtc:false})); }\r\n\r\n        BRA.appClient.on(BRA.APPEvent.ClientConnected,      onAppConnect   );\r\n        BRA.rtcClient.on(BRA.RTCEvent.ClientConnected,      onRtcConnect   );\r\n        BRA.appClient.on(BRA.APPEvent.ClientDisconnected,   onAppDisconnect);\r\n        BRA.rtcClient.on(BRA.RTCEvent.ClientDisconnected,   onRtcDisconnect);\r\n\r\n    return ()=>{ //Destructor\r\n        BRA.appClient.off(BRA.APPEvent.ClientConnected,     onAppConnect        );\r\n        BRA.appClient.off(BRA.RTCEvent.ClientConnected,     onAppDisconnect     );\r\n        BRA.rtcClient.off(BRA.APPEvent.ClientDisconnected,  onRtcConnect        );\r\n        BRA.rtcClient.off(BRA.RTCEvent.ClientDisconnected,  onRtcDisconnect     );\r\n\r\n        onUnload();\r\n    }\r\n    }, []);\r\n\r\n\r\n    useEffect( ()=>{\r\n        if(!isConnected.app && token){\r\n            BRA.appClient.connect(process.env.REACT_APP_APP_URL, token);\r\n        }\r\n    }, [isConnected.app, token]);\r\n\r\n    useEffect( ()=>{\r\n        if(!isConnected.rtc && token){\r\n            BRA.rtcClient.connect(process.env.REACT_APP_RTC_URL, token);\r\n        }\r\n    }, [isConnected.rtc, token]);\r\n\r\n    useEffect( ()=>{\r\n        if(isConnected.rtc && isConnected.app && token && !isLogged) //Im properly connected\r\n        {\r\n            toast_usr = toast.loading(`Fetching user info...`, {duration:Infinity});\r\n            getUserInfo()\r\n            .then( (response) => {\r\n                toast.success(`Success`, {id:toast_usr, icon:'⚡', duration:2000});\r\n                setUser(response);\r\n                setLogged(true);\r\n            })\r\n            .catch( ({error, message}) => {\r\n                toast.error(`onGetUserInfo(e:${error}): ${message}`, {id:toast_usr, icon:'⚠️', duration:4000});\r\n                if(retries >= 3) logout();\r\n                else \r\n                {\r\n                    toast((t) => {\r\n                        const [timer, setTimer] = useState(t.duration * .001);\r\n                        useEffect( ()=>{ const interval_id = setInterval(()=>setTimer(s=>Math.max(0,s-1)), 1000);   //Toast Constructor\r\n                            return ()=>{ clearInterval(interval_id);    setRetries(v => v+1);                       //Toast Destructor\r\n                        }}, []);\r\n                        return <span>{timer === 0 ? `Retrying`:`Retrying in ${timer}s...`}</span>\r\n                    },{duration:5000});\r\n                }\r\n            });\r\n        }\r\n        if(isConnected.rtc && isConnected.app && isLogged){\r\n\r\n            BRA.rtcClient.register(user.username, ({status, description})=>{\r\n                if(status === 'error')\r\n                {\r\n                    toast.error(`onRegister error: ${description}`,{icon:<i className=\"bi bi-activity\"/>, duration: 5000});\r\n                    setTimeout(logout,1000);\r\n                }\r\n            });\r\n        }\r\n    },[isConnected.rtc && isConnected.app, token, isLogged, retries]);\r\n\r\n    async function login(email, password){\r\n        const toastId = toast.loading('Logging in...');\r\n        email = email.toLowerCase();\r\n        setToken(null);\r\n        return http.post(`${process.env.REACT_APP_API_URL}/auth/basic`, {data:{ email, password }})\r\n        .then(response => {\r\n            if(response?.error || !response?.access_token)\r\n            {\r\n                for(let msg of [response.message].flat()) \r\n                    toast.error(`onLogin error: ${msg}`);\r\n                toast.dismiss(toastId);\r\n                setTimeout(logout,2000)\r\n                return null;\r\n            }\r\n            toast.success('Success login', { id: toastId });\r\n            setToken(response.access_token);\r\n            return response.access_token;\r\n        })\r\n        .catch(err => toast.error(`Error catch: ${err}`, { id: toastId }));\r\n    }\r\n\r\n    async function logout(){\r\n        cookies.set(\"admire_app_email\",null,-1);\r\n        cookies.set(\"admire_app_token\",null,-1);\r\n        setToken(null);\r\n        setLogged(false);\r\n        toast('Logged out');\r\n        \r\n        BRA.rtcClient.unregister();\r\n        BRA.rtcClient.disconnect();\r\n        BRA.appClient.disconnect(); \r\n        setRetries(0);\r\n    }\r\n\r\n    async function getUserInfo(){\r\n        return new Promise((resolve, reject) => {\r\n            http.get(`${process.env.REACT_APP_API_URL}/users/me`, {headers:{Authorization:`Bearer ${token}`}})\r\n            .then( response => {\r\n                if(response?.error) reject(response);\r\n                else resolve(response);\r\n            })\r\n            .catch(err => reject(err));\r\n        });\r\n    }\r\n    \r\n    const store = window.auth = {\r\n        user       \r\n        ,isLogged\r\n       ,isConnected: isConnected.app && isConnected.rtc\r\n       ,login\r\n       ,logout\r\n   }\r\n \r\n    return <AuthContext.Provider value={store}> \r\n        {children}\r\n    </AuthContext.Provider>\r\n}","var map = {\n\t\"./Battery.jsx\": [\n\t\t471,\n\t\t5\n\t],\n\t\"./Devices.jsx\": [\n\t\t472,\n\t\t6\n\t],\n\t\"./Pose.jsx\": [\n\t\t469,\n\t\t7,\n\t\t3\n\t],\n\t\"./Shader.jsx\": [\n\t\t470,\n\t\t4\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 460;\nmodule.exports = webpackAsyncContext;","const reportWebVitals = (onPerfEntry) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\n\r\nimport Layout from 'partials/layout'\r\nimport {ProgressBar} from 'react-bootstrap';\r\n\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n      <React.Suspense children={<Layout/>} fallback={<ProgressBar className=\"start-50\" animated now={100} />}/>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://cra.link/PWA\r\nserviceWorkerRegistration.register();\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","export const RTCEvent =\r\n{\r\n\tClientConnected:        \"client_connected\",\r\n\tClientDisconnected:     \"client_disconnected\",\r\n    IncomingCall:           \"incoming_call\",\r\n    CallAccepted:           \"call_accepted\",\r\n    CallCanceled:           \"call_canceled\",\r\n    CallOpened:             \"call_opened\",\r\n    CallClosed:             \"call_closed\",\r\n    UserHangup:             \"user_hangup\"\r\n};\r\n\r\nexport function RTCClient( settings )\r\n{\r\n//#region Variables\r\n    let defaultSettings =\r\n    {\r\n        debug: false,\r\n        debugStyle: \"background: hsla(0, 0%, 13%, 1); color: hsla(74, 64%, 60%, 1)\",\r\n        pingPeriod: 5 * 1000,\r\n        defaultStream: new MediaStream()\r\n    };\r\n\r\n    settings = (typeof settings !== \"object\") ? { } : settings;\r\n    settings = Object.assign({ }, defaultSettings, settings);\r\n\r\n    let console = (settings.debug) ? window.console : null;\r\n\r\n    let responses = { };\r\n    let events = { };\r\n\r\n    let calls = { };\r\n    let socket = null;\r\n    let keepAliveTimeout = null;\r\n\r\n    let userId = null;\r\n    let rtcConfiguration = { iceServers: null };\r\n//#endregion\r\n\r\n//#region Methods\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Get the call identified by the specified ID.\r\n     */\r\n    let getCall = function( callId )\r\n    {\r\n        return (callId in calls) ? calls[callId] : null;\r\n    };\r\n \r\n    /**\r\n     * Get all the calls.\r\n     */\r\n    let getCalls = function()\r\n    {\r\n        return calls;\r\n    };\r\n\r\n    /**\r\n     * Connect to the server.\r\n     */\r\n    let connect = function( url )\r\n    {\r\n        if( socket && socket.readyState != WebSocket.CLOSED )\r\n        {\r\n            console?.error(\"WebSocket not closed\");\r\n            return;\r\n        }\r\n\r\n        socket = new WebSocket(url);\r\n\r\n        socket.onopen = onOpen;\r\n        socket.onmessage = onMessage;\r\n        socket.onclose = onClose;\r\n    };\r\n\r\n    /**\r\n     * Disconnect from the server.\r\n     */\r\n    let disconnect = function()\r\n    {\r\n        if( !socket )\r\n        {\r\n            console?.error(\"WebSocket not opened\");\r\n            return;\r\n        }\r\n        socket?.close();\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is opened.\r\n     */\r\n    let onOpen = function( event )\r\n    {\r\n        startKeepAlive();\r\n\r\n        console?.log(\"%c\" + RTCEvent.ClientConnected + \"%o\", settings.debugStyle, socket.url);\r\n\r\n        emit(RTCEvent.ClientConnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is closed.\r\n     */\r\n    let onClose = function( event )\r\n    {\r\n        userId = null;\r\n        rtcConfiguration.iceServers = null;\r\n\r\n        stopKeepAlive();\r\n\r\n        console?.log(\"%c\" + RTCEvent.ClientDisconnected + \"%o\", settings.debugStyle, socket.url);\r\n        emit(RTCEvent.ClientDisconnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when a message is received from the server.\r\n     */\r\n    let onMessage = function( msg )\r\n    {\r\n        let message = JSON.parse(msg.data);\r\n        if( message.id === \"pong\" )\r\n        {\r\n            return;\r\n        }\r\n\r\n        console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.id, msg.data);\r\n\r\n        // Check whether the message needs internal handling.\r\n        switch( message.id )\r\n        {\r\n            case \"register_response\":       handleRegisterResponse(message);        break;\r\n            case \"unregister_response\":     handleUnregisterResponse(message);      break;\r\n            case \"call_response\":           handleCallResponse(message);            break;\r\n            case \"incoming_call\":           handleIncomingCall(message);            break;\r\n            case \"call_accepted\":           handleCallAccepted(message);            break;\r\n            case \"call_canceled\":           handleCallCanceled(message);            break;\r\n            case \"remote_offer\":            handleRemoteOffer(message);             break;\r\n            case \"remote_answer\":           handleRemoteAnswer(message);            break;\r\n            case \"remote_candidate\":        handleRemoteCandidate(message);         break;\r\n            case \"user_hangup\":             handleUserHangup(message);              break;\r\n        }\r\n\r\n        // Check whether the message has a response listener.\r\n        if( message.uuid in responses )\r\n        {\r\n            let response = responses[message.uuid];\r\n            delete responses[message.uuid];\r\n            delete message.uuid;\r\n            response(message);\r\n        }\r\n\r\n        // Check whether the message has an event.\r\n        emit(message.id, message);\r\n    };\r\n\r\n    /**\r\n     * Send a message to the server.\r\n     */\r\n    let sendMessage = function( message, response )\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Generate a UUID.\r\n        message.uuid = uuid();\r\n\r\n        // Add the response listener.\r\n        if( response instanceof Function )\r\n        {\r\n            responses[message.uuid] = response;\r\n        }\r\n\r\n        // Send the message.\r\n        let msg = JSON.stringify(message);\r\n        socket.send(msg);\r\n        if( message.id !== \"ping\" )\r\n        {\r\n            console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.id, msg);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start a keep alive timeout.\r\n     */\r\n    let startKeepAlive = function()\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            console?.error(\"WebSocket not opened\");\r\n            return false;\r\n        }\r\n\r\n        ping();\r\n\r\n        keepAliveTimeout = window.setTimeout(startKeepAlive, settings.pingPeriod);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Stop the keep alive timeout.\r\n     */\r\n    let stopKeepAlive = function()\r\n    {\r\n        window.clearTimeout(keepAliveTimeout);\r\n    };\r\n \r\n    /**\r\n     * Send a ping to the server.\r\n     */\r\n    let ping = function()\r\n    {\r\n        let message =\r\n        {\r\n            id: \"ping\"\r\n        };\r\n        return sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Register to the server.\r\n     */\r\n    let register = function( username, response )\r\n    {\r\n        if( userId )\r\n        {\r\n            console?.error(\"Client already registered\");\r\n            return false;\r\n        }\r\n\r\n        let message =\r\n        {\r\n            id: \"register\",\r\n            userId: username\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Unregister from the server.\r\n     */\r\n    let unregister = function( response )\r\n    {\r\n        if( !userId )\r\n        {\r\n            console?.error(\"Client not registered\");\r\n            return false;\r\n        }\r\n\r\n        hangup();\r\n\r\n        let message =\r\n        {\r\n            id: \"unregister\",\r\n            userId: userId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Call a user.\r\n     */\r\n    let call = function( calleeId, response )\r\n    {\r\n        if( userId === calleeId )\r\n        {\r\n            console?.error(\"Invalid user id \" + calleeId);\r\n            return false;\r\n        }\r\n\r\n        let message =\r\n        {\r\n            id: \"call\",\r\n            callerId: userId,\r\n            calleeId: calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Close a call.\r\n     */\r\n    let closeCall = function( callId )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let call = calls[callId];\r\n        call.close();\r\n        delete(calls[callId]);\r\n\r\n        emit(RTCEvent.CallClosed, { call: call });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Accept a call.\r\n     */\r\n    let acceptCall = function( callId, response )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            console?.error(\"Call \" + callId + \" not found\");\r\n            return false;\r\n        }\r\n\r\n        let call = calls[callId];\r\n\r\n        let message =\r\n        {\r\n            id: \"accept_call\",\r\n            callId: call.callId,\r\n            callerId: call.callerId,\r\n            calleeId: call.calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Cancel a call.\r\n     */\r\n    let cancelCall = function( callId, response )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            console?.error(\"Call \" + callId + \" not found\");\r\n            return false;\r\n        }\r\n\r\n        // Delete the call.\r\n        let call = calls[callId];\r\n        delete calls[callId];\r\n\r\n        let message =\r\n        {\r\n            id: \"cancel_call\",\r\n            callId: call.callId,\r\n            callerId: call.callerId,\r\n            calleeId: call.calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Hang up a call. If call ID is undefined then all calls are hang up.\r\n     */\r\n    let hangup = function( callId, response )\r\n    {\r\n        if( callId ) // Close the call.\r\n        {\r\n            if( !closeCall(callId) )\r\n            {\r\n                return false;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"hangup\",\r\n                callId: callId\r\n            };\r\n            return sendMessage(message, response);\r\n        }\r\n        else // Close all the calls.\r\n        {\r\n            for( let callId in calls )\r\n            {\r\n                if( !closeCall(callId) )\r\n                {\r\n                    continue;\r\n                }\r\n\r\n                let message =\r\n                {\r\n                    id: \"hangup\",\r\n                    callId: callId\r\n                };\r\n                sendMessage(message);\r\n            }\r\n\r\n            calls = { };\r\n\r\n            return true;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier.\r\n     * Reference: RFC 4122 https://www.ietf.org/rfc/rfc4122.txt\r\n     */\r\n    let uuid = function()\r\n    {\r\n        return uuidv4();\r\n    };\r\n \r\n    /**\r\n     * Generate a universally unique identifier v4.\r\n     * Reference: https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\r\n     */\r\n    let uuidv4 = function()\r\n    {\r\n        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\r\n        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\r\n        );\r\n    };\r\n//#endregion\r\n\r\n//#region EventHandlers\r\n    /**\r\n     * Register response event handler.\r\n     */\r\n    let handleRegisterResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            userId = event.userId;\r\n            rtcConfiguration.iceServers = JSON.parse(event.iceServers);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Unregister response event handler.\r\n     */\r\n    let handleUnregisterResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            userId = null;\r\n            rtcConfiguration.iceServers = null;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Call response event handler.\r\n     */\r\n    let handleCallResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            // Create the call.\r\n            let call = new RTCCall(event.callId, event.callerId, event.calleeId);\r\n            calls[call.callId] = call;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Incoming call event handler.\r\n     */\r\n    let handleIncomingCall = function( event )\r\n    {\r\n        // Create the call.\r\n        let call = new RTCCall(event.callId, event.callerId, event.calleeId);\r\n        calls[event.callId] = call;\r\n    };\r\n\r\n    /**\r\n     * Call accepted event handler.\r\n     */\r\n    let handleCallAccepted = function( event )\r\n    {\r\n        // Create the peer connection.\r\n        let peerConnection = new RTCPeerConnection(rtcConfiguration);\r\n        let call = calls[event.callId];\r\n        call.bind(peerConnection, true);\r\n\r\n        // Handle the peer connection lifecycle.\r\n        peerConnection.oniceconnectionstatechange = function( other )\r\n        {\r\n            handleIceConnectionStateChange(call);\r\n        }\r\n\r\n        // Generate candidates.\r\n        peerConnection.onicecandidate = function( other )\r\n        {\r\n            if( !other.candidate || other.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n            {\r\n                return;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"candidate\",\r\n                callId: event.callId,\r\n                callerId: event.callerId,\r\n                calleeId: event.calleeId,\r\n                candidate: JSON.stringify(other.candidate)\r\n            };\r\n            sendMessage(message);\r\n        };\r\n\r\n        peerConnection.onnegotiationneeded = function( other )\r\n        {\r\n            // Generate offer.\r\n            peerConnection.createOffer().then(function( sdp )\r\n            {\r\n                // Set caller local description.\r\n                peerConnection.setLocalDescription(sdp);\r\n\r\n                let message =\r\n                {\r\n                    id: \"offer\",\r\n                    callId: event.callId,\r\n                    callerId: event.callerId,\r\n                    calleeId: event.calleeId,\r\n                    offer: JSON.stringify(sdp)\r\n                };\r\n                sendMessage(message);\r\n            });\r\n        };\r\n\r\n        // Add the tracks. This action triggers the ICE negotiation process.\r\n        let tracks = settings.defaultStream.getTracks();\r\n        tracks.forEach(track => peerConnection.addTrack(track));\r\n\r\n        // Create a default data channel to avoid renegotiation.\r\n        peerConnection.createDataChannel(\"default\");\r\n    };\r\n\r\n    /**\r\n     * Call canceled event handler.\r\n     */\r\n    let handleCallCanceled = function( event )\r\n    {\r\n        closeCall(event.callId);\r\n    };\r\n\r\n    /**\r\n     * Remote offer event handler.\r\n     */\r\n    let handleRemoteOffer = function( event )\r\n    {\r\n        // Create the peer connection.\r\n        let peerConnection = new RTCPeerConnection(rtcConfiguration);\r\n        let call = calls[event.callId];\r\n        call.bind(peerConnection, false);\r\n\r\n        // Handle the peer connection lifecycle.\r\n        peerConnection.oniceconnectionstatechange = function( other )\r\n        {\r\n            handleIceConnectionStateChange(call);\r\n        }\r\n\r\n        // Set the callee remote description.\r\n        peerConnection.setRemoteDescription(JSON.parse(event.offer));\r\n\r\n        // Gather the pending candidates.\r\n        call.gatherPendingCandidates();\r\n\r\n        // Generate the candidates.\r\n        peerConnection.onicecandidate = function( other )\r\n        {\r\n            if( !other.candidate || other.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n            {\r\n                return;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"candidate\",\r\n                callId: event.callId,\r\n                callerId: event.callerId,\r\n                calleeId: event.calleeId,\r\n                candidate: JSON.stringify(other.candidate)\r\n            };\r\n            sendMessage(message);\r\n        };\r\n\r\n        // Add the tracks.\r\n        let tracks = settings.defaultStream.getTracks();\r\n        tracks.forEach(track => peerConnection.addTrack(track));\r\n\r\n        // Create the answer.\r\n        window.setTimeout(function()\r\n        {\r\n            peerConnection.createAnswer().then(function( sdp )\r\n            {\r\n                // Set the callee local description.\r\n                peerConnection.setLocalDescription(sdp);\r\n\r\n                let message =\r\n                {\r\n                    id: \"answer\",\r\n                    callId: event.callId,\r\n                    callerId: event.callerId,\r\n                    calleeId: event.calleeId,\r\n                    answer: JSON.stringify(sdp)\r\n                };\r\n                sendMessage(message);\r\n            });\r\n        }, 500);\r\n    };\r\n\r\n    /**\r\n     * Remote answer event handler.\r\n     */\r\n    let handleRemoteAnswer = function( event )\r\n    {\r\n        if( event.callId in calls )\r\n        {\r\n            let answer = JSON.parse(event.answer);\r\n\r\n            // Set the caller remote description.\r\n            calls[event.callId].setRemoteDescription(answer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Remote candidate event handler.\r\n     */\r\n    let handleRemoteCandidate = function( event )\r\n    {\r\n        let candidate = JSON.parse(event.candidate);\r\n        if( !candidate || !candidate.candidate || candidate.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n        {\r\n            return;\r\n        }\r\n\r\n        if( event.callId in calls )\r\n        {\r\n            let call = calls[event.callId];\r\n            call.addCandidate(candidate);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * User hangup event handler.\r\n     */\r\n    let handleUserHangup = function( event )\r\n    {\r\n        closeCall(event.callId);\r\n    };\r\n\r\n    /**\r\n     * ICE connection state change event handler.\r\n     */\r\n    let handleIceConnectionStateChange = async function( call )\r\n    {\r\n        let state = call.getState();\r\n        console?.log(\"%c\" + \"Connection State\" + \"%o%o\", settings.debugStyle, call.callId, state);\r\n\r\n        switch( state )\r\n        {\r\n            case \"failed\":\r\n            case \"disconnected\":\r\n            case \"closed\":\r\n            {\r\n                hangup(call.callId);\r\n                break;\r\n            }\r\n            case \"new\":\r\n            case \"checking\":\r\n            case \"completed\":\r\n            {\r\n                break;\r\n            }\r\n            case \"connected\":\r\n            {\r\n                let stream = call.getRemoteStream();\r\n                console?.log(\"%c\" + RTCEvent.CallOpened + \"%o%o\", settings.debugStyle, call.callId, stream);\r\n                emit(RTCEvent.CallOpened, { call: call, stream: stream });\r\n                break;\r\n            }\r\n        }\r\n    };\r\n//#endregion\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        getCall,\r\n        getCalls,\r\n        connect,\r\n        disconnect,\r\n        register,\r\n        unregister,\r\n        call,\r\n        acceptCall,\r\n        cancelCall,\r\n        hangup\r\n    };\r\n}\r\n\r\nexport function RTCCall( callId, callerId, calleeId )\r\n{\r\n//#region Variables\r\n    let connection = null;\r\n    let candidates = [];\r\n    let channels = { };\r\n    let initiator = false;\r\n//#endregion\r\n\r\n//#region Methods\r\n    /**\r\n     * Bind the call to a peer connection.\r\n     */\r\n    let bind = function( peerConnection, isInitiator )\r\n    {\r\n        if( !(peerConnection instanceof RTCPeerConnection) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection = peerConnection;\r\n        initiator = isInitiator;\r\n\r\n        // Handle the data channel event internally to track the data channels lifecycle.\r\n        connection.addEventListener(\"datachannel\", function( event )\r\n        {\r\n            channels[event.channel.label] = event.channel;\r\n\r\n            // Handle the close event.\r\n            event.channel.addEventListener(\"onclose\", function( event )\r\n            {\r\n                delete channels[event.channel.label];\r\n            });\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Close the call.\r\n     */\r\n    let close = function()\r\n    {\r\n        connection?.close();\r\n    };\r\n\r\n    /**\r\n     * Return whether the user is the initiator.\r\n     */\r\n    let isInitiator = function()\r\n    {\r\n        return initiator;\r\n    };\r\n\r\n    /**\r\n     * Get the call state.\r\n     */\r\n    let getState = function()\r\n    {\r\n        return (connection) ? connection.iceConnectionState : \"closed\";\r\n    };\r\n\r\n    /**\r\n     * Get the call stats.\r\n     */\r\n    let getStats = async function()\r\n    {\r\n        if( !connection )\r\n        {\r\n            return;\r\n        }\r\n\r\n        let callStats = { callId: callId, callerId: callerId, calleeId: calleeId };\r\n\r\n        return await connection.getStats(null).then(function( stats )\r\n        {\r\n            // Get the stats of the succeeded candidate pair.\r\n            let pairStats = null;\r\n            stats.forEach(report =>\r\n            {\r\n                //console.log(report);\r\n                if( report.type === \"candidate-pair\" && (report.selected === true || report.state === \"succeeded\") )\r\n                {\r\n                    pairStats = report;\r\n                }\r\n            });\r\n\r\n            // Get the stats of the local and remote candidates.\r\n            if( pairStats )\r\n            {\r\n                stats.forEach(report =>\r\n                {\r\n                    if( report.id === pairStats.localCandidateId )\r\n                    {\r\n                        callStats.localType = report.candidateType;\r\n                        callStats.localAddress = report.address ?? report.ip;\r\n                        callStats.localPort = report.port;\r\n                        callStats.localProtocol = report.protocol;\r\n                    }\r\n                    if( report.id === pairStats.remoteCandidateId )\r\n                    {\r\n                        callStats.remoteType = report.candidateType;\r\n                        callStats.remoteAddress = report.address ?? report.ip;\r\n                        callStats.remotePort = report.port;\r\n                        callStats.remoteProtocol = report.protocol;\r\n                    }\r\n                });\r\n            }\r\n\r\n            return Promise.resolve(callStats);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Add a candidate or save it for gathering.\r\n     */\r\n    let addCandidate = function( candidate )\r\n    {\r\n        if( !connection )\r\n        {\r\n            candidates.push(candidate);\r\n        }\r\n        else\r\n        {\r\n            connection.addIceCandidate(candidate);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Gather the pending candidates.\r\n     */\r\n    let gatherPendingCandidates = function()\r\n    {\r\n        if( candidates.length > 0 )\r\n        {\r\n            candidates.forEach(candidate => connection.addIceCandidate(candidate));\r\n            candidates = [];\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set the remote session description.\r\n     */\r\n    let setRemoteDescription = function( description )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection.setRemoteDescription(description);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * [NYI] Set the stream's bandwidth.\r\n     * References:\r\n     * https://webrtchacks.com/limit-webrtc-bandwidth-sdp/\r\n     * https://stackoverflow.com/questions/57653899/how-to-increase-the-bitrate-of-webrtc\r\n     */\r\n    let setBandwidth = function( bandwidth )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let senders = connection.getSenders();\r\n        if( !senders )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            let parameters = sender.getParameters();\r\n            if( !parameters.encodings )\r\n            {\r\n                parameters.encodings = [{ }];\r\n            }\r\n\r\n            parameters.encodings[0].maxBitrate = bandwidth * 1000;\r\n\r\n            sender.setParameters(parameters);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Get the remote audio track specified by index.\r\n     */\r\n    let getRemoteAudioTrack = function ( index = 0 )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track.kind === \"audio\" )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < tracks.length )\r\n        {\r\n            return tracks[index];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Get the remote video track specified by index.\r\n     */\r\n    let getRemoteVideoTrack = function ( index = 0 )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track.kind === \"video\" )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < tracks.length )\r\n        {\r\n            return tracks[index];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Get the remote stream of the peer connection composed by all the audio and video tracks.\r\n     */\r\n    let getRemoteStream = function()\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( tracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let stream = new MediaStream();\r\n        for( let i = 0; i < tracks.length; i++ )\r\n        {\r\n            let track = tracks[i];\r\n            stream.addTrack(track);\r\n        }\r\n\r\n        return stream;\r\n    };\r\n\r\n    /**\r\n     * Replace the local audio track specified by index.\r\n     */\r\n    let replaceLocalAudioTrack = function( track, index = 0 )\r\n    {\r\n        if( !connection || !track )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let audioSenders = [];\r\n        let senders = connection.getSenders();\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            if( sender.track && sender.track.kind === \"audio\" )\r\n            {\r\n                audioSenders.push(sender);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < audioSenders.length )\r\n        {\r\n            audioSenders[index].replaceTrack(track);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Replace the local video track specified by index.\r\n     */\r\n    let replaceLocalVideoTrack = function( track, index = 0 )\r\n    {\r\n        if( !connection || !track )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let videoSenders = [];\r\n        let senders = connection.getSenders();\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            if( sender.track && sender.track.kind === \"video\" )\r\n            {\r\n                videoSenders.push(sender);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < videoSenders.length )\r\n        {\r\n            videoSenders[index].replaceTrack(track);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n//#endregion\r\n\r\n//#region DataChannel\r\n    /**\r\n     * Open a data channel.\r\n     */\r\n    let openChannel = function( label )\r\n    {\r\n        if( !connection || label in channels )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = connection.createDataChannel(label);\r\n        channels[label] = channel;\r\n\r\n        // Handle the close event.\r\n        channel.addEventListener(\"onclose\", function( event )\r\n        {\r\n            delete channels[channel.label];\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Close a data channel.\r\n     */\r\n    let closeChannel = function( label )\r\n    {\r\n        if( !connection || !(label in channels) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.close();\r\n        delete channels[label];\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback for the data channel event.\r\n     */\r\n    let onDataChannel = function( callback )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection.addEventListener(\"datachannel\", callback);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel open event.\r\n     */\r\n    let onChannelOpen = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onopen = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel close event.\r\n     */\r\n    let onChannelClose = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.addEventListener(\"onclose\", callback);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel error event.\r\n     */\r\n    let onChannelError = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onerror = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel message event.\r\n     */\r\n    let onChannelMessage = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onmessage = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Send data through an opened channel.\r\n     */\r\n    let sendData = function( label, data )\r\n    {\r\n        if( !connection || !(label in channels) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        if( channel.readyState !== \"open\" )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        channel.send(data);\r\n\r\n        return true;\r\n    };\r\n//#endregion\r\n\r\n    return {\r\n        get callId() { return callId; },\r\n        get callerId() { return callerId; },\r\n        get calleeId() { return calleeId; },\r\n        bind,\r\n        close,\r\n        isInitiator,\r\n        getState,\r\n        getStats,\r\n        addCandidate,\r\n        gatherPendingCandidates,\r\n        setRemoteDescription,\r\n        setBandwidth,\r\n        getRemoteAudioTrack,\r\n        getRemoteVideoTrack,\r\n        getRemoteStream,\r\n        replaceLocalAudioTrack,\r\n        replaceLocalVideoTrack,\r\n        openChannel,\r\n        closeChannel,\r\n        onDataChannel,\r\n        onChannelOpen,\r\n        onChannelClose,\r\n        onChannelError,\r\n        onChannelMessage,\r\n        sendData\r\n    };\r\n}","\"use strict\";\r\n\r\nexport const LobbyEvent =\r\n{\r\n\tClientConnected:        \"client_connected\",\r\n\tClientDisconnected:     \"client_disconnected\",\r\n    Error:                  \"error\",\r\n    UserOnline:             \"user_online\",\r\n    UserOffline:            \"user_offline\",\r\n    RoomCreated:            \"room_created\",\r\n    RoomDeleted:            \"room_deleted\",\r\n    GuestJoinedRoom:        \"guest_joined_room\",\r\n    GuestLeftRoom:          \"guest_left_room\",\r\n    UserRejoined:           \"user_rejoined\"\r\n};\r\n\r\nexport function LobbyClient( settings )\r\n{\r\n    let defaultSettings =\r\n    {\r\n        debug: false,\r\n        debugStyle: \"background: hsla(0, 0%, 13%, 1); color: hsla(180, 89%, 45%, 1)\",\r\n        pingPeriod: 5 * 1000\r\n    };\r\n\r\n    settings = (typeof settings !== \"object\") ? { } : settings;\r\n    settings = Object.assign({ }, defaultSettings, settings);\r\n\r\n    let console = (settings.debug) ? window.console : null;\r\n\r\n    let responses = { };\r\n    let events = { };\r\n\r\n    let token = null;\r\n    let socket = null;\r\n    let keepAliveTimeout = null;\r\n\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n \r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n \r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Connect to the server.\r\n     */\r\n    let connect = function( url, accessToken )\r\n    {\r\n        token = accessToken;\r\n        socket = new WebSocket(url + \"?token=\" + token);\r\n\r\n        socket.onopen = onOpen;\r\n        socket.onmessage = onMessage;\r\n        socket.onclose = onClose;\r\n    };\r\n\r\n    /**\r\n     * Disconnect from the server.\r\n     */\r\n    let disconnect = function()\r\n    {\r\n        socket?.close();\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is opened.\r\n     */\r\n    let onOpen = function( event )\r\n    {\r\n        console?.log(\"%c\" + \"connected\" + \"%o\", settings.debugStyle, socket.url);\r\n\r\n        startKeepAlive();\r\n\r\n        emit(LobbyEvent.ClientConnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is closed.\r\n     */\r\n    let onClose = function( event )\r\n    {\r\n        console?.log(\"%c\" + \"disconnected\" + \"%o\", settings.debugStyle, socket.url);\r\n\r\n        stopKeepAlive();\r\n\r\n        emit(LobbyEvent.ClientDisconnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when a message is received from the server.\r\n     */\r\n    let onMessage = function( msg )\r\n    {\r\n        let message = JSON.parse(msg.data);\r\n        if( message.event === \"pong\" )\r\n        {\r\n            return;\r\n        }\r\n\r\n        console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.event, message.data);\r\n\r\n        // Check whether the message has a response listener.\r\n        if( message.data.uuid in responses )\r\n        {\r\n            let response = responses[message.data.uuid];\r\n            delete responses[message.data.uuid];\r\n            delete message.data.uuid;\r\n            response(message);\r\n            return;\r\n        }\r\n\r\n        // Check whether the message has an event.\r\n        emit(message.event, message);\r\n    };\r\n\r\n    /**\r\n     * Send a message to the server.\r\n     */\r\n    let sendMessage = function( message, response )\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Set the token.\r\n        message.data.token = token;\r\n\r\n        // Generate a UUID.\r\n        message.data.uuid = uuid();\r\n\r\n        // Add the response listener.\r\n        if( response instanceof Function )\r\n        {\r\n            responses[message.data.uuid] = response;\r\n        }\r\n\r\n        // Send the message.\r\n        let msg = JSON.stringify(message);\r\n        socket.send(msg);\r\n        if( message.event !== \"ping\" )\r\n        {\r\n            console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.event, msg);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start a keep alive timeout.\r\n     */\r\n    let startKeepAlive = function()\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return;\r\n        }\r\n\r\n        ping();\r\n\r\n        keepAliveTimeout = window.setTimeout(startKeepAlive, settings.pingPeriod);\r\n    };\r\n\r\n    /**\r\n     * Stop the keep alive timeout.\r\n     */\r\n    let stopKeepAlive = function()\r\n    {\r\n        window.clearTimeout(keepAliveTimeout);\r\n    };\r\n\r\n    /**\r\n     * Send a ping to the server.\r\n     */\r\n    let ping = function()\r\n    {\r\n        let message =\r\n        {\r\n            event: \"ping\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Get the user's room.\r\n     */\r\n    let getRoom = function( response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"get_room\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Get the lobby rooms.\r\n     */\r\n    let getRooms = function( response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"get_rooms\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Create a room.\r\n     */\r\n    let createRoom = function( name, password, hidden, icon, response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"create_room\",\r\n            data:\r\n            {\r\n                name: name,\r\n                password: password,\r\n                hidden: hidden,\r\n                icon: icon\r\n            }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Join a room.\r\n     */\r\n    let joinRoom = function( name, password, response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"join_room\",\r\n            data:\r\n            {\r\n                name: name,\r\n                password: password\r\n            }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Leave a room.\r\n     */\r\n    let leaveRoom = function( response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"leave_room\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier.\r\n     * Reference: RFC 4122 https://www.ietf.org/rfc/rfc4122.txt\r\n     */\r\n    let uuid = function()\r\n    {\r\n        return uuidv4();\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier v4.\r\n     * Reference: https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\r\n     */\r\n    let uuidv4 = function()\r\n    {\r\n        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\r\n          (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\r\n        );\r\n    };\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        connect,\r\n        disconnect,\r\n        getRoom,\r\n        getRooms,\r\n        createRoom,\r\n        joinRoom,\r\n        leaveRoom\r\n    };\r\n}","\"use strict\";\r\n\r\nexport const MediaEvent =\r\n{\r\n\tGotDevices:         \"got_devices\",\r\n\tErrorDevices:       \"error_devices\",\r\n    GotResolutions:     \"got_resolutions\",\r\n    GotStream:          \"got_stream\",\r\n    ErrorStream:        \"error_stream\"\r\n};\r\n\r\nexport function MediaAdapter()\r\n{\r\n    let events = { };\r\n\r\n    let audioStream = null;\r\n    let videoStream = null;\r\n    let mediaStream = null;\r\n\r\n    let audioDevices = { }; // audioDevices[label] = deviceId\r\n    let videoDevices = { }; // videoDevices[label] = deviceId\r\n\r\n    let resolutions =\r\n    {\r\n        \"Undefined\":    { },\r\n        \"320x240\":      { width: 320,\theight: 240 },\t// QVGA 4:3\r\n        \"640x360\":      { width: 640,\theight: 360 },\t// nHD 16:9\r\n        \"640x480\":      { width: 640,\theight: 480 },\t// VGA 4:3\r\n        \"1280x720\":     { width: 1280,\theight: 720 },\t// HD 16:9\r\n        \"1920x1080\":    { width: 1920,\theight: 1080 },\t// FullHD 16:9\r\n        \"3840x2160\":    { width: 3840,\theight: 2160 },\t// 4k 16:9\r\n        //\"7680x4320\":    { width: 7680,\theight: 4320 }\t// 8k 16:9\r\n    };\r\n\r\n    let audioConstraints =\r\n    {\r\n        audio:\r\n        {\r\n            deviceId: { exact: undefined }\r\n        }\r\n    };\r\n\r\n    let videoConstraints =\r\n    {\r\n        video:\r\n        {\r\n            deviceId: { exact: undefined },\r\n            width: { exact: undefined },\r\n            height: { exact: undefined },\r\n            frameRate: { ideal: 60 }\r\n        }\r\n    };\r\n\r\n    let settings =\r\n    {\r\n        audio: \"None\", // label\r\n        video: \"None\", // label\r\n        resolution: \"Undefined\", // resolutions key\r\n    };\r\n\r\n    let previousAudioConstraints = null;\r\n    let previousVideoConstraints = null;\r\n\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start the media adapter.\r\n     */\r\n    let start = async function()\r\n    {\r\n        if( !navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Create a dummy stream.\r\n        audioStream = new SilenceStream();\r\n        videoStream = new BlackStream();\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        await window.navigator.mediaDevices.getUserMedia({ audio: true }).catch(e => console.error(e));\r\n        await window.navigator.mediaDevices.getUserMedia({ video: true }).catch(e => console.error(e));\r\n        await findDevices();\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Find the available input and output devices.\r\n     */\r\n    let findDevices = async function()\r\n    {\r\n        return getDevices().then(gotDevices).catch(errorDevices);\r\n    };\r\n\r\n    /**\r\n     * Request a list of the available input and output devices.\r\n     */\r\n    let getDevices = function()\r\n    {\r\n        return window.navigator.mediaDevices.enumerateDevices();\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get devices function.\r\n     */\r\n    let gotDevices = function( deviceInfos )\r\n    {\r\n        audioDevices = { };\r\n        videoDevices = { };\r\n\r\n        // Add inputs for silence and black streams.\r\n        audioDevices[\"None\"] = \"\";\r\n        videoDevices[\"None\"] = \"\";\r\n\r\n        let a = 0, v = 0;\r\n        for( let deviceInfo of deviceInfos )\r\n        {\r\n            if( deviceInfo.kind === \"audioinput\" )\r\n            {\r\n                let label = (deviceInfo.label === \"\" ) ? (\"Audio input \" + a) : deviceInfo.label;\r\n                audioDevices[label] = deviceInfo.deviceId;\r\n                a++;\r\n            }\r\n\r\n            if( deviceInfo.kind === \"videoinput\" )\r\n            {\r\n                let label = (deviceInfo.label === \"\" ) ? (\"Video input \" + v) : deviceInfo.label;\r\n                videoDevices[label] = deviceInfo.deviceId;\r\n                v++;\r\n            }\r\n        }\r\n\r\n        emit(MediaEvent.GotDevices, { audioDevices: audioDevices, videoDevices: videoDevices, settings: settings });\r\n        emit(MediaEvent.GotResolutions, { resolutions: resolutions, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get devices function.\r\n     */\r\n    let errorDevices = function( error )\r\n    {\r\n        let message = \"Device request not allowed in the browser\";\r\n        emit(MediaEvent.ErrorDevices, { error: error, message: message });\r\n    };\r\n\r\n    /**\r\n     * Set the audio device.\r\n     */\r\n    let setAudio = function( device )\r\n    {\r\n        if( !device )\r\n        {\r\n            device = \"None\";\r\n        }\r\n\r\n        if( !(device in audioDevices) )\r\n        {\r\n            let error = \"DeviceNotFound\";\r\n            let message = \"Audio device \" + device + \" not found\";\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            device = \"None\";\r\n        }\r\n\r\n        if( device === \"None\" )\r\n        {\r\n            // Update settings.\r\n            settings.audio = device;\r\n\r\n            // Get dummy stream.\r\n            audioStream = new SilenceStream();\r\n            mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n            emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n        }\r\n        else\r\n        {\r\n            // Save previous constraints.\r\n            previousAudioConstraints = clone(audioConstraints);\r\n\r\n            // Update constraints.\r\n            let deviceId = audioDevices[device];\r\n            audioConstraints.audio.deviceId.exact = deviceId;\r\n\r\n            getAudioStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set the video device and resolution.\r\n     */\r\n    let setVideo = function( device, resolution = \"Undefined\" )\r\n    {\r\n        if( !device )\r\n        {\r\n            device = \"None\";\r\n            resolution = \"Undefined\";\r\n        }\r\n\r\n        if( !resolution )\r\n        {\r\n            resolution = \"Undefined\";\r\n        }\r\n\r\n        if( !(device in videoDevices) )\r\n        {\r\n            let error = \"DeviceNotFound\";\r\n            let message = \"Video device \" + device + \" not found\";\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            device = \"None\";\r\n        }\r\n\r\n        if( !(resolution in resolutions) )\r\n        {\r\n            let error = \"ResolutionNotFound\";\r\n            let message = \"Resolution \" + resolution + \" not found\";\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            resolution = \"Undefined\";\r\n        }\r\n\r\n        if( device === \"None\" )\r\n        {\r\n            // Update settings.\r\n            settings.video = device;\r\n            settings.resolution = resolution;\r\n\r\n            // Get dummy stream.\r\n            let width = resolutions[resolution].width;\r\n            let height = resolutions[resolution].height;\r\n            videoStream = new BlackStream(width, height);\r\n            mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n            emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n        }\r\n        else\r\n        {\r\n            // Save previous constraints.\r\n            previousVideoConstraints = clone(videoConstraints);\r\n\r\n            // Update constraints.\r\n            let deviceId = videoDevices[device];\r\n            videoConstraints.video.deviceId.exact = deviceId;\r\n            let width = resolutions[resolution].width;\r\n            let height = resolutions[resolution].height;\r\n            videoConstraints.video.width.exact = width;\r\n            videoConstraints.video.height.exact = height;\r\n\r\n            getVideoStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Request an audio stream.\r\n     */\r\n    let getAudioStream = function()\r\n    {\r\n        mediaStream = null;\r\n        stopStream(audioStream);\r\n        return window.navigator.mediaDevices.getUserMedia(audioConstraints).then(gotAudioStream).catch(errorAudioStream);\r\n    };\r\n\r\n    /**\r\n     * Request a video stream.\r\n     */\r\n    let getVideoStream = function()\r\n    {\r\n        mediaStream = null;\r\n        stopStream(videoStream);\r\n        return window.navigator.mediaDevices.getUserMedia(videoConstraints).then(gotVideoStream).catch(errorVideoStream);\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get audio stream function.\r\n     */\r\n    let gotAudioStream = async function( stream )\r\n    {\r\n        let audioTrack = stream.getAudioTracks()[0];\r\n\r\n        // Check whether the label is listed, enumerateDevices returns an empty label if the permission for accessing the mediadevice is not given.\r\n        if( !(audioTrack.label in audioDevices) )\r\n        {\r\n            await findDevices();\r\n        }\r\n\r\n        // Update settings.\r\n        settings.audio = audioTrack.label;\r\n\r\n        audioStream = stream;\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get video stream function.\r\n     */\r\n    let gotVideoStream = async function( stream )\r\n    {\r\n        // Video track.\r\n        let videoTrack = stream.getVideoTracks()[0];\r\n        let videoTrackSettings = videoTrack.getSettings();\r\n\r\n        // Check whether the label is listed, enumerateDevices returns an empty label if the permission for accessing the mediadevice is not given.\r\n        if( !(videoTrack.label in videoDevices) )\r\n        {\r\n            await findDevices();\r\n        }\r\n\r\n        // Check whether the resolution is already listed.\r\n        let width = videoTrackSettings.width;\r\n        let height = videoTrackSettings.height;\r\n        let resolution = width + \"x\" + height;\r\n        if( !resolutions[resolution] )\r\n        {\r\n            // Add the resolution.\r\n            resolutions[resolution] = { width: width, height: height };\r\n\r\n            // Sort resolutions.\r\n            resolutions = Object.entries(resolutions).sort((a, b) => (a[1].width || Number.NEGATIVE_INFINITY) > (b[1].width || Number.NEGATIVE_INFINITY)).reduce((r, [k, v]) => ({ ...r, [k]: v }), {});\r\n\r\n            emit(MediaEvent.GotResolutions, { resolutions: resolutions, settings: settings });\r\n        }\r\n\r\n        // Update video constraints.\r\n        videoConstraints.video.width.exact = width;\r\n        videoConstraints.video.height.exact = height;\r\n\r\n        // Update settings.\r\n        settings.video = videoTrack.label;\r\n        settings.resolution = resolution;\r\n\r\n        videoStream = stream;\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Return a semantic error string from the specified error.\r\n     */\r\n    let errorStream = function( error )\r\n    {\r\n        let message = \"\";\r\n        if( error.name === \"NotFoundError\" || error.name === \"DevicesNotFoundError\" )\r\n        {\r\n            message = \"Required track is missing\";\r\n        }\r\n        else if( error.name === \"NotReadableError\" || error.name === \"TrackStartError\" )\r\n        {\r\n            message = \"Microphone or Webcam are already in use\";\r\n        }\r\n        else if( error.name === \"OverconstrainedError\" || error.name === \"ConstraintNotSatisfiedError\" )\r\n        {\r\n            //message = \"Constraints cannot be satisfied\";\r\n            message = \"Invalid device settings\";\r\n        }\r\n        else if( error.name === \"NotAllowedError\" || error.name === \"PermissionDeniedError\" )\r\n        {\r\n            message = \"Permission denied in browser\";\r\n        }\r\n        else if( error.name === \"TypeError\" || error.name === \"TypeError\" )\r\n        {\r\n            message = \"Empty constraints object\";\r\n        }\r\n        else\r\n        {\r\n            message = \"Unknown error\";\r\n        }\r\n\r\n        return message;\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get audio stream function.\r\n     */\r\n    let errorAudioStream = function( error )\r\n    {\r\n        let message = errorStream(error);\r\n        emit(MediaEvent.ErrorStream, { error: error.name, message: message, settings: settings });\r\n\r\n        if( previousAudioConstraints )\r\n        {\r\n            audioConstraints = clone(previousAudioConstraints);\r\n            previousAudioConstraints = null;\r\n            getAudioStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get video stream function.\r\n     */\r\n    let errorVideoStream = function( error )\r\n    {\r\n        let message = errorStream(error);\r\n        emit(MediaEvent.ErrorStream, { error: error.name, message: message, settings: settings });\r\n\r\n        if( previousVideoConstraints )\r\n        {\r\n            videoConstraints = clone(previousVideoConstraints);\r\n            previousVideoConstraints = null;\r\n            getVideoStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Mix two streams with 1 audio and 1 video tracks into one.\r\n     */\r\n    let mixStreams = function( audioStream, videoStream )\r\n    {\r\n        let audioTracks = audioStream.getAudioTracks();\r\n        if( !audioTracks || audioTracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let videoTracks = videoStream.getVideoTracks();\r\n        if( !videoTracks || videoTracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let stream = new MediaStream();\r\n        stream.addTrack(audioTracks[0]);\r\n        stream.addTrack(videoTracks[0]);\r\n\r\n        return stream;\r\n    };\r\n\r\n    /**\r\n     * Stop a stream, stopping its tracks.\r\n     */\r\n    let stopStream = function( stream )\r\n    {\r\n        stream.getTracks().forEach(track => track.stop());\r\n    };\r\n\r\n    /**\r\n     * Return a clone of the object.\r\n     */\r\n    let clone = function( object )\r\n    {\r\n        return JSON.parse(JSON.stringify(object));\r\n    };\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        start,\r\n        findDevices,\r\n        getDevices,\r\n        setAudio,\r\n        setVideo\r\n    };\r\n}\r\n\r\nexport function SilenceTrack()\r\n{\r\n    let stream = new SilenceStream();\r\n    let track = stream.getAudioTracks()[0];\r\n    return track;\r\n}\r\n\r\nexport function BlackTrack( width = 320, height = 240 )\r\n{\r\n    let stream = new BlackStream(width, height);\r\n    let track = stream.getVideoTracks()[0];\r\n    return track;\r\n}\r\n\r\nexport function SilenceStream()\r\n{\r\n    let audioContext = new AudioContext();\r\n\r\n    let gainNode = audioContext.createGain();\r\n    let oscillatorNode = audioContext.createOscillator();\r\n    oscillatorNode.connect(gainNode);\r\n    let destination = gainNode.connect(audioContext.createMediaStreamDestination());\r\n\r\n    gainNode.gain.setValueAtTime(0, audioContext.currentTime);\r\n    oscillatorNode.start();\r\n\r\n    let stream = destination.stream;\r\n    return stream;\r\n}\r\n\r\nexport function BlackStream( width = 320, height = 240 )\r\n{\r\n    let canvas = window.document.createElement(\"canvas\");\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    let context = canvas.getContext(\"2d\");\r\n    let interval = null;\r\n    function render()\r\n    {\r\n        if( !context )\r\n        {\r\n            window.clearInterval(interval);\r\n            return;\r\n        }\r\n\r\n        context.fillRect(0, 0, width, height);\r\n        // context.beginPath();\r\n        // context.rect(0, 0, width, height);\r\n        // context.fillStyle = \"blue\";\r\n        // context.fill();\r\n    }\r\n    interval = window.setInterval(render, 1000);\r\n\r\n    let stream = canvas.captureStream();\r\n    return stream;\r\n}\r\n\r\nexport function DummyStream()\r\n{\r\n    let silenceStream = new SilenceStream();\r\n    let blackStream = new BlackStream();\r\n    let silenceTrack = silenceStream.getAudioTracks()[0];\r\n    let blackTrack = blackStream.getVideoTracks()[0];\r\n    let stream = new MediaStream([silenceTrack, blackTrack]);\r\n\r\n    /**\r\n     * Return the audio track.\r\n     */\r\n    let getAudioTrack = function()\r\n    {\r\n        return silenceTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the video track.\r\n     */\r\n    let getVideoTrack = function()\r\n    {\r\n        return blackTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the stream.\r\n     */\r\n    let getStream = function()\r\n    {\r\n        return stream;\r\n    };\r\n\r\n    return {\r\n        getAudioTrack,\r\n        getVideoTrack,\r\n        getStream\r\n    };\r\n}","// eslint-disable\r\n\r\n//import AdapterJS from 'adapterjs';\r\nimport { RTCEvent,   RTCClient }    from \"./rtcClient.js\";  // eslint-disable-line\r\nimport { LobbyEvent, LobbyClient }  from './lobbyClient.js';      // eslint-disable-line\r\nimport { MediaEvent, MediaAdapter } from \"./mediaAdapter.js\";   // eslint-disable-line\r\nimport { DummyStream }  from \"./dummyStream.js\";\r\n\r\nconst DEBUG = process.env.REACT_APP_DEBUG ?? false;\r\n\r\nlet appClient    = window.appClient    = new LobbyClient({ debug: DEBUG }),\r\n    mediaAdapter = window.mediaAdapter = new MediaAdapter({ debug: DEBUG }),\r\n    dummyStream  = window.dummyStream  = new DummyStream({ debug: DEBUG }),\r\n    rtcClient    = window.rtcClient    = new RTCClient({ debug: DEBUG, defaultStream: dummyStream.getStream() });\r\n\r\nlet APPEvent = LobbyEvent;\r\n\r\nexport {\r\n   APPEvent,\r\n   RTCEvent,\r\n   MediaEvent,\r\n   rtcClient, \r\n   appClient,\r\n   mediaAdapter,\r\n   dummyStream\r\n}","export function DummyStream()\r\n{\r\n//#region PRIVATE\r\n\r\n    let _blackCanvas = null;\r\n    let _silenceStream = null;\r\n    let _blackStream = null;\r\n    let _silenceTrack = null\r\n    let _blackTrack = null;\r\n\r\n    /**\r\n     * Create a silence audio track.\r\n     */\r\n    let createSilenceTrack = function()\r\n    {\r\n        let audioContext = new AudioContext();\r\n\r\n        let gainNode = audioContext.createGain();\r\n        let oscillatorNode = audioContext.createOscillator();\r\n        oscillatorNode.connect(gainNode);\r\n        let destination = gainNode.connect(audioContext.createMediaStreamDestination());\r\n\r\n        _silenceStream = destination.stream;\r\n        _silenceTrack = _silenceStream.getAudioTracks()[0];\r\n    };\r\n\r\n    /**\r\n     * Create a black video track.\r\n     * @param {Number} width - The video width.\r\n     * @param {Number} height - The video height.\r\n     */\r\n    let createBlackTrack = function( width = 320, height = 240 )\r\n    {\r\n        if( !_blackCanvas )\r\n        {\r\n            _blackCanvas = window.document.createElement(\"canvas\");\r\n        }\r\n\r\n        _blackCanvas.width = width;\r\n        _blackCanvas.height = height;\r\n        let context = _blackCanvas.getContext(\"2d\");\r\n        context.fillRect(0, 0, width, height);\r\n\r\n        _blackStream = _blackCanvas.captureStream();\r\n        _blackTrack = _blackStream.getVideoTracks()[0];\r\n    };\r\n\r\n    createSilenceTrack();\r\n    createBlackTrack();\r\n    let _stream = new MediaStream([_silenceTrack, _blackTrack]);\r\n\r\n    /**\r\n     * Return the audio track.\r\n     * @returns {MediaStreamTrack} The audio track.\r\n     */\r\n    let getAudioTrack = function()\r\n    {\r\n        return _silenceTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the video track.\r\n     * @returns {MediaStreamTrack} The video track.\r\n     */\r\n    let getVideoTrack = function()\r\n    {\r\n        return _blackTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the stream.\r\n     * @returns {MediaStream} The stream.\r\n     */\r\n    let getStream = function()\r\n    {\r\n        return _stream;\r\n    };\r\n\r\n//#endregion\r\n\r\n//#region PUBLIC\r\n\r\n    return {\r\n        getAudioTrack,\r\n        getVideoTrack,\r\n        getStream\r\n    };\r\n\r\n//#endregion\r\n}","\r\nlet http = {\r\n    get: async function(url, options = {}) {\r\n        const headers = Object.assign({\r\n            'Content-Type': 'application/json'\r\n        }, options.headers ?? {});\r\n\r\n        return fetch(url, {method: 'GET',headers})\r\n        .then(response => response.json())\r\n        .catch(error => console.trace(error));\r\n    },\r\n\r\n    post: async function(url, options = {}) {\r\n        const headers = Object.assign({\r\n            'Content-Type': 'application/json'\r\n        }, options.headers ?? {});\r\n\r\n        const body = JSON.stringify(options.data ?? {});\r\n\r\n        return fetch(url, {method: 'POST',headers,body})\r\n        .then(response =>  response.json())\r\n        .catch(error => console.trace(error));\r\n    },\r\n}\r\n\r\nexport default http;","import * as BRA from \"lib_bra\"\r\nimport toast from 'react-hot-toast'\r\nimport { useState, useContext, useReducer, useEffect, createContext, useRef } from 'react'\r\n\r\n\r\nexport const MediaContext = createContext(); \r\nexport default ({children, ...props}) => {\r\n\r\n    let   {current:init_evts}            = useRef(0);\r\n    const videoRef                       = useRef(null);\r\n    const [ready, setReady ]             = useState(false);\r\n    const [devices , setDevices]         = useState(null);\r\n    const [settings, setSettings ]       = useState(null);\r\n    const [resolutions, setResolutions ] = useState(null);\r\n    let [localStream, setLocalStream ] = useReducer( (value, newvalue)=>{\r\n        if( videoRef && videoRef.current )\r\n            videoRef.current.srcObject = newvalue;\r\n        return newvalue;\r\n    }, BRA.dummyStream.getStream() );\r\n    \r\n    useEffect( ()=>{ \r\n      \r\n     \r\n        (async ()=>{\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.GotDevices,          onGotDevices );\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.ErrorStream,         onError);\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.ErrorDevices,        onError);\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.GotResolutions,      onGotResolutions );\r\n  \r\n            let supported = await BRA.mediaAdapter.start();\r\n            if( !supported )\r\n                return toast.error(\"Media devices are not available\");\r\n            \r\n\r\n            let audio = window.localStorage.getItem(\"audio\");\r\n            let video = window.localStorage.getItem(\"video\");               \r\n            \r\n            await new Promise((resolve, reject)=>{\r\n                function onStream(d){\r\n                    BRA.mediaAdapter.off(BRA.MediaEvent.GotStream, onStream );\r\n                    resolve(d);\r\n                }\r\n                BRA.mediaAdapter.on(BRA.MediaEvent.GotStream, onStream );\r\n                BRA.mediaAdapter.setVideo(video);\r\n            })\r\n            .then(onGotStream);\r\n\r\n            await new Promise((resolve, reject)=>{\r\n                function onStream(d){\r\n                    BRA.mediaAdapter.off(BRA.MediaEvent.GotStream, onStream );\r\n                    BRA.mediaAdapter.on(BRA.MediaEvent.GotStream, onGotStream );\r\n                    resolve(d);\r\n                }\r\n                BRA.mediaAdapter.on(BRA.MediaEvent.GotStream, onStream );\r\n                BRA.mediaAdapter.setAudio(audio);\r\n            })\r\n            .then(onGotStream)        \r\n           \r\n            setReady(true);\r\n        })();\r\n            \r\n        function onUnload(){\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.GotStream,      onGotStream );\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.GotDevices,     onGotDevices );\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.ErrorStream,    onError);\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.ErrorDevices,   onError);\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.GotResolutions, onGotResolutions );\r\n            window.removeEventListener('unload ', onUnload);\r\n        }\r\n        window.addEventListener('unload ',    onUnload);\r\n    return ()=>{\r\n        onUnload();\r\n    }}, []);\r\n\r\n    function getDevices(){\r\n        BRA.mediaAdapter.getDevices();\r\n    }\r\n\r\n    function onGotResolutions({resolutions, settings})\r\n    { \r\n        setSettings({...settings});\r\n        setResolutions(resolutions); \r\n    }\r\n    \r\n    function onGotDevices ({ audioDevices: audio, videoDevices: video, settings }) \r\n    { \r\n        setSettings({...settings});\r\n        setDevices({...devices, audio, video});\r\n    }\r\n\r\n    function onGotStream({stream, settings})\r\n    { \r\n        window.localStorage.setItem(\"audio\", settings?.audio);\r\n        window.localStorage.setItem(\"video\", settings?.video);\r\n        window.localStream = localStream = stream;\r\n        setSettings({...settings});\r\n        setLocalStream(localStream);\r\n    }\r\n\r\n    function onError({error, message}){\r\n        toast.error(`${error}: ${message}`);\r\n    }\r\n\r\n    function init(){\r\n        if( init_evts <= 0 ){\r\n            //start the thing\r\n            //BRA.mediaAdapter.start();\r\n            getDevices();\r\n        }\r\n        ++init_evts;\r\n    }\r\n\r\n    function stop(){\r\n        --init_evts;\r\n        if( init_evts <= 0 ){\r\n            //BRA.mediaAdapter.stop();\r\n            //stop the thing\r\n        }\r\n    }\r\n\r\n    function setVideo(device, resolution){\r\n        BRA.mediaAdapter.setVideo(device, resolution);\r\n    }\r\n    function setAudio(device){\r\n        BRA.mediaAdapter.setAudio(device);\r\n    }\r\n\r\n    const store = window.media = {\r\n        devices,\r\n        settings, \r\n        resolutions,\r\n        localStream,\r\n        init,\r\n        stop,\r\n        getDevices,\r\n        setVideo,\r\n        setAudio,\r\n        ready,\r\n    }\r\n\r\n    return <MediaContext.Provider value={store} children={children}/>\r\n}","import * as BRA from \"lib_bra\"\r\nimport toast from 'react-hot-toast'\r\nimport { useState, useContext, useEffect, createContext } from 'react'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport { strategy } from \"workbox-streams\"\r\n\r\n\r\nexport const StreamContext = createContext(); \r\nexport default ({children, ...props}) => {\r\n    const auth  = useContext(AuthContext);\r\n    const rooms = useContext(RoomsContext);\r\n    const media = useContext(MediaContext);\r\n\r\n    const [state, setState]             = useState(0);\r\n    let   [streams, setStreams]         = useState({});\r\n    let   [liveCalls, setLiveCalls]     = useState({});\r\n    let   [localStream, setLocalStream] = useState(media.localStream);\r\n\r\n    useEffect( ()=>{ \r\n        BRA.rtcClient.on(BRA.RTCEvent.IncomingCall, onIncomingCall);\r\n        BRA.rtcClient.on(BRA.RTCEvent.CallOpened,   onCallOpened);\r\n        BRA.rtcClient.on(BRA.RTCEvent.CallClosed,   onCallClosed);\r\n        BRA.rtcClient.on(BRA.RTCEvent.UserHangup,   onUserHangup);\r\n    return ()=>{\r\n        BRA.rtcClient.off(BRA.RTCEvent.IncomingCall, onIncomingCall);\r\n        BRA.rtcClient.off(BRA.RTCEvent.CallOpened,   onCallOpened);\r\n        BRA.rtcClient.off(BRA.RTCEvent.CallClosed,   onCallClosed);\r\n        BRA.rtcClient.off(BRA.RTCEvent.UserHangup,   onUserHangup);\r\n    }}, []);\r\n\r\n    useEffect( ()=>{\r\n        setState(s => s+1);\r\n        localStream = media.localStream;\r\n        setLocalStream(localStream);\r\n    }, [media.localStream]);\r\n\r\n    function callUser(username, callback){\r\n        return BRA.rtcClient.call(username, callback ?? (({callId, status, description}) => {\r\n            if(status === 'error'){\r\n                toast.error(`Call error: ${description}`,{icon:<i className=\"bi bi-telephone-x\"/>, duration: 5000});\r\n            }\r\n        }));\r\n    }\r\n\r\n    function callAllUsers(){\r\n        const users = rooms.current?.users?.filter((v, k, a) => { return v && v?.username !== auth.user?.username });\r\n        for (let user of users ?? []){\r\n            \r\n            if(!callUser(user?.username)){\r\n                toast.error(`Call missed to ${user?.username}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    function callHangup(callId){\r\n        BRA.rtcClient.hangup(callId);\r\n    }\r\n\r\n    function callHangupAll(){\r\n        const calls = Object.keys(BRA.rtcClient.getCalls())\r\n        for (let callId of calls){\r\n            callHangup(callId);\r\n        }\r\n    }\r\n\r\n    function onIncomingCall({ callId, callerId }){\r\n        BRA.rtcClient.acceptCall(callId);\r\n    }\r\n\r\n    function onCallOpened({ call, stream }) {\r\n        const callId = call.callId;\r\n        \r\n        streams = {...streams, [callId]: stream}\r\n        setStreams(streams);\r\n        const forwardingCallId = liveCalls[callId];   //Live call\r\n\r\n        if (forwardingCallId) {\r\n            const forward_stream = streams[forwardingCallId];\r\n            if (!forward_stream) {\r\n                callHangup(callId);\r\n                return toast.error(`Live Call Error: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);;\r\n            }\r\n            toast.success(`Live Call: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);\r\n            const videotrack = forward_stream.getVideoTracks()[0];\r\n            const audiotrack = forward_stream.getAudioTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n            toast(`Forwarding stream`, {icon:<i className=\"bi bi-cast\"/>});\r\n        }\r\n\r\n        //Regular call\r\n        else {\r\n            toast.success(`Incoming Call: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);\r\n            //TODO:esto no deberia estar en window!!!!\r\n            if(!window.localStream) return;\r\n            const videotrack = window.localStream.getVideoTracks()[0];\r\n            const audiotrack = window.localStream.getAudioTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n            toast(`Call from ${getUserId(callId)}`, {icon:<i className=\"bi bi-telephone-inbound\"/>});\r\n        }\r\n    }\r\n\r\n    function onCallClosed({ call }){\r\n        if (!call)\r\n            return console.error(\"No call\");\r\n\r\n        const callId = call.callId;\r\n        manageLiveCallClosed(callId);\r\n\r\n        delete streams[callId];\r\n        setStreams({...streams});\r\n        toast(`Call from ${getUserId(callId)} closed`, {icon:<i className=\"bi bi-telephone-x\"/>});\r\n    }\r\n\r\n    function onUserHangup({ callId }){\r\n        if (!callId)\r\n            return console.error(\"No call\");\r\n\r\n        manageLiveCallClosed(callId);\r\n        delete streams[callId];\r\n        setStreams({...streams});\r\n\r\n        toast(`User ${getUserId(callId)} hangup`, {icon:<i className=\"bi bi-telephone-x\"/>});\r\n    }\r\n\r\n    function manageLiveCallClosed(callId) {\r\n        let result = null;\r\n        for (const [mId, fId] of Object.entries(liveCalls)) {\r\n            if (callId !== mId && fId !== callId)\r\n                continue;\r\n\r\n            result = [mId, fId];\r\n            break;\r\n        }\r\n\r\n        if (result) {\r\n            const [mediaHubCallId, forwardedCallId] = result;\r\n            delete liveCalls[mediaHubCallId];\r\n            setLiveCalls(liveCalls);\r\n        }\r\n    }\r\n\r\n    function getUserId(callId){\r\n        let id = auth.user?.username;\r\n        let call = BRA.rtcClient.getCalls()[callId];\r\n        if (callId !== \"local\" && call) {\r\n            let { calleeId, callerId } = call;\r\n            id = (calleeId === auth.user?.username) ? callerId : calleeId;\r\n        }\r\n        return id;\r\n    }\r\n\r\n    //TODO:check this\r\n    function forwardCall(source, target) {\r\n        if (!target || !source)\r\n            return console.error(`source or target callId's are undefined`);\r\n        liveCalls[target] = source;\r\n        setLiveCalls({...liveCalls});\r\n    }\r\n\r\n    function getLiveCall(callId)\r\n    {\r\n        return Object.entries(liveCalls).find( v => v[1] === callId ) ?? [null,null];\r\n    }\r\n\r\n    function replaceStream(stream){\r\n        for( const callId in BRA.rtcClient.getCalls() )\r\n        {\r\n            let s = stream;\r\n            const forwardingCallId = liveCalls[callId];   //Live call\r\n            if(forwardingCallId && streams[forwardingCallId])\r\n            {\r\n                s = streams[forwardingCallId];\r\n            }\r\n\r\n            let call = BRA.rtcClient.getCall(callId);\r\n            let audiotrack = s.getAudioTracks()[0];\r\n            let videotrack = s.getVideoTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n        }\r\n    }\r\n\r\n    const store = window.wrtc = {\r\n        callUser,\r\n        callAllUsers,\r\n        callHangup,\r\n        callHangupAll,\r\n        forwardCall,\r\n        getUserId,\r\n        getLiveCall,\r\n        replaceStream,\r\n        streams: {...streams, local:localStream},\r\n    }\r\n\r\n    return <StreamContext.Provider value={store} children={children}/>\r\n}"],"sourceRoot":""}