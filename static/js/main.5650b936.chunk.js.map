{"version":3,"sources":["assets/img/logo.png","partials/video.jsx","components/layout.jsx","views/verified.jsx","views/resetpassword.jsx","components/modal_about.jsx","partials/modal.jsx","components/modal_profile.jsx","components/btn_fullscreen.jsx","partials/title.jsx","partials/nav.jsx","components/badge_forward.jsx","views/room.jsx","components/modal_recovery.jsx","components/modal_register.jsx","views/login.jsx","components/modal_create_room.jsx","views/lobby.jsx","views/wizard.jsx","components/modal_leave_room.jsx","components/modal_wizard.jsx","components/modal_users.jsx","components/modal_chat.jsx","components/btngrp_stream.jsx","views/App.jsx","utils/ctx_rooms.jsx","utils/md.jsx","utils/ctx_authentication.jsx","pages lazy /^/.*/.jsx$/ groupOptions: {} namespace object","reportWebVitals.js","serviceWorkerRegistration.js","index.js","utils/ctx_mediadevices.jsx","utils/http.js","../lib/bra/rtcClient.js","../lib/bra/lobbyClient.js","../lib/bra/mediaAdapter.js","../lib/bra/index.js","../lib/bra/dummyStream.js","utils/ctx_streaming.jsx"],"names":["id","stream","onClick","isLocal","props","ref","useRef","useState","audio","status","setStatus","useEffect","current","srcObject","play","className","variant","disabled","autoPlay","playsInline","muted","window","toast","children","position","reverseOrder","toastOptions","duration","style","background","color","basename","process","title","property","content","REACT_APP_OG_TYPE","envREACT_APP_OG_IMAGE","component","App","exact","path","Verified","ResetPass","to","history","useHistory","size","show","button_tittle","callback","push","token","useParams","formRef","undefined","validated","setValidated","formErrors","formvalues","setFormValues","e","a","preventDefault","toastId","loading","password","http","post","data","then","description","message","success","setTimeout","error","warn","catch","err","isValid","key","indexOf","validateForm","onSubmit","closeButton","onHide","buttons","placement","overlay","type","controlId","label","Control","required","name","placeholder","onChange","value","check","test","length","console","v","validateField","target","defaultValue","setShow","useReducer","o","n","proposalEvent","proposal","dispatch","onBeforeInstallPrompt","state","prompt","userChoice","outcome","addEventListener","removeEventListener","centered","keyboard","dialogClassName","Header","Title","Body","Footer","map","k","auth","useContext","AuthContext","isLogged","user","username","logout","setState","f","screenfull","on","off","isEnabled","toggle","document","fullscreen","rooms","RoomsContext","width","height","src","logo","Nav","zIndex","Item","icon","appendclass","Button","button","callId","isForwardCall","wrtc","StreamContext","fetching","setFetching","getLiveCall","mediaHubCallId","submit","mediaHubtarget","callUser","Spinner","as","animation","role","Badge","padding","pill","bg","callHangup","onKeyDown","keyCode","FloatingLabel","Form","roomId","carouselRef","media","MediaContext","selected","setSelected","imInRoom","ready","callAllUsers","callHangupAll","replaceStream","localStream","Row","Col","xs","Object","entries","local","streams","getUserId","master","isSelected","handleSubmit","email","toLowerCase","OverlayTrigger","Tooltip","isConnected","handleUserInput","values","testImage","url","timeoutT","Promise","resolve","reject","timer","timeout","img","Image","onerror","onabort","clearTimeout","onload","gravatar","Gravatar","s","r","d","checked","avatar","surname","birthdate","Card","roundedCircle","Group","htmlFor","cookies","get","remember","login","app_token","set","Img","Text","Switch","defaultChecked","Array","from","elements","roomname","hidden","createRoom","room","tabIndex","RoomTile","onKeyPress","list","sm","span","offset","lg","xl","joinRoom","pages","page","setPage","views","setViews","onKeyPressed","vs","p","default","onSwipeLeft","onSwipeRight","leaveRoom","_title","log","users","canvasRef","isAudioEnabled","setAudioEnabled","audiotracks","getAudioTracks","every","enabled","settings","ctx","getContext","globalAlpha","requestAnimationFrame","draw","clearRect","canvas","x0","y0","x1","y1","r1","gradient","createRadialGradient","addColorStop","fillStyle","fillRect","cancelAnimationFrame","marginTop","marginBottom","track","view","location","pathname","container","Container","fluid","createContext","setRooms","setReady","setCurrent","isUserInRoom","roomName","onRoomCreated","onRoomDeleted","BRA","getRoom","onGetRoom","onGuestLeft","filter","u","onGuestJoin","GuestLeftRoom","GuestJoinedRoom","RoomCreated","RoomDeleted","getRooms","m1","rs","onGetRooms","m2","store","event","Provider","replaceAll","remarkPlugins","remarkGfm","remarkBreaks","rehypePlugins","rehypeRaw","setUser","setToken","setLogged","app","rtc","setConnected","toast_app","toast_rtc","toast_usr","retries","setRetries","response","access_token","unregister","disconnect","headers","Authorization","onUnload","onAppConnect","onAppDisconnect","onRtcConnect","onRtcDisconnect","ClientConnected","ClientDisconnected","connect","Infinity","getUserInfo","t","setTimer","interval_id","setInterval","Math","max","clearInterval","register","webpackAsyncContext","req","__webpack_require__","Error","code","ids","keys","module","exports","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","render","StrictMode","Suspense","fallback","ProgressBar","animated","now","getElementById","URL","href","origin","fetch","contentType","reload","checkValidServiceWorker","serviceWorkerRegistration","init_evts","videoRef","devices","setDevices","setSettings","resolutions","setResolutions","newvalue","getStream","setLocalStream","getDevices","onGotResolutions","onGotDevices","audioDevices","video","videoDevices","onGotStream","onError","start","init","stop","setVideo","device","resolution","setAudio","options","assign","method","json","trace","body","JSON","stringify","RTCEvent","IncomingCall","CallAccepted","CallCanceled","CallOpened","CallClosed","UserHangup","RTCCall","callerId","calleeId","connection","candidates","channels","initiator","getStats","callStats","stats","pairStats","forEach","report","localCandidateId","localType","candidateType","localAddress","address","ip","localPort","port","localProtocol","protocol","remoteCandidateId","remoteType","remoteAddress","remotePort","remoteProtocol","bind","peerConnection","isInitiator","RTCPeerConnection","channel","close","getState","iceConnectionState","addCandidate","candidate","addIceCandidate","gatherPendingCandidates","setRemoteDescription","setBandwidth","bandwidth","senders","getSenders","i","sender","parameters","getParameters","encodings","maxBitrate","setParameters","getRemoteAudioTrack","index","receivers","getReceivers","tracks","receiver","kind","getRemoteVideoTrack","getRemoteStream","MediaStream","addTrack","replaceLocalAudioTrack","audioSenders","replaceTrack","replaceLocalVideoTrack","videoSenders","openChannel","createDataChannel","closeChannel","onDataChannel","onChannelOpen","onopen","onChannelClose","onChannelError","onChannelMessage","onmessage","sendData","readyState","send","LobbyEvent","UserOnline","UserOffline","UserRejoined","MediaEvent","GotDevices","ErrorDevices","GotResolutions","GotStream","ErrorStream","SilenceStream","audioContext","AudioContext","gainNode","createGain","oscillatorNode","createOscillator","destination","createMediaStreamDestination","gain","setValueAtTime","currentTime","BlackStream","createElement","context","interval","captureStream","DEBUG","appClient","debug","debugStyle","pingPeriod","responses","events","socket","keepAliveTimeout","emit","args","slice","call","arguments","listeners","apply","this","onOpen","startKeepAlive","onClose","stopKeepAlive","onMessage","msg","parse","uuid","sendMessage","WebSocket","OPEN","ping","uuidv4","replace","c","crypto","getRandomValues","Uint8Array","toString","listener","splice","accessToken","onclose","mediaAdapter","audioStream","videoStream","mediaStream","audioConstraints","deviceId","videoConstraints","frameRate","ideal","previousAudioConstraints","previousVideoConstraints","mediaDevices","enumerateDevices","mixStreams","getUserMedia","findDevices","gotDevices","errorDevices","deviceInfos","deviceInfo","getAudioStream","stopStream","gotAudioStream","errorAudioStream","getVideoStream","gotVideoStream","errorVideoStream","audioTrack","videoTrack","getVideoTracks","videoTrackSettings","getSettings","sort","b","Number","NEGATIVE_INFINITY","reduce","errorStream","clone","audioTracks","videoTracks","getTracks","object","dummyStream","_blackCanvas","_silenceStream","_blackStream","_silenceTrack","_blackTrack","createSilenceTrack","createBlackTrack","_stream","getAudioTrack","getVideoTrack","rtcClient","defaultSettings","defaultStream","calls","userId","rtcConfiguration","iceServers","handleRegisterResponse","handleUnregisterResponse","handleCallResponse","handleIncomingCall","handleCallAccepted","handleCallCanceled","handleRemoteOffer","handleRemoteAnswer","handleRemoteCandidate","handleUserHangup","closeCall","hangup","oniceconnectionstatechange","other","handleIceConnectionStateChange","onicecandidate","onnegotiationneeded","createOffer","sdp","setLocalDescription","offer","createAnswer","answer","getCall","getCalls","CLOSED","acceptCall","cancelCall","APPEvent","setStreams","liveCalls","setLiveCalls","onIncomingCall","onCallOpened","forwardingCallId","forward_stream","videotrack","audiotrack","onCallClosed","manageLiveCallClosed","onUserHangup","result","mId","fId","forwardCall","source","find"],"mappings":"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","file":"static/js/main.5650b936.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.f23962e9.png\";","import {Button} from 'react-bootstrap'\r\nimport { useEffect, useState, useRef, useContext } from 'react'\r\n\r\nexport default ({id, stream, onClick, isLocal = false, ...props})=>{\r\n    let ref = useRef(null);\r\n    const [status, setStatus] = useState({audio:true});\r\n\r\n    useEffect(()=>{\r\n        if(stream && ref.current){\r\n            ref.current.srcObject = stream;\r\n            ref.current.play();\r\n        }\r\n    },[stream]);\r\n\r\n    function handleClick(){\r\n        setStatus({...status, audio:!status.audio});\r\n    }\r\n    \r\n    return <>\r\n    <div className={`Video ${props.className??\"\"}`} >\r\n        <div className=\"stream-status position-absolute bottom-0 start-0\">\r\n            <span   className=\"status-user\"> {id} </span>\r\n            <Button className=\"status-audio\" variant=\"link\" disabled={isLocal} onClick={handleClick}>\r\n                {isLocal? <i className={`bi bi-mic${!(isLocal||!status?.audio) ? \"\" : \"-mute\"}`} />\r\n                :<i className={`fs-4 bi bi-volume${!(isLocal||!status?.audio) ? \"-down\" : \"-mute\"}`} />}\r\n            </Button>\r\n        </div>\r\n        <video autoPlay playsInline muted={isLocal || !status?.audio} ref={ref} {...{onClick}}/>\r\n    </div>\r\n    <style global jsx>{`\r\n        @import 'src/variables.scss';\r\n\r\n        .Video{\r\n            position: relative;\r\n            margin:1px;\r\n            padding:0;\r\n            border:1px solid $secondary;\r\n            transition:all .2s ease-in-out;\r\n\r\n            &:hover, .selected{\r\n                border:1px solid $primary;\r\n            }\r\n\r\n            .stream-status{ \r\n                color:white !important;\r\n                z-index:1000;\r\n                .status-user{\r\n                    padding: 0rem 0.5rem;\r\n                    padding-right:0;\r\n                }\r\n                .status-audio{\r\n                    color:white !important;\r\n                    cursor:pointer;\r\n                    padding:0;\r\n                    margin-bottom: -1.2rem;\r\n                    margin-top: -1.4rem;\r\n                    margin-left: -0.2rem;                    \r\n                }\r\n            }\r\n\r\n            video{\r\n                width:100%;\r\n                height:100%;\r\n                object-fit: cover;\r\n                margin-bottom: -4px;\r\n            }\r\n        }\r\n\r\n    `}</style>\r\n    </>;\r\n}","import { Helmet } from \"react-helmet\"\r\nimport { Image } from 'react-bootstrap'\r\nimport toast, { Toaster } from 'react-hot-toast'\r\nimport { BrowserRouter as Router, Switch, Route, Redirect } from \"react-router-dom\"\r\n\r\nimport App from 'views/App'\r\nimport Verified from 'views/verified'\r\nimport ResetPass from 'views/resetpassword'\r\nimport AboutModal from 'components/modal_about'\r\nimport ProfileModal from 'components/modal_profile'\r\nimport FullScreenBTN from 'components/btn_fullscreen'\r\nimport Title from 'partials/title'\r\n\r\nimport 'bootstrap/dist/js/bootstrap.bundle.min.js';\r\nimport 'style.scss'\r\n\r\nimport RoomsContext  from 'utils/ctx_rooms'\r\nimport StreamContext from 'utils/ctx_streaming'\r\nimport MediaContext from 'utils/ctx_mediadevices'\r\nimport AuthContext  from 'utils/ctx_authentication'\r\n\r\nwindow.toast = toast;\r\n//toast.error = (message, options) => { toast.error(message, options); console.trace(message) }\r\n\r\nexport default ({ children, ...props }) => {\r\n  return <div id=\"layout\" className=\"\" {...props}>\r\n    <Toaster\r\n      id=\"toaster\"\r\n      position=\"bottom-right\"\r\n      reverseOrder={true}\r\n      toastOptions={{\r\n        duration: 2000,\r\n        style: {\r\n          background: '#333',\r\n          color: '#fff',\r\n        },\r\n      }}\r\n    />\r\n    <Router basename={process.env.REACT_APP_BASE}>\r\n    <AuthContext>\r\n    <RoomsContext>\r\n    <MediaContext>\r\n    <StreamContext>\r\n    \r\n    <Helmet>\r\n      <title>{process.env.REACT_APP_NAME}</title>\r\n      <title>{props.title}</title>\r\n      <meta property=\"og:url\" content={process.env.REACT_APP_OG_URL} />\r\n      <meta property=\"og:type\" content={process.env.REACT_APP_OG_TYPE} />\r\n      <meta property=\"og:title\" content={process.env.REACT_APP_OG_TITLE} />\r\n      <meta property=\"og:description\" content={process.env.REACT_APP_OG_DESC} />\r\n      <meta property=\"og:image\" content={process.envREACT_APP_OG_IMAGE} />\r\n    </Helmet>\r\n\r\n    <Title/>\r\n\r\n    <div className=\"z-top d-flex m-2 position-absolute top-0 end-0\">\r\n      <ProfileModal />\r\n      <AboutModal />\r\n      <FullScreenBTN />\r\n    </div>\r\n\r\n    <Switch>\r\n        <Route component={App}       exact path={[\"/\", \"/settings\", \"/about\", \"/users\", \"/chat\", \"/profile\", \"/room/:roomId\", \"/room/:roomId/chat\", \"/room/:roomId/guests\"]} />\r\n        <Route component={Verified}  exact path=\"/verified/:token\"/>\r\n        <Route component={ResetPass} exact path=\"/reset-password/:token\"/>\r\n        <Route> <Redirect to='/'/> </Route>\r\n    </Switch>\r\n    \r\n    </StreamContext>\r\n    </MediaContext>\r\n    </RoomsContext>\r\n    </AuthContext>\r\n    </Router>\r\n\r\n    <style global jsx>{`\r\n      @import \"src/variables.scss\";\r\n\r\n      #layout {\r\n        text-align:center;\r\n        background:$background;\r\n      }  \r\n\r\n      #title {\r\n        color:$text;\r\n        filter: invert(.5) brightness(0.5);\r\n        mix-blend-mode: luminosity;\r\n      }\r\n\r\n      .z-top{\r\n        z-index:1000;\r\n      }\r\n      \r\n    `}</style>\r\n  </div>\r\n}","import { useHistory } from 'react-router-dom'\r\n\r\nimport MD from 'utils/md';\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default ()=>{\r\n    const history = useHistory();\r\n\r\n    return <>\r\n        <Modal size=\"md\" show={true} \r\n            title={<h2 className=\"user-select-none\">User verified!🎉🎉</h2>}\r\n            button_tittle=\"Understood\"\r\n            callback={ ()=>{ history.push('/') } }\r\n        >\r\n            <MD className=\"user-select-none\">{`Account verified successfully in the system. You can now login on the application.`}</MD>\r\n        </Modal> \r\n    </>\r\n}","import toast from 'react-hot-toast'\r\nimport { useState, useEffect, useRef } from 'react'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport { Form, FloatingLabel, OverlayTrigger, Tooltip, Button} from 'react-bootstrap'\r\n\r\nimport http from 'utils/http'\r\nimport MD from 'utils/md'\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default ()=>{\r\n    let { token } = useParams();\r\n    const history = useHistory();\r\n\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated] = useState(undefined);\r\n    const [formvalues, setFormValues] = useState({formErrors:{}});\r\n\r\n    function handleUserInput (e) {\r\n        const name = e.target.name;\r\n        const value = e.target.value;\r\n        validateField(name, value);\r\n    }\r\n\r\n    function validateField(name, value){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(name){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default: console.warn(\"Invalid field name: \", name);\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n    \r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        const toastId = toast.loading('Resetting password...');\r\n        const password = formvalues.password;\r\n        await http.post(`${process.env.REACT_APP_API_URL}/reset-password/${token}`, {data:{password}})\r\n        .then( ({status, description, message }) => {\r\n            switch (status) {\r\n                case 'ok':\r\n                    toast.success('Success', {id: toastId});\r\n                    setTimeout( ()=>history.push(`/`), 1000);\r\n                    break;\r\n                case 400: toast.error(message, {id: toastId}); break;\r\n                case 'error': toast.error(description, {id: toastId}); break;\r\n                default: toast.warn(description, {id: toastId});\r\n            }\r\n        })\r\n        .catch(err => {\r\n            toast.error(`Error: ${err}`, {id: toastId});\r\n        });\r\n    }\r\n\r\n    return <>\r\n        <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n        <Modal closeButton show={true} \r\n            onHide={() => history.push(\"/\")} \r\n            title={<h2 className=\"user-select-none\">Reset password</h2>}\r\n            buttons={[\r\n                <OverlayTrigger placement=\"bottom\"\r\n                overlay={\r\n                    <Tooltip className={`${validated?\"d-none\":\"\"} mt-2`}  id={`tooltip-bottom`}>\r\n                        Check form errors\r\n                    </Tooltip>\r\n                }\r\n                >\r\n                    <Button type=\"submit\" disabled={!validated} > Proceed </Button>\r\n                </OverlayTrigger>\r\n            ]}\r\n        >\r\n            <MD className=\"user-select-none\">{ \"Please enter your new password.\"}</MD>\r\n            \r\n            <FloatingLabel controlId=\"floatingPassword\" label=\"New Password\">\r\n                <Form.Control required name=\"password\" type=\"password\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.password??\"\"}/>\r\n            </FloatingLabel>\r\n\r\n        </Modal> \r\n        </Form>\r\n    </>\r\n}","import React, {useEffect, useState, useReducer} from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\n\r\nexport default () => {\r\n    const [show, setShow] = useState(false);\r\n    const [proposal, dispatch] = useReducer((o,n)=>n, {proposalEvent : undefined});\r\n    useEffect(() => { \r\n            window.addEventListener('beforeinstallprompt',onBeforeInstallPrompt, 0);\r\n        return () => { \r\n            window.removeEventListener('beforeinstallprompt',onBeforeInstallPrompt, 0);\r\n        }\r\n    },[]);\r\n\r\n    function onBeforeInstallPrompt(e) \r\n    {\r\n        debugger;\r\n        e.preventDefault();\r\n        dispatch(state => ({...state, e}));\r\n    }\r\n\r\n    async function promptInstall()\r\n    {\r\n        if(!proposal?.proposalEvent) \r\n            return;\r\n\r\n        proposal.proposalEvent.prompt();\r\n        const { outcome } = await proposal.proposalEvent.userChoice;\r\n        if (outcome === 'accepted') {\r\n            dispatch(state => ({ ...state, proposalEvent: undefined }));\r\n        }\r\n    }\r\n\r\n    return <>\r\n        <Button variant=\"link\" onClick={ ()=>setShow(1) }>About</Button>\r\n        <Modal closeButton size=\"md\" {...{show, setShow}} title={<span>{process.env.REACT_APP_NAME} - Offline capable <Button variant={`${proposal.proposalEvent?\"outline-primary\":\"outline-secondary\"}`}size=\"sm\" onClick={promptInstall} disabled={!proposal.proposalEvent}> {`${proposal.proposalEvent? \"Install PWA\" : \"Not available\"}`}</Button></span>}>\r\n        <MD>{`\r\n        An offline-capable AdMiRe version is available, wich is a [Progressive Web App](https://docs.microsoft.com/en-us/microsoft-edge/progressive-web-apps-chromium/).\r\n\r\n        The app serves the following features:\r\n        - Offline-capable (with [Service Workers](https://developers.google.com/web/fundamentals/primers/service-workers/))\r\n        - \"Add to Home Screen\" feature on Android and iOS supported devices to launch the app from the home screen.\r\n        - Dark Mode.\r\n        - Privacy-focused - We don't collect any personal data.\r\n        - Lightweight - The app is only ~5MB.\r\n\r\n        Hope you liked using this app 😉\r\n\r\n        <div align=\"center\" className=\"fw-bolder\">Made with ❤️ by <a href=\"https://www.upf.edu/web/gti\"> UPF-GTI</a> </div>\r\n        `}</MD>\r\n        </Modal>\r\n    </>;\r\n}\r\n//<Button onClick={handleClick}>Install {import.meta.env.NAME}</Button>","import React from 'react';\r\nimport { Modal, Button } from 'react-bootstrap';\r\n\r\nexport default ({title, children, show, setShow = ()=>{}, callback, buttons, closeButton, ...props}) => {\r\n    return <>\r\n        <Modal\r\n            centered\r\n            show={show}\r\n            keyboard={true}\r\n            //backdrop={closeButton?\"\":\"static\"}\r\n            onHide={() => setShow(false)}\r\n            dialogClassName=\"modal-partial modal-shadow-lg\"\r\n            {...props}\r\n        >\r\n            {(closeButton && title) && <Modal.Header closeButton={closeButton} >\r\n                <Modal.Title className=\"user-select-none\">{title}</Modal.Title>\r\n            </Modal.Header>}\r\n            \r\n            <Modal.Body>\r\n                {children}\r\n            </Modal.Body>\r\n\r\n            { (buttons || closeButton) && <Modal.Footer>\r\n                {buttons && buttons.map( (v,k,a) => <div key={k}>{v}</div> )}\r\n                {closeButton && <Button variant=\"outline-secondary\" onClick={() => setShow(false)}> Close</Button>}\r\n            </Modal.Footer>} \r\n        </Modal>\r\n\r\n        <style global jsx>{`\r\n            @import 'src/variables.scss';\r\n\r\n            .modal-partial.modal-shadow-lg.modal-md.modal-dialog-centered:focus-visible {\r\n                outline: none;\r\n            }\r\n\r\n            .modal-partial {\r\n                .modal-title {\r\n                    font-weight: lighter;\r\n                    font-family: $header-font;\r\n\r\n                    h1,h2,h3,h4,h5,h6 {padding:0; margin:0}\r\n                }\r\n\r\n                .modal-header{\r\n                    padding-bottom: .2em;\r\n                }\r\n\r\n                .modal-footer{\r\n                    padding: 0 0.75rem;\r\n                }\r\n            }\r\n            \r\n\r\n            /* -----------------------------------------\r\n                Wearables\r\n            ----------------------------------------- */\r\n\r\n            /* ----------- Moto 360 Watch ----------- */\r\n            @media (max-device-width: 218px)and (max-device-height: 281px) { \r\n\r\n            }\r\n\r\n            /* ----------- Non-Retina Screens ----------- */\r\n            @media screen \r\n            and (min-device-width: 1200px) \r\n            and (max-device-width: 1600px) \r\n            and (-webkit-min-device-pixel-ratio: 1) { \r\n            }\r\n\r\n            /* ----------- Retina Screens ----------- */\r\n            @media screen \r\n            and (min-device-width: 1200px) \r\n            and (max-device-width: 1600px) \r\n            and (-webkit-min-device-pixel-ratio: 2)\r\n            and (min-resolution: 192dpi) { \r\n            }\r\n\r\n            /* Smartphones (landscape) ———– */\r\n            @media only screen\r\n            and (min-width : 321px) {\r\n            /* Styles */\r\n            }\r\n\r\n            /* Large Desktop and Laptop Screens (devices and browsers) */\r\n            @media only screen and (min-width: 1824px) {}\r\n\r\n            /* Tablet Devices, Desktop and Laptop Screens */\r\n            @media only screen and (max-width: 768px) {}\r\n\r\n            /* iPads (portrait and landscape) */\r\n            @media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {}\r\n\r\n            /* Smartphones (portrait and landscape) */\r\n            @media only screen and (min-device-width: 320px) and (max-device-width: 480px) {}\r\n\r\n            /* iPhone 4 */\r\n            @media only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen and (min-device-pixel-ratio: 1.5) {}\r\n\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {\r\n                .modal-dialog{\r\n                    max-width: 38rem !important;\r\n                }\r\n            }\r\n            @media only screen and (orientation: portrait){\r\n\r\n            }      \r\n        `}</style>\r\n    </>;\r\n}","import React, {useState, useContext } from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\n\r\nexport default () => {\r\n    const [show, setShow] = useState(false);\r\n    const auth = useContext(AuthContext);\r\n\r\n    if(!auth.isLogged) return <></>;\r\n    return <>\r\n        <Button variant=\"link\" onClick={ ()=>setShow(1) }>Profile</Button>\r\n        <Modal closeButton size=\"lg\" {...{show, setShow}} title={<h2 className=\"user-select-none\">{auth.user.username}</h2>}>\r\n        <MD className=\"user-select-none\">{`\r\n        An offline-capable AdMiRe version is available, wich is a [Progressive Web App](https://docs.microsoft.com/en-us/microsoft-edge/progressive-web-apps-chromium/).\r\n\r\n        The app serves the following features:\r\n        - Offline-capable (with [Service Workers](https://developers.google.com/web/fundamentals/primers/service-workers/))\r\n        - \"Add to Home Screen\" feature on Android and iOS supported devices to launch the app from the home screen.\r\n        - Dark Mode.\r\n        - Privacy-focused - We don't collect any personal data.\r\n        - Lightweight - The app is only ~5MB.\r\n\r\n        Hope you liked using this app 😉\r\n\r\n        <div align=\"center\" className=\"fw-bolder\">Made with ❤️ by <a href=\"https://www.upf.edu/web/gti\"> UPF-GTI</a> </div>\r\n        `}</MD>\r\n\r\n        <Button onClick={auth.logout}><i className=\"bi bi-power\"></i> Log me out</Button>\r\n        </Modal>\r\n    </>;\r\n}","import screenfull from 'screenfull'\r\nimport { Button } from 'react-bootstrap'\r\nimport { useState, useEffect } from 'react'\r\n\r\n\r\nexport default () => {  \r\n    let [state, setState] = useState(0);\r\n\r\n    function handleClick(){\r\n        /*let promise\r\n        if (document.fullscreenElement) {\r\n            promise = document.exitFullscreen();\r\n        } else {\r\n            promise = document.documentElement.requestFullscreen();\r\n        }\r\n        promise.then( ()=>setState(++state) );*/\r\n        screenfull.toggle();\r\n    }\r\n\r\n    useEffect(()=>{\r\n        const f = () => setState(++state);\r\n        screenfull.on('change', f);\r\n    return ()=>{\r\n        screenfull.off('change', f);\r\n    }\r\n    },[])\r\n    \r\n//window.document.documentElement.webkitRequestFullScreen\r\n\r\n    return <div id=\"btn_fullscreen\">\r\n        { screenfull.isEnabled && \r\n            <Button \r\n            onClick={handleClick} variant=\"link\"> \r\n                {  document.fullscreen && <i className=\"bi bi-fullscreen-exit\"/> }\r\n                { !document.fullscreen && <i className=\"bi bi-fullscreen\"/> }\r\n            </Button>    \r\n        }\r\n    </div>;\r\n}","import {useContext} from 'react'\r\nimport {Image} from 'react-bootstrap'\r\nimport logo from \"assets/img/logo.png\"\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\nexport default () => {\r\n    const rooms    = useContext(RoomsContext);\r\n\r\n    return <>\r\n        <div id=\"title\" variant=\"none\" className=\"d-flex m-3 position-absolute top-0 start-0 user-select-none\">\r\n            <Image className=\"me-2\" width={32} height={32} src={logo} />\r\n            <h1 className=\"fs-3\">{process.env.REACT_APP_NAME}</h1>\r\n            {rooms?.current && <h1 className=\"fs-3\">: #{rooms?.current?.name}</h1>}\r\n        </div>\r\n    </>\r\n}","function Nav({children}){\r\n\r\n    return <>\r\n\r\n        <div className=\"nav-partial px-3 mb-1 d-flex justify-content-evenly align-items-center position-absolute bottom-0 start-50 translate-middle-x shadow rounded-5 bg-light\" style={{ zIndex: 1100}}>\r\n            { children.map( (v,k) => v && <div key={'nav-i-'+k}>{v}</div>) }\r\n        </div>\r\n\r\n        <style global jsx>{`\r\n            @import \"node_modules/bootstrap/scss/_functions.scss\";\r\n            @import \"node_modules/bootstrap/scss/_variables.scss\";\r\n            @import \"src/variables.scss\";\r\n\r\n            .rounded-5{\r\n                border-radius: .5em;\r\n            }\r\n            .nav-partial{\r\n                min-width: 1rem;\r\n                min-height: 1rem;\r\n                transition: all .2s ease-in-out;\r\n            }\r\n            .nav-button, .nav-item{\r\n                color: $secondary;\r\n                cursor: pointer;\r\n                height: 100%;\r\n                width: auto;\r\n                user-select: none;\r\n                transition: all .2s ease-in-out;\r\n\r\n                & i{\r\n                    transform: scale(1.5);\r\n                    width: 50px;\r\n                    overflow: hidden;\r\n                    padding:0;\r\n                    margin:0;\r\n                    user-select: none;\r\n                    text-transform: capitalize;\r\n\r\n                }\r\n                &:hover{\r\n                    color:  lighten($danger,15%);\r\n                }\r\n            }\r\n\r\n            .nav-item{\r\n                height: 44px;\r\n            }\r\n\r\n            .nav-item-active{\r\n                color: red !important;\r\n            }\r\n\r\n            .nav-item-disabled{\r\n                opacity: .35;\r\n                user-select: none !important;\r\n                pointer-events:none;\r\n                cursor: not-allowed;\r\n                &:hover{\r\n                    opacity: .35;\r\n                }\r\n            }\r\n\r\n\r\n            .nav-button{\r\n                color: black !important;\r\n                height: 3.5rem;\r\n                width: 3.5rem;\r\n                line-height: 3rem;\r\n                margin-top: -1.5rem;\r\n                margin-bottom: 1.5rem;\r\n\r\n                &:hover{\r\n                    color:  lighten($danger,50%) !important;\r\n                }\r\n            }\r\n\r\n            .dark-mode{\r\n                &.navpartial, .nav-partial{\r\n                    background-color: transparent !important;\r\n                    border: 1px solid rgba(255,255,255, .25);\r\n\r\n                    .nav-item{\r\n                        color: invert($secondary,50%);\r\n                        &:hover{\r\n                            color:  lighten($danger,15%);\r\n                            filter: saturate(120%) drop-shadow(0 0 .1rem $danger);\r\n                        }\r\n                    }\r\n\r\n                    .nav-button{\r\n                        filter: saturate(80%);\r\n                        background: $color1 !important;\r\n                        line-height: 2.8rem;\r\n                        border: 2px solid $danger;\r\n                        color: $danger !important;\r\n\r\n                        &:hover{\r\n                            filter: saturate(120%) drop-shadow(0 0 .1rem $danger);\r\n                            color:  $danger !important;\r\n                            border: 2px solid $danger;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n                .nav-partial{\r\n                    flex-direction: column;\r\n                    //top: 50%;\r\n                    left: 100% !important;\r\n                    transform: translate(-100%, 0%) !important;\r\n                    margin-left: -1.1rem;\r\n                    padding:1.251rem 0 !important;\r\n\r\n                    .nav-button{\r\n                        margin:0;\r\n                        margin-left: -1.5rem;\r\n                        margin-right: 1.5rem;\r\n                    }\r\n                }\r\n            }\r\n            @media only screen and (orientation: portrait){\r\n\r\n            } \r\n        `}</style>\r\n    </>\r\n}\r\n\r\n\r\nNav.Item = function({children, icon, disabled, to, ...props}){\r\n    return <div to={to??\"/\"} className={`nav-item ${disabled?\"nav-item-disabled\":\"\"} ${props.appendclass??\"\"}`} {...props}>\r\n        <div className={`d-flex flex-column fs-6 fw-lighter`} >{children}</div>\r\n    </div>\r\n}\r\n\r\nNav.Button = function({children,...props}){\r\n    return <div className={`nav-button ${props.appendclass??\"\"}`} {...props}>\r\n        <div className=\" pt-1 fs-1 fw-lighter\">{children}</div>\r\n    </div>\r\n}\r\n\r\nexport default Nav;","import {useState, useContext, useRef} from 'react'\r\nimport Modal from 'partials/modal'\r\nimport {Badge, Button, Form, FloatingLabel, Spinner} from 'react-bootstrap'\r\n\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport { StreamContext } from 'utils/ctx_streaming'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport toast from 'react-hot-toast';\r\n\r\n\r\nexport default ({callId, isForwardCall})=>{\r\n    const wrtc     = useContext(StreamContext);\r\n    const ref = useRef(null);\r\n    const [show, setShow] = useState(null);\r\n    const [fetching, setFetching] = useState(0);//0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n\r\n    let [mediaHubCallId, forwardedCallId] = wrtc.getLiveCall(callId);\r\n    \r\nfunction submit() {\r\n\r\n        if ( !ref?.current || !show )\r\n            return setShow(false);\r\n\r\n        setFetching(true);            \r\n\r\n        const [forwardingCallId, mediaHubtarget] = [callId, ref.current.value];\r\n\r\n        function callback({callId, status, description}) {\r\n            if(status === 'error'){\r\n                setFetching(3);           \r\n                setTimeout( () => { setFetching(0); } , 2000);\r\n                toast.error(`Call response error: ${description}`);\r\n            }\r\n            else {\r\n                setFetching(2);   \r\n                setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n                callback(callId, forwardingCallId);\r\n            }\r\n        }\r\n\r\n        if(!wrtc.callUser(mediaHubtarget, callback))\r\n        {\r\n            setFetching(3);   \r\n            toast.error(`call missed to backend`);\r\n            setTimeout( () => { setFetching(0); } , 2000);\r\n        }\r\n    }\r\n\r\n    function onKeyDown(e){\r\n        if(e.keyCode === 13)\r\n        submit()\r\n    }\r\n\r\n    let button;\r\n    switch(fetching){\r\n        case 1:  button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2:  button = <Button variant=\"outline-success\" > ✔️ Succeed! </Button>; break;\r\n        case 3:  button = <Button variant=\"outline-danger\"  > ❌ Error </Button>; break;\r\n        default: button = <Button variant=\"outline-primary\" onClick={submit} >Proceed!</Button>;\r\n    }\r\n\r\n    return <>\r\n        {isForwardCall ? <Badge style={{padding:\".44em .45em\"}} pill bg=\"danger\" onClick={() => wrtc.callHangup( mediaHubCallId )}><i className=\"bi bi-x\"></i></Badge>\r\n        :                <Badge style={{padding:\".44em .45em\"}} pill bg=\"danger\" onClick={() => setShow( callId )} className=\"cursor-pointer\"><i className=\"bi bi-cast\"></i></Badge>}\r\n        <Modal {...{show,setShow}}  buttons={[button]}  closeButton title=\"Ready to forward?\" onKeyDown={onKeyDown}>\r\n            Enter the destination ID you want to forward to\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"targetId\" className=\"mb-3\">\r\n                <Form.Control ref={ref} name=\"targetId\" type=\"text\" placeholder=\"mediahub target id\"/>\r\n            </FloatingLabel>\r\n        </Modal>\r\n    </>;\r\n}\r\n\r\n//{ imMaster && (!isForwardCall && id !== roomInfo?.master && id !== user.id) && <Badge pill bg=\"danger\" onClick={() => setShowModal( callId )}><i class=\"bi bi-cast\"></i></Badge> }","//import { useEffect } from 'react';\r\nimport { Row, Col, Badge } from 'react-bootstrap'\r\nimport { useContext, useEffect,useLayoutEffect, useState, useRef } from 'react'\r\nimport { useParams, useHistory } from \"react-router-dom\"\r\n\r\nimport * as BRA from 'lib_bra'\r\nimport Video from 'partials/video'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport { StreamContext } from 'utils/ctx_streaming'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport BadgeForwardCall from 'components/badge_forward'\r\n\r\nexport default ({ ...props }) => {\r\n    const history     = useHistory();\r\n    const {roomId}    = useParams();\r\n    const carouselRef = useRef();\r\n    const auth        = useContext(AuthContext);\r\n    const rooms       = useContext(RoomsContext);\r\n    const media       = useContext(MediaContext);\r\n    const wrtc        = useContext(StreamContext);\r\n\r\n    const [state, setState]       = useState(0);\r\n    const [selected, setSelected] = useState(null);\r\n\r\n    useEffect(()=>{//Constructor\r\n        if(!rooms.imInRoom(roomId) || !rooms.ready || !media.ready) \r\n            return;\r\n\r\n        wrtc.callAllUsers();\r\n    return ()=>{//Destructor\r\n        wrtc.callHangupAll();\r\n    }},[rooms.current, rooms.ready & media.ready]);\r\n\r\n    useEffect( ()=>{\r\n        wrtc.replaceStream(media.localStream);\r\n    },[media.localStream]);\r\n\r\n    /*useEffect(() => {\r\n        function unload(){\r\n            rooms.leaveRoom();\r\n            document.body.addEventListener('unload', unload);\r\n        }\r\n        document.body.addEventListener('unload', unload);\r\n        media.init();\r\n    return ()=>{\r\n        media.stop();\r\n    }},[])\r\n   \r\n    useEffect(() => {\r\n        function scrollHorizontal(e){\r\n            this.scrollLeft += e.deltaY;\r\n        }\r\n        carouselRef.current?.removeEventListener('wheel', scrollHorizontal)\r\n        carouselRef.current?.addEventListener('wheel', scrollHorizontal)\r\n\r\n        return ()=>{\r\n            carouselRef.current?.removeEventListener('wheel', scrollHorizontal)\r\n        }\r\n    },[carouselRef]);\r\n\r\n    useEffect(()=>{\r\n        if(!rooms.ready) \r\n            return;\r\n\r\n        (async ()=>{\r\n            const room = rooms.list[roomId];\r\n            //If room does not exist, redirect to home\r\n            if(!room){\r\n                return history.push('/')\r\n            }\r\n            \r\n            //If room is not joined, join it\r\n            if(!room.users.find( v => v.username === auth.user.username)){\r\n                await rooms.joinRoom(roomId)\r\n                .catch( (err, data)=>{ \r\n                    history.push('/') \r\n                })\r\n            }\r\n            \r\n            //Now that I am on the room, start it calling the rest of users.\r\n            if(rooms.current){\r\n                wrtc.callAllUsers();\r\n            }\r\n            \r\n        })();\r\n\r\n    },[rooms.ready, rooms.current]);\r\n\r\n    useEffect(()=>{\r\n        setState(s=>s+1);\r\n    },[wrtc.streams])*/\r\n\r\n    return <div id=\"room\" className=\"overflow-hidden m-auto\" style={{zIndex:1000}}>\r\n        <Row id=\"content-row\" className=\"g-0\" style={{ height:\"100%\" }}>\r\n  \r\n            <Col xs=\"auto\" id=\"carousel-col\" ref={carouselRef}>\r\n                <div id=\"carousel\" className=\"d-flex flex-column\" >\r\n                {  Object.entries({local:media.localStream, ...wrtc.streams}).map(([callId, stream], k)=>{\r\n\r\n                    let id = wrtc.getUserId(callId);\r\n                    let imMaster = auth.user.username === rooms.current?.master && id !== rooms.current?.master && id !== auth.user.username;\r\n                    let [mediaHubCallId, forwardedCallId] = wrtc.getLiveCall(callId);\r\n                    let isForwardCall = !!forwardedCallId;\r\n                    let isSelected = selected === callId || (!selected && k === 0);\r\n\r\n                    return <div>\r\n                        <div className=\"stream-forward\">\r\n                            <BadgeForwardCall callId={callId} isForwardCall={isForwardCall}/>\r\n                            { isSelected && <Badge pill bg=\"primary\"><i className=\"bi bi-eye active\"/></Badge> }\r\n                        </div>\r\n                        <Video isLocal={id === auth.user.username} key={callId} id={id} stream={stream} className={!isSelected?\"cursor-pointer\":\"\"} onClick={()=>{setSelected(callId)}}/>\r\n                    </div>\r\n                })}\r\n                </div>\r\n            </Col>\r\n            <Col id=\"main-col\">\r\n                <Video isLocal={wrtc.getUserId(selected) === auth.user.username} className=\"main-video\" id={wrtc.getUserId(selected)} stream={wrtc.streams[selected]??media.localStream} />\r\n            </Col>\r\n        </Row>\r\n\r\n        <style global jsx>{`\r\n            @import \"src/variables.scss\";\r\n\r\n            #room{\r\n                height:calc(100vh - 3rem - 4.5rem);\r\n                \r\n                #main-col {\r\n                    height: 100%;\r\n                    overflow: hidden;\r\n\r\n                    .Video\r\n                    {\r\n                        width:100%;\r\n                        height:100%;\r\n                        object-fit: cover;\r\n                    }\r\n                }\r\n\r\n                #carousel-col {\r\n                    height: 100%;\r\n                    width:166px;\r\n                    overflow-x: hidden;\r\n                    overflow-y: scroll;\r\n\r\n                    #carousel{\r\n                        height:100%;\r\n                        .Video{\r\n                            padding-right: 1px;\r\n                            padding-bottom: 2px;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                .stream-forward{\r\n                    height:1.9rem;\r\n                    position:relative;\r\n                    margin-bottom:-1.9rem;\r\n                    text-align:left;\r\n                    padding:3px 6px;\r\n                    z-index:1000;\r\n                }\r\n\r\n                .stream-controls{\r\n                    margin-bottom: 5.5rem;\r\n                }\r\n            }\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n                #room{\r\n                    height:calc(100vh - 2rem);\r\n                }\r\n                \r\n                .stream-controls{\r\n                    margin-bottom: .5rem !important;\r\n                }\r\n        \r\n            }\r\n\r\n            @media only screen and (orientation: portrait){\r\n                .stream-controls{\r\n                    margin-bottom: 5.5rem !important;\r\n                }\r\n\r\n                #content-row{ flex-direction: column; }\r\n                #carousel-col{\r\n                    overflow-x: scroll;\r\n                    overflow-y: hidden;\r\n                    height: 126px !important;\r\n                    width: 100% !important;\r\n                    #carousel{\r\n                        flex-direction: row !important;\r\n                        border:none;\r\n                        .Video, .Video video{ \r\n                            width: 166px; \r\n                            height:124px; \r\n                            object-fit: cover;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </div>;\r\n}\r\n\r\n","import React, {useState, useContext, useEffect, useRef  } from 'react';\r\nimport { Button, Form, FloatingLabel, Spinner, OverlayTrigger, Tooltip } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport toast from 'react-hot-toast';\r\nimport http from 'utils/http'\r\n\r\nexport default () => {\r\n    const formRef = useRef(null);\r\n    const [show, setShow] = useState(false);\r\n    const auth = useContext(AuthContext);\r\n    const user = \"h3R\"\r\n\r\n    const [formvalues, setFormValues] = useState({formErrors:{}});\r\n    const [validated, setValidated] = useState(undefined);\r\n   \r\n    function handleUserInput (e) {\r\n        const name = e.target.name;\r\n        const value = e.target.value;\r\n        validateField(name, value);\r\n    }\r\n\r\n    function validateField(name, value){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(name){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default: console.warn(\"Invalid field name: \", name);\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        const email = formvalues.email.toLowerCase();\r\n        const toastId = toast.loading('Resetting password...');\r\n        debugger;\r\n        await http.post(`${process.env.REACT_APP_API_URL}/forgot-password`, { data: {email} })\r\n        .then(({error, message, status}) => {\r\n            if (error) {\r\n                return toast.error(`onSubmitRecovery: ${message}`, { id: toastId });\r\n            }\r\n            setShow(false);\r\n            toast.success('Success', { id: toastId });\r\n        })\r\n        .catch(err => {\r\n            toast.error(`onSubmitRecovery: ${err}`, { id: toastId });\r\n        });\r\n    }\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n    const button =  <OverlayTrigger placement=\"bottom\"\r\n    overlay={\r\n        <Tooltip className={`${validated?\"d-none\":\"\"}`}  id={`tooltip-bottom`}>\r\n            Enter your email address first.\r\n        </Tooltip>\r\n    }\r\n    >\r\n        <span style={{padding:\"10px 0\"}}>\r\n            <Button type=\"submit\" onClick={handleSubmit} disabled={!validated && auth.isConnected} > Send password reset email </Button>\r\n        </span>\r\n    </OverlayTrigger>\r\n\r\n    return <>\r\n        <Button size=\"sm\" className=\"mt-4\" variant=\"link\" onClick={ ()=>setShow(1) }><i className=\"bi bi-lock\"></i>Forgot password?</Button>\r\n        <Modal buttons={[button]} closeButton size=\"lg\" {...{show, setShow}} title={<h2 className=\"user-select-none\">Forgot Password</h2>} size=\"md\">\r\n            <MD className=\"user-select-none\">{`Enter your email adress, on a couple of minutes you will receive an email with a link to reset your password.`}</MD>\r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingInput\" label=\"Email address\" className=\"mb-3\">\r\n                    <Form.Control required name=\"email\" type=\"email\" placeholder=\" \" \r\n                    onChange={handleUserInput} />\r\n                </FloatingLabel>\r\n            </Form>\r\n        </Modal>\r\n    </>;\r\n}","import React, {useState, useContext, useEffect, useRef  } from 'react';\r\nimport { Button, Form, FloatingLabel, Spinner, OverlayTrigger, Tooltip, Card, Image as ReactImage } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport http from 'utils/http'\r\nimport toast from 'react-hot-toast'\r\nimport Gravatar from 'gravatar'\r\n\r\nexport default () => {\r\n    const formRef = useRef(null);\r\n    const [show, setShow] = useState(false);\r\n    const auth = useContext(AuthContext);\r\n\r\n    const [fetching, setFetching]       = useState(false);\r\n    const [validated, setValidated]     = useState(undefined);\r\n    const [formvalues, setFormValues]   = useState({formErrors:{}});\r\n   \r\n    function handleUserInput (e) {\r\n        const name  = e.target.name;\r\n        const type  = e.target.type;\r\n        const value = type===\"checkbox\"?e.target.checked:e.target.value;\r\n        validateField(name, value, type);\r\n    }\r\n\r\n    function validateField(name, value, type = \"any\"){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n        let values = {...formvalues};\r\n\r\n        function checkImageURL(url) {\r\n            return (url.match(/\\.(jpeg|jpg|gif|png)$/) != null);\r\n        }\r\n\r\n        function testImage(url, timeoutT) {\r\n            return new Promise(function (resolve, reject) {\r\n                var timeout = timeoutT || 5000;\r\n                var timer, img = new Image();\r\n                img.onerror = img.onabort = function () {\r\n                    clearTimeout(timer);\r\n                    reject(\"Error: the url provided is not an image\");\r\n                };\r\n                img.onload = function () {\r\n                    clearTimeout(timer);\r\n                    resolve(\"success\");\r\n                };\r\n                timer = setTimeout(function () {\r\n                    // reset .src to invalid URL so it stops previous\r\n                    // loading, but doesn't trigger new load\r\n                    img.src = \"//!!!!/test.jpg\";\r\n                    reject(\"timeout\");\r\n                }, timeout);\r\n                img.src = url;\r\n            });\r\n        }\r\n\r\n        switch(type){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n\r\n                if(check && !formvalues.gravatar){\r\n                    const url = \"https:\"+Gravatar.url(value, { s: '256', r: 'pg', d: '404' });\r\n                    testImage(url, 2000)\r\n                    .then( (v) => { \r\n                        setFormValues( { ...values, gravatar:url,  [`gravatar_check`]:check, formErrors } );\r\n                    })\r\n                    .catch((err) => {\r\n                        setFormValues( { ...values, gravatar:null,  [`gravatar_check`]:check, formErrors } );\r\n                    });\r\n                }\r\n\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default:\r\n                check = true;\r\n                formErrors[name] = '';\r\n                break;\r\n        }\r\n        setFormValues( { ...values, [name]:value, [`${name}_check`]:check, formErrors } );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        const {username, email, password, avatar, name, surname, birthdate, role} = formvalues;\r\n        const toastId = toast.loading('Registering...');\r\n        await http.post(`${process.env.REACT_APP_API_URL}/register`, {data:{ username, email, password, avatar, name, surname, birthdate, role }})\r\n        .then(({ error, message, status }) => {\r\n            if(error){\r\n                return toast.error(`onRegister: ${message}`, { id: toastId });\r\n            }\r\n            toast.success('Success', { id: toastId });\r\n            setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n        })\r\n        .catch(err => {\r\n            toast.error(`Error: ${err}`, { id: toastId });\r\n        });\r\n    }\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n\r\n\r\n    return <>\r\n        <Card.Footer className=\"text-center user-select-none\" onClick={ ()=>setShow(1) }> Create an account </Card.Footer>\r\n        <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n        <Modal className=\"py-4\" closeButton {...{show, setShow}} \r\n        title={<h2 className=\"user-select-none\">Let's create your account</h2>}\r\n        buttons={[\r\n            <OverlayTrigger placement=\"bottom\"\r\n            overlay={\r\n                <Tooltip className={`${validated?\"d-none\":\"\"}`}  id={`tooltip-bottom`}>\r\n                    Enter your email address first.\r\n                </Tooltip>\r\n            }\r\n            >\r\n            <Button type=\"submit\"  onClick={handleSubmit} disabled={!validated && auth.isConnected} >CREATE ACCOUNT</Button>\r\n            </OverlayTrigger>\r\n        ]}\r\n        >\r\n            <ReactImage\r\n                id=\"avatar-img\"\r\n                src={formvalues.avatar ?? formvalues.gravatar ?? \"https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fforums.opera.com%2Fassets%2Fuploads%2Fprofile%2F192104-profileavatar.png&f=1&nofb=1\"}\r\n                roundedCircle\r\n                className='position-absolute top-0 start-50 bg-danger shadow'\r\n                width=\"128\" height=\"128\"\r\n                \r\n            />\r\n\r\n            <MD className=\"user-select-none\">{`Create your account. It's free and only takes a minute.`}</MD>\r\n\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"username\">     <Form.Control name='username'   placeholder='username'   onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['username'  ]}     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"email\">        <Form.Control name='email'      placeholder='email'      onChange={handleUserInput} type=\"email\"     defaultValue={formvalues['email'     ]}     />      </FloatingLabel>} />{/*value={userEmail} onChange={event => setEmail(event.target.value)} isInvalid={!isEmailValid} /> */}\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"password\">     <Form.Control name='password'   placeholder='password'   onChange={handleUserInput} type=\"password\"  defaultValue={formvalues['password'  ]}     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"avatar URL\">   <Form.Control name='avatar'     placeholder='avatar URL' onChange={handleUserInput} type=\"avatar\"    defaultValue={formvalues['avatar URL']}     />      </FloatingLabel>} />{/*value={image_url !== '' ? image_url : userEmail !== '' ? gravatar_url : ''} onChange={event => setImageURL(event.target.value)} */}\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"name\">         <Form.Control name='name'       placeholder='name'       onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['name'      ]}     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"surname\">      <Form.Control name='surname'    placeholder='surname'    onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['surname'   ]}     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"birthddate\">   <Form.Control name='birthdate'  placeholder='birthdate'  onChange={handleUserInput} type=\"date\"      defaultValue={formvalues['birthdate' ]}     />      </FloatingLabel>} />\r\n            \r\n            <div className=\"form-floating\">\r\n                <select className=\"form-select\" id=\"floatingSelect\" aria-label=\"Floating label select example\">\r\n                    <option value=\"0\">User</option>\r\n                    <option value=\"1\">Admin</option>\r\n                </select>\r\n                <label htmlFor=\"floatingSelect\"> User role</label>\r\n            </div>\r\n        </Modal>\r\n        </Form>\r\n        <style global jsx>{`\r\n            #avatar-img{\r\n                transform: translate(-50%,-125%) !important;\r\n            }\r\n        `}</style>\r\n    </>;\r\n}","//https://learnetto.com/blog/react-form-validation\r\n\r\nimport { useContext, useRef, useState, useEffect } from 'react';\r\nimport { Row, Col, Card,Form, FloatingLabel, Button, Spinner, OverlayTrigger, Tooltip } from \"react-bootstrap\"\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport RecoveryModal from 'components/modal_recovery'\r\nimport RegisterModal from 'components/modal_register'\r\nimport logo from 'assets/img/logo.png';\r\nimport toast from 'react-hot-toast';\r\nimport cookies from '@h3r/cookies'\r\nimport * as BRA from 'lib_bra'\r\n\r\nexport default () => {\r\n    const auth = useContext(AuthContext);\r\n\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated] = useState(undefined);\r\n    const [formvalues, setFormValues] = useState({formErrors:{}, email: cookies.get(\"admire_app_email\"), remember: !!cookies.get(\"admire_app_email\")});\r\n    const [fetching, setFetching] = useState(false);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        setFetching(true);\r\n        auth.login(formvalues.email, formvalues.password)\r\n        .then(  app_token => {\r\n            setFetching(false);\r\n            if(formvalues.remember){\r\n                cookies.set('admire_app_token', app_token, process.env.REACT_APP_COOKIES_EXPIRE_TIME);\r\n                cookies.set(\"admire_app_email\", formvalues.email, process.env.REACT_APP_COOKIES_EXPIRE_TIME);\r\n            }\r\n        })\r\n        .catch( err => {\r\n            setFetching(false);\r\n        })\r\n        ;\r\n    }\r\n\r\n    function handleUserInput (e) {\r\n        const name  = e.target.name;\r\n        const type  = e.target.type;\r\n        const value = type===\"checkbox\"?e.target.checked:e.target.value;\r\n\r\n        validateField(name, value, type);\r\n    }\r\n\r\n    function validateField(name, value, type = \"any\"){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(type){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default:\r\n                check = true;\r\n                formErrors[name] = '';\r\n                break;\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n    \r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n\r\n    return <>\r\n    <Card id=\"login\" bg=\"light\" className=\"flex-column text-center position-absolute start-50 top-50 translate-middle\" style={{ width: '24rem' }}>\r\n\r\n        <Col>\r\n            <Card.Img variant=\"top\" className=\"mt-4 user-select-none\" src={logo}/>\r\n            <h1 className=\"text-start ps-4 mb-0 mt-3 user-select-none\">{process.env.REACT_APP_NAME}</h1>\r\n            <div className=\"divider\"><span/></div>\r\n        </Col>\r\n\r\n        <Col>\r\n            <Card.Body as={Col} className=\"text-start px-4 pb-4\">\r\n\r\n            <Card.Text className=\"user-select-none\">Enter your e-mail adress and your password.</Card.Text>\r\n            \r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingInput\" label=\"Email address\" className=\"mb-3\">\r\n                    <Form.Control required name=\"email\" type=\"email\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.email??\" \"}/>\r\n                </FloatingLabel>\r\n                <FloatingLabel controlId=\"floatingPassword\" label=\"Password\">\r\n                    <Form.Control required name=\"password\" type=\"password\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.password??\"\"}/>\r\n                </FloatingLabel>\r\n\r\n                <Form.Switch id=\"remember-switch\" label=\"Remember me\" className=\"user-select-none\" name=\"remember\" onChange={handleUserInput} defaultChecked={formvalues.remember??false}/>\r\n\r\n\r\n                <OverlayTrigger placement=\"bottom\"\r\n                    overlay={\r\n                        <Tooltip className={`${validated?\"d-none\":\"\"} mt-2`}  id={`tooltip-bottom`}>\r\n                            Check form errors\r\n                        </Tooltip>\r\n                    }\r\n                    >\r\n                        <span style={{padding:\"10px 0\"}}>\r\n                            <Button size=\"sm\" className=\"mt-4\" type=\"submit\" disabled={!(validated && !fetching)} > \r\n                                {!fetching?\r\n                                <><i className=\"bi bi-box-arrow-in-left\"/> Log me in </>\r\n                                : <><Spinner as=\"span\"animation=\"grow\" size=\"sm\" role=\"status\" aria-hidden=\"true\"/> Logging in... </>\r\n                            }</Button>\r\n                        </span>\r\n                    </OverlayTrigger>\r\n                    \r\n                <RecoveryModal/>\r\n            </Form>\r\n\r\n\r\n            </Card.Body>\r\n            <RegisterModal/>\r\n        </Col>\r\n    </Card>\r\n\r\n    <style global jsx>{`\r\n        @import \"src/variables.scss\";\r\n        .divider {\r\n                border-bottom: 1px solid #FFF;\r\n                background-color: #DADADA;\r\n                height: 2px;\r\n                margin: 0.5em 0px 1.5em;\r\n\r\n                & span{\r\n                    position:relative;\r\n                    display: block;\r\n                    width: 75px;\r\n                    height: 3px;\r\n                    background-color: $color4;\r\n                    transform:translatey(-25%);\r\n                    left: 6%;\r\n                }\r\n        }\r\n\r\n        #login{\r\n            border:none;\r\n            img {\r\n                width: 192px;\r\n                filter: \r\n                    hue-rotate(260deg)\r\n                ;\r\n            }\r\n\r\n            .card-footer{\r\n                color:$text;\r\n                background:$color4;\r\n                transition: all 0.1s ease-in-out; \r\n                &:hover{\r\n                    background:darken($color4, 10%);\r\n                    font-weight:bold;\r\n                    cursor:pointer;\r\n                }\r\n            }\r\n        } \r\n\r\n        @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n            #login{\r\n                width: 40rem !important;\r\n                flex-direction: row !important;\r\n                .col{\r\n                    align-self: end;\r\n                }\r\n            }\r\n        }\r\n        @media only screen and (orientation: portrait){\r\n\r\n        }    \r\n    `}</style>\r\n    </>;\r\n}\r\n","import toast from 'react-hot-toast'\r\nimport React, {useContext, useRef, useEffect, useState} from 'react'\r\nimport { Col, Card, Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\n\r\nimport MD from 'utils/md'\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const ref                     = useRef(null);\r\n    const [show, setShow]         = useState(false);\r\n    const [isValid, setValid]     = useState(true);\r\n    const [fetching, setFetching] = useState(0);               //0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n    useEffect(()=>{\r\n        function onKeyDown(e) {\r\n            if (e.keyCode === 13) {\r\n                setShow(true);\r\n            }\r\n        }\r\n            window.addEventListener('keydown', onKeyDown);\r\n        return ()=>{\r\n            window.removeEventListener('keydown', onKeyDown);\r\n        }\r\n    },[])\r\n\r\n    function submit() {\r\n        if ( !ref?.current || !show ) return;\r\n            \r\n        let [roomname, password, icon, hidden] = Array.from(ref.current.elements).map(v => v.value);\r\n        \r\n        rooms.createRoom(roomname.toLowerCase(), {password, icon, hidden})\r\n        .then( room =>{\r\n            toast.success(`Created room ${room.name}`); \r\n            setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n            setFetching(2);   \r\n        }) \r\n        .catch( err =>{\r\n            toast.error(`onCreateRoom: ${err}`); \r\n            setFetching(3);   \r\n            setTimeout( () => { setFetching(0); } , 1000);\r\n        }) \r\n    }\r\n\r\n    function handleUserInput(e){\r\n        //setValid(ref?.current?.value.length > 3);\r\n    }\r\n\r\n    let button = <Button disabled={!isValid} variant={isValid?\"outline-primary\":\"outline-secondary\"} onClick={submit} >Proceed!</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" > ✔️ Succeed! </Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\"  > ❌ Error </Button>; break;\r\n        default: break;\r\n    }\r\n\r\n\r\n    return <>\r\n        <Nav.Button onClick={()=>setShow(1)} label=\"Create room\" appendclass=\"shadow rounded-circle bg-danger\" >\r\n            <i className=\"bi bi-plus-lg\"></i> \r\n        </Nav.Button>\r\n        \r\n        <Modal size=\"sm\" onKeyDown={ (e)=> (e.keyCode === 13) && submit() } tabIndex=\"0\" buttons={[button]} closeButton {...{show, setShow}} title={<span>Let's create a room</span>}>\r\n        <MD>{``}</MD>\r\n        <Form ref={ref}>\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"roomId\" className=\"mb-3\">\r\n                <Form.Control onChange={handleUserInput} required name=\"roomId\" type=\"text\" placeholder=\"roomId\"/>\r\n            </FloatingLabel>\r\n\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"password\" className=\"mb-3\">\r\n                <Form.Control required name=\"password\" type=\"password\" placeholder=\"password\"/>\r\n            </FloatingLabel>\r\n\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"icon\" className=\"mb-3\">\r\n                <Form.Control required name=\"icon\" type=\"text\" placeholder=\"icon URL\"/>\r\n            </FloatingLabel>\r\n\r\n            <Form.Switch id=\"hidden-switch\" label=\"Hidden\" name=\"hidden\" defaultValue={false}/>\r\n        </Form>\r\n        </Modal>\r\n        <style global jsx>{`\r\n            #new-room-card {\r\n                cursor: pointer;\r\n                opacity: .5;\r\n                border: 2px dashed white;\r\n\r\n                .card-img-top{\r\n                    display: none;\r\n                }\r\n                .card-body{\r\n                    height: 155px;\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </>;\r\n}","import { useContext, useEffect } from 'react'\r\nimport {useHistory} from 'react-router-dom'\r\nimport {Row, Col, Card} from 'react-bootstrap'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport CreateRoomModal from 'components/modal_create_room'\r\n\r\n\r\nfunction RoomTile({id, name, ...props}){\r\n    return <div>\r\n    \r\n        <Card className=\"bg-dark text-light\" {...props}>\r\n            <Card.Img variant=\"top\" src={`https://unsplash.it/seed/tesst-${name}/160/100`} />\r\n            <Card.Body>\r\n            <Card.Title>#{name}</Card.Title>\r\n            {/*<Card.Text></Card.Text>*/}\r\n            </Card.Body>\r\n        </Card>\r\n\r\n        <style global jsx>{`\r\n            @import 'src/variables.scss';\r\n\r\n            .card {\r\n                cursor: pointer;\r\n                user-select: none;\r\n                transition: all 0.075s ease-in-out;\r\n\r\n                &:hover {\r\n                    .card-body{\r\n                        background: lighten($dark,25%);\r\n                    }\r\n                        \r\n                    box-shadow: 0 0 0px 2px rgba(255, 255, 255, .5) !important;\r\n                }\r\n\r\n                .card-body{\r\n                    transition: all 0.075s ease-in-out;\r\n                    .card-title{\r\n                        margin:0;\r\n                        font-size: 1rem;\r\n                        white-space: nowrap;\r\n                    }\r\n                }\r\n            }\r\n        `}</style>\r\n    </div>\r\n}\r\n\r\nfunction onKeyPress(){\r\n}\r\n\r\nexport default ()=>{\r\n    const history = useHistory();\r\n    const rooms = useContext(RoomsContext);\r\n\r\n    useEffect( ()=>{\r\n\r\n    }, [rooms.list])\r\n\r\n\r\n    return <>\r\n        <Row onKeyPress={onKeyPress} id=\"lobby\" className=\"h-100 m-auto\">\r\n            <Col xs={12} sm={{span:10, offset:1}} >\r\n        \r\n            <h1 className=\"text-light\">Lobby</h1>    \r\n            <Row xs={2} sm={4} lg={4} xl={5} className=\"g-4\">\r\n            { [...Object.values(rooms.list)].map((v,k) => <Col key={k}>\r\n                    <RoomTile name={` ${v?.name || 'Room '+k}`} onClick={()=>rooms.joinRoom(v?.name)}/>\r\n                </Col>\r\n            )}\r\n            </Row>\r\n\r\n            </Col>\r\n        </Row>\r\n        <style global jsx>{`\r\n            #lobby{\r\n                min-height: 19rem;\r\n            }    \r\n        `}</style>\r\n    </>\r\n}\r\n//{name:'room test'},{name:'low coverage'},{name:'volcano'},{name:'ecogreen'},{name:'weathercast'},...","import { useState, useEffect } from 'react'\r\nimport { Row, Col } from 'react-bootstrap'\r\nimport MD from 'utils/md'\r\nimport Gesture from 'rc-gesture'\r\nimport { findByDisplayValue } from '.pnpm/@testing-library+dom@8.10.1/node_modules/@testing-library/dom'\r\nimport Modal from 'partials/modal'\r\n\r\nexport default ({show, setShow, ...props}) => {\r\n    const pages = [\"Devices\",\"p1\", \"p2\", \"p3\"];\r\n    const [selected, setSelected] = useState(0);\r\n    const [page, setPage] = useState(null);\r\n    const [views, setViews] = useState([]);\r\n\r\n    //use useEffect to fetch page views dynamically\r\n    useEffect(() => {\r\n        (async () => {\r\n            let vs = [];\r\n            for (let p of pages)\r\n                await import(`pages/${p}.jsx`).then(v => vs.push(<v.default />))\r\n            setViews([...vs]);\r\n            setPage(vs[selected]);\r\n        })();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        setPage(views[selected]);\r\n    }, [selected]);\r\n\r\n    function onKeyPressed(e)\r\n    {\r\n        switch(e?.keyCode)\r\n        {\r\n            case 37: return setSelected( s => (s-1 < 0)? pages.length-1 : s-1 );\r\n            case 39: return setSelected( s => (s+1)%pages.length );\r\n        }\r\n    }\r\n\r\n    useEffect(()=>{\r\n            document.addEventListener(\"keydown\", onKeyPressed)\r\n        return ()=>{\r\n            document.removeEventListener(\"keydown\", onKeyPressed)\r\n        }\r\n    }, [])\r\n\r\n    return <div>\r\n        <Gesture\r\n            onSwipeLeft={ () => setSelected( s => (s+1)%pages.length ) } \r\n            onSwipeRight={() => setSelected( s => (s-1 < 0)? pages.length-1 : s-1 ) }\r\n            \r\n        >\r\n            {/*\r\n            <Row id=\"wizard\" className=\"pt-5 h-100 m-auto\">\r\n                <Col sm={12} md={{ span: 10, offset: 1 }} lg={{ span: 8, offset: 2 }} xl={{ span: 6, offset: 3 }} className=\"pt-3 bg-light shadow-lg rounded-bottom\" style={{zIndex:1000}}>\r\n            */}\r\n                <div>\r\n                    <ul className=\"nav nav-tabs justify-content-start mb-2\">\r\n                    { pages.map( (v,k) => <li key={k} className=\"nav-item\">\r\n                            <div className={`nav-link ${selected === k?\"active\":\"\"}`} onClick={()=>setSelected(k)}>{v}</div>  \r\n                    </li>)}\r\n                </ul>\r\n\r\n                {page}\r\n                </div>\r\n            {/*\r\n                </Col>\r\n            </Row>\r\n            */}\r\n        </Gesture>\r\n        <style global jsx>{`\r\n            #wizard{\r\n                .nav-tabs{\r\n                    width: calc(100% + 24px);\r\n                    margin-left: -12px;\r\n                    margin-top: -3.6rem;\r\n                    //margin-top: -1rem;\r\n                }\r\n\r\n                .modal-content{\r\n                    margin-top: 1.5rem;\r\n                    min-height: calc(100vh - 10rem);                \r\n                }\r\n            }    \r\n        `}</style>\r\n    </div>;\r\n}\r\n\r\n//xs={12} md={{span:6, offset:3}} lg={{span:8, offset:2}}","import React, {useContext, useEffect, useState, useReducer} from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport Nav from 'partials/nav'\r\nimport MD from 'utils/md';\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms = useContext(RoomsContext);\r\n    const [show, setShow] = useState(false);\r\n\r\n    \r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(1)} label=\"Leave room\" >\r\n            <i className=\"bi bi-telephone-x\"></i>Leave\r\n        </Nav.Item>\r\n        <Modal buttons={[<Button size=\"lg\" onClick={()=>rooms.leaveRoom()}>Yes, leave</Button>]} closeButton size=\"md\" {...{show, setShow}} title={<span>Hey! Are you sure?</span>}>\r\n            \r\n            <MD>{`\r\n            Are you sure you want to leave this room? Any call in progress will be lost and any active stream will be stopped.\r\n            `}</MD>\r\n            \r\n        </Modal>\r\n    </>;\r\n}","import { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\nimport React, {useContext, useRef, useEffect, useState, useReducer} from 'react'\r\n\r\nimport MD from 'utils/md';\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport Wizard from 'views/wizard'\r\n\r\n\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const ref                     = useRef(null);\r\n    const [show, setShow]         = useState(false);\r\n    const [isValid, setValid]        = useState(false);\r\n    const [fetching, setFetching] = useState(0);               //0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n    function submit() {\r\n        if ( !ref?.current || !show ) return;\r\n            \r\n        rooms.createRoom(ref.current.value.toLowerCase())\r\n        .then( ()=>{\r\n            setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n            setFetching(2);   \r\n        }) \r\n        .catch( ()=>{\r\n            setFetching(3);   \r\n        }) \r\n        //setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n    }\r\n\r\n    function onKeyDown(e) {\r\n        if ( e.keyCode === 13 )\r\n            submit();\r\n    }\r\n\r\n    function handleUserInput(e){\r\n        setValid(ref?.current?.value.length > 3);\r\n    }\r\n\r\n    let button = <Button disabled={!isValid} variant={isValid?\"outline-primary\":\"outline-secondary\"} onClick={submit} >Proceed!</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" > ✔️ Succeed! </Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\"  > ❌ Error </Button>; break;\r\n        default: break;\r\n    }\r\n\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} ><i className=\"bi bi-magic\"/>Settings</Nav.Item>\r\n        <Modal id='wizard' onKeyDown={onKeyDown} tabIndex=\"0\" buttons={[button]} closeButton size=\"md\" {...{show, setShow}} _title={<span>Settings: Wizard</span>}>\r\n            <Wizard/>\r\n        </Modal>\r\n    </>;\r\n}","import { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\nimport React, {useContext, useRef, useEffect, useState, useReducer} from 'react'\r\n\r\nimport MD from 'utils/md';\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const [show, setShow]         = useState(false);\r\n\r\n    useEffect(() => {},[rooms.current]);\r\n    console.log('render-users')\r\n    \r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} disabled={!rooms.current} ><i className=\"bi bi-people\"/>Users</Nav.Item>\r\n        <Modal tabIndex=\"0\" closeButton size=\"md\" {...{show, setShow}} title={<span><i className=\"bi bi-people\"/> Users</span>}>\r\n            <ul>\r\n                {rooms.current?.users?.map( (v,k,a) => v && <li key={k}>{v?.username}</li> )}\r\n            </ul>            \r\n        </Modal>\r\n    </>;\r\n}","import { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\nimport React, {useContext, useRef, useEffect, useState, useReducer} from 'react'\r\n\r\nimport MD from 'utils/md';\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const [show, setShow]         = useState(false);\r\n\r\n    useEffect(() => {},[rooms.current]);\r\n    console.log('render-chat')\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} disabled={!rooms.current}><i className=\"bi bi-chat-dots\"/>Chat</Nav.Item>\r\n        <Modal tabIndex=\"0\" closeButton size=\"md\" {...{show, setShow}} title={<span><i className=\"bi bi-chat-dots\"/> Chat</span>}>\r\n            <ul>\r\n                {rooms.current?.users?.map( (v,k,a) => v && <li key={k}>{v?.username}</li> )}\r\n            </ul>            \r\n        </Modal>\r\n    </>;\r\n}","import Nav from \"partials/nav\"\r\nimport { useEffect, useState, useContext, useRef } from 'react'\r\nimport { ButtonToolbar, Button } from 'react-bootstrap'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\n\r\n\r\nexport default () => {\r\n    const canvasRef = useRef(null);\r\n    const media    = useContext(MediaContext);\r\n    const [isAudioEnabled, setAudioEnabled] = useState(false);\r\n    //const videotracks = media.localStream.getVideoTracks()??[];\r\n    //const [isVideoEnabled, setVideoEnabled] = useState(videotracks.every( v => v.enabled ));\r\n\r\n    function handleClick()\r\n    {\r\n        const audiotracks = media.localStream.getAudioTracks()??[];\r\n        const enabled = audiotracks.every(track => { track.enabled = !isAudioEnabled; return !!track.enabled;});\r\n        setAudioEnabled(enabled); \r\n    }\r\n\r\n    useEffect(() => {\r\n        const audiotracks = media.localStream.getAudioTracks()??[];\r\n        setAudioEnabled(audiotracks.every( v => v.enabled ))\r\n    } , [media.localStream, media.settings?.audio]);\r\n\r\n    useEffect(()=>{\r\n        const ctx = canvasRef?.current?.getContext('2d');\r\n        ctx.globalAlpha   = 0.5;\r\n        function draw()\r\n        {\r\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n            \r\n            const [x0, y0, r0, x1, y1, r1] = [ctx.canvas.width*.5, ctx.canvas.height * .5, 135, ctx.canvas.width*.5,ctx.canvas.height * .5,ctx.canvas.height * .5];\r\n            let gradient = ctx.createRadialGradient(x0, y0, r0, x1, y1, r1);\r\n            gradient.addColorStop(0, \"rgba(255, 255, 255, 0.0)\");\r\n            gradient.addColorStop(0.1, \"rgba(255, 255, 255, 0.5)\");\r\n            gradient.addColorStop(.5, \"rgba(255, 255, 255, 0.1)\");\r\n            gradient.addColorStop(1, \"rgba(255, 255, 255, 0.0)\");\r\n\r\n            ctx.fillStyle = gradient;\r\n            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n            requestAnimationFrame(draw)\r\n        }\r\n        const id = requestAnimationFrame(draw);\r\n        \r\n    return ()=>{\r\n        cancelAnimationFrame(id);\r\n    }\r\n    },[])\r\n\r\n    return <>\r\n    <div id='pulse-wrapper'className=\"p-4 rounded-circle\" style={{marginTop: '-4rem', marginBottom: '-4rem'}}>\r\n        <canvas width='512' height='512' ref={canvasRef} className='position-absolute top-0 rounded-circle'/>\r\n        <Nav.Button onClick={handleClick} label=\"Create room\" appendclass=\"shadow rounded-circle bg-danger\" >\r\n            <i className={isAudioEnabled?\"bi bi-mic\":\"bi bi-mic-mute\"}></i>\r\n        </Nav.Button>\r\n    </div>\r\n    \r\n    <style global jsx>{`\r\n        #pulse-wrapper {\r\n            //border: 1px dashed #ccc;\r\n            margin: -3rem -1.5rem 0rem -1.5rem !important;\r\n            overflow:hidden !important;\r\n\r\n            .nav-button{\r\n                margin-top: 0;\r\n                margin-bottom: 0;\r\n            }\r\n\r\n            canvas {\r\n                pointer-events: none;\r\n                margin-top: .35rem;\r\n                width: 5rem;\r\n                height:5rem;\r\n                transform:translate(-50%,-50%) scale(1.3) !important;\r\n            }\r\n    \r\n        }\r\n        @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n            #pulse-wrapper {\r\n                margin: -1.5rem 1rem -1.5rem -4rem !important;\r\n                .nav-button{\r\n                    margin-left: 0;\r\n                    margin-right: 0;\r\n                }\r\n                canvas {\r\n                    top: 50% !important;\r\n                    margin-top: 0rem;\r\n                }\r\n            }\r\n        }\r\n        @media only screen and (orientation: portrait){\r\n\r\n        } \r\n    \r\n    `}</style>\r\n    {/*\r\n    <Nav.Button>\r\n        <ButtonToolbar>\r\n            \r\n            <Button onClick={()=>{ \r\n                const enabled = audiotracks.every(track => { track.enabled = !isAudioEnabled; return !!track.enabled;});\r\n                setAudioEnabled(enabled); \r\n            }}><i className={isAudioEnabled?\"bi bi-mic-mute\":\"bi bi-mic-mute\"}></i></Button>\r\n            \r\n            <Button onClick={()=>{ \r\n                const enabled = videotracks.every(track => { track.enabled = !isVideoEnabled; return !!track.enabled;});\r\n                setVideoEnabled(enabled); \r\n            }}><i className={isVideoEnabled?\"bi bi-camera-video\":\"bi bi-camera-video-off\"}></i></Button>\r\n        \r\n        </ButtonToolbar>\r\n    </Nav.Button>\r\n    */}\r\n    </>\r\n}\r\n","import { useContext, useRef, useEffect } from 'react'\r\nimport { Container } from \"react-bootstrap\"\r\nimport { useHistory, Redirect } from \"react-router-dom\"\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nimport Nav from \"partials/nav\"\r\nimport Room  from 'views/room'\r\nimport Login  from 'views/login'\r\nimport Lobby  from 'views/lobby'\r\nimport Wizard from 'views/wizard'\r\nimport CreateRoomModal from 'components/modal_create_room'\r\nimport LeaveRoomModal from 'components/modal_leave_room'\r\nimport WizardModal from 'components/modal_wizard'\r\nimport UsersModal from 'components/modal_users'\r\nimport ChatModal from 'components/modal_chat'\r\nimport StreamButtons from 'components/btngrp_stream';\r\n\r\n\r\nfunction App({...props}) {\r\n  const history = useHistory();\r\n  const auth = useContext(AuthContext);\r\n  const rooms = useContext(RoomsContext);\r\n  let {current: view} = useRef();\r\n\r\n  if((/^\\/room\\/[a-zA-Z0-9]+/).test(history.location.pathname)) view = <Room container/>\r\n  if(history.location.pathname === '/'        ) view = <Lobby container/> \r\n  if(history.location.pathname === '/settings') view = <Wizard show={true} container/>\r\n  if((/^\\/room\\/[a-zA-Z0-9]+\\/chat$/).test(history.location.pathname)  ) view = <Redirect to=\"/\"/>\r\n  if((/^\\/room\\/[a-zA-Z0-9]+\\/users$/).test(history.location.pathname) ) view = <Redirect to=\"/\"/>\r\n\r\n  if(!(auth.isLogged && auth.isConnected))\r\n    return <div className=\"App\" children={<Login />}/>\r\n  else\r\n    return <>\r\n    <div className=\"App\">\r\n        \r\n      <Container fluid={view?.props?.container} id=\"content-wrapper\" > \r\n      {view}\r\n      </Container>\r\n\r\n      <Nav>\r\n          {rooms.current? <LeaveRoomModal/> : <Nav.Item><i className=\"bi bi-house\"/>Lobby</Nav.Item>}\r\n          <WizardModal/>\r\n          {rooms.current?<StreamButtons/>:<CreateRoomModal/>}\r\n          <UsersModal/>\r\n          <ChatModal/>\r\n      </Nav>\r\n \r\n \r\n    </div>\r\n    <style global jsx>{`\r\n      \r\n      html, body, .App{\r\n        overflow: hidden;\r\n        min-height:330px;\r\n      }\r\n\r\n      #content-wrapper{\r\n        height: 100%;\r\n        margin-bottom: 6rem;\r\n        margin-top: 3.5rem;\r\n        overflow-y: scroll;\r\n        overflow-x: hidden;\r\n        & .container-fluid{\r\n          margin:0 !important;\r\n        }\r\n      }\r\n\r\n      @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n          #content-wrapper{\r\n            margin-bottom: 1rem;\r\n            margin-top: 1rem;\r\n            margin-right:3rem;\r\n          }\r\n      }\r\n      @media only screen and (orientation: portrait){\r\n\r\n      }    \r\n    `}</style>\r\n  </>\r\n}\r\n\r\nexport default App;\r\n","import * as BRA from 'lib_bra'\r\nimport toast from  'react-hot-toast'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport React, { createContext, useContext, useEffect, useState } from 'react'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\n\r\n\r\nexport const RoomsContext = createContext(); \r\n\r\nexport default ({children, ...props}) => {\r\n    const auth    = useContext(AuthContext);\r\n    const history = useHistory();\r\n    \r\n    let   [rooms, setRooms]     = useState({});\r\n    const [ready, setReady]     = useState(false);\r\n    let   [current, setCurrent] = useState(null);\r\n    \r\n    useEffect( ()=>{ \r\n        if(!auth.isLogged) return;\r\n        \r\n        BRA.appClient.on(BRA.APPEvent.GuestLeftRoom,     onGuestLeft);\r\n        BRA.appClient.on(BRA.APPEvent.GuestJoinedRoom,   onGuestJoin);\r\n        BRA.appClient.on(BRA.APPEvent.RoomCreated,       onRoomCreated);\r\n        BRA.appClient.on(BRA.APPEvent.RoomDeleted,       onRoomDeleted);\r\n\r\n        //Initial fetch of rooms\r\n        BRA.appClient.getRooms( (m1) => { onGetRooms(m1)\r\n            BRA.appClient.getRoom(  (m2) => { onGetRoom(m2); \r\n            setReady(true);\r\n        });});\r\n\r\n        /*const interval = setInterval(() => {\r\n            BRA.appClient.getRooms(onGetRooms);\r\n            BRA.appClient.getRoom(onGetRoom);\r\n        } , 2000);*/\r\n\r\n    return ()=>{\r\n        BRA.appClient.off(BRA.APPEvent.GuestLeftRoom,    onGuestLeft);\r\n        BRA.appClient.off(BRA.APPEvent.GuestJoinedRoom,  onGuestJoin);\r\n        BRA.appClient.off(BRA.APPEvent.RoomCreated,      onRoomCreated);\r\n        BRA.appClient.off(BRA.APPEvent.RoomDeleted,      onRoomDeleted);\r\n        //clearInterval(interval);\r\n    }}, [auth.isLogged]);\r\n\r\n    function isUserInRoom(username, roomName)\r\n    {\r\n        const room = {...rooms,[current?.name]:current}[roomName];\r\n        for(let user of room?.users??[]){\r\n            if(user?.username === username) \r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function imInRoom(roomName)\r\n    {\r\n        return isUserInRoom(auth.user?.username, roomName);\r\n    }\r\n\r\n    function onRoomCreated({data:{room}}){\r\n        setRooms({...rooms, [room.name]:room});\r\n    }\r\n\r\n    function onRoomDeleted({data:{room}}){\r\n        delete rooms[room.name];\r\n        setRooms({...rooms});\r\n        BRA.appClient.getRoom(onGetRoom)\r\n    }\r\n\r\n    function onGuestLeft({data:{user,room}})\r\n    {\r\n        BRA.appClient.getRoom(onGetRoom);\r\n        toast(`User '${user.username}' left`);\r\n        if(current)\r\n            setCurrent( {...current, users: current?.users??[].filter(u=>u.username!==user.username)} );\r\n    }    \r\n    \r\n    function onGuestJoin({data:{user,room}})\r\n    {\r\n        BRA.appClient.getRoom(onGetRoom);\r\n        toast(`User '${user.username}' joined`);\r\n        if(current)\r\n            setCurrent( {...current, users: current?.users??[].push(user)} );\r\n    }\r\n    \r\n    function onGetRoom({ data: {room} }){\r\n        setCurrent(room?.name?{...room}:null);\r\n\r\n        if(room?.name)\r\n        {\r\n            history.push(`/room/${room?.name}`);\r\n        }\r\n        else{\r\n            history.push(`/`);\r\n        }\r\n    }\r\n\r\n    function onGetRooms({data:{rooms}}){\r\n        let rs = {};\r\n        for(let room of rooms??[])\r\n            rs[room.name] = room;\r\n        setRooms(rs);\r\n    }\r\n\r\n    function createRoom(roomName, {password, hidden, icon}){\r\n        return new Promise((resolve, reject)=>{\r\n            BRA.appClient.createRoom(roomName, password??\"\", hidden??false, icon??\"\", ({event, data}) => {\r\n                if(data.error) reject(data.message);\r\n                else resolve(data.room);\r\n            });\r\n        })\r\n        .then(  (room)=>{ BRA.appClient.getRoom(onGetRoom); return room; } )\r\n        //.catch( (e) => toast.error(e) );\r\n    }\r\n\r\n    function joinRoom(roomName){\r\n        return new Promise((resolve, reject) => {\r\n            BRA.appClient.joinRoom(roomName,\"\",({event, data}) => {\r\n                if(data.error) reject(data.message);\r\n                else resolve(data.room);\r\n            });\r\n        })    \r\n        .then(  (room)=>{ BRA.appClient.getRoom(onGetRoom); return room; } )\r\n        //.catch( (e) => toast.error(e) );\r\n    }\r\n\r\n    function leaveRoom(){\r\n        return new Promise((resolve, reject)=>{\r\n            BRA.appClient.leaveRoom(({event, data}) => {\r\n                if(data.error) reject(data.message);\r\n                else resolve(data.room);\r\n            });\r\n        })\r\n        .then(  (room)=>{ BRA.appClient.getRoom(onGetRoom); return room; } )\r\n        //.catch( (e)=> toast.error(e) );\r\n    }\r\n\r\n\r\n    const store = window.rooms = {\r\n        joinRoom,\r\n        leaveRoom,\r\n        createRoom,\r\n        setCurrent,\r\n        imInRoom,\r\n        isUserInRoom,\r\n        ready,\r\n        current,\r\n        list: rooms,\r\n    }\r\n\r\n    return <RoomsContext.Provider value={store} children={children}/>\r\n}","import rehypeRaw from 'rehype-raw'\r\nimport remarkGfm from 'remark-gfm'\r\nimport remarkBreaks from 'remark-breaks'\r\nimport ReactMarkdown from 'react-markdown'\r\n\r\nexport default ({children,...props}) => {\r\n    return <ReactMarkdown children={children.replaceAll(\"  \",\"\")} remarkPlugins={[remarkGfm, remarkBreaks]} rehypePlugins={[rehypeRaw]} {...props}/>\r\n}","import http from \"utils/http\"\r\nimport * as BRA from \"lib_bra\";\r\nimport cookies from '@h3r/cookies'\r\nimport toast from 'react-hot-toast'\r\nimport { createContext, useEffect, useState, useRef } from 'react'\r\n\r\nexport const AuthContext = createContext()\r\n\r\nexport default ({children, ...props}) => {\r\n    const [ user,        setUser      ] = useState(null);\r\n    const [ token,       setToken     ] = useState(cookies.get(\"admire_app_token\"));\r\n    const [ isLogged,    setLogged    ] = useState(false);\r\n    const [ isConnected, setConnected ] = useState({app:false, rtc:false});\r\n    let   { current: toast_app }        = useRef(null);\r\n    let   { current: toast_rtc }        = useRef(null);\r\n    let   { current: toast_usr }        = useRef(null);\r\n    const [ retries, setRetries ]       = useState(0);        \r\n\r\n\r\n    useEffect( ()=>{ //Constructor\r\n        function onUnload(){\r\n            BRA.rtcClient.unregister();\r\n            BRA.rtcClient.disconnect();\r\n            BRA.appClient.disconnect(); \r\n            window.removeEventListener('unload', onUnload);\r\n        }\r\n        window.addEventListener('unload', onUnload);\r\n\r\n        let onAppConnect, onAppDisconnect, onRtcConnect, onRtcDisconnect;\r\n        BRA.appClient.on(BRA.APPEvent.ClientConnected,      onAppConnect      = () => { toast(\"App Connected\",    {id:toast_app, icon:'⚡', duration:2000}); setConnected( v => ({...v, app:true })); });\r\n        BRA.rtcClient.on(BRA.RTCEvent.ClientConnected,      onRtcConnect      = () => { toast(\"RTC Connected\",    {id:toast_rtc, icon:'⚡', duration:2000}); setConnected( v => ({...v, rtc:true })); });\r\n        BRA.appClient.on(BRA.APPEvent.ClientDisconnected,   onAppDisconnect   = () => { toast(\"App Disconnected\", {id:toast_app, icon:'⚠️', duration:2000}); setConnected( v => ({...v, app:false})); });\r\n        BRA.rtcClient.on(BRA.RTCEvent.ClientDisconnected,   onRtcDisconnect   = () => { toast(\"RTC Disconnected\", {id:toast_rtc, icon:'⚠️', duration:2000}); setConnected( v => ({...v, rtc:false})); });\r\n\r\n    return ()=>{ //Destructor\r\n        BRA.appClient.off(BRA.APPEvent.ClientConnected,     onAppConnect        );\r\n        BRA.appClient.off(BRA.RTCEvent.ClientConnected,     onAppDisconnect     );\r\n        BRA.rtcClient.off(BRA.APPEvent.ClientDisconnected,  onRtcConnect        );\r\n        BRA.rtcClient.off(BRA.RTCEvent.ClientDisconnected,  onRtcDisconnect     );\r\n\r\n        onUnload();\r\n    }\r\n    }, []);\r\n\r\n    useEffect( ()=>{\r\n        if(!isConnected.app && token){\r\n            BRA.appClient.connect(process.env.REACT_APP_APP_URL, token);\r\n        }\r\n    }, [isConnected.app, token]);\r\n\r\n    useEffect( ()=>{\r\n        if(!isConnected.rtc && token){\r\n            BRA.rtcClient.connect(process.env.REACT_APP_RTC_URL, token);\r\n        }\r\n    }, [isConnected.rtc, token]);\r\n\r\n    useEffect( ()=>{\r\n        if(isConnected.rtc && isConnected.app && token && !isLogged) //Im properly connected\r\n        {\r\n            toast_usr = toast.loading(`Fetching user info...`, {duration:Infinity});\r\n            getUserInfo()\r\n            .then( (response) => {\r\n                toast.success(`Success`, {id:toast_usr, icon:'⚡', duration:2000});\r\n                console.log(response);\r\n                setUser(response);\r\n                setLogged(true);\r\n            })\r\n            .catch( ({error, message}) => {\r\n                toast.error(`onGetUserInfo(e:${error}): ${message}`, {id:toast_usr, icon:'⚠️', duration:4000});\r\n                if(retries >= 3) logout();\r\n                else \r\n                {\r\n                    toast((t) => {\r\n                        const [timer, setTimer] = useState(t.duration * .001);\r\n                        useEffect( ()=>{ const interval_id = setInterval(()=>setTimer(s=>Math.max(0,s-1)), 1000);   //Toast Constructor\r\n                            return ()=>{ clearInterval(interval_id);    setRetries(v => v+1);                       //Toast Destructor\r\n                        }}, []);\r\n                        return <span>{timer === 0 ? `Retrying`:`Retrying in ${timer}s...`}</span>\r\n                    },{duration:5000});\r\n                }\r\n            });\r\n        }\r\n        if(isConnected.rtc && isConnected.app && isLogged){\r\n            BRA.rtcClient.register(user.username);\r\n        }\r\n    },[isConnected.rtc && isConnected.app, token, isLogged, retries]);\r\n\r\n    async function login(email, password){\r\n        const toastId = toast.loading('Logging in...');\r\n        email = email.toLowerCase();\r\n        return http.post(`${process.env.REACT_APP_API_URL}/auth/basic`, {data:{ email, password }})\r\n        .then(response => {\r\n            if(response?.access_token){\r\n                toast.success('Success login', { id: toastId });\r\n                setToken(response.access_token);\r\n                return response.access_token;\r\n            }\r\n            else {\r\n                toast.error(`Error ${response.error}: ${response.message}`, { id: toastId });\r\n                setTimeout(logout,2000)\r\n            }\r\n        })\r\n        .catch(err => toast.error(`Error catch: ${err}`, { id: toastId }));\r\n    }\r\n\r\n    async function logout(){\r\n        cookies.set(\"admire_app_email\",null,-1);\r\n        cookies.set(\"admire_app_token\",null,-1);\r\n        setToken(null);\r\n        setLogged(false);\r\n        toast('Logged out');\r\n        \r\n        BRA.rtcClient.unregister();\r\n        BRA.rtcClient.disconnect();\r\n        BRA.appClient.disconnect(); \r\n        setRetries(0);\r\n    }\r\n\r\n    async function getUserInfo(){\r\n        return new Promise((resolve, reject) => {\r\n            http.get(`${process.env.REACT_APP_API_URL}/users/me`, {headers:{Authorization:`Bearer ${token}`}})\r\n            .then( response => {\r\n                if(response?.error) reject(response);\r\n                else resolve(response);\r\n            })\r\n            .catch(err => reject(err));\r\n        });\r\n    }\r\n    \r\n    const store = window.auth = {\r\n        user       \r\n        ,isLogged\r\n       ,isConnected: isConnected.app && isConnected.rtc\r\n       ,login\r\n       ,logout\r\n   }\r\n \r\n    return <AuthContext.Provider value={store}> \r\n        {children}\r\n    </AuthContext.Provider>\r\n}","var map = {\n\t\"./Devices.jsx\": [\n\t\t467,\n\t\t3\n\t],\n\t\"./p1.jsx\": [\n\t\t464,\n\t\t4\n\t],\n\t\"./p2.jsx\": [\n\t\t465,\n\t\t5\n\t],\n\t\"./p3.jsx\": [\n\t\t466,\n\t\t6\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 456;\nmodule.exports = webpackAsyncContext;","const reportWebVitals = (onPerfEntry) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\n\r\nimport Layout from 'components/layout'\r\nimport {ProgressBar} from 'react-bootstrap';\r\n\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n      <React.Suspense children={<Layout/>} fallback={<ProgressBar className=\"start-50\" animated now={100} />}/>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://cra.link/PWA\r\nserviceWorkerRegistration.register();\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","import * as BRA from \"lib_bra\"\r\nimport toast from 'react-hot-toast'\r\nimport { useState, useContext, useReducer, useEffect, createContext, useRef } from 'react'\r\n\r\n\r\nexport const MediaContext = createContext(); \r\nexport default ({children, ...props}) => {\r\n\r\n    let   {current:init_evts}            = useRef(0);\r\n    const videoRef                       = useRef(null);\r\n    const [ready, setReady ]             = useState(false);\r\n    const [devices , setDevices]         = useState(null);\r\n    const [settings, setSettings ]       = useState(null);\r\n    const [resolutions, setResolutions ] = useState(null);\r\n    const [localStream, setLocalStream ] = useReducer( (value, newvalue)=>{\r\n        if( videoRef && videoRef.current )\r\n            videoRef.current.srcObject = newvalue;\r\n        return newvalue;\r\n    }, BRA.dummyStream.getStream() );\r\n    \r\n    useEffect( ()=>{ \r\n        BRA.mediaAdapter.on(\"got_stream\",         onGotStream );\r\n        BRA.mediaAdapter.on('got_devices',        onGotDevices );\r\n        BRA.mediaAdapter.on(\"error_stream\",       onError);\r\n        BRA.mediaAdapter.on(\"error_devices\",      onError);\r\n        BRA.mediaAdapter.on(\"got_resolutions\",    onGotResolutions );\r\n        BRA.mediaAdapter.start();\r\n        getDevices();\r\n        \r\n\r\n        function onUnload(){\r\n            BRA.mediaAdapter.off(\"got_stream\",        onGotStream );\r\n            BRA.mediaAdapter.off('got_devices',       onGotDevices );\r\n            BRA.mediaAdapter.off(\"error_stream\",      onError);\r\n            BRA.mediaAdapter.off(\"error_devices\",     onError);\r\n            BRA.mediaAdapter.off(\"got_resolutions\",   onGotResolutions );\r\n            window.removeEventListener('unload ', onUnload);\r\n        }\r\n        window.addEventListener('unload ',    onUnload);\r\n    return ()=>{\r\n        onUnload();\r\n    }}, []);\r\n\r\n    function getDevices(){\r\n        BRA.mediaAdapter.getDevices();\r\n    }\r\n\r\n    function onGotResolutions({resolutions, settings})\r\n    { \r\n        setSettings({...settings});\r\n        setResolutions(resolutions); \r\n    }\r\n    \r\n    function onGotDevices ({ audioDevices: audio, videoDevices: video, settings }) \r\n    { \r\n        setSettings({...settings});\r\n        setDevices({...devices, audio, video});\r\n    }\r\n\r\n    function onGotStream( {stream, settings})\r\n    { \r\n        setSettings({...settings});\r\n        setLocalStream(stream);\r\n        setReady(true);\r\n    }\r\n\r\n    function onError({description}){\r\n        toast.error(\"Error:\", description);\r\n    }\r\n\r\n    function init(){\r\n        if( init_evts <= 0 ){\r\n            //start the thing\r\n            //BRA.mediaAdapter.start();\r\n            getDevices();\r\n        }\r\n        ++init_evts;\r\n    }\r\n\r\n    function stop(){\r\n        --init_evts;\r\n        if( init_evts <= 0 ){\r\n            //BRA.mediaAdapter.stop();\r\n            //stop the thing\r\n        }\r\n    }\r\n\r\n    function setVideo(device, resolution){\r\n        BRA.mediaAdapter.setVideo(device, resolution);\r\n    }\r\n    function setAudio(device){\r\n        BRA.mediaAdapter.setAudio(device);\r\n    }\r\n\r\n    const store = window.media = {\r\n        devices,\r\n        settings, \r\n        resolutions,\r\n        localStream,\r\n        init,\r\n        stop,\r\n        getDevices,\r\n        setVideo,\r\n        setAudio,\r\n        ready,\r\n    }\r\n\r\n    return <MediaContext.Provider value={store} children={children}/>\r\n}","\r\nlet http = {\r\n    get: async function(url, options = {}) {\r\n        const headers = Object.assign({\r\n            'Content-Type': 'application/json'\r\n        }, options.headers ?? {});\r\n\r\n        return fetch(url, {method: 'GET',headers})\r\n        .then(response => response.json())\r\n        .catch(error => console.trace(error));\r\n    },\r\n\r\n    post: async function(url, options = {}) {\r\n        const headers = Object.assign({\r\n            'Content-Type': 'application/json'\r\n        }, options.headers ?? {});\r\n\r\n        const body = JSON.stringify(options.data ?? {});\r\n\r\n        return fetch(url, {method: 'POST',headers,body})\r\n        .then(response =>  response.json())\r\n        .catch(error => console.trace(error));\r\n    },\r\n}\r\n\r\nexport default http;","export const RTCEvent =\r\n{\r\n\tClientConnected:        \"client_connected\",\r\n\tClientDisconnected:     \"client_disconnected\",\r\n    IncomingCall:           \"incoming_call\",\r\n    CallAccepted:           \"call_accepted\",\r\n    CallCanceled:           \"call_canceled\",\r\n    CallOpened:             \"call_opened\",\r\n    CallClosed:             \"call_closed\",\r\n    UserHangup:             \"user_hangup\"\r\n};\r\n\r\nexport function RTCClient( settings )\r\n{\r\n//#region Variables\r\n    let defaultSettings =\r\n    {\r\n        debug: false,\r\n        debugStyle: \"background: hsla(0, 0%, 13%, 1); color: hsla(74, 64%, 60%, 1)\",\r\n        pingPeriod: 5 * 1000,\r\n        defaultStream: new MediaStream()\r\n    };\r\n\r\n    settings = (typeof settings !== \"object\") ? { } : settings;\r\n    settings = Object.assign({ }, defaultSettings, settings);\r\n\r\n    let console = (settings.debug) ? window.console : null;\r\n\r\n    let responses = { };\r\n    let events = { };\r\n\r\n    let calls = { };\r\n    let socket = null;\r\n    let keepAliveTimeout = null;\r\n\r\n    let userId = null;\r\n    let rtcConfiguration = { iceServers: null };\r\n//#endregion\r\n\r\n//#region Methods\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Get the call identified by the specified ID.\r\n     */\r\n    let getCall = function( callId )\r\n    {\r\n        return (callId in calls) ? calls[callId] : null;\r\n    };\r\n \r\n    /**\r\n     * Get all the calls.\r\n     */\r\n    let getCalls = function()\r\n    {\r\n        return calls;\r\n    };\r\n\r\n    /**\r\n     * Connect to the server.\r\n     */\r\n    let connect = function( url )\r\n    {\r\n        if( socket && socket.readyState != WebSocket.CLOSED )\r\n        {\r\n            console?.error(\"WebSocket not closed\");\r\n            return;\r\n        }\r\n\r\n        socket = new WebSocket(url);\r\n\r\n        socket.onopen = onOpen;\r\n        socket.onmessage = onMessage;\r\n        socket.onclose = onClose;\r\n    };\r\n\r\n    /**\r\n     * Disconnect from the server.\r\n     */\r\n    let disconnect = function()\r\n    {\r\n        if( !socket || socket.readyState == WebSocket.OPEN )\r\n        {\r\n            console?.error(\"WebSocket not opened\");\r\n            return;\r\n        }\r\n\r\n        socket?.close();\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is opened.\r\n     */\r\n    let onOpen = function( event )\r\n    {\r\n        startKeepAlive();\r\n\r\n        console?.log(\"%c\" + RTCEvent.ClientConnected + \"%o\", settings.debugStyle, socket.url);\r\n\r\n        emit(RTCEvent.ClientConnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is closed.\r\n     */\r\n    let onClose = function( event )\r\n    {\r\n        userId = null;\r\n        rtcConfiguration.iceServers = null;\r\n\r\n        stopKeepAlive();\r\n\r\n        console?.log(\"%c\" + RTCEvent.ClientDisconnected + \"%o\", settings.debugStyle, socket.url);\r\n        emit(RTCEvent.ClientDisconnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when a message is received from the server.\r\n     */\r\n    let onMessage = function( msg )\r\n    {\r\n        let message = JSON.parse(msg.data);\r\n        if( message.id === \"pong\" )\r\n        {\r\n            return;\r\n        }\r\n\r\n        console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.id, msg.data);\r\n\r\n        // Check whether the message needs internal handling.\r\n        switch( message.id )\r\n        {\r\n            case \"register_response\":       handleRegisterResponse(message);        break;\r\n            case \"unregister_response\":     handleUnregisterResponse(message);      break;\r\n            case \"call_response\":           handleCallResponse(message);            break;\r\n            case \"incoming_call\":           handleIncomingCall(message);            break;\r\n            case \"call_accepted\":           handleCallAccepted(message);            break;\r\n            case \"call_canceled\":           handleCallCanceled(message);            break;\r\n            case \"remote_offer\":            handleRemoteOffer(message);             break;\r\n            case \"remote_answer\":           handleRemoteAnswer(message);            break;\r\n            case \"remote_candidate\":        handleRemoteCandidate(message);         break;\r\n            case \"user_hangup\":             handleUserHangup(message);              break;\r\n        }\r\n\r\n        // Check whether the message has a response listener.\r\n        if( message.uuid in responses )\r\n        {\r\n            let response = responses[message.uuid];\r\n            delete responses[message.uuid];\r\n            delete message.uuid;\r\n            response(message);\r\n        }\r\n\r\n        // Check whether the message has an event.\r\n        emit(message.id, message);\r\n    };\r\n\r\n    /**\r\n     * Send a message to the server.\r\n     */\r\n    let sendMessage = function( message, response )\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Generate a UUID.\r\n        message.uuid = uuid();\r\n\r\n        // Add the response listener.\r\n        if( response instanceof Function )\r\n        {\r\n            responses[message.uuid] = response;\r\n        }\r\n\r\n        // Send the message.\r\n        let msg = JSON.stringify(message);\r\n        socket.send(msg);\r\n        if( message.id !== \"ping\" )\r\n        {\r\n            console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.id, msg);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start a keep alive timeout.\r\n     */\r\n    let startKeepAlive = function()\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            console?.error(\"WebSocket not opened\");\r\n            return false;\r\n        }\r\n\r\n        ping();\r\n\r\n        keepAliveTimeout = window.setTimeout(startKeepAlive, settings.pingPeriod);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Stop the keep alive timeout.\r\n     */\r\n    let stopKeepAlive = function()\r\n    {\r\n        window.clearTimeout(keepAliveTimeout);\r\n    };\r\n \r\n    /**\r\n     * Send a ping to the server.\r\n     */\r\n    let ping = function()\r\n    {\r\n        let message =\r\n        {\r\n            id: \"ping\"\r\n        };\r\n        return sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Register to the server.\r\n     */\r\n    let register = function( username, response )\r\n    {\r\n        if( userId )\r\n        {\r\n            console?.error(\"Client already registered\");\r\n            return false;\r\n        }\r\n\r\n        let message =\r\n        {\r\n            id: \"register\",\r\n            userId: username\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Unregister from the server.\r\n     */\r\n    let unregister = function( response )\r\n    {\r\n        if( !userId )\r\n        {\r\n            console?.error(\"Client not registered\");\r\n            return false;\r\n        }\r\n\r\n        hangup();\r\n\r\n        let message =\r\n        {\r\n            id: \"unregister\",\r\n            userId: userId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Call a user.\r\n     */\r\n    let call = function( calleeId, response )\r\n    {\r\n        if( userId === calleeId )\r\n        {\r\n            console?.error(\"Invalid user id \" + calleeId);\r\n            return false;\r\n        }\r\n\r\n        let message =\r\n        {\r\n            id: \"call\",\r\n            callerId: userId,\r\n            calleeId: calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Close a call.\r\n     */\r\n    let closeCall = function( callId )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let call = calls[callId];\r\n        call.close();\r\n        delete(calls[callId]);\r\n\r\n        emit(RTCEvent.CallClosed, { call: call });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Accept a call.\r\n     */\r\n    let acceptCall = function( callId, response )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            console?.error(\"Call \" + callId + \" not found\");\r\n            return false;\r\n        }\r\n\r\n        let call = calls[callId];\r\n\r\n        let message =\r\n        {\r\n            id: \"accept_call\",\r\n            callId: call.callId,\r\n            callerId: call.callerId,\r\n            calleeId: call.calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Cancel a call.\r\n     */\r\n    let cancelCall = function( callId, response )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            console?.error(\"Call \" + callId + \" not found\");\r\n            return false;\r\n        }\r\n\r\n        // Delete the call.\r\n        let call = calls[callId];\r\n        delete calls[callId];\r\n\r\n        let message =\r\n        {\r\n            id: \"cancel_call\",\r\n            callId: call.callId,\r\n            callerId: call.callerId,\r\n            calleeId: call.calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Hang up a call. If call ID is undefined then all calls are hang up.\r\n     */\r\n    let hangup = function( callId, response )\r\n    {\r\n        if( callId ) // Close the call.\r\n        {\r\n            if( !closeCall(callId) )\r\n            {\r\n                return false;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"hangup\",\r\n                callId: callId\r\n            };\r\n            return sendMessage(message, response);\r\n        }\r\n        else // Close all the calls.\r\n        {\r\n            for( let callId in calls )\r\n            {\r\n                if( !closeCall(callId) )\r\n                {\r\n                    continue;\r\n                }\r\n\r\n                let message =\r\n                {\r\n                    id: \"hangup\",\r\n                    callId: callId\r\n                };\r\n                sendMessage(message);\r\n            }\r\n\r\n            calls = { };\r\n\r\n            return true;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier.\r\n     * Reference: RFC 4122 https://www.ietf.org/rfc/rfc4122.txt\r\n     */\r\n    let uuid = function()\r\n    {\r\n        return uuidv4();\r\n    };\r\n \r\n    /**\r\n     * Generate a universally unique identifier v4.\r\n     * Reference: https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\r\n     */\r\n    let uuidv4 = function()\r\n    {\r\n        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\r\n        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\r\n        );\r\n    };\r\n//#endregion\r\n\r\n//#region EventHandlers\r\n    /**\r\n     * Register response event handler.\r\n     */\r\n    let handleRegisterResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            userId = event.userId;\r\n            rtcConfiguration.iceServers = JSON.parse(event.iceServers);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Unregister response event handler.\r\n     */\r\n    let handleUnregisterResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            userId = null;\r\n            rtcConfiguration.iceServers = null;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Call response event handler.\r\n     */\r\n    let handleCallResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            // Create the call.\r\n            let call = new RTCCall(event.callId, event.callerId, event.calleeId);\r\n            calls[call.callId] = call;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Incoming call event handler.\r\n     */\r\n    let handleIncomingCall = function( event )\r\n    {\r\n        // Create the call.\r\n        let call = new RTCCall(event.callId, event.callerId, event.calleeId);\r\n        calls[event.callId] = call;\r\n    };\r\n\r\n    /**\r\n     * Call accepted event handler.\r\n     */\r\n    let handleCallAccepted = function( event )\r\n    {\r\n        // Create the peer connection.\r\n        let peerConnection = new RTCPeerConnection(rtcConfiguration);\r\n        let call = calls[event.callId];\r\n        call.bind(peerConnection, true);\r\n\r\n        // Handle the peer connection lifecycle.\r\n        peerConnection.oniceconnectionstatechange = function( other )\r\n        {\r\n            handleIceConnectionStateChange(call);\r\n        }\r\n\r\n        // Generate candidates.\r\n        peerConnection.onicecandidate = function( other )\r\n        {\r\n            if( !other.candidate || other.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n            {\r\n                return;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"candidate\",\r\n                callId: event.callId,\r\n                callerId: event.callerId,\r\n                calleeId: event.calleeId,\r\n                candidate: JSON.stringify(other.candidate)\r\n            };\r\n            sendMessage(message);\r\n        };\r\n\r\n        peerConnection.onnegotiationneeded = function( other )\r\n        {\r\n            // Generate offer.\r\n            peerConnection.createOffer().then(function( sdp )\r\n            {\r\n                // Set caller local description.\r\n                peerConnection.setLocalDescription(sdp);\r\n\r\n                let message =\r\n                {\r\n                    id: \"offer\",\r\n                    callId: event.callId,\r\n                    callerId: event.callerId,\r\n                    calleeId: event.calleeId,\r\n                    offer: JSON.stringify(sdp)\r\n                };\r\n                sendMessage(message);\r\n            });\r\n        };\r\n\r\n        // Add the tracks. This action triggers the ICE negotiation process.\r\n        let tracks = settings.defaultStream.getTracks();\r\n        tracks.forEach(track => peerConnection.addTrack(track));\r\n\r\n        // Create a default data channel to avoid renegotiation.\r\n        peerConnection.createDataChannel(\"default\");\r\n    };\r\n\r\n    /**\r\n     * Call canceled event handler.\r\n     */\r\n    let handleCallCanceled = function( event )\r\n    {\r\n        closeCall(event.callId);\r\n    };\r\n\r\n    /**\r\n     * Remote offer event handler.\r\n     */\r\n    let handleRemoteOffer = function( event )\r\n    {\r\n        // Create the peer connection.\r\n        let peerConnection = new RTCPeerConnection(rtcConfiguration);\r\n        let call = calls[event.callId];\r\n        call.bind(peerConnection, false);\r\n\r\n        // Handle the peer connection lifecycle.\r\n        peerConnection.oniceconnectionstatechange = function( other )\r\n        {\r\n            handleIceConnectionStateChange(call);\r\n        }\r\n\r\n        // Set the callee remote description.\r\n        peerConnection.setRemoteDescription(JSON.parse(event.offer));\r\n\r\n        // Gather the pending candidates.\r\n        call.gatherPendingCandidates();\r\n\r\n        // Generate the candidates.\r\n        peerConnection.onicecandidate = function( other )\r\n        {\r\n            if( !other.candidate || other.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n            {\r\n                return;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"candidate\",\r\n                callId: event.callId,\r\n                callerId: event.callerId,\r\n                calleeId: event.calleeId,\r\n                candidate: JSON.stringify(other.candidate)\r\n            };\r\n            sendMessage(message);\r\n        };\r\n\r\n        // Add the tracks.\r\n        let tracks = settings.defaultStream.getTracks();\r\n        tracks.forEach(track => peerConnection.addTrack(track));\r\n\r\n        // Create the answer.\r\n        window.setTimeout(function()\r\n        {\r\n            peerConnection.createAnswer().then(function( sdp )\r\n            {\r\n                // Set the callee local description.\r\n                peerConnection.setLocalDescription(sdp);\r\n\r\n                let message =\r\n                {\r\n                    id: \"answer\",\r\n                    callId: event.callId,\r\n                    callerId: event.callerId,\r\n                    calleeId: event.calleeId,\r\n                    answer: JSON.stringify(sdp)\r\n                };\r\n                sendMessage(message);\r\n            });\r\n        }, 500);\r\n    };\r\n\r\n    /**\r\n     * Remote answer event handler.\r\n     */\r\n    let handleRemoteAnswer = function( event )\r\n    {\r\n        if( event.callId in calls )\r\n        {\r\n            let answer = JSON.parse(event.answer);\r\n\r\n            // Set the caller remote description.\r\n            calls[event.callId].setRemoteDescription(answer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Remote candidate event handler.\r\n     */\r\n    let handleRemoteCandidate = function( event )\r\n    {\r\n        let candidate = JSON.parse(event.candidate);\r\n        if( !candidate || !candidate.candidate || candidate.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n        {\r\n            return;\r\n        }\r\n\r\n        if( event.callId in calls )\r\n        {\r\n            let call = calls[event.callId];\r\n            call.addCandidate(candidate);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * User hangup event handler.\r\n     */\r\n    let handleUserHangup = function( event )\r\n    {\r\n        closeCall(event.callId);\r\n    };\r\n\r\n    /**\r\n     * ICE connection state change event handler.\r\n     */\r\n    let handleIceConnectionStateChange = async function( call )\r\n    {\r\n        let state = call.getState();\r\n        console?.log(\"%c\" + \"Connection State\" + \"%o%o\", settings.debugStyle, call.callId, state);\r\n\r\n        switch( state )\r\n        {\r\n            case \"failed\":\r\n            case \"disconnected\":\r\n            case \"closed\":\r\n            {\r\n                hangup(call.callId);\r\n                break;\r\n            }\r\n            case \"new\":\r\n            case \"checking\":\r\n            case \"completed\":\r\n            {\r\n                break;\r\n            }\r\n            case \"connected\":\r\n            {\r\n                let stream = call.getRemoteStream();\r\n                console?.log(\"%c\" + RTCEvent.CallOpened + \"%o%o\", settings.debugStyle, call.callId, stream);\r\n                emit(RTCEvent.CallOpened, { call: call, stream: stream });\r\n                break;\r\n            }\r\n        }\r\n    };\r\n//#endregion\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        getCall,\r\n        getCalls,\r\n        connect,\r\n        disconnect,\r\n        register,\r\n        unregister,\r\n        call,\r\n        acceptCall,\r\n        cancelCall,\r\n        hangup\r\n    };\r\n}\r\n\r\nexport function RTCCall( callId, callerId, calleeId )\r\n{\r\n//#region Variables\r\n    let connection = null;\r\n    let candidates = [];\r\n    let channels = { };\r\n    let initiator = false;\r\n//#endregion\r\n\r\n//#region Methods\r\n    /**\r\n     * Bind the call to a peer connection.\r\n     */\r\n    let bind = function( peerConnection, isInitiator )\r\n    {\r\n        if( !(peerConnection instanceof RTCPeerConnection) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection = peerConnection;\r\n        initiator = isInitiator;\r\n\r\n        // Handle the data channel event internally to track the data channels lifecycle.\r\n        connection.addEventListener(\"datachannel\", function( event )\r\n        {\r\n            channels[event.channel.label] = event.channel;\r\n\r\n            // Handle the close event.\r\n            event.channel.addEventListener(\"onclose\", function( event )\r\n            {\r\n                delete channels[event.channel.label];\r\n            });\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Close the call.\r\n     */\r\n    let close = function()\r\n    {\r\n        connection?.close();\r\n    };\r\n\r\n    /**\r\n     * Return whether the user is the initiator.\r\n     */\r\n    let isInitiator = function()\r\n    {\r\n        return initiator;\r\n    };\r\n\r\n    /**\r\n     * Get the call state.\r\n     */\r\n    let getState = function()\r\n    {\r\n        return (connection) ? connection.iceConnectionState : \"closed\";\r\n    };\r\n\r\n    /**\r\n     * Get the call stats.\r\n     */\r\n    let getStats = async function()\r\n    {\r\n        if( !connection )\r\n        {\r\n            return;\r\n        }\r\n\r\n        let callStats = { callId: callId, callerId: callerId, calleeId: calleeId };\r\n\r\n        return await connection.getStats(null).then(function( stats )\r\n        {\r\n            // Get the stats of the succeeded candidate pair.\r\n            let pairStats = null;\r\n            stats.forEach(report =>\r\n            {\r\n                //console.log(report);\r\n                if( report.type === \"candidate-pair\" && (report.selected === true || report.state === \"succeeded\") )\r\n                {\r\n                    pairStats = report;\r\n                }\r\n            });\r\n\r\n            // Get the stats of the local and remote candidates.\r\n            if( pairStats )\r\n            {\r\n                stats.forEach(report =>\r\n                {\r\n                    if( report.id === pairStats.localCandidateId )\r\n                    {\r\n                        callStats.localType = report.candidateType;\r\n                        callStats.localAddress = report.address ?? report.ip;\r\n                        callStats.localPort = report.port;\r\n                        callStats.localProtocol = report.protocol;\r\n                    }\r\n                    if( report.id === pairStats.remoteCandidateId )\r\n                    {\r\n                        callStats.remoteType = report.candidateType;\r\n                        callStats.remoteAddress = report.address ?? report.ip;\r\n                        callStats.remotePort = report.port;\r\n                        callStats.remoteProtocol = report.protocol;\r\n                    }\r\n                });\r\n            }\r\n\r\n            return Promise.resolve(callStats);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Add a candidate or save it for gathering.\r\n     */\r\n    let addCandidate = function( candidate )\r\n    {\r\n        if( !connection )\r\n        {\r\n            candidates.push(candidate);\r\n        }\r\n        else\r\n        {\r\n            connection.addIceCandidate(candidate);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Gather the pending candidates.\r\n     */\r\n    let gatherPendingCandidates = function()\r\n    {\r\n        if( candidates.length > 0 )\r\n        {\r\n            candidates.forEach(candidate => connection.addIceCandidate(candidate));\r\n            candidates = [];\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set the remote session description.\r\n     */\r\n    let setRemoteDescription = function( description )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection.setRemoteDescription(description);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * [NYI] Set the stream's bandwidth.\r\n     * References:\r\n     * https://webrtchacks.com/limit-webrtc-bandwidth-sdp/\r\n     * https://stackoverflow.com/questions/57653899/how-to-increase-the-bitrate-of-webrtc\r\n     */\r\n    let setBandwidth = function( bandwidth )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let senders = connection.getSenders();\r\n        if( !senders )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            let parameters = sender.getParameters();\r\n            if( !parameters.encodings )\r\n            {\r\n                parameters.encodings = [{ }];\r\n            }\r\n\r\n            parameters.encodings[0].maxBitrate = bandwidth * 1000;\r\n\r\n            sender.setParameters(parameters);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Get the remote audio track specified by index.\r\n     */\r\n    let getRemoteAudioTrack = function ( index = 0 )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track.kind === \"audio\" )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < tracks.length )\r\n        {\r\n            return tracks[index];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Get the remote video track specified by index.\r\n     */\r\n    let getRemoteVideoTrack = function ( index = 0 )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track.kind === \"video\" )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < tracks.length )\r\n        {\r\n            return tracks[index];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Get the remote stream of the peer connection composed by all the audio and video tracks.\r\n     */\r\n    let getRemoteStream = function()\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( tracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let stream = new MediaStream();\r\n        for( let i = 0; i < tracks.length; i++ )\r\n        {\r\n            let track = tracks[i];\r\n            stream.addTrack(track);\r\n        }\r\n\r\n        return stream;\r\n    };\r\n\r\n    /**\r\n     * Replace the local audio track specified by index.\r\n     */\r\n    let replaceLocalAudioTrack = function( track, index = 0 )\r\n    {\r\n        if( !connection || !track )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let audioSenders = [];\r\n        let senders = connection.getSenders();\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            if( sender.track && sender.track.kind === \"audio\" )\r\n            {\r\n                audioSenders.push(sender);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < audioSenders.length )\r\n        {\r\n            audioSenders[index].replaceTrack(track);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Replace the local video track specified by index.\r\n     */\r\n    let replaceLocalVideoTrack = function( track, index = 0 )\r\n    {\r\n        if( !connection || !track )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let videoSenders = [];\r\n        let senders = connection.getSenders();\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            if( sender.track && sender.track.kind === \"video\" )\r\n            {\r\n                videoSenders.push(sender);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < videoSenders.length )\r\n        {\r\n            videoSenders[index].replaceTrack(track);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n//#endregion\r\n\r\n//#region DataChannel\r\n    /**\r\n     * Open a data channel.\r\n     */\r\n    let openChannel = function( label )\r\n    {\r\n        if( !connection || label in channels )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = connection.createDataChannel(label);\r\n        channels[label] = channel;\r\n\r\n        // Handle the close event.\r\n        channel.addEventListener(\"onclose\", function( event )\r\n        {\r\n            delete channels[channel.label];\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Close a data channel.\r\n     */\r\n    let closeChannel = function( label )\r\n    {\r\n        if( !connection || !(label in channels) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.close();\r\n        delete channels[label];\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback for the data channel event.\r\n     */\r\n    let onDataChannel = function( callback )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection.addEventListener(\"datachannel\", callback);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel open event.\r\n     */\r\n    let onChannelOpen = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onopen = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel close event.\r\n     */\r\n    let onChannelClose = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.addEventListener(\"onclose\", callback);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel error event.\r\n     */\r\n    let onChannelError = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onerror = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel message event.\r\n     */\r\n    let onChannelMessage = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onmessage = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Send data through an opened channel.\r\n     */\r\n    let sendData = function( label, data )\r\n    {\r\n        if( !connection || !(label in channels) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        if( channel.readyState !== \"open\" )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        channel.send(data);\r\n\r\n        return true;\r\n    };\r\n//#endregion\r\n\r\n    return {\r\n        get callId() { return callId; },\r\n        get callerId() { return callerId; },\r\n        get calleeId() { return calleeId; },\r\n        bind,\r\n        close,\r\n        isInitiator,\r\n        getState,\r\n        getStats,\r\n        addCandidate,\r\n        gatherPendingCandidates,\r\n        setRemoteDescription,\r\n        setBandwidth,\r\n        getRemoteAudioTrack,\r\n        getRemoteVideoTrack,\r\n        getRemoteStream,\r\n        replaceLocalAudioTrack,\r\n        replaceLocalVideoTrack,\r\n        openChannel,\r\n        closeChannel,\r\n        onDataChannel,\r\n        onChannelOpen,\r\n        onChannelClose,\r\n        onChannelError,\r\n        onChannelMessage,\r\n        sendData\r\n    };\r\n}","\"use strict\";\r\n\r\nexport const LobbyEvent =\r\n{\r\n\tClientConnected:        \"client_connected\",\r\n\tClientDisconnected:     \"client_disconnected\",\r\n    Error:                  \"error\",\r\n    UserOnline:             \"user_online\",\r\n    UserOffline:            \"user_offline\",\r\n    RoomCreated:            \"room_created\",\r\n    RoomDeleted:            \"room_deleted\",\r\n    GuestJoinedRoom:        \"guest_joined_room\",\r\n    GuestLeftRoom:          \"guest_left_room\",\r\n    UserRejoined:           \"user_rejoined\"\r\n};\r\n\r\nexport function LobbyClient( settings )\r\n{\r\n    let defaultSettings =\r\n    {\r\n        debug: false,\r\n        debugStyle: \"background: hsla(0, 0%, 13%, 1); color: hsla(180, 89%, 45%, 1)\",\r\n        pingPeriod: 5 * 1000\r\n    };\r\n\r\n    settings = (typeof settings !== \"object\") ? { } : settings;\r\n    settings = Object.assign({ }, defaultSettings, settings);\r\n\r\n    let console = (settings.debug) ? window.console : null;\r\n\r\n    let responses = { };\r\n    let events = { };\r\n\r\n    let token = null;\r\n    let socket = null;\r\n    let keepAliveTimeout = null;\r\n\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n \r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n \r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Connect to the server.\r\n     */\r\n    let connect = function( url, accessToken )\r\n    {\r\n        token = accessToken;\r\n        socket = new WebSocket(url + \"?token=\" + token);\r\n\r\n        socket.onopen = onOpen;\r\n        socket.onmessage = onMessage;\r\n        socket.onclose = onClose;\r\n    };\r\n\r\n    /**\r\n     * Disconnect from the server.\r\n     */\r\n    let disconnect = function()\r\n    {\r\n        socket?.close();\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is opened.\r\n     */\r\n    let onOpen = function( event )\r\n    {\r\n        console?.log(\"%c\" + \"connected\" + \"%o\", settings.debugStyle, socket.url);\r\n\r\n        startKeepAlive();\r\n\r\n        emit(LobbyEvent.ClientConnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is closed.\r\n     */\r\n    let onClose = function( event )\r\n    {\r\n        console?.log(\"%c\" + \"disconnected\" + \"%o\", settings.debugStyle, socket.url);\r\n\r\n        stopKeepAlive();\r\n\r\n        emit(LobbyEvent.ClientDisconnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when a message is received from the server.\r\n     */\r\n    let onMessage = function( msg )\r\n    {\r\n        let message = JSON.parse(msg.data);\r\n        if( message.event === \"pong\" )\r\n        {\r\n            return;\r\n        }\r\n\r\n        console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.event, message.data);\r\n\r\n        // Check whether the message has a response listener.\r\n        if( message.data.uuid in responses )\r\n        {\r\n            let response = responses[message.data.uuid];\r\n            delete responses[message.data.uuid];\r\n            delete message.data.uuid;\r\n            response(message);\r\n            return;\r\n        }\r\n\r\n        // Check whether the message has an event.\r\n        emit(message.event, message);\r\n    };\r\n\r\n    /**\r\n     * Send a message to the server.\r\n     */\r\n    let sendMessage = function( message, response )\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Set the token.\r\n        message.data.token = token;\r\n\r\n        // Generate a UUID.\r\n        message.data.uuid = uuid();\r\n\r\n        // Add the response listener.\r\n        if( response instanceof Function )\r\n        {\r\n            responses[message.data.uuid] = response;\r\n        }\r\n\r\n        // Send the message.\r\n        let msg = JSON.stringify(message);\r\n        socket.send(msg);\r\n        if( message.event !== \"ping\" )\r\n        {\r\n            console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.event, msg);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start a keep alive timeout.\r\n     */\r\n    let startKeepAlive = function()\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return;\r\n        }\r\n\r\n        ping();\r\n\r\n        keepAliveTimeout = window.setTimeout(startKeepAlive, settings.pingPeriod);\r\n    };\r\n\r\n    /**\r\n     * Stop the keep alive timeout.\r\n     */\r\n    let stopKeepAlive = function()\r\n    {\r\n        window.clearTimeout(keepAliveTimeout);\r\n    };\r\n\r\n    /**\r\n     * Send a ping to the server.\r\n     */\r\n    let ping = function()\r\n    {\r\n        let message =\r\n        {\r\n            event: \"ping\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Get the user's room.\r\n     */\r\n    let getRoom = function( response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"get_room\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Get the lobby rooms.\r\n     */\r\n    let getRooms = function( response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"get_rooms\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Create a room.\r\n     */\r\n    let createRoom = function( name, password, hidden, icon, response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"create_room\",\r\n            data:\r\n            {\r\n                name: name,\r\n                password: password,\r\n                hidden: hidden,\r\n                icon: icon\r\n            }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Join a room.\r\n     */\r\n    let joinRoom = function( name, password, response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"join_room\",\r\n            data:\r\n            {\r\n                name: name,\r\n                password: password\r\n            }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Leave a room.\r\n     */\r\n    let leaveRoom = function( response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"leave_room\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier.\r\n     * Reference: RFC 4122 https://www.ietf.org/rfc/rfc4122.txt\r\n     */\r\n    let uuid = function()\r\n    {\r\n        return uuidv4();\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier v4.\r\n     * Reference: https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\r\n     */\r\n    let uuidv4 = function()\r\n    {\r\n        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\r\n          (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\r\n        );\r\n    };\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        connect,\r\n        disconnect,\r\n        getRoom,\r\n        getRooms,\r\n        createRoom,\r\n        joinRoom,\r\n        leaveRoom\r\n    };\r\n}","\"use strict\";\r\n\r\nexport const MediaEvent =\r\n{\r\n\tGotDevices:         \"got_devices\",\r\n\tErrorDevices:       \"error_devices\",\r\n    GotResolutions:     \"got_resolutions\",\r\n    GotStream:          \"got_stream\",\r\n    ErrorStream:        \"error_stream\"\r\n};\r\n\r\nexport function MediaAdapter()\r\n{\r\n    let events = { };\r\n\r\n    let audioStream = null;\r\n    let videoStream = null;\r\n    let mediaStream = null;\r\n\r\n    let audioDevices = { }; // audioDevices[label] = deviceId\r\n    let videoDevices = { }; // videoDevices[label] = deviceId\r\n\r\n    let resolutions =\r\n    {\r\n        \"Undefined\":    { },\r\n        \"320x240\":      { width: 320,\theight: 240 },\t// QVGA 4:3\r\n        \"640x360\":      { width: 640,\theight: 360 },\t// nHD 16:9\r\n        \"640x480\":      { width: 640,\theight: 480 },\t// VGA 4:3\r\n        \"1280x720\":     { width: 1280,\theight: 720 },\t// HD 16:9\r\n        \"1920x1080\":    { width: 1920,\theight: 1080 },\t// FullHD 16:9\r\n        \"3840x2160\":    { width: 3840,\theight: 2160 },\t// 4k 16:9\r\n        //\"7680x4320\":    { width: 7680,\theight: 4320 }\t// 8k 16:9\r\n    };\r\n\r\n    let audioConstraints =\r\n    {\r\n        audio:\r\n        {\r\n            deviceId: { exact: undefined }\r\n        }\r\n    };\r\n\r\n    let videoConstraints =\r\n    {\r\n        video:\r\n        {\r\n            deviceId: { exact: undefined },\r\n            width: { exact: undefined },\r\n            height: { exact: undefined },\r\n            frameRate: { ideal: 60 }\r\n        }\r\n    };\r\n\r\n    let settings =\r\n    {\r\n        audio: \"None\", // label\r\n        video: \"None\", // label\r\n        resolution: \"Undefined\", // resolutions key\r\n    };\r\n\r\n    let previousAudioConstraints = null;\r\n    let previousVideoConstraints = null;\r\n\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start the media adapter.\r\n     */\r\n    let start = async function()\r\n    {\r\n        if( !navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Create a dummy stream.\r\n        audioStream = new SilenceStream();\r\n        videoStream = new BlackStream();\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        await window.navigator.mediaDevices.getUserMedia({ audio: true });\r\n        await window.navigator.mediaDevices.getUserMedia({ video: true });\r\n        await findDevices();\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Find the available input and output devices.\r\n     */\r\n    let findDevices = async function()\r\n    {\r\n        return getDevices().then(gotDevices).catch(errorDevices);\r\n    };\r\n\r\n    /**\r\n     * Request a list of the available input and output devices.\r\n     */\r\n    let getDevices = function()\r\n    {\r\n        return window.navigator.mediaDevices.enumerateDevices();\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get devices function.\r\n     */\r\n    let gotDevices = function( deviceInfos )\r\n    {\r\n        audioDevices = { };\r\n        videoDevices = { };\r\n\r\n        // Add inputs for silence and black streams.\r\n        audioDevices[\"None\"] = \"\";\r\n        videoDevices[\"None\"] = \"\";\r\n\r\n        let a = 0, v = 0;\r\n        for( let deviceInfo of deviceInfos )\r\n        {\r\n            if( deviceInfo.kind === \"audioinput\" )\r\n            {\r\n                let label = (deviceInfo.label === \"\" ) ? (\"Audio input \" + a) : deviceInfo.label;\r\n                audioDevices[label] = deviceInfo.deviceId;\r\n                a++;\r\n            }\r\n\r\n            if( deviceInfo.kind === \"videoinput\" )\r\n            {\r\n                let label = (deviceInfo.label === \"\" ) ? (\"Video input \" + v) : deviceInfo.label;\r\n                videoDevices[label] = deviceInfo.deviceId;\r\n                v++;\r\n            }\r\n        }\r\n\r\n        emit(MediaEvent.GotDevices, { audioDevices: audioDevices, videoDevices: videoDevices, settings: settings });\r\n        emit(MediaEvent.GotResolutions, { resolutions: resolutions, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get devices function.\r\n     */\r\n    let errorDevices = function( error )\r\n    {\r\n        let message = \"Device request not allowed in the browser\";\r\n        emit(MediaEvent.ErrorDevices, { error: error, message: message });\r\n    };\r\n\r\n    /**\r\n     * Set the audio device.\r\n     */\r\n    let setAudio = function( device )\r\n    {\r\n        if( !device )\r\n        {\r\n            device = \"None\";\r\n        }\r\n\r\n        if( !(device in audioDevices) )\r\n        {\r\n            let error = \"DeviceNotFound\";\r\n            let message = \"Audio device \" + device + \" not found\";\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            device = \"None\";\r\n        }\r\n\r\n        if( device === \"None\" )\r\n        {\r\n            // Update settings.\r\n            settings.audio = device;\r\n\r\n            // Get dummy stream.\r\n            audioStream = new SilenceStream();\r\n            mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n            emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n        }\r\n        else\r\n        {\r\n            // Save previous constraints.\r\n            previousAudioConstraints = clone(audioConstraints);\r\n\r\n            // Update constraints.\r\n            let deviceId = audioDevices[device];\r\n            audioConstraints.audio.deviceId.exact = deviceId;\r\n\r\n            getAudioStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set the video device and resolution.\r\n     */\r\n    let setVideo = function( device, resolution = \"Undefined\" )\r\n    {\r\n        if( !device )\r\n        {\r\n            device = \"None\";\r\n            resolution = \"Undefined\";\r\n        }\r\n\r\n        if( !resolution )\r\n        {\r\n            resolution = \"Undefined\";\r\n        }\r\n\r\n        if( !(device in videoDevices) )\r\n        {\r\n            let error = \"DeviceNotFound\";\r\n            let message = \"Video device \" + device + \" not found\";\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            device = \"None\";\r\n        }\r\n\r\n        if( !(resolution in resolutions) )\r\n        {\r\n            let error = \"ResolutionNotFound\";\r\n            let message = \"Resolution \" + resolution + \" not found\";\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            resolution = \"Undefined\";\r\n        }\r\n\r\n        if( device === \"None\" )\r\n        {\r\n            // Update settings.\r\n            settings.video = device;\r\n            settings.resolution = resolution;\r\n\r\n            // Get dummy stream.\r\n            let width = resolutions[resolution].width;\r\n            let height = resolutions[resolution].height;\r\n            videoStream = new BlackStream(width, height);\r\n            mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n            emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n        }\r\n        else\r\n        {\r\n            // Save previous constraints.\r\n            previousVideoConstraints = clone(videoConstraints);\r\n\r\n            // Update constraints.\r\n            let deviceId = videoDevices[device];\r\n            videoConstraints.video.deviceId.exact = deviceId;\r\n            let width = resolutions[resolution].width;\r\n            let height = resolutions[resolution].height;\r\n            videoConstraints.video.width.exact = width;\r\n            videoConstraints.video.height.exact = height;\r\n\r\n            getVideoStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Request an audio stream.\r\n     */\r\n    let getAudioStream = function()\r\n    {\r\n        mediaStream = null;\r\n        stopStream(audioStream);\r\n        return window.navigator.mediaDevices.getUserMedia(audioConstraints).then(gotAudioStream).catch(errorAudioStream);\r\n    };\r\n\r\n    /**\r\n     * Request a video stream.\r\n     */\r\n    let getVideoStream = function()\r\n    {\r\n        mediaStream = null;\r\n        stopStream(videoStream);\r\n        return window.navigator.mediaDevices.getUserMedia(videoConstraints).then(gotVideoStream).catch(errorVideoStream);\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get audio stream function.\r\n     */\r\n    let gotAudioStream = async function( stream )\r\n    {\r\n        let audioTrack = stream.getAudioTracks()[0];\r\n\r\n        // Check whether the label is listed, enumerateDevices returns an empty label if the permission for accessing the mediadevice is not given.\r\n        if( !(audioTrack.label in audioDevices) )\r\n        {\r\n            await findDevices();\r\n        }\r\n\r\n        // Update settings.\r\n        settings.audio = audioTrack.label;\r\n\r\n        audioStream = stream;\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get video stream function.\r\n     */\r\n    let gotVideoStream = async function( stream )\r\n    {\r\n        // Video track.\r\n        let videoTrack = stream.getVideoTracks()[0];\r\n        let videoTrackSettings = videoTrack.getSettings();\r\n\r\n        // Check whether the label is listed, enumerateDevices returns an empty label if the permission for accessing the mediadevice is not given.\r\n        if( !(videoTrack.label in videoDevices) )\r\n        {\r\n            await findDevices();\r\n        }\r\n\r\n        // Check whether the resolution is already listed.\r\n        let width = videoTrackSettings.width;\r\n        let height = videoTrackSettings.height;\r\n        let resolution = width + \"x\" + height;\r\n        if( !resolutions[resolution] )\r\n        {\r\n            // Add the resolution.\r\n            resolutions[resolution] = { width: width, height: height };\r\n\r\n            // Sort resolutions.\r\n            resolutions = Object.entries(resolutions).sort((a, b) => (a[1].width || Number.NEGATIVE_INFINITY) > (b[1].width || Number.NEGATIVE_INFINITY)).reduce((r, [k, v]) => ({ ...r, [k]: v }), {});\r\n\r\n            emit(MediaEvent.GotResolutions, { resolutions: resolutions, settings: settings });\r\n        }\r\n\r\n        // Update video constraints.\r\n        videoConstraints.video.width.exact = width;\r\n        videoConstraints.video.height.exact = height;\r\n\r\n        // Update settings.\r\n        settings.video = videoTrack.label;\r\n        settings.resolution = resolution;\r\n\r\n        videoStream = stream;\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Return a semantic error string from the specified error.\r\n     */\r\n    let errorStream = function( error )\r\n    {\r\n        let message = \"\";\r\n        if( error.name === \"NotFoundError\" || error.name === \"DevicesNotFoundError\" )\r\n        {\r\n            message = \"Required track is missing\";\r\n        }\r\n        else if( error.name === \"NotReadableError\" || error.name === \"TrackStartError\" )\r\n        {\r\n            message = \"Microphone or Webcam are already in use\";\r\n        }\r\n        else if( error.name === \"OverconstrainedError\" || error.name === \"ConstraintNotSatisfiedError\" )\r\n        {\r\n            //message = \"Constraints cannot be satisfied\";\r\n            message = \"Invalid device settings\";\r\n        }\r\n        else if( error.name === \"NotAllowedError\" || error.name === \"PermissionDeniedError\" )\r\n        {\r\n            message = \"Permission denied in browser\";\r\n        }\r\n        else if( error.name === \"TypeError\" || error.name === \"TypeError\" )\r\n        {\r\n            message = \"Empty constraints object\";\r\n        }\r\n        else\r\n        {\r\n            message = \"Unknown error\";\r\n        }\r\n\r\n        return message;\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get audio stream function.\r\n     */\r\n    let errorAudioStream = function( error )\r\n    {\r\n        let message = errorStream(error);\r\n        emit(MediaEvent.ErrorStream, { error: error.name, message: message, settings: settings });\r\n\r\n        if( previousAudioConstraints )\r\n        {\r\n            audioConstraints = clone(previousAudioConstraints);\r\n            previousAudioConstraints = null;\r\n            getAudioStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get video stream function.\r\n     */\r\n    let errorVideoStream = function( error )\r\n    {\r\n        let message = errorStream(error);\r\n        emit(MediaEvent.ErrorStream, { error: error.name, message: message, settings: settings });\r\n\r\n        if( previousVideoConstraints )\r\n        {\r\n            videoConstraints = clone(previousVideoConstraints);\r\n            previousVideoConstraints = null;\r\n            getVideoStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Mix two streams with 1 audio and 1 video tracks into one.\r\n     */\r\n    let mixStreams = function( audioStream, videoStream )\r\n    {\r\n        let audioTracks = audioStream.getAudioTracks();\r\n        if( !audioTracks || audioTracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let videoTracks = videoStream.getVideoTracks();\r\n        if( !videoTracks || videoTracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let stream = new MediaStream();\r\n        stream.addTrack(audioTracks[0]);\r\n        stream.addTrack(videoTracks[0]);\r\n\r\n        return stream;\r\n    };\r\n\r\n    /**\r\n     * Stop a stream, stopping its tracks.\r\n     */\r\n    let stopStream = function( stream )\r\n    {\r\n        stream.getTracks().forEach(track => track.stop());\r\n    };\r\n\r\n    /**\r\n     * Return a clone of the object.\r\n     */\r\n    let clone = function( object )\r\n    {\r\n        return JSON.parse(JSON.stringify(object));\r\n    };\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        start,\r\n        findDevices,\r\n        getDevices,\r\n        setAudio,\r\n        setVideo\r\n    };\r\n}\r\n\r\nexport function SilenceTrack()\r\n{\r\n    let stream = new SilenceStream();\r\n    let track = stream.getAudioTracks()[0];\r\n    return track;\r\n}\r\n\r\nexport function BlackTrack( width = 320, height = 240 )\r\n{\r\n    let stream = new BlackStream(width, height);\r\n    let track = stream.getVideoTracks()[0];\r\n    return track;\r\n}\r\n\r\nexport function SilenceStream()\r\n{\r\n    let audioContext = new AudioContext();\r\n\r\n    let gainNode = audioContext.createGain();\r\n    let oscillatorNode = audioContext.createOscillator();\r\n    oscillatorNode.connect(gainNode);\r\n    let destination = gainNode.connect(audioContext.createMediaStreamDestination());\r\n\r\n    gainNode.gain.setValueAtTime(0, audioContext.currentTime);\r\n    oscillatorNode.start();\r\n\r\n    let stream = destination.stream;\r\n    return stream;\r\n}\r\n\r\nexport function BlackStream( width = 320, height = 240 )\r\n{\r\n    let canvas = window.document.createElement(\"canvas\");\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    let context = canvas.getContext(\"2d\");\r\n    let interval = null;\r\n    function render()\r\n    {\r\n        if( !context )\r\n        {\r\n            window.clearInterval(interval);\r\n            return;\r\n        }\r\n\r\n        context.fillRect(0, 0, width, height);\r\n        // context.beginPath();\r\n        // context.rect(0, 0, width, height);\r\n        // context.fillStyle = \"blue\";\r\n        // context.fill();\r\n    }\r\n    interval = window.setInterval(render, 1000);\r\n\r\n    let stream = canvas.captureStream();\r\n    return stream;\r\n}\r\n\r\nexport function DummyStream()\r\n{\r\n    let silenceStream = new SilenceStream();\r\n    let blackStream = new BlackStream();\r\n    let silenceTrack = silenceStream.getAudioTracks()[0];\r\n    let blackTrack = blackStream.getVideoTracks()[0];\r\n    let stream = new MediaStream([silenceTrack, blackTrack]);\r\n\r\n    /**\r\n     * Return the audio track.\r\n     */\r\n    let getAudioTrack = function()\r\n    {\r\n        return silenceTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the video track.\r\n     */\r\n    let getVideoTrack = function()\r\n    {\r\n        return blackTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the stream.\r\n     */\r\n    let getStream = function()\r\n    {\r\n        return stream;\r\n    };\r\n\r\n    return {\r\n        getAudioTrack,\r\n        getVideoTrack,\r\n        getStream\r\n    };\r\n}","// eslint-disable\r\n\r\n//import AdapterJS from 'adapterjs';\r\nimport { RTCEvent, RTCClient }    from \"./rtcClient.js\";      // eslint-disable-line\r\nimport { LobbyEvent, LobbyClient }  from './lobbyClient.js';      // eslint-disable-line\r\nimport { MediaAdapter } from \"./mediaAdapter.js\";   // eslint-disable-line\r\nimport { DummyStream }  from \"./dummyStream.js\";\r\n\r\nconst DEBUG = process.env.REACT_APP_DEBUG ?? false;\r\n\r\nlet appClient    = window.appClient    = new LobbyClient({ debug: false }),\r\n    mediaAdapter = window.mediaAdapter = new MediaAdapter({ debug: DEBUG }),\r\n    dummyStream  = window.dummyStream  = new DummyStream({ debug: DEBUG }),\r\n    rtcClient    = window.rtcClient    = new RTCClient({ debug: DEBUG, defaultStream: dummyStream.getStream() });\r\n\r\nlet APPEvent = LobbyEvent;\r\n\r\nexport {\r\n   APPEvent,\r\n   RTCEvent,\r\n   rtcClient, \r\n   appClient,\r\n   mediaAdapter,\r\n   dummyStream\r\n}","export function DummyStream()\r\n{\r\n//#region PRIVATE\r\n\r\n    let _blackCanvas = null;\r\n    let _silenceStream = null;\r\n    let _blackStream = null;\r\n    let _silenceTrack = null\r\n    let _blackTrack = null;\r\n\r\n    /**\r\n     * Create a silence audio track.\r\n     */\r\n    let createSilenceTrack = function()\r\n    {\r\n        let audioContext = new AudioContext();\r\n\r\n        let gainNode = audioContext.createGain();\r\n        let oscillatorNode = audioContext.createOscillator();\r\n        oscillatorNode.connect(gainNode);\r\n        let destination = gainNode.connect(audioContext.createMediaStreamDestination());\r\n\r\n        _silenceStream = destination.stream;\r\n        _silenceTrack = _silenceStream.getAudioTracks()[0];\r\n    };\r\n\r\n    /**\r\n     * Create a black video track.\r\n     * @param {Number} width - The video width.\r\n     * @param {Number} height - The video height.\r\n     */\r\n    let createBlackTrack = function( width = 320, height = 240 )\r\n    {\r\n        if( !_blackCanvas )\r\n        {\r\n            _blackCanvas = window.document.createElement(\"canvas\");\r\n        }\r\n\r\n        _blackCanvas.width = width;\r\n        _blackCanvas.height = height;\r\n        let context = _blackCanvas.getContext(\"2d\");\r\n        context.fillRect(0, 0, width, height);\r\n\r\n        _blackStream = _blackCanvas.captureStream();\r\n        _blackTrack = _blackStream.getVideoTracks()[0];\r\n    };\r\n\r\n    createSilenceTrack();\r\n    createBlackTrack();\r\n    let _stream = new MediaStream([_silenceTrack, _blackTrack]);\r\n\r\n    /**\r\n     * Return the audio track.\r\n     * @returns {MediaStreamTrack} The audio track.\r\n     */\r\n    let getAudioTrack = function()\r\n    {\r\n        return _silenceTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the video track.\r\n     * @returns {MediaStreamTrack} The video track.\r\n     */\r\n    let getVideoTrack = function()\r\n    {\r\n        return _blackTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the stream.\r\n     * @returns {MediaStream} The stream.\r\n     */\r\n    let getStream = function()\r\n    {\r\n        return _stream;\r\n    };\r\n\r\n//#endregion\r\n\r\n//#region PUBLIC\r\n\r\n    return {\r\n        getAudioTrack,\r\n        getVideoTrack,\r\n        getStream\r\n    };\r\n\r\n//#endregion\r\n}","import * as BRA from \"lib_bra\"\r\nimport toast from 'react-hot-toast'\r\nimport { useState, useContext, useEffect, createContext } from 'react'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport const StreamContext = createContext(); \r\nexport default ({children, ...props}) => {\r\n    const auth  = useContext(AuthContext);\r\n    const rooms = useContext(RoomsContext);\r\n    const media = useContext(MediaContext);\r\n\r\n    const [streams, setStreams]         = useState({});\r\n    const [liveCalls, setLiveCalls]     = useState({});\r\n    const [localStream, setLocalStream] = useState(media.localStream);\r\n\r\n    useEffect( ()=>{ \r\n        BRA.rtcClient.on(BRA.RTCEvent.IncomingCall, onIncomingCall);\r\n        BRA.rtcClient.on(BRA.RTCEvent.CallOpened,   onCallOpened);\r\n        BRA.rtcClient.on(BRA.RTCEvent.CallClosed,   onCallClosed);\r\n        BRA.rtcClient.on(BRA.RTCEvent.UserHangup,   onUserHangup);\r\n    return ()=>{\r\n        BRA.rtcClient.off(BRA.RTCEvent.IncomingCall, onIncomingCall);\r\n        BRA.rtcClient.off(BRA.RTCEvent.CallOpened,   onCallOpened);\r\n        BRA.rtcClient.off(BRA.RTCEvent.CallClosed,   onCallClosed);\r\n        BRA.rtcClient.off(BRA.RTCEvent.UserHangup,   onUserHangup);\r\n    }}, []);\r\n\r\n    useEffect( ()=>{\r\n        for( const callId in BRA.rtcClient.getCalls() )\r\n        {\r\n            let call = BRA.rtcClient.getCall(callId);\r\n            let stream = media.localStream;\r\n            {\r\n                let track = stream.getVideoTracks()[0];\r\n                call.replaceLocalVideoTrack(track);\r\n            }\r\n            {\r\n                let track = stream.getAudioTracks()[0];\r\n                call.replaceLocalAudioTrack(track);\r\n            }\r\n        }\r\n        setLocalStream(media.localStream);\r\n    }, [media.localStream]);\r\n\r\n    function callUser(username, callback){\r\n        return BRA.rtcClient.call(username, callback ?? (({callId, status, description}) => {\r\n            if(status === 'error'){\r\n                toast.error(`Call error: ${description}`,{icon:<i className=\"bi bi-telephone-x\"/>, duration: 5000});\r\n            }\r\n        }));\r\n    }\r\n\r\n    function callAllUsers(){\r\n        const users = rooms.current?.users?.filter((v, k, a) => { return v && v?.username !== auth.user?.username });\r\n        for (let user of users ?? []){\r\n            if(!callUser(user?.username)){\r\n                toast.error(`Call missed to ${user?.username}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    function callHangup(callId){\r\n        BRA.rtcClient.hangup(callId);\r\n    }\r\n\r\n    function callHangupAll(){\r\n        const calls = Object.keys(BRA.rtcClient.getCalls())\r\n        for (let callId of calls){\r\n            callHangup(callId);\r\n        }\r\n    }\r\n\r\n    function onIncomingCall({ callId, callerId }){\r\n        BRA.rtcClient.acceptCall(callId);\r\n    }\r\n\r\n    function onCallOpened({ call, stream }) {\r\n        const callId = call.callId;\r\n        \r\n        setStreams({...streams, [callId]: stream});\r\n        const forwardingCallId = liveCalls[callId];   //Live call\r\n\r\n        if (forwardingCallId) {\r\n            const forward_stream = streams[forwardingCallId];\r\n            if (!forward_stream) {\r\n                callHangup(callId);\r\n                return toast.error(`Live Call Error: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);;\r\n            }\r\n            toast.success(`Live Call: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);\r\n            const videotrack = forward_stream.getVideoTracks()[0];\r\n            const audiotrack = forward_stream.getAudioTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n            toast(`Forwarding stream`, {icon:<i className=\"bi bi-cast\"/>});\r\n        }\r\n\r\n        //Regular call\r\n        else {\r\n            toast.success(`Incoming Call: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);\r\n            const videotrack = media.localStream.getVideoTracks()[0];\r\n            const audiotrack = media.localStream.getAudioTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n            toast(`Call from ${getUserId(callId)}`, {icon:<i className=\"bi bi-telephone-inbound\"/>});\r\n        }\r\n    }\r\n\r\n    function onCallClosed({ call }){\r\n        if (!call)\r\n            return console.error(\"No call\");\r\n\r\n        const callId = call.callId;\r\n        manageLiveCallClosed(callId);\r\n\r\n        delete streams[callId];\r\n        setStreams({...streams});\r\n        toast(`Call from ${getUserId(callId)} closed`, {icon:<i className=\"bi bi-telephone-x\"/>});\r\n    }\r\n\r\n    function onUserHangup({ callId }){\r\n        if (!callId)\r\n            return console.error(\"No call\");\r\n\r\n        manageLiveCallClosed(callId);\r\n        delete streams[callId];\r\n        setStreams({...streams});\r\n\r\n        toast(`User ${getUserId(callId)} hangup`, {icon:<i className=\"bi bi-telephone-x\"/>});\r\n    }\r\n\r\n    function manageLiveCallClosed(callId) {\r\n        let result = null;\r\n        for (const [mId, fId] of Object.entries(liveCalls)) {\r\n            if (callId !== mId && fId !== callId)\r\n                continue;\r\n\r\n            result = [mId, fId];\r\n            break;\r\n        }\r\n\r\n        if (result) {\r\n            const [mediaHubCallId, forwardedCallId] = result;\r\n            delete liveCalls[mediaHubCallId];\r\n            setLiveCalls(liveCalls);\r\n        }\r\n    }\r\n\r\n    function getUserId(callId){\r\n        let id = auth.user?.username;\r\n        let call = BRA.rtcClient.getCalls()[callId];\r\n        if (callId !== \"local\" && call) {\r\n            let { calleeId, callerId } = call;\r\n            id = (calleeId === auth.user?.username) ? callerId : calleeId;\r\n        }\r\n        return id;\r\n    }\r\n\r\n    //TODO:check this\r\n    function forwardCall(source, target) {\r\n        if (!target || !source)\r\n            return console.error(`source or target callId's are undefined`);\r\n        liveCalls[target] = source;\r\n        setLiveCalls({...liveCalls});\r\n    }\r\n\r\n    function getLiveCall(callId)\r\n    {\r\n        return Object.entries(liveCalls).find( v => v[1] === callId ) ?? [null,null];\r\n    }\r\n\r\n    function replaceStream(stream){\r\n        for( const callId in BRA.rtcClient.getCalls() )\r\n        {\r\n            let call = BRA.rtcClient.getCall(callId);\r\n            {\r\n                let track = stream.getVideoTracks()[0];\r\n                call.replaceLocalVideoTrack(track);\r\n            }\r\n            {\r\n                let track = stream.getAudioTracks()[0];\r\n                call.replaceLocalAudioTrack(track);\r\n            }\r\n        }\r\n    }\r\n\r\n    const store = window.wrtc = {\r\n        callUser,\r\n        callAllUsers,\r\n        callHangup,\r\n        callHangupAll,\r\n        forwardCall,\r\n        getUserId,\r\n        getLiveCall,\r\n        replaceStream,\r\n        streams: {...streams, local:localStream},\r\n    }\r\n\r\n    return <StreamContext.Provider value={store} children={children}/>\r\n}"],"sourceRoot":""}