{"version":3,"sources":["serviceWorkerRegistration.js","assets/img/face-mask.png","assets/img/torso-mask.png","assets/img/body-mask.png","partials/video.jsx","partials/layout.jsx","views/verified.jsx","views/resetpassword.jsx","components/modal_about.jsx","components/modal_profile.jsx","components/btn_fullscreen.jsx","partials/title.jsx","partials/modal.jsx","partials/nav.jsx","components/badge_forward.jsx","components/modal_composite.jsx","views/room.jsx","components/modal_recovery.jsx","components/modal_register.jsx","views/login.jsx","assets/img/TeenyiconsPasswordOutline.svg","components/modal_room_password.jsx","views/lobby.jsx","views/wizard.jsx","components/modal_nav_profile.jsx","components/modal_create_room.jsx","components/modal_leave_room.jsx","components/modal_wizard.jsx","components/modal_users.jsx","components/modal_chat.jsx","components/btngrp_stream.jsx","views/App.jsx","assets/img/UilUser.svg","utils/ctx_rooms.jsx","utils/ctx_authentication.jsx","utils/md.jsx","pages lazy /^/.*/.jsx$/ groupOptions: {} namespace object","reportWebVitals.js","index.js","utils/http.js","utils/ctx_mediadevices.jsx","../lib/bra/rtcClient.js","../lib/bra/lobbyClient.js","../lib/bra/mediaAdapter.js","../lib/bra/index.js","../lib/bra/dummyStream.js","utils/ctx_streaming.jsx","assets/img/profile_light.png","assets/img/logo.png"],"names":["isLocalhost","Boolean","window","location","hostname","match","register","config","navigator","URL","process","href","origin","addEventListener","swUrl","fetch","headers","then","response","contentType","get","status","indexOf","serviceWorker","ready","registration","unregister","reload","registerValidSW","catch","console","log","checkValidServiceWorker","setInterval","update","debug","onupdatefound","installingWorker","installing","onstatechange","state","controller","toast","info","toastId","onClick","close","autoClose","onUpdate","onSuccess","error","id","stream","isLocal","props","ref","useRef","useState","audio","setStatus","setMask","media","useContext","MediaContext","handleMediaClick","undefined","settings","mask","useEffect","current","srcObject","className","Button","variant","disabled","Image","src","value","face_mask","torso_mask","body_mask","handleMask","width","height","autoPlay","playsInline","muted","message","options","trace","success","loading","custom","children","position","reverseOrder","toastOptions","duration","style","background","color","basename","property","content","REACT_APP_OG_TYPE","envREACT_APP_OG_IMAGE","component","App","exact","path","Verified","ResetPass","to","history","useHistory","onHide","push","size","show","title","closeButton","backdrop","buttons","token","useParams","formRef","validated","setValidated","formErrors","formvalues","setFormValues","handleSubmit","e","a","preventDefault","password","http","post","data","setTimeout","err","isValid","key","validateForm","setShow","placement","overlay","type","onSubmit","controlId","label","Control","required","name","placeholder","onChange","check","test","warn","v","validateField","target","defaultValue","useReducer","o","n","proposalEvent","dispatch","onBeforeInstallPrompt","removeEventListener","logo","auth","AuthContext","rooms","RoomsContext","isLogged","logout","xs","user","avatar","length","profile_img","roundedCircle","username","Group","email","surname","birthdate","screenfull","isEnabled","toggle","document","inFullscreen","fsButton","getElementById","callback","Hide","centered","keyboard","dialogClassName","Header","Title","Body","Footer","map","k","Nav","zIndex","Item","icon","appendclass","defaultMediaHubTarget","button","callId","isForwardCall","wrtc","StreamContext","fetching","setFetching","getLiveCall","mediaHubCallId","submit","forwardingCallId","mediaHubtarget","callUser","event","callid","callee","caller","forwardCall","Spinner","as","animation","role","Badge","padding","pill","bg","callHangup","onKeyDown","keyCode","FloatingLabel","Form","lutResponse","videoARef","videoBRef","A","setA","B","setB","refreshStreams","streams","snapshot","video","canvas","createElement","videoWidth","videoHeight","getContext","drawImage","toDataURL","submitButton","str","body","studio","actor","constructor","String","JSON","stringify","Blob","filename","file","lut","url","createObjectURL","element","setAttribute","display","appendChild","click","removeChild","revokeObjectURL","s","tabIndex","_title","Row","Col","md","marginBottom","Select","Object","keys","Room","roomId","carouselRef","selected","setSelected","useLayoutEffect","imInRoom","callAllUsers","callHangupAll","replaceStream","localStream","carousel","videoItem","querySelectorAll","scrollLeft","Math","max","clientWidth","master","min","scrollWidth","entries","local","getUserId","imMaster","isMediahubCall","isSelected","toLowerCase","OverlayTrigger","Tooltip","isConnected","handleUserInput","values","testImage","timeoutT","Promise","resolve","reject","timer","timeout","img","onerror","onabort","clearTimeout","onload","Gravatar","r","d","gravatar","confirm","checked","hasError","Card","password2","htmlFor","cookies","remember","login","app_token","set","Img","Text","Switch","defaultChecked","Array","from","elements","finally","RoomTile","hidden","hasPassword","users","secured","enterRoom","joinRoom","margin","lock","filter","onKeyPress","list","sm","span","offset","lg","xl","pages","page","setPage","views","setViews","onKeyPressed","vs","p","default","onSwipeLeft","onSwipeRight","roomname","createRoom","room","step","leaveRoom","kickUser","alt","inputRef","scrollDown","chat","div","querySelector","scrollTop","scrollHeight","messages","noValidate","sendMessage","InputGroup","i","opacity","Date","timestamp","getHours","getMinutes","text","canvasRef","isAudioEnabled","setAudioEnabled","audiotracks","getAudioTracks","every","enabled","ctx","globalAlpha","requestAnimationFrame","draw","clearRect","x0","y0","x1","y1","r1","gradient","createRadialGradient","addColorStop","fillStyle","fillRect","cancelAnimationFrame","marginTop","track","serviceWorkerRegistration","view","pathname","container","Container","fluid","createContext","avatars","setRooms","setReady","setCurrent","setState","setMessages","onUserKicked","BRA","getRoom","onGetRoom","getRooms","onGetRooms","isUserInRoom","roomName","onRoomCreated","onRoomDeleted","onGuestLeft","u","toISOString","onGuestJoin","getUserAvatar","avatar_img","rs","onUserRejoined","onMessage","sendText","on","GuestLeftRoom","GuestJoinedRoom","RoomCreated","RoomDeleted","UserRejoined","UserKicked","ChatText","m1","m2","off","localStorage","setItem","store","m","getItem","parse","Provider","setUser","setToken","setLogged","app","rtc","setConnected","toast_app","toast_rtc","toast_usr","retries","setRetries","onError","disconnect","getUserInfo","Authorization","promises","description","all","some","onUnload","onAppConnect","onRtcConnect","onAppDisconnect","onRtcDisconnect","ClientConnected","ClientDisconnected","Error","connect","Infinity","t","setTimer","interval_id","clearInterval","flat","msg","dismiss","updateUserInfo","replaceAll","remarkPlugins","remarkGfm","remarkBreaks","rehypePlugins","rehypeRaw","webpackAsyncContext","req","__webpack_require__","code","ids","slice","module","exports","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","Suspense","fallback","ProgressBar","animated","now","assign","method","json","init_evts","videoRef","devices","setDevices","setSettings","resolutions","setResolutions","newvalue","getStream","setLocalStream","getDevices","onGotResolutions","onGotDevices","audioDevices","videoDevices","onGotStream","GotStream","GotDevices","ErrorStream","ErrorDevices","GotResolutions","start","onStream","setVideo","setAudio","init","stop","device","resolution","this","DEBUG_STYLE","RTCEvent","IncomingCall","CallAccepted","CallCanceled","CallOpened","CallClosed","CallHangup","RTCCall","iceServers","connection","candidates","channels","initiator","getStats","callStats","stats","pairStats","forEach","report","localCandidateId","localType","candidateType","localAddress","address","ip","localPort","port","localProtocol","protocol","remoteCandidateId","remoteType","remoteAddress","remotePort","remoteProtocol","bind","peerConnection","isInitiator","RTCPeerConnection","channel","getState","iceConnectionState","addCandidate","candidate","addIceCandidate","gatherPendingCandidates","setRemoteDescription","setBandwidth","bandwidth","senders","getSenders","sender","parameters","getParameters","encodings","maxBitrate","setParameters","getRemoteAudioTrack","index","receivers","getReceivers","tracks","receiver","kind","getRemoteVideoTrack","getRemoteStream","MediaStream","addTrack","replaceLocalAudioTrack","audioSenders","replaceTrack","replaceLocalVideoTrack","videoSenders","openChannel","createDataChannel","closeChannel","onDataChannel","onChannelOpen","onopen","onChannelClose","onChannelError","onChannelMessage","onmessage","sendData","readyState","send","LobbyEvent","UserOnline","UserOffline","MediaEvent","SilenceStream","audioContext","AudioContext","gainNode","createGain","oscillatorNode","createOscillator","destination","createMediaStreamDestination","gain","setValueAtTime","currentTime","BlackStream","frameRate","context","interval","captureStream","DEBUG","appClient","responses","events","socket","keepAliveTimeout","emit","args","call","arguments","listeners","apply","onOpen","startKeepAlive","onClose","stopKeepAlive","uuid","WebSocket","OPEN","ping","uuidv4","replace","c","crypto","getRandomValues","Uint8Array","toString","listener","splice","accessToken","onclose","mediaAdapter","audioStream","videoStream","mediaStream","audioConstraints","deviceId","videoConstraints","ideal","previousAudioConstraints","previousVideoConstraints","mediaDevices","enumerateDevices","mixStreams","getUserMedia","findDevices","gotDevices","errorDevices","deviceInfos","deviceInfo","getAudioStream","stopStream","gotAudioStream","errorAudioStream","getVideoStream","gotVideoStream","errorVideoStream","find","getVideoTracks","trackSettings","getSettings","sort","b","Number","NEGATIVE_INFINITY","reduce","aspectRatio","facingMode","errorStream","clone","audioTracks","videoTracks","getTracks","object","dummyStream","_blackCanvas","_silenceStream","_blackStream","_silenceTrack","_blackTrack","createSilenceTrack","createBlackTrack","_stream","getAudioTrack","getVideoTrack","rtcClient","defaultStream","calls","handleCallResponse","handleIncomingCall","handleCallAccepted","handleCallCanceled","handleRemoteOffer","handleRemoteAnswer","handleRemoteCandidate","handleCallHangup","closeCall","hangup","rtcConfiguration","oniceconnectionstatechange","other","handleIceConnectionStateChange","onicecandidate","onnegotiationneeded","createOffer","sdp","setLocalDescription","offer","createAnswer","answer","getCall","getCalls","acceptCall","cancelCall","APPEvent","liveCalls","setStreams","fwdCallId","callID","fwd_call","onIncomingCall","onCallOpened","request","forward_stream","videotrack","audiotrack","onCallClosed","manageLiveCallClosed","onCallHangup","result","mId","fId","source"],"mappings":"gHAAA,mDAeMA,EAAcC,QACW,cAA7BC,OAAOC,SAASC,UAEe,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASC,MAAM,2DAG5B,SAASC,EAASC,GACvB,GAA6C,kBAAmBC,UAAW,CAGzE,GADkB,IAAIC,IAAIC,cAAwBR,OAAOC,SAASQ,MACpDC,SAAWV,OAAOC,SAASS,OAIvC,OAGFV,OAAOW,iBAAiB,QAAQ,WAC9B,IAAMC,EAAK,UAAMJ,cAAN,sBAEPV,IA6EV,SAAiCc,EAAOP,GAEtCQ,MAAMD,EAAO,CACXE,QAAS,CAAE,iBAAkB,YAE5BC,MAAK,SAACC,GAEL,IAAMC,EAAcD,EAASF,QAAQI,IAAI,gBAEnB,MAApBF,EAASG,QACO,MAAfF,IAA8D,IAAvCA,EAAYG,QAAQ,cAG5Cd,UAAUe,cAAcC,MAAMP,MAAK,SAACQ,GAClCA,EAAaC,aAAaT,MAAK,WAC7Bf,OAAOC,SAASwB,eAKpBC,EAAgBd,EAAOP,MAG1BsB,OAAM,WACLC,QAAQC,IAAI,oEAnGVC,CAAwBlB,EAAOP,GAI/BC,UAAUe,cAAcC,MAAMP,MAAK,WACjCa,QAAQC,IACN,+GAMJH,EAAgBd,EAAOP,OAM/B,SAASqB,EAAgBd,EAAOP,GAC9BC,UAAUe,cACPjB,SAASQ,GACTG,MAAK,SAACQ,GAGHQ,aAAY,WACVR,EAAaS,SACbJ,QAAQK,MAAM,2BACZ,KAENV,EAAaW,cAAgB,WAC3B,IAAMC,EAAmBZ,EAAaa,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiBG,QACfhC,UAAUe,cAAckB,YAI1BX,QAAQC,IACN,+GAIFW,IAAMC,KAAN,6DAAyE,CACvEC,QAAS,qBACTC,QAAS,kBAAM3C,OAAO4C,SACtBC,WAAW,IAITxC,GAAUA,EAAOyC,UACnBzC,EAAOyC,SAASvB,KAMlBK,QAAQC,IAAI,sCAGRxB,GAAUA,EAAO0C,WACnB1C,EAAO0C,UAAUxB,WAO5BI,OAAM,SAACqB,GACNpB,QAAQoB,MAAM,4CAA6CA,Q,2GC9GlD,MAA0B,sCCA1B,MAA0B,uCCA1B,MAA0B,sC,6CCS1B,gBAAqD,IAAD,EAAlDC,EAAkD,EAAlDA,GAAIC,EAA8C,EAA9CA,OAAQP,EAAsC,EAAtCA,QAAsC,IAA7BQ,eAA6B,SAATC,EAAS,iBAC3DC,EAAMC,iBAAO,MAEjB,EAA8BC,mBAAS,CAACC,OAAM,IAA9C,mBAAOrC,EAAP,KAAesC,EAAf,KACA,EAA8BF,mBAAS,QAAvC,mBAAaG,GAAb,WACMC,EAAwBC,qBAAWC,KA0BzC,SAASC,SACUC,IAAZpB,EAAuBA,IACrBe,EAAQC,EAAMK,SAASC,MAQhC,OAlCAC,qBAAU,WACHhB,GAAUG,EAAIc,UACbd,EAAIc,QAAQC,UAAYlB,KAG9B,CAACA,IA6BI,qCACP,4EAAyBE,EAAMiB,iBAA/B,QAA0C,IAA1C,UACI,4GACI,4EAAkCpB,EAAlC,OACA,cAACqB,EAAA,EAAD,CAAQD,UAAU,eAAeE,QAAQ,OAAOC,SAAUrB,EAASR,QA/B3E,WACIc,EAAU,2BAAItC,GAAL,IAAaqC,OAAOrC,EAAOqC,UA8BhC,SACKL,EAAS,mEAA4BA,GAAS,OAAChC,QAAD,IAACA,KAAQqC,MAAS,GAAK,WACrE,2EAAoCL,GAAS,OAAChC,QAAD,IAACA,KAAQqC,MAAS,QAAU,iBAVlF5B,QAAQC,IAAI,YAAc8B,EAAMK,SAASC,MAClCN,EAAMK,SAASC,MAAgC,SAAxBN,EAAMK,SAASC,OAY1BtB,EAAU,cAAC8B,EAAA,EAAD,CAAOJ,UAAU,aAAa1B,QAASmB,EAAkBY,IAhC1F,SAAoBC,GAChB,OAAOA,GACH,IAAK,OACD,OAAOC,EACX,IAAK,QACD,OAAOC,EACX,IAAK,OACD,OAAOC,EACX,QACI,OAAO,MAuB4EC,CAAWpB,EAAMK,SAASC,MAAOe,MAAOrB,EAAMK,SAASgB,MAAOC,OAAQtB,EAAMK,SAASiB,SAAa,8BAC7L,uBAAOC,UAAQ,EAACC,aAAW,EAACC,MAAOjC,KAAW,OAAChC,QAAD,IAACA,KAAQqC,OAAOH,IAAKA,EAAKV,QAASmB,EAAjF,gCAVG,+gC,uPC9BX9D,OAAOwC,MAASA,IAChB,IAAMQ,EAAUR,IAAMQ,MAASR,IAAMQ,MAAU,SAACqC,EAASC,GAAsC,OAAxB1D,QAAQ2D,MAAMF,GAAmBrC,EAAMqC,EAASC,IACvH,IAAME,EAAUhD,IAAMgD,QAAShD,IAAMgD,QAAU,SAACH,EAASC,GAAsC,OAAxB1D,QAAQC,IAAIwD,GAAmBG,EAAQH,EAASC,IACvH,IAAMG,EAAUjD,IAAMiD,QAASjD,IAAMiD,QAAU,SAACJ,EAASC,GAAsC,OAAxB1D,QAAQC,IAAIwD,GAAmBI,EAAQJ,EAASC,IACvH,IAAMI,EAAUlD,IAAMkD,OAASlD,IAAMkD,OAAU,SAACL,EAASC,GAAsC,OAAxB1D,QAAQC,IAAIwD,GAAoBK,EAAOL,EAASC,IAExG,gBAA4B,EAAzBK,SAA0B,IAAbvC,EAAY,iBACzC,OAAO,8CAAKH,GAAG,UAA0BG,GAAlC,oEAA2B,IAA3B,UACL,cAAC,IAAD,CACEH,GAAG,UACH2C,SAAS,eACTC,cAAc,EACdC,aAAc,CACZC,SAAU,IACVC,MAAO,CACLC,WAAY,OACZC,MAAO,WAIb,cAAC,IAAD,CAAQC,SAAU3F,aAAlB,SACA,cAAC,IAAD,UACA,cAAC,IAAD,UACA,cAAC,IAAD,UACA,eAAC,IAAD,WAEA,eAAC,IAAD,WACE,2DAAQA,WACR,sBAAM4F,SAAS,SAASC,QAAS7F,0BAAjC,6BACA,sBAAM4F,SAAS,UAAUC,QAAS7F,qnBAAY8F,kBAA9C,6BACA,sBAAMF,SAAS,WAAWC,QAAS7F,SAAnC,6BACA,sBAAM4F,SAAS,iBAAiBC,QAAS7F,2BAAzC,6BACA,sBAAM4F,SAAS,WAAWC,QAAS7F,EAAQ+F,sBAA3C,gCAGF,cAAC,IAAD,IAEA,0GACE,cAAC,IAAD,IACA,cAAC,IAAD,IACA,cAAC,IAAD,OAGF,eAAC,IAAD,WACI,cAAC,IAAD,CAAOC,UAAWC,IAAWC,OAAK,EAACC,KAAM,CAAC,IAAK,YAAa,SAAU,SAAU,QAAS,WAAY,gBAAiB,qBAAsB,0BAC5I,cAAC,IAAD,CAAOH,UAAWI,IAAWF,OAAK,EAACC,KAAK,mBACxC,cAAC,IAAD,CAAOH,UAAWK,IAAWH,OAAK,EAACC,KAAK,2BACxC,eAAC,IAAD,eAAQ,cAAC,IAAD,CAAUG,GAAG,MAArB,qBAxCC,iQ,oDC3BT,2CAOe,eACX,IAAMC,EAAUC,cAChB,SAASC,IACLF,EAAQG,KAAK,KAEjB,OAAO,mCACH,cAAC,IAAD,CAAOC,KAAK,KAAKC,MAAM,EACnBC,MAAO,oBAAIhD,UAAU,mBAAd,wCACPiD,aAAW,EACXC,SAAS,SACTN,OAASA,EACTO,QAAS,CAAC,cAAC,IAAD,CAAQ7E,QAASsE,EAAjB,8BALd,SAOI,cAAC,IAAD,CAAI5C,UAAU,mBAAd,sG,mLCVG,eAAK,IAAD,EACToD,EAAUC,cAAVD,MACAV,EAAUC,cAEVW,EAAUrE,iBAAO,MACvB,EAAkCC,wBAASQ,GAA3C,mBAAO6D,EAAP,KAAkBC,EAAlB,KACA,EAAoCtE,mBAAS,CAACuE,WAAW,KAAzD,mBAAOC,EAAP,KAAmBC,EAAnB,KANe,SA2DAC,EA3DA,8EA2Df,WAA4BC,GAA5B,iBAAAC,EAAA,6DACID,EAAEE,iBACI1F,EAAUF,IAAMiD,QAAQ,yBACxB4C,EAAWN,EAAWM,SAHhC,SAIUC,IAAKC,KAAL,UAAa/H,2CAAb,2BAA6DiH,GAAS,CAACe,KAAK,CAACH,cAClFtH,MAAM,YAAwB,IAAtBiC,EAAqB,EAArBA,MAAOqC,EAAc,EAAdA,QACZ,GAAIrC,EACA,OAAOR,IAAMQ,MAAN,2BAAgCqC,GAAW,CAAEpC,GAAIP,IAGxDF,IAAMgD,QAAQ,UAAW,CAACvC,GAAIP,IAC9B+F,YAAY,kBAAI1B,EAAQG,KAAR,OAAmB,QAG1CvF,OAAM,SAAA+G,GACHlG,IAAMQ,MAAN,iBAAsB0F,GAAO,CAACzF,GAAIP,OAf1C,4CA3De,sBA8Ef,OAhCAwB,qBAAU,YATV,WACI,IAAIyE,GAAU,EACd,IAAK,IAAIC,KAAOb,GACmB,IAA3Ba,EAAIxH,QAAQ,YACZuH,GAAWZ,EAAWa,IAE9Bf,IAAcc,GAIdE,KACF,CAACd,IAGH7D,qBAAU,WACN2D,GAAc,KAChB,IAyBK,mCACH,cAAC,IAAD,CAAOP,aAAW,EAACF,MAAM,EACrB0B,QAAS,kBAAI/B,EAAQG,KAAR,MACbD,OAAQ,kBAAMF,EAAQG,KAAK,MAC3BG,MAAO,oBAAIhD,UAAU,mBAAd,4BACPmD,QAAS,CACL,cAAC,IAAD,CAAgBuB,UAAU,SAC1BC,QACI,cAAC,IAAD,CAAS3E,UAAS,UAAKuD,EAAU,SAAS,GAAxB,SAAoC3E,GAAE,iBAAxD,+BAFJ,SAOI,cAAC,IAAD,CAAQgG,KAAK,SAAStG,QAASsF,EAAczD,UAAWoD,EAAxD,0BAZZ,SAgBI,eAAC,IAAD,CAAMA,UAAWA,EAAWsB,SAAUjB,EAAc5E,IAAKsE,EAAzD,UACI,cAAC,IAAD,CAAItD,UAAU,mBAAd,SAAmC,oCAEnC,cAAC,IAAD,CAAe8E,UAAU,mBAAmBC,MAAM,eAAlD,SACI,cAAC,IAAKC,QAAN,CAAcC,UAAQ,EAACC,KAAK,WAAWN,KAAK,WAAWO,YAAY,IAAIC,SA3FvF,SAA0BvB,IAM1B,SAAuBqB,EAAM5E,GACzB,IAAI+E,GAAQ,EACP5B,EAAcC,EAAdD,WAEL,OAAOyB,GACH,IAAK,QAEDG,EADW,wJACAC,KAAKhF,GAChBmD,EAAWyB,GAAQG,EAAQ,GAAK,cAChC,MAEJ,IAAK,WAEDA,EADiB,uBACDC,KAAKhF,GACrBmD,EAAWyB,GAAQG,EAAQ,GAAI,gBAC/B,MAEJ,QAAS9H,QAAQgI,KAAK,uBAAwBL,GAGlDvB,GAAe,SAAA6B,GAAC,wCAAUA,GAAV,uBAAcN,EAAM5E,GAApB,wBAA+B4E,EAA/B,UAA6CG,GAA7C,2BAAoD5B,GAApD,OAvBhBgC,CAFa5B,EAAE6B,OAAOR,KACRrB,EAAE6B,OAAOpF,QAyFuFqF,aAAY,UAAEjC,EAAWM,gBAAb,QAAuB,gB,sHCvG1I,eACX,MAAwB9E,oBAAS,GAAjC,mBAAO6D,EAAP,KAAa0B,EAAb,KACA,EAA6BmB,sBAAW,SAACC,EAAEC,GAAH,OAAOA,IAAG,CAACC,mBAAgBrG,IAAnE,mBAAiBsG,GAAjB,WAQA,SAASC,EAAsBpC,GAG3BA,EAAEE,iBACFiC,GAAS,SAAA/H,GAAK,kCAASA,GAAT,IAAgB4F,SAelC,OA1BAhE,qBAAU,WAEN,OADIlE,OAAOW,iBAAiB,sBAAsB2J,EAAuB,GAClE,WACHtK,OAAOuK,oBAAoB,sBAAsBD,EAAuB,MAE9E,IAqBK,qCACH,cAAC,IAAD,CAAQ/F,QAAQ,OAAO5B,QAAU,kBAAImG,EAAQ,IAA7C,mBAEA,eAAC,IAAD,CAAOxB,aAAW,EAACH,KAAK,KAAUC,OAAM0B,UAAUzB,MAAO,iCAAO7G,SAAP,OAAzD,UACA,cAAC,IAAD,CAAO6D,UAAU,iBAAiBW,MAAO,GAAIC,OAAQ,GAAIP,IAAK8F,MAC9D,cAAC,IAAD,ka,iLC9BO,eAAO,IAAD,IACXnH,EAAMC,iBAAO,MACbmH,EAAO7G,qBAAW8G,KAClBC,EAAQ/G,qBAAWgH,KACzB,EAAwBrH,oBAAS,GAAjC,mBAAO6D,EAAP,KAAa0B,EAAb,KAcA,OAAI2B,EAAKI,UAAaF,EAAMxG,QACrB,qCACH,cAAC,IAAD,CAAQI,QAAQ,OAAO5B,QAAU,kBAAImG,EAAQ,IAA7C,qBAGA,cAAC,IAAD,CAAOxB,aAAW,EAACH,KAAK,KAAUC,OAAM0B,UACxCzB,MAAQ,qFACRG,QAAS,CACT,eAAC,IAAD,CAAQ7E,QAAS8H,EAAKK,OAAtB,UAA8B,4DAA9B,gBAHA,SAcA,eAAC,IAAD,WACA,eAAC,IAAD,CAAKC,GAAI,EAAT,UACI,cAAC,IAAD,CAAKA,GAAG,OAAO1G,UAAU,mBAAzB,SACI,cAAC,IAAD,CACIpB,GAAG,aACHyB,IAAM,UAAA+F,EAAKO,YAAL,SAAWC,OAAOC,OAAlB,UAA0BT,EAAKO,YAA/B,aAA0B,EAAWC,OAASE,IACpDC,eAAa,EAEbpG,MAAM,MAAMC,OAAO,UAG3B,cAAC,IAAD,UACA,cAAC,IAAD,CAAIZ,UAAU,mBAAd,+CACgBoG,EAAKO,KAAKK,SAD1B,8MAOJ,cAAC,IAAD,CAAKN,GAAI,EAAT,SACI,eAAC,IAAD,CAAM1H,IAAKA,EAAX,UACA,cAAC,IAAKiI,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAAC,IAAD,CAAeyD,MAAM,WAArB,kBAAqC,cAAC,IAAKC,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,WAAaC,YAAY,WAAaQ,aAAcS,EAAKO,KAAKK,SAAwCpC,KAAK,SAA5K,cACvC,cAAC,IAAKqC,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAAC,IAAD,CAAeyD,MAAM,QAArB,qBAAqC,cAAC,IAAKC,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,QAAaC,YAAY,QAAaQ,aAAcS,EAAKO,KAAKO,MAAqCtC,KAAK,UAAzK,cACvC,cAAC,IAAKqC,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAAC,IAAD,CAAeyD,MAAM,WAArB,kBAAqC,cAAC,IAAKC,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,WAAaC,YAAY,WAAaQ,aAAcS,EAAKO,KAAoC/B,KAAK,aAAnK,cACvC,cAAC,IAAKqC,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAAC,IAAD,CAAeyD,MAAM,aAArB,gBAAqC,cAAC,IAAKC,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,SAAaC,YAAY,aAAaQ,aAAcS,EAAKO,KAAKC,OAAsChC,KAAK,WAA1K,cACvC,cAAC,IAAKqC,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAAC,IAAD,CAAeyD,MAAM,OAArB,sBAAqC,cAAC,IAAKC,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,OAAaC,YAAY,OAAaQ,aAAcS,EAAKO,KAAKzB,KAAoCN,KAAK,SAAxK,cACvC,cAAC,IAAKqC,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAAC,IAAD,CAAeyD,MAAM,UAArB,mBAAqC,cAAC,IAAKC,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,UAAaC,YAAY,UAAaQ,aAAcS,EAAKO,KAAKQ,QAAuCvC,KAAK,SAA3K,cACvC,cAAC,IAAKqC,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAAC,IAAD,CAAeyD,MAAM,aAArB,gBAAqC,cAAC,IAAKC,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,YAAaC,YAAY,YAAaQ,aAAcS,EAAKO,KAAKS,UAAyCxC,KAAK,SAA7K,wBA7CxC,mFADqC,+B,iCC5BhD,4BAGe,eAaX,OAAO,qBAAKhG,GAAG,iBAAR,SACDyI,IAAWC,WACT,cAAC,IAAD,CAAQ1I,GAAG,YACXN,QAdR,WACI+I,IAAWE,SACXC,SAASC,cAAgBD,SAASC,aAElC,IAAMC,EAAWF,SAASG,eAAe,aACtCD,IACcA,EAASpG,SAAS,GAC1BtB,UAAYwH,SAASC,aAAe,wBAA0B,qBAO7CvH,QAAQ,OAD9B,SAEG,mBAAGF,UAAU,2B,6FCfb,eAAO,IAAD,EACXsG,EAAW/G,qBAAWgH,KAE5B,OAAO,qCACH,sBAAK3H,GAAG,QAAQsB,QAAQ,OAAxB,iGACI,cAAC,IAAD,CAAOF,UAAU,OAAOW,MAAO,GAAIC,OAAQ,GAAIP,IAAK8F,MACpD,oBAAIvH,GAAG,WAAP,yCAAoCzC,YAC9B,OAALmK,QAAK,IAALA,OAAA,EAAAA,EAAOxG,UAAW,2EAAwBwG,QAAxB,IAAwBA,GAAxB,UAAwBA,EAAOxG,eAA/B,aAAwB,EAAgBoF,WAJ5D,+H,6KCLI,gBAAiF,IAA/ElC,EAA8E,EAA9EA,MAAO1B,EAAuE,EAAvEA,SAAUyB,EAA6D,EAA7DA,KAAM0B,EAAuD,EAAvDA,QAAmBtB,GAAoC,EAA9CyE,SAA8C,EAApCzE,SAASF,EAA2B,EAA3BA,YAAgBlE,EAAW,iBAE3F,SAAS8I,IACLpD,GAAQ,GAGZ,OAAO,qCACH,eAAC,IAAD,yBACIqD,UAAQ,EACR/E,KAAMA,EACNgF,UAAU,EACVnF,OAAQiF,EACRG,gBAAgB,iCACZjJ,GANR,cAQMkE,GAAeD,GAAU,cAAC,IAAMiF,OAAP,CAAchF,YAAaA,EAA3B,SACvB,cAAC,IAAMiF,MAAP,CAAalI,UAAU,mBAAvB,SAA2CgD,MAG/C,cAAC,IAAMmF,KAAP,UACK7G,KAGF6B,GAAWF,IAAgB,eAAC,IAAMmF,OAAP,CAAcpI,UAAU,cAAxB,UACzBmD,GAAWA,EAAQkF,KAAK,SAAC7C,EAAE8C,EAAExE,GAAL,OAAW0B,KACnCvC,GAAe,cAAC,IAAD,CAAQ/C,QAAQ,oBAAoB5B,QAASuJ,EAA7C,2BAnBrB,s9B,wKCTX,SAASU,EAAT,GAAyB,IAAXjH,EAAU,EAAVA,SAEV,OAAO,qCAEH,qBAAgKK,MAAO,CAAE6G,OAAQ,KAAjL,kLACMlH,EAAS+G,KAAK,SAAC7C,EAAE8C,GAAH,OAAS9C,GAAK,wDAAuBA,GAAb,SAAS8C,QAHlD,uiFAgIXC,EAAIE,KAAO,SAAS,GAA0C,IAAD,EAAxCnH,EAAwC,EAAxCA,SAAgBnB,GAAwB,EAA9BuI,KAA8B,EAAxBvI,UAAUsC,EAAc,EAAdA,GAAO1D,EAAO,iBACzD,OAAO,6CAAK0D,GAAE,OAAEA,QAAF,IAAEA,IAAI,IAAKzC,UAAS,mBAAcG,EAAS,oBAAoB,GAA3C,sBAAiDpB,EAAM4J,mBAAvD,QAAoE,KAAU5J,GAAzG,aACH,qBAAKiB,UAAS,qCAAd,SAAwDsB,QAIhEiH,EAAItI,OAAS,SAAS,GAAqB,IAAD,EAAnBqB,EAAmB,EAAnBA,SAAYvC,EAAO,iBACtC,OAAO,6CAAKiB,UAAS,+BAAgBjB,EAAM4J,mBAAtB,QAAmC,KAAU5J,GAA3D,aACH,qBAAKiB,UAAU,wBAAf,SAAwCsB,QAIjCiH,Q,2GCxIXK,EAAwB,cAEb,cAA4B,IAkDnCC,EAlDSC,EAAyB,EAAzBA,OAAQC,EAAiB,EAAjBA,cACfC,EAAWzJ,qBAAW0J,KACtBjK,EAAMC,iBAAO,MACnB,EAAwBC,mBAAS,MAAjC,mBAAO6D,EAAP,KAAa0B,EAAb,KACA,EAAgCvF,mBAAS,GAAzC,mBAAOgK,EAAP,KAAiBC,EAAjB,KAGA,EAAwCH,EAAKI,YAAYN,GAAzD,mBAAKO,EAAL,UAEA,SAASC,IAEL,GAAK,OAACtK,QAAD,IAACA,MAAKc,UAAYiD,EACnB,OAAO0B,GAAQ,GAEnB0E,GAAY,GAEZ,MAA2C,CAACL,EAAQ9J,EAAIc,QAAQQ,OAAzDiJ,EAAP,KAAyBC,EAAzB,KAqBIR,EAAKS,SAASD,GAnBlB,YAAiC,EAAdE,MAAe,IAARvF,EAAO,EAAPA,KAEtByE,EAAwBY,EAExB,IAAOG,EAA0CxF,EAA1CwF,OAAwBhL,GAAkBwF,EAAlCyF,OAAkCzF,EAA1B0F,OAA0B1F,EAAlBxF,OAAOqC,EAAWmD,EAAXnD,QACnCrC,GAECwK,EAAY,GACZ/E,YAAY,WAAQ+E,EAAY,KAAQ,KACxChL,IAAMQ,MAAN,wCAA6CqC,GAAW,CAACU,SAAU,QAInEyH,EAAY,GACZ/E,YAAY,WAAQ+E,EAAY,GAAI1E,GAAQ,KAAY,KACxDuE,EAAKc,YAAYP,EAAkBI,MAICJ,KAExCJ,EAAY,GACZhL,IAAMQ,MAAN,0BACAyF,YAAY,WAAQ+E,EAAY,KAAQ,MAUhD,OAAOD,GACH,KAAK,EAAIL,EAAS,eAAC5I,EAAA,EAAD,CAAQC,QAAQ,kBAAhB,cAAmC,cAAC6J,EAAA,EAAD,CAASC,GAAG,OAAYC,UAAU,SAAcnH,KAAK,KAAUoH,KAAK,SAAc,cAAY,YAAmB,MACtK,KAAK,EAAIrB,EAAS,cAAC5I,EAAA,EAAD,CAAQC,QAAQ,kBAAhB,kBAAkD,MACpE,KAAK,EAAI2I,EAAS,cAAC5I,EAAA,EAAD,CAAQC,QAAQ,iBAAhB,mBAAmD,MACrE,QAAS2I,EAAS,cAAC5I,EAAA,EAAD,CAAQC,QAAQ,kBAAkB5B,QAASgL,EAA3C,qBAGtB,OAAO,qCACFP,EAAgB,cAACoB,EAAA,EAAD,CAAOxI,MAAO,CAACyI,QAAQ,eAAgBC,MAAI,EAACC,GAAG,SAAShM,QAAS,kBAAM0K,EAAKuB,WAAYlB,IAAxF,SAA0G,mBAAGrJ,UAAU,cACvH,cAACmK,EAAA,EAAD,CAAOxI,MAAO,CAACyI,QAAQ,eAAgBC,MAAI,EAACC,GAAG,SAAShM,QAAS,kBAAMmG,EAASqE,IAAU9I,UAAU,iBAApG,SAAqH,mBAAGA,UAAU,iBACnJ,eAAC,IAAD,CAAY+C,OAAK0B,UAAWtB,QAAS,CAAC0F,GAAU5F,aAAW,EAACD,MAAM,iBAAiBwH,UAhBvF,SAAmB3G,GACE,KAAdA,EAAE4G,SACLnB,KAcA,6DAEI,cAACoB,EAAA,EAAD,CAAe5F,UAAU,gBAAgBC,MAAM,WAAW/E,UAAU,OAApE,SACI,cAAC2K,EAAA,EAAK3F,QAAN,CAAchG,IAAKA,EAAKkG,KAAK,WAAWN,KAAK,OAAOe,aAAciD,EAAuBzD,YAAY,gC,QC9DjHyF,EAAc,KAOH,aACX,IAAMC,EAAY5L,iBAAO,MACnB6L,EAAY7L,iBAAO,MAEnBqH,GADc/G,qBAAW8G,KACX9G,qBAAWgH,MACzBjH,EAAcC,qBAAWC,KACzBwJ,EAAczJ,qBAAW0J,KAC/B,EAAwB/J,oBAAS,GAAjC,mBAAO6D,EAAP,KAAa0B,EAAb,KACA,EAAkBvF,mBAAS,SAA3B,mBAAO6L,EAAP,KAAUC,EAAV,KACA,EAAkB9L,mBAAS,SAA3B,mBAAO+L,EAAP,KAAUC,EAAV,KACA,EAAgChM,mBAAS,GAAzC,mBAAOgK,EAAP,KAAiBC,EAAjB,KAmBA,SAASgC,IACFJ,GAAKF,EAAU/K,UACd+K,EAAU/K,QAAQC,UAAYiJ,EAAKoC,QAAQL,IAC5CE,GAAKH,EAAUhL,UACdgL,EAAUhL,QAAQC,UAAYiJ,EAAKoC,QAAQH,IAcnD,SAASI,EAASC,GAEd,IAAMC,EAAU/D,SAASgE,cAAc,UAKvC,OAJAD,EAAO5K,MAAQ2K,EAAMG,WACrBF,EAAO3K,OAAS0K,EAAMI,YACLH,EAAOI,WAAW,MAC/BC,UAAUN,EAAO,EAAG,EAAGC,EAAO5K,MAAO4K,EAAO3K,QACzC2K,EAAOM,UAAU,aA1C5BhM,qBAAU,WACN,GAAIyG,EAAMrJ,OAAUqC,EAAMrC,MAC1B,OAAO,eACR,CAACqJ,EAAMrJ,MAAOqC,EAAMrC,QAEvB4C,qBAAU,WACN,GAAIkL,GAAMF,EAAU/K,QAEpB,OADA+K,EAAU/K,QAAQC,UAAYiJ,EAAKoC,QAAQL,GACpC,eACR,CAACA,EAAG/B,EAAKoC,UAEZvL,qBAAU,WACN,GAAIoL,GAAMH,EAAUhL,QAEpB,OADAgL,EAAUhL,QAAQC,UAAYiJ,EAAKoC,QAAQH,GACpC,eACR,CAACA,EAAGjC,EAAKoC,UAyEZ,IACIU,EADA3I,EAAU,GAGd,OAAO+F,GACH,KA5GU,EA4GM4C,EAAe,cAAC7L,EAAA,EAAD,CAAQC,QAAQ,kBAAhB,SAAkC,cAAC6J,EAAA,EAAD,CAASC,GAAG,OAAOC,UAAU,SAASnH,KAAK,KAAKoH,KAAK,SAAS,cAAY,WAAmB,MAC9J,KA5GU,EA4GM4B,EAAe,cAAC7L,EAAA,EAAD,CAAQC,QAAQ,kBAAhB,kBAAiD,MAChF,KA5GQ,EA4GM4L,EAAe,cAAC7L,EAAA,EAAD,CAAQC,QAAQ,iBAAhB,mBAAiD,MAC9E,QAAS4L,EAAe,cAAC7L,EAAA,EAAD,CAAQ3B,QAlDpC,WACI,GAAIyM,GAAME,EAAV,CACA,IAvBcc,EA0BVC,EAAO,CACPC,OAJiBZ,EAAUR,EAAU/K,SAKrCoM,MAJgBb,EAAUP,EAAUhL,UAOxCvC,QAAQC,IAAI,+BA/BEuO,EA+BuCC,GA9B9CG,cAAgBC,SACnBL,EAAMM,KAAKC,UAAWP,IACnB,IAAIQ,KAAK,CAACR,IAAMjJ,OA6BvBqG,EAxEU,GA0EVlF,IAAKC,KAAK,mDAAoD,CAACC,KAAM6H,IACpEtP,MAAK,SAAAC,GAEFwM,EA5EM,GA6EN/E,YAAY,WAAQ+E,EA/EjB,KA+E0C,MAC7CyB,EAAcjO,KACfW,OAAM,SAAA+G,GACL8E,EA/EI,GAgFJ5L,QAAQoB,MAAM0F,QA6BM,oBAU5B,OAPGuG,GACCzH,EAAQN,KAAM,eAAC5C,EAAA,EAAD,CAAQC,QAAQ,OAAO5B,QA7BzC,WAEF,IAAIsM,EACM,KAAM,SAEV,IAAI4B,EAAWzB,EAAI,IAAME,EAAI,OAC/BwB,EAAO,IAAIF,KAAM,CAAC3B,EAAY8B,KAAM,CAAC9H,KAAO,eAC5C+H,EAAMzQ,IAAI0Q,gBAAiBH,GAC3BI,EAAUrF,SAASgE,cAAc,KACrCqB,EAAQC,aAAa,OAAQH,GAC7BE,EAAQC,aAAa,WAAYN,GACjCK,EAAQlL,MAAMoL,QAAU,OACxBvF,SAASwE,KAAKgB,YAAYH,GAC1BA,EAAQI,QACRzF,SAASwE,KAAKkB,YAAYL,GAC1BzI,YAAY,kBAAMlI,IAAIiR,gBAAiBR,KAAQ,MAc3B,0BAA0D,mBAAG3M,UAAU,uBAIzFmD,EAAQN,KAAMiJ,GAEP,qCACH,eAAC7L,EAAA,EAAD,CAAQD,UAAU,YAAY1B,QA5ElC,WACImG,GAAQ,SAAA2I,GAAC,OAAKA,KACdhJ,WAAY+G,EAAgB,MA0E5B,UAAgD,2DAAhD,wBACA,cAAC,IAAD,CAAOhI,QAASA,EAASvE,GAAG,YAAYyO,SAAS,IAAIpK,aAAW,EAACH,KAAK,KAAUC,OAAM0B,UAAU6I,OAAQ,8EAAxG,SACI,eAACC,EAAA,EAAD,CAAK3O,GAAG,cAAR,UACI,eAAC4O,EAAA,EAAD,CAAKC,GAAI,EAAT,UACI,kEACA,uBAAO5M,UAAQ,EAACE,OAAK,EAA+C/B,IAAK6L,EAAWlJ,MAAO,CAAChB,MAAM,OAAQ+M,aAAc,OAAxH,8DAEA,cAAChD,EAAA,EAAD,CAAe1K,UAAU,OAAO8E,UAAU,iBAAiBC,MAAO,+DAAO,kEAAP,oBAAlE,SACA,cAAC4F,EAAA,EAAKgD,OAAN,CAAarN,MAAOyK,EAAG3F,SAAU,YAAiB,IAAdM,EAAa,EAAbA,OAChCsF,EAAKtF,EAAOpF,QADhB,SAGCsN,OAAOC,KAAK7E,EAAKoC,SAAS/C,KAAI,SAAC7C,EAAG8C,GAAJ,OAAU,wBAAgBhI,MAAOkF,EAAvB,mCAA2BA,GAAd8C,aAI1D,eAACkF,EAAA,EAAD,CAAKC,GAAI,EAAT,UACI,iEACA,uBAAO5M,UAAQ,EAACE,OAAK,EAA+C/B,IAAK8L,EAAWnJ,MAAO,CAAChB,MAAM,OAAQ+M,aAAc,OAAxH,8DAEA,cAAChD,EAAA,EAAD,CAAe1K,UAAU,OAAO8E,UAAU,iBAAiBC,MAAO,+DAAO,kEAAP,oBAAlE,SACA,cAAC4F,EAAA,EAAKgD,OAAN,CAAarN,MAAO2K,EAAG7F,SAAU,YAAiB,IAAdM,EAAa,EAAbA,OAChCwF,EAAKxF,EAAOpF,QADhB,SAGAsN,OAAOC,KAAK7E,EAAKoC,SAAS/C,KAAI,SAAC7C,EAAG8C,GAAJ,OAAU,wBAAgBhI,MAAOkF,EAAvB,mCAA2BA,GAAd8C,kBAxB9D,mZCxHI,SAASwF,EAAT,GAA2B,oBAAC,IAAD,IAC/BC,EAAa1K,cAAb0K,OACDC,EAAc/O,mBACdmH,EAAc7G,qBAAW8G,KACzBC,EAAc/G,qBAAWgH,KACzBjH,EAAcC,qBAAWC,KACzBwJ,EAAczJ,qBAAW0J,KAC/B,EAAgC/J,mBAAS,MAAzC,mBAAO+O,EAAP,KAAiBC,EAAjB,KA2BA,OAzBAC,2BAAgB,WACZ,GAAI7H,EAAM8H,SAASL,IAAYzH,EAAMrJ,OAAUqC,EAAMrC,MAIzD,OADI+L,EAAKqF,eACF,WACHrF,EAAKsF,mBACN,CAAChI,EAAMrJ,MAAOqC,EAAMrC,QAEvB4C,qBAAW,WACPmJ,EAAKuF,cAAcjP,EAAMkP,eAC3B,CAAClP,EAAMkP,cAcF,sBAAK5P,GAAG,OAA0C+C,MAAO,CAAC6G,OAAO,KAAjE,2DACH,eAAC+E,EAAA,EAAD,CAAM3O,GAAG,cAAcoB,UAAU,MAAM2B,MAAO,CAAEf,OAAO,QAAvD,UACI,eAAC4M,EAAA,EAAD,CAAK9G,GAAG,OAAO9H,GAAG,eAAeI,IAAKgP,EAAtC,UACI,cAAC/N,EAAA,EAAD,CAAQ3B,QAfpB,WACI,IAAImQ,EAAWjH,SAASG,eAAe,YACjC+G,EAAYlH,SAASmH,iBAAiB,sBAAsB,GAClEF,EAASG,WAAaC,KAAKC,IAAKL,EAASG,WAAaF,EAAUK,YAAc,EAAG,IAY1C/O,UAAU,2BAA2BE,QAAQ,gBAA5E,SAA4F,uEAC3FkG,EAAKO,KAAKK,YAAV,UAAuBV,EAAMxG,eAA7B,aAAuB,EAAekP,OAAOhI,WAAY,cAAC,EAAD,IAC1D,cAAC/G,EAAA,EAAD,CAAQ3B,QAXpB,WACI,IAAImQ,EAAWjH,SAASG,eAAe,YACjC+G,EAAYlH,SAASmH,iBAAiB,sBAAsB,GAClEF,EAASG,WAAaC,KAAKI,IAAKR,EAASG,WAAaF,EAAUK,YAAc,EAAGN,EAASS,cAQlDlP,UAAU,yBAAyBE,QAAQ,gBAA3E,SAA2F,wEAC3F,qBAAKtB,GAAG,WAAR,sDACGgP,OAAOuB,QAAPvB,OAAA,IAAAA,CAAA,CAAgBwB,MAAM9P,EAAMkP,aAAgBxF,EAAKoC,UAAU/C,KAAI,WAAmBC,GAAK,IAAD,qBAArBQ,EAAqB,KAAbjK,EAAa,KAEjFD,EAAKoK,EAAKqG,UAAUvG,GACpBwG,EAAWlJ,EAAKO,KAAKK,YAAV,UAAuBV,EAAMxG,eAA7B,aAAuB,EAAekP,OAAOhI,UAC5D,EAAwCgC,EAAKI,YAAYN,GAAzD,mBAAKO,EAAL,KACIN,IADJ,KAEIwG,EAAiBlG,IAAmBP,EACpC0G,EAAavB,IAAanF,IAAYmF,GAAkB,IAAN3F,EAEtD,OAAO,4EACH,yEACMgH,GAAY,cAAC,EAAD,CAAkBxG,OAAQA,EAAQC,cAAeA,IAC7DyG,GAAc,cAACrF,EAAA,EAAD,CAAOE,MAAI,EAACC,GAAG,UAAf,SAAyB,sEAE3CiF,GAAkB,cAAC,IAAD,CAAOzQ,QAASF,IAAOwH,EAAKO,KAAKK,SAAuBpI,GAAIA,EAAIC,OAAQA,EAAQmB,UAAYwP,EAA4B,GAAjB,iBAAqBlR,QAAS,WAAK4P,EAAYpF,KAAtGA,KALvDR,WAUzB,cAACkF,EAAA,EAAD,CAAK5O,GAAG,WAAR,SACI,cAAC,IAAD,CAAOE,QAASkK,EAAKqG,UAAUpB,KAAc7H,EAAKO,KAAKK,SAAUhH,UAAU,aAAapB,GAAIoK,EAAKqG,UAAUpB,GAAWpP,OAAM,UAAEmK,EAAKoC,QAAQ6C,UAAf,QAA0B3O,EAAMkP,mBA3BjK,goD,uECxCI,aAAO,IAAD,EACXlL,EAAUrE,iBAAO,MACvB,EAAwBC,oBAAS,GAAjC,mBAAO6D,EAAP,KAAa0B,EAAb,KACM2B,EAAO7G,qBAAW8G,KAExB,EAAoCnH,mBAAS,CAACuE,WAAW,KAAzD,mBAAOC,EAAP,KAAmBC,EAAnB,KACA,EAAkCzE,wBAASQ,GAA3C,mBAAO6D,EAAP,KAAkBC,EAAlB,KANiB,SAsDFI,EAtDE,8EAsDjB,WAA4BC,GAA5B,iBAAAC,EAAA,6DACID,EAAEE,iBACImD,EAAQxD,EAAWwD,MAAMuI,cACzBpR,EAAUF,IAAMiD,QAAQ,yBAHlC,SAIU6C,IAAKC,KAAL,UAAa/H,2CAAb,oBAA8D,CAAEgI,KAAM,CAAC+C,WAC5ExK,MAAK,YAAuB,IAArBiC,EAAoB,EAApBA,MAAOqC,EAAa,EAAbA,QACX,GAAIrC,EACA,OAAOR,IAAMQ,MAAN,4BAAiCqC,GAAW,CAAEpC,GAAIP,IAE7DoG,GAAQ,GACRtG,IAAMgD,QAAQ,UAAW,CAAEvC,GAAIP,OAElCf,OAAM,SAAA+G,GACHlG,IAAMQ,MAAN,4BAAiC0F,GAAO,CAAEzF,GAAIP,OAbtD,4CAtDiB,sBAsCjBwB,qBAAU,YACN,WACI,IAAIyE,GAAU,EACd,IAAK,IAAIC,KAAOb,GACmB,IAA3Ba,EAAIxH,QAAQ,YACZuH,GAAWZ,EAAWa,IAE9Bf,IAAcc,GAElBE,KACF,CAACd,IAEH7D,qBAAU,WACN2D,GAAc,KAChB,IAwBF,IALkB7E,EAKZkK,EAAU,cAAC6G,EAAA,EAAD,CAAgBhL,UAAU,SAC1CC,QACI,cAACgL,EAAA,EAAD,CAAS3P,UAAS,UAAKuD,EAAU,SAAS,IAAO3E,GAAE,iBAAnD,SACKgP,OAAOuB,QAAQzL,EAAWD,YAAY4E,KAAI,YAAmB,IAAD,mBAAhB9D,EAAgB,KAAXjE,EAAW,KAAE,OAAO,iCAAOiE,EAAP,KAAcjE,UAH5E,SAOZ,sBAAMqB,MAAO,CAACyI,QAAQ,UAAtB,SACI,cAACnK,EAAA,EAAD,CAAQ2E,KAAK,SAAStG,QAASsF,EAAczD,UAAWoD,GAAa6C,EAAKwJ,YAA1E,6CAIR,OAAO,qCACH,eAAC3P,EAAA,EAAD,CAAQ6C,KAAK,KAAK9C,UAAU,qBAAqBE,QAAQ,OAAO5B,QAAU,kBAAImG,EAAQ,IAAtF,UAA2F,2DAA3F,uBACA,eAAC,IAAD,CAAO3B,KAAK,KAAKG,aAAW,EAAMF,OAAM0B,UACxCtB,QAAS,CAAC0F,GACV7F,MAAO,6FAFP,UAII,cAAC,IAAD,CAAIhD,UAAU,mBAAd,2HACA,cAAC2K,EAAA,EAAD,CAAMpH,UAAWA,EAAWsB,SAAUjB,EAAc5E,IAAKsE,EAAzD,SACI,cAACoH,EAAA,EAAD,CAAe5F,UAAU,gBAAgBC,MAAM,gBAAgB/E,UAAU,OAAzE,SACI,cAAC2K,EAAA,EAAK3F,QAAN,CAAcC,UAAQ,EAACjF,WA1BrBrB,EA0ByC,UAAC+E,EAAWD,kBAAZ,aAAC,EAAuByD,MAzB3EvI,EACoB,IAAjBA,EAAMkI,OAAe,GAAK,YADf,IAyBqE3B,KAAK,QAAQN,KAAK,QAAQO,YAAY,IAAIC,SAzFrI,SAA0BvB,IAM1B,SAAuBqB,EAAM5E,GACzB,IAAI+E,GAAQ,EACP5B,EAAcC,EAAdD,WAEL,OAAOyB,GACH,IAAK,QAEDG,EADW,wJACAC,KAAKhF,GAChBmD,EAAWyB,GAAQG,EAAQ,GAAK,cAChC,MAEJ,IAAK,WACDA,EAAQ/E,EAAMuG,QAAU,EACxBpD,EAAWyB,GAAQG,EAAQ,GAAI,gBAC/B,MAEJ,QAAS9H,QAAQgI,KAAK,uBAAwBL,GAGlDvB,GAAe,SAAA6B,GAAC,wCAAUA,GAAV,uBAAcN,EAAM5E,GAApB,wBAA+B4E,EAA/B,UAA6CG,GAA7C,2BAAoD5B,GAApD,OAtBhBgC,CAFa5B,EAAE6B,OAAOR,KACRrB,EAAE6B,OAAOpF,iBA8EpB,mF,mCCrFI,aAAO,IAAD,oBACXgD,EAAUrE,iBAAO,MACvB,EAAwBC,oBAAS,GAAjC,mBAAO6D,EAAP,KAAa0B,EAAb,KAEA,EAAsCvF,oBAAS,GAA/C,mBAAOgK,EAAP,KAAiBC,EAAjB,KACA,EAAsCjK,wBAASQ,GAA/C,mBAAO6D,EAAP,KAAkBC,EAAlB,KACA,EAAsCtE,mBAAS,CAACuE,WAAW,KAA3D,mBAAOC,EAAP,KAAmBC,EAAnB,KAEA,SAASkM,EAAiBhM,GACtB,IAAMqB,EAAQrB,EAAE6B,OAAOR,KACjBN,EAAQf,EAAE6B,OAAOd,MAK3B,SAAuBM,EAAM5E,GAAqB,IAAD,IAAbsE,EAAa,uDAAN,MACnCS,GAAQ,EACP5B,EAAcC,EAAdD,WACDqM,EAAM,eAAOpM,GAEjB,SAASqM,EAAUpD,EAAKqD,GACpB,OAAO,IAAIC,SAAQ,SAAUC,EAASC,GAClC,IACIC,EADAC,EAAUL,GAAY,IACfM,EAAM,IAAIlQ,MACrBkQ,EAAIC,QAAUD,EAAIE,QAAU,WACxBC,aAAaL,GACbD,EAAO,4CAEXG,EAAII,OAAS,WACTD,aAAaL,GACbF,EAAQ,YAEZE,EAAQhM,YAAW,WAGfkM,EAAIjQ,IAAM,kBACV8P,EAAO,aACRE,GACHC,EAAIjQ,IAAMsM,KAIlB,OAAO/H,GACH,IAAK,QAKD,GAHAS,EADiB,wJACAC,KAAKhF,GACtBmD,EAAWyB,GAAQG,EAAQ,GAAK,cAChCyK,EAAM,2BAAQA,GAAR,uBAAiB5K,EAAM5E,GAAvB,wBAAkC4E,EAAlC,UAAgDG,GAAhD,2BAAuD5B,GAAvD,IACH4B,EAAM,CACL,IAAMsH,EAAM,SAASgE,IAAShE,IAAIrM,EAAO,CAAE8M,EAAG,MAAOwD,EAAG,KAAMC,EAAG,QACjEd,EAAUpD,EAAK,KACdjQ,MAAM,SAAC8I,GAAO,IAAD,EACV7B,EAAc,2BAAMmM,GAAP,OAAegB,SAASnE,GAAxB,+BAAiDtH,GAAjD,2BAAwD5B,GAAxD,QAEhBnG,OAAM,SAAC+G,GAAS,IAAD,EACZV,EAAc,2BAAMmM,GAAP,OAAegB,SAAS,MAAxB,+BAAkDzL,GAAlD,2BAAyD5B,GAAzD,YAEhB,CAAC,IAAD,EACDqM,EAAM,2BAAQA,GAAR,OAAgBgB,SAAS,MAAzB,+BAAmDzL,GAAnD,2BAA0D5B,GAA1D,IAGV,MAEJ,IAAK,WAED4B,EADiB,uBACDC,KAAKhF,GACrBmD,EAAWyB,GAAQG,EAAQ,GAAI,gBAE/B,IAAI0L,EAAUrN,EAAU,WAAiBA,EAAU,UACnDD,EAAU,2BAAOA,GAAP,IAAmBsN,QAAQ,GAAD,OAAMA,EAAiD,GAAzC,4CAClDjB,EAAM,2BAAOA,GAAP,IAAeiB,UAAStN,eAC9B,MAEJ,QACI4B,GAAQ,EACR5B,EAAWyB,GAAQ,GAG3BvB,EAAc,2BAAMmM,GAAP,uBAAgB5K,EAAM5E,GAAtB,wBAAiC4E,EAAjC,UAA+CG,GAA/C,2BAAsD5B,GAAtD,KAlEbgC,CAAcP,EADO,aAAPN,EAAkBf,EAAE6B,OAAOsL,QAAQnN,EAAE6B,OAAOpF,MAC/BsE,GAZd,SAiGFhB,EAjGE,8EAiGjB,WAA4BC,GAA5B,+BAAAC,EAAA,6DACID,EAAEE,iBACGiD,EAA+EtD,EAA/EsD,SAAUE,EAAqExD,EAArEwD,MAAOlD,EAA8DN,EAA9DM,SAAU4C,EAAoDlD,EAApDkD,OAAoDlD,EAA5CoN,SAAU5L,EAAkCxB,EAAlCwB,KAAMiC,EAA4BzD,EAA5ByD,QAASC,EAAmB1D,EAAnB0D,UAAW8C,EAAQxG,EAARwG,KAEtE7L,EAAUF,IAAMiD,QAAQ,kBAJlC,SAMU6C,IAAKC,KAAL,UAAa/H,2CAAb,aAAuD,CAACgI,KAAK,CAAE6C,WAAUE,QAAOlD,WAAU4C,SAAQ1B,OAAMiC,UAASC,YAAW8C,UACjIxN,MAAK,YAAiC,IAA9BiC,EAA6B,EAA7BA,MAAOqC,EAAsB,EAAtBA,QAAsB,EAAblE,OACrB,GAAG6B,EACC,OAAOR,IAAMQ,MAAN,sBAA2BqC,GAAW,CAAEpC,GAAIP,IAEvDF,IAAMgD,QAAQ,UAAW,CAAEvC,GAAIP,IAC/B+F,YAAY,WAAQ+E,EAAY,GAAI1E,GAAQ,KAAY,QAE3DnH,OAAM,SAAA+G,GACHlG,IAAMQ,MAAN,iBAAsB0F,GAAO,CAAEzF,GAAIP,OAf3C,4CAjGiB,sBAoHjB,SAAS4S,EAAStS,GACd,OAAY,OAALA,QAAK,IAALA,KAAOkI,OAAS,GAAK,YApChChH,qBAAU,YACN,WACI,IAAIyE,GAAU,EACd,IAAK,IAAIC,KAAOb,GACmB,IAA3Ba,EAAIxH,QAAQ,YACZuH,GAAWZ,EAAWa,IAE9Bf,IAAcc,GAElBE,KACF,CAACd,IAEH7D,qBAAU,WACN2D,GAAc,KAChB,IAyBF,IAAIqF,EAAS,cAAC5I,EAAA,EAAD,CAAQ3B,QAASsF,EAAcgB,KAAK,SAASzE,UAAWoD,EAAWrD,QAASqD,EAAU,kBAAkB,oBAAxG,qBACb,OAAO2F,GACH,KAAK,EAAGL,EAAS,eAAC5I,EAAA,EAAD,CAAQC,QAAQ,kBAAhB,cAAmC,cAAC6J,EAAA,EAAD,CAASC,GAAG,OAAYC,UAAU,SAAcnH,KAAK,KAAUoH,KAAK,SAAc,cAAY,YAAmB,MACrK,KAAK,EAAGrB,EAAS,cAAC5I,EAAA,EAAD,CAAQC,QAAQ,kBAAhB,kBAAkD,MACnE,KAAK,EAAG2I,EAAS,cAAC5I,EAAA,EAAD,CAAQC,QAAQ,iBAAhB,mBAIrB,OAAO,qCACH,cAACgR,EAAA,EAAK9I,OAAN,CAAapI,UAAU,+BAA+B1B,QAAU,kBAAImG,EAAQ,IAA5E,uBACA,cAACkG,EAAA,EAAD,CAAMpH,UAAWA,EAAWsB,SAAUjB,EAAc5E,IAAKsE,EAAzD,SACA,eAAC,IAAD,CAAOtD,UAAU,OAAOiD,aAAW,EAAMF,OAAM0B,UAC/CzB,MAAO,4FACPE,SAAS,SACTC,QAAS,CACL,cAACuM,EAAA,EAAD,CAAgBhL,UAAU,MAC1BC,QACI,cAACgL,EAAA,EAAD,CAAS3P,UAAS,UAAKuD,EAAU,SAAS,IAAO3E,GAAE,cAAnD,SACKgP,OAAOuB,QAAQzL,EAAWD,YAAY4E,KAAI,WAAeC,GAAO,IAAD,mBAAnB/D,EAAmB,KAAdjE,EAAc,KAAE,OAAOA,EAAMuG,OAAO,yDAAYtC,EAAZ,KAAmBjE,IAAXgI,GAAsB,QAH5H,SAMA,yDACKO,OAXT,UAgBI,cAAC8B,EAAA,EAAK1D,MAAN,CAAYjH,UAAY,OAAOsB,SAAY,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,WAArB,kBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAcE,KAAK,WAAiBlF,UAAYiR,EAAQ,UAACvN,EAAWD,kBAAZ,aAAC,EAAuBuD,UAAY7B,YAAY,WAAaC,SAAUyK,EAAiBjL,KAAK,OAAYe,aAAcjC,EAAU,WAA9N,cAC3C,cAACiH,EAAA,EAAK1D,MAAN,CAAYjH,UAAY,OAAOsB,SAAY,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,QAArB,qBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAcE,KAAK,QAAiBlF,UAAYiR,EAAQ,UAACvN,EAAWD,kBAAZ,aAAC,EAAuByD,OAAY/B,YAAY,QAAaC,SAAUyK,EAAiBjL,KAAK,QAAYe,aAAcjC,EAAU,QAA9N,cAC3C,cAACiH,EAAA,EAAK1D,MAAN,CAAYjH,UAAY,OAAOsB,SAAY,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,WAArB,kBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAcE,KAAK,WAAiBlF,UAAYiR,EAAQ,UAACvN,EAAWD,kBAAZ,aAAC,EAAuBO,UAAYmB,YAAY,WAAaC,SAAUyK,EAAiBjL,KAAK,WAAYe,aAAcjC,EAAU,WAA9N,cAC3C,cAACiH,EAAA,EAAK1D,MAAN,CAAYjH,UAAY,OAAOsB,SAAY,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,mBAArB,cAAyC,cAAC4F,EAAA,EAAK3F,QAAN,CAAcE,KAAK,YAAalF,UAAYiR,EAAQ,UAACvN,EAAWD,kBAAZ,aAAC,EAAuB0N,WAAYhM,YAAY,YAAaC,SAAUyK,EAAiBjL,KAAK,WAAYe,aAAcjC,EAAU,YAA9N,cAC3C,cAACiH,EAAA,EAAK1D,MAAN,CAAYjH,UAAY,OAAOsB,SAAY,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,aAArB,gBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAcE,KAAK,SAAiBlF,UAAYiR,EAAQ,UAACvN,EAAWD,kBAAZ,aAAC,EAAuBmD,QAAYzB,YAAY,aAAaC,SAAUyK,EAAiBjL,KAAK,SAAYe,aAAcjC,EAAW,gBACtQ,cAAC,IAAD,CACI9E,GAAG,aACHyB,IAAG,oBAAEqD,EAAWkD,cAAb,QAAuBlD,EAAWoN,gBAAlC,QAA8ChK,IACjDC,eAAa,EACb/G,UAAU,mBACVW,MAAM,KAAKC,OAAO,YAE1B,cAAC+J,EAAA,EAAK1D,MAAN,CAAYjH,UAAY,OAAOsB,SAAY,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,OAArB,sBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAcE,KAAK,OAAalF,UAAYiR,EAAQ,UAACvN,EAAWD,kBAAZ,aAAC,EAAuByB,MAAYC,YAAY,OAAaC,SAAUyK,EAAiBjL,KAAK,OAAYe,aAAcjC,EAAU,OAA1N,cAC3C,cAACiH,EAAA,EAAK1D,MAAN,CAAYjH,UAAY,OAAOsB,SAAY,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,UAArB,mBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAcE,KAAK,UAAalF,UAAYiR,EAAQ,UAACvN,EAAWD,kBAAZ,aAAC,EAAuB0D,SAAYhC,YAAY,UAAaC,SAAUyK,EAAiBjL,KAAK,OAAYe,aAAcjC,EAAU,UAA1N,cAC3C,cAACiH,EAAA,EAAK1D,MAAN,CAAYjH,UAAY,OAAOsB,SAAY,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,aAArB,gBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAcE,KAAK,YAAalF,UAAYiR,EAAQ,UAACvN,EAAWD,kBAAZ,aAAC,EAAuB2D,WAAYjC,YAAY,YAAaC,SAAUyK,EAAiBjL,KAAK,OAAYe,aAAcjC,EAAU,YAA1N,cAE3C,yEACI,yBAAgC9E,GAAG,iBAAiB,aAAW,gCAA/D,iDACI,wBAAQ0B,MAAM,IAAd,6CACA,wBAAQA,MAAM,IAAd,iDAEJ,uBAAO8Q,QAAQ,iBAAf,2DAxCL,mH,gBChII,aAAO,IAAD,MACXhL,EAAO7G,qBAAW8G,KAElB/C,EAAUrE,iBAAO,MACvB,EAAkCC,wBAASQ,GAA3C,mBAAO6D,EAAP,KAAkBC,EAAlB,KACA,EAAoCtE,mBAAS,CAACuE,WAAW,GAAIyD,MAAOmK,IAAQxU,IAAI,oBAAqByU,WAAYD,IAAQxU,IAAI,sBAA7H,mBAAO6G,EAAP,KAAmBC,EAAnB,KACA,EAAgCzE,oBAAS,GAAzC,mBAAOgK,EAAP,KAAiBC,EAAjB,KANiB,4CAQjB,WAA4BtF,GAA5B,SAAAC,EAAA,sDACID,EAAEE,iBACFoF,GAAY,GACZ/C,EAAKmL,MAAM7N,EAAWwD,MAAOxD,EAAWM,UACvCtH,MAAO,SAAA8U,GACJrI,GAAY,GACTzF,EAAW4N,WACVD,IAAQI,IAAI,mBAAoBD,EAAWrV,MAC3CkV,IAAQI,IAAI,mBAAoB/N,EAAWwD,MAAO/K,UAGzDmB,OAAO,SAAA+G,GACJ8E,GAAY,MAZpB,4CARiB,sBAyBjB,SAAS0G,EAAiBhM,GACtB,IAAMqB,EAAQrB,EAAE6B,OAAOR,KACjBN,EAAQf,EAAE6B,OAAOd,MAM3B,SAAuBM,EAAM5E,GAAqB,IAAdsE,EAAa,uDAAN,MACnCS,GAAQ,EACP5B,EAAcC,EAAdD,WAEL,OAAOmB,GACH,IAAK,QAEDS,EADW,wJACAC,KAAKhF,GAChBmD,EAAWyB,GAAQG,EAAQ,GAAK,cAChC,MAEJ,IAAK,WACDA,EAAQ/E,EAAMuG,QAAU,EACxBpD,EAAWyB,GAAQG,EAAQ,GAAI,gBAC/B,MAEJ,QACIA,GAAQ,EACR5B,EAAWyB,GAAQ,GAI3BvB,GAAe,SAAA6B,GAAC,wCAAUA,GAAV,uBAAcN,EAAM5E,GAApB,wBAA+B4E,EAA/B,UAA6CG,GAA7C,2BAAoD5B,GAApD,OAzBhBgC,CAAcP,EAFO,aAAPN,EAAkBf,EAAE6B,OAAOsL,QAAQnN,EAAE6B,OAAOpF,MAE/BsE,GAmD/B,OAdA/E,qBAAU,YATV,WACI,IAAIyE,GAAU,EACd,IAAK,IAAIC,KAAOb,GACmB,IAA3Ba,EAAIxH,QAAQ,YACZuH,GAAWZ,EAAWa,IAE9Bf,IAAcc,GAIdE,KACF,CAACd,IAGH7D,qBAAU,WACN2D,GAAc,KAChB,IAOK,qCACP,eAAC0N,EAAA,EAAD,CAAMtS,GAAG,QAAQ0L,GAAG,QAAQtK,UAAU,6EAA6E2B,MAAO,CAAEhB,MAAO,SAAnI,UAEI,eAAC6M,EAAA,EAAD,WACI,cAAC0D,EAAA,EAAKQ,IAAN,CAAUxR,QAAQ,MAAMF,UAAU,wBAAwBK,IAAK8F,MAC/D,mGAA4DhK,WAC5D,iEAAyB,wDAG7B,eAACqR,EAAA,EAAD,WACI,eAAC0D,EAAA,EAAK/I,KAAN,CAAW6B,GAAIwD,IAAKxN,UAAU,uBAA9B,UAEA,cAACkR,EAAA,EAAKS,KAAN,CAAW3R,UAAU,mBAArB,0DAEA,eAAC2K,EAAA,EAAD,CAAMpH,UAAWA,EAAWsB,SA/FnB,4CA+F2C7F,IAAKsE,EAAzD,UACI,cAACoH,EAAA,EAAD,CAAe5F,UAAU,gBAAgBC,MAAM,gBAAgB/E,UAAU,OAAzE,SACI,cAAC2K,EAAA,EAAK3F,QAAN,CAAcC,UAAQ,EAACC,KAAK,QAAQN,KAAK,QAAQO,YAAY,IAAIC,SAAUyK,EAAiBlK,aAAY,UAAEjC,EAAWwD,aAAb,QAAoB,QAEhI,cAACwD,EAAA,EAAD,CAAe5F,UAAU,mBAAmBC,MAAM,WAAlD,SACI,cAAC4F,EAAA,EAAK3F,QAAN,CAAcC,UAAQ,EAACC,KAAK,WAAWN,KAAK,WAAWO,YAAY,IAAIC,SAAUyK,EAAiBlK,aAAY,UAAEjC,EAAWM,gBAAb,QAAuB,OAGzI,cAAC2G,EAAA,EAAKiH,OAAN,CAAahT,GAAG,kBAAkBmG,MAAM,cAAc/E,UAAU,wCAAwCkF,KAAK,WAAWE,SAAUyK,EAAiBgC,eAAc,UAAEnO,EAAW4N,gBAAb,WAEjK,cAAC5B,EAAA,EAAD,CAAgBhL,UAAU,SACtBC,QACI,cAACgL,EAAA,EAAD,CAAS3P,UAAS,UAAKuD,EAAU,SAAS,GAAxB,SAAoC3E,GAAE,iBAAxD,+BAFR,SAOQ,sBAAM+C,MAAO,CAACyI,QAAQ,UAAtB,oCACI,cAACnK,EAAA,EAAD,CAAQ6C,KAAK,KAAK9C,UAAU,OAAO4E,KAAK,SAASzE,WAAYoD,IAAc2F,GAA3E,SACMA,EAEA,qCAAE,cAACa,EAAA,EAAD,CAASC,GAAG,OAAMC,UAAU,OAAOnH,KAAK,KAAKoH,KAAK,SAAS,cAAY,SAAzE,qBADF,qCAAE,wEAAF,qBAMhB,cAAC,EAAD,UAKJ,cAAC,EAAD,UA7CD,0jC,QC5FI,OAA0B,sD,iCCO1B,eAA0C,IAAxCnH,EAAuC,EAAvCA,KAAM0B,EAAiC,EAAjCA,QAASI,EAAwB,EAAxBA,SAEtB7F,GAF8C,kBACpBO,qBAAWgH,KACXtH,iBAAO,OACvC,EAAgCC,oBAAS,GAAzC,mBAAOoF,EAAP,KACA,GADA,KACgCpF,mBAAS,IAAzC,mBAAOgK,EAAP,KAAiBC,EAAjB,KAWA,SAASG,EAAOI,GAIZ,GAFAA,EAAM3F,iBAED,OAAC/E,QAAD,IAACA,KAAKc,SAAYiD,EAAvB,CACA,MAAiB+O,MAAMC,KAAK/S,EAAIc,QAAQkS,UAAU3J,KAAI,SAAA7C,GAAC,OAAIA,EAAElF,SAAxD0D,EAAL,oBAEAa,EAASb,GACRtH,MAAM,kBAAM+H,GAAQ,MACpBnH,OAAO,kBAAM6L,EAAY,MACzB8I,SAAS,WACN7N,YAAY,kBAAM+E,EAAY,KAAI,SApB1CtJ,qBAAU,WAED,OAACb,QAAD,IAACA,KAAKc,SAAYiD,GAEvB/D,EAAIc,QAAQxD,iBAAiB,UAAU,SAACuH,GACpCA,EAAEE,sBAER,IAiBF,IAAI8E,EAAS,cAAC5I,EAAA,EAAD,CAAQE,UAAWmE,EAASpE,QAASoE,EAAQ,kBAAkB,oBAAqBhG,QAASgL,EAA7F,qBACb,OAAOJ,GACH,KAAK,EAAGL,EAAS,eAAC5I,EAAA,EAAD,CAAQC,QAAQ,kBAAhB,cAAmC,cAAC6J,EAAA,EAAD,CAASC,GAAG,OAAYC,UAAU,SAAcnH,KAAK,KAAUoH,KAAK,SAAc,cAAY,YAAmB,MACrK,KAAK,EAAGrB,EAAS,cAAC5I,EAAA,EAAD,CAAQC,QAAQ,kBAAhB,kBAAkD,MACnE,KAAK,EAAG2I,EAAS,cAAC5I,EAAA,EAAD,CAAQC,QAAQ,iBAAhB,mBAIrB,OAAO,qCAEH,eAAC,IAAD,CAAOF,UAAU,OAAOqN,SAAS,IAAIlK,QAAS,CAAC0F,GAAS5F,aAAW,EAAMF,OAAM0B,UAAUzB,MAAM,gBAA/F,UACA,cAAC,IAAD,eACA,cAAC2H,EAAA,EAAD,CAAM3L,IAAKA,EAAK6F,SAAUyE,EAA1B,SACI,cAACoB,EAAA,EAAD,CAAe5F,UAAU,gBAAgBC,MAAM,WAAW/E,UAAU,OAApE,SACI,cAAC2K,EAAA,EAAK3F,QAAN,CAAcE,KAAK,WAAWN,KAAK,WAAWO,YAAY,oBAN/D,kN,4DCtCX,SAAS+M,GAAT,GAA0F,EAAvEtT,GAAwE,IAApEsG,EAAmE,EAAnEA,KAAKwD,EAA8D,EAA9DA,KAAMyJ,EAAwD,EAAxDA,OAAiCC,GAAuB,EAAhDpD,OAAgD,EAAxCqD,MAAwC,EAAjCC,SAA0BvT,EAAO,kBACtF,EAAwBG,oBAAS,GAAjC,mBAAO6D,EAAP,KAAa0B,EAAb,KACM6B,EAAQ/G,qBAAWgH,KAczB,SAASgM,EAAUvO,GACf,OAAOsC,EAAMkM,SAAStN,EAAMlB,GAGhC,OAAGmO,EACQ,6BAIJ,sBAAK7T,QArBZ,WAGOyE,IAGAqP,EACC3N,GAAQ,GAGR8N,MAWD,qCAEH,eAACrB,EAAA,EAAD,yBAAMlR,UAAU,sBAAyBjB,GAAzC,cACI,cAACmS,EAAA,EAAKQ,IAAN,CAAUxR,QAAQ,MAAMG,IAAKqI,IAC5B0J,GAAe,cAACjI,EAAA,EAAD,CAAOxI,MAAO,CAACyI,QAAQ,0BAA2BqI,OAAO,UAAWnI,GAAG,QAAQtK,UAAU,gCAAgCqK,MAAI,EAA7H,SAA8H,qBAAK1J,MAAM,KAAKN,IAAKqS,GAAM/Q,MAAO,CAACgR,OAAO,cAA1C,+BAC9I,cAACzB,EAAA,EAAK/I,KAAN,UACI,eAAC+I,EAAA,EAAKhJ,MAAN,eAAchD,WAGtB,cAAC,GAAD,CACInC,KAASA,EACT0B,QAAYA,EACZI,SAAa0N,IAZd,ksBAwDX,SAASK,MAGM,kBAEKjQ,cAAhB,IACM2D,EAAQ/G,qBAAWgH,KAMzB,OAJA1G,qBAAW,cAER,CAACyG,EAAMuM,OAEH,qCACH,cAACtF,EAAA,EAAD,CAAKqF,WAAYA,GAAYhU,GAAG,QAAQoB,UAAU,eAAlD,SACI,eAACwN,EAAA,EAAD,CAAK9G,GAAI,GAAIoM,GAAI,CAACC,KAAK,GAAIC,OAAO,GAAlC,UAEA,yFACA,cAACzF,EAAA,EAAD,CAAK7G,GAAI,EAAGoM,GAAI,EAAGG,GAAI,EAAGC,GAAI,EAAGlT,UAAU,MAA3C,SACE,YAAI4N,OAAOkC,OAAOxJ,EAAMuM,OAAOxK,KAAI,SAAC7C,EAAE8C,GAAH,OAAS,cAACkF,EAAA,EAAD,UACtC,cAAC0E,GAAD,eAAoD1M,KADJ8C,aANzD,4N,yCCjGI,eAA+B,EAA7BvF,KAA6B,EAAvB0B,QAAuB,kBAAC,IACrC0O,EAAQ,CAAC,UAAU,UAAW,QACpC,EAAgCjU,mBAAS,GAAzC,mBAAO+O,EAAP,KAAiBC,EAAjB,KACA,EAAwBhP,mBAAS,MAAjC,mBAAOkU,EAAP,KAAaC,EAAb,KACA,EAA0BnU,mBAAS,IAAnC,mBAAOoU,EAAP,KAAcC,EAAd,KAiBA,SAASC,EAAa3P,GAElB,cAAOA,QAAP,IAAOA,OAAP,EAAOA,EAAG4G,SAEN,KAAK,GAAI,OAAOyD,GAAa,SAAAd,GAAC,OAAKA,EAAE,EAAI,EAAI+F,EAAMtM,OAAO,EAAIuG,EAAE,KAChE,KAAK,GAAI,OAAOc,GAAa,SAAAd,GAAC,OAAKA,EAAE,GAAG+F,EAAMtM,WAWtD,OA9BAhH,qBAAU,WACN,sBAAC,kCAAAiE,EAAA,sDACO2P,EAAK,GADZ,eAEiBN,GAFjB,gEAEYO,EAFZ,iBAGa,OAAO,YAASA,EAAhB,SAAyBhX,MAAK,SAAA8I,GAAC,OAAIiO,EAAG5Q,KAAK,cAAC2C,EAAEmO,QAAH,QAHxD,8IAIGJ,EAAS,GAAD,OAAKE,IACbJ,EAAQI,EAAGxF,IALd,+DAAD,KAOD,IAEHpO,qBAAU,WACNwT,EAAQC,EAAMrF,MACf,CAACA,IAWJpO,qBAAU,WAEN,OADI2H,SAASlL,iBAAiB,UAAWkX,GAClC,WACHhM,SAAStB,oBAAoB,UAAWsN,MAE7C,IAEI,2DACH,cAAC,KAAD,CACII,YAAc,kBAAM1F,GAAa,SAAAd,GAAC,OAAKA,EAAE,GAAG+F,EAAMtM,WAClDgN,aAAc,kBAAM3F,GAAa,SAAAd,GAAC,OAAKA,EAAE,EAAI,EAAI+F,EAAMtM,OAAO,EAAIuG,EAAE,MAFxE,SAMI,2DACI,gGACE+F,EAAM9K,KAAK,SAAC7C,EAAE8C,GAAH,OAAS,iEACd,qBAA0DhK,QAAS,kBAAI4P,EAAY5F,IAAnF,+CAA4B2F,IAAa3F,EAAE,SAAS,IAApD,SAAwF9C,KADjE8C,QAKlC8K,OAdF,0gBC9BI,cAAO,IAAD,IACXpU,EAAMC,iBAAO,MACbmH,EAAO7G,qBAAW8G,KACxB,EAAwBnH,oBAAS,GAAjC,mBAAO6D,EAAP,KAAa0B,EAAb,KAmBA,OAAI2B,EAAKI,SACF,qCACH,eAAC,EAAIiC,KAAL,CAAUnK,QAAS,kBAAImG,EAAQ,IAA/B,UAAoC,oEAApC,aAIA,cAAC,IAAD,CAAOxB,aAAW,EAACH,KAAK,KAAUC,OAAM0B,UACxCzB,MAAQ,qFACRG,QAAS,CACT,eAAClD,EAAA,EAAD,CAAQ3B,QAAS8H,EAAKK,OAAtB,UAA8B,4DAA9B,gBAHA,SAcA,eAAC8G,EAAA,EAAD,WACA,eAACC,EAAA,EAAD,CAAK9G,GAAI,EAAT,UACI,cAAC8G,EAAA,EAAD,CAAK9G,GAAG,OAAO1G,UAAU,mBAAzB,SACI,cAAC,IAAD,CACIpB,GAAG,aACHyB,IAAM,UAAA+F,EAAKO,YAAL,SAAWC,OAAOC,OAAlB,UAA0BT,EAAKO,YAA/B,aAA0B,EAAWC,OAASE,IACpDC,eAAa,EAEbpG,MAAM,MAAMC,OAAO,UAG3B,cAAC4M,EAAA,EAAD,UACA,cAAC,IAAD,CAAIxN,UAAU,mBAAd,+CACgBoG,EAAKO,KAAKK,SAD1B,8MAOJ,cAACwG,EAAA,EAAD,CAAK9G,GAAI,EAAT,SACI,eAACiE,EAAA,EAAD,CAAM3L,IAAKA,EAAX,UACA,cAAC2L,EAAA,EAAK1D,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,WAArB,kBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,WAAaC,YAAY,WAAaQ,aAAcS,EAAKO,KAAKK,SAAwCpC,KAAK,SAA5K,cACvC,cAAC+F,EAAA,EAAK1D,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,QAArB,qBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,QAAaC,YAAY,QAAaQ,aAAcS,EAAKO,KAAKO,MAAqCtC,KAAK,UAAzK,cACvC,cAAC+F,EAAA,EAAK1D,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,WAArB,kBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,WAAaC,YAAY,WAAaQ,aAAcS,EAAKO,KAAoC/B,KAAK,aAAnK,cACvC,cAAC+F,EAAA,EAAK1D,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,aAArB,gBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,SAAaC,YAAY,aAAaQ,aAAcS,EAAKO,KAAKC,OAAsChC,KAAK,WAA1K,cACvC,cAAC+F,EAAA,EAAK1D,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,OAArB,sBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,OAAaC,YAAY,OAAaQ,aAAcS,EAAKO,KAAKzB,KAAoCN,KAAK,SAAxK,cACvC,cAAC+F,EAAA,EAAK1D,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,UAArB,mBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,UAAaC,YAAY,UAAaQ,aAAcS,EAAKO,KAAKQ,QAAuCvC,KAAK,SAA3K,cACvC,cAAC+F,EAAA,EAAK1D,MAAN,CAAYjH,UAAU,OAAOsB,SAAU,eAACoJ,EAAA,EAAD,CAAe3F,MAAM,aAArB,gBAAqC,cAAC4F,EAAA,EAAK3F,QAAN,CAAc7E,UAAQ,EAAC+E,KAAK,YAAaC,YAAY,YAAaQ,aAAcS,EAAKO,KAAKS,UAAyCxC,KAAK,SAA7K,wBA9CxC,mFADmB,8BCvBf,cACX,IAAM0B,EAA0B/G,qBAAWgH,KACrCvH,EAA0BC,iBAAO,MACvC,EAAgCC,oBAAS,GAAzC,mBAAO6D,EAAP,KAAa0B,EAAb,KACA,EAAgCvF,oBAAS,GAAzC,mBAAOoF,EAAP,KACA,GADA,KACgCpF,mBAAS,IAAzC,mBAAOgK,EAAP,KAAiBC,EAAjB,KAEA,SAASG,IACL,GAAK,OAACtK,QAAD,IAACA,KAAKc,SAAYiD,EAAvB,CAEA,MAA+C+O,MAAMC,KAAK/S,EAAIc,QAAQkS,UAAU3J,KAAI,SAAA7C,GAAC,OAAIA,EAAElF,SAA3F,mBAAKwT,EAAL,KAAe9P,EAAf,KAAyBlB,EAAzB,KAA+B4F,EAA/B,KAAqCyJ,EAArC,KAEA7L,EAAMyN,WAAWD,EAASrE,cAAe,CAACzL,WAAUlB,OAAM4F,OAAMyJ,WAC/DzV,MAAM,SAAAsX,GACH7V,IAAMgD,QAAN,uBAA8B6S,EAAK9O,OACnCd,YAAY,WAAQ+E,EAAY,GAAI1E,GAAQ,KAAY,KACxD0E,EAAY,MAEf7L,OAAO,SAAA+G,GACJlG,IAAMQ,MAAN,wBAA6B0F,IAC7B8E,EAAY,GACZ/E,YAAY,WAAQ+E,EAAY,KAAQ,SAQhD,IAAIN,EAAS,cAAC5I,EAAA,EAAD,CAAQE,UAAWmE,EAASpE,QAASoE,EAAQ,kBAAkB,oBAAqBhG,QAASgL,EAA7F,oBACb,OAAOJ,GACH,KAAK,EAAGL,EAAS,eAAC5I,EAAA,EAAD,CAAQC,QAAQ,kBAAhB,cAAmC,cAAC6J,EAAA,EAAD,CAASC,GAAG,OAAYC,UAAU,SAAcnH,KAAK,KAAUoH,KAAK,SAAc,cAAY,YAAmB,MACrK,KAAK,EAAGrB,EAAS,cAAC5I,EAAA,EAAD,CAAQC,QAAQ,kBAAhB,kBAAkD,MACnE,KAAK,EAAG2I,EAAS,cAAC5I,EAAA,EAAD,CAAQC,QAAQ,iBAAhB,mBAKrB,OAAO,qCACH,cAAC,EAAID,OAAL,CAAY3B,QAAS,kBAAImG,EAAQ,IAAIzB,MAAM,cAAc+B,MAAM,cAAc4D,YAAY,kCAAzF,SACI,gEAGJ,eAAC,IAAD,CAAO7F,KAAK,KAAK0H,UAAY,SAAC3G,GAAD,OAAqB,KAAdA,EAAE4G,SAAmBnB,KAAW+D,SAAS,IAAIlK,QAAS,CAAC0F,GAAS5F,aAAW,EAAMF,OAAM0B,UAAUzB,MAAO,4EAA5I,UACA,cAAC,IAAD,eACA,eAAC2H,EAAA,EAAD,CAAM3L,IAAKA,EAAX,UACI,cAAC0L,EAAA,EAAD,CAAe5F,UAAU,gBAAgBC,MAAM,SAAS/E,UAAU,OAAlE,SACI,cAAC2K,EAAA,EAAK3F,QAAN,CAAcI,SAtB1B,SAAyBvB,KAsB4BoB,UAAQ,EAACC,KAAK,SAASN,KAAK,OAAOO,YAAY,aAG5F,cAACuF,EAAA,EAAD,CAAe5F,UAAU,gBAAgBC,MAAM,WAAW/E,UAAU,OAApE,SACI,cAAC2K,EAAA,EAAK3F,QAAN,CAAcE,KAAK,WAAWN,KAAK,WAAWO,YAAY,eAI9D,cAACuF,EAAA,EAAD,CAAe5F,UAAU,gBAAgBC,MAAM,OAAO/E,UAAU,OAAhE,SACI,cAAC2K,EAAA,EAAK3F,QAAN,CAAcE,KAAK,OAAO+J,IAAI,IAAIgF,KAAK,IAAIrP,KAAK,SAASO,YAAY,YAAYQ,aAAa,QAGlG,cAAC+E,EAAA,EAAD,CAAe5F,UAAU,gBAAgBC,MAAM,OAAO/E,UAAU,OAAhE,SACI,cAAC2K,EAAA,EAAK3F,QAAN,CAAcE,KAAK,OAAON,KAAK,OAAOO,YAAY,eAGtD,cAACwF,EAAA,EAAKiH,OAAN,CAAahT,GAAG,gBAAgBmG,MAAM,SAASG,KAAK,SAASS,cAAc,UAzB5E,kNCvCI,cACX,IAAMW,EAAQ/G,qBAAWgH,KACzB,EAAwBrH,oBAAS,GAAjC,mBAAO6D,EAAP,KAAa0B,EAAb,KAEA,OAAO,qCACH,eAAC,EAAIgE,KAAL,CAAUnK,QAAS,kBAAImG,EAAQ,IAAIM,MAAM,aAAzC,UACI,mBAAG/E,UAAU,yBADjB,WAGA,cAAC,IAAD,CAAOmD,QAAS,CAAC,cAAClD,EAAA,EAAD,CAAQ6C,KAAK,KAAKxE,QAAS,kBAAIgI,EAAM4N,aAArC,sBAAqEjR,aAAW,EAACH,KAAK,KAAUC,OAAM0B,UAAUzB,MAAO,4CAAesD,EAAMxG,QAAQoF,QAArK,SAEI,cAAC,IAAD,mKCXG,cACX,MAAgChG,oBAAS,GAAzC,mBAAO6D,EAAP,KAAa0B,EAAb,KAEA,OAAO,qCACH,eAAC,EAAIgE,KAAL,CAAUnK,QAAS,kBAAImG,GAAQ,SAAA2I,GAAC,OAAKA,MAArC,UAA0C,mBAAGpN,UAAU,8BAAvD,cACA,cAAC,IAAD,CAAOpB,GAAG,SAASyO,SAAS,IAAIpK,aAAW,EAACH,KAAK,KAAUC,OAAM0B,UAAU6I,OAAQ,oDAAnF,SACI,cAAC,GAAD,UCNG,cAAO,IAAD,IACXhH,EAA0B/G,qBAAWgH,KAC3C,EAAgCrH,oBAAS,GAAzC,mBAAO6D,EAAP,KAAa0B,EAAb,KAIA,OAAO,qCACH,eAAC,EAAIgE,KAAL,CAAUnK,QAAS,kBAAImG,GAAQ,SAAA2I,GAAC,OAAKA,MAAIjN,UAAWmG,EAAMxG,QAA1D,UAAoE,4DAApE,WACA,cAAC,IAAD,CAAOuN,SAAS,IAAIpK,aAAW,EAACH,KAAK,KAAUC,OAAM0B,UAAUzB,MAAO,2DAAM,4DAAN,YAAtE,SACI,oBAAIpE,GAAG,YAAP,6CACK0H,EAAMxG,eADX,iBACK,EAAeuS,aADpB,aACK,EAAsBhK,KAAK,SAAC7C,EAAE8C,EAAExE,GAAL,OAAW0B,GACvC,mEACI,sBAAMlH,QAAS,kBAAIgI,EAAM6N,SAAN,OAAe3O,QAAf,IAAeA,OAAf,EAAeA,EAAGwB,WAArC,8CACA,cAAC,IAAD,CAAOhH,UAAU,sCAAsC+G,eAAa,EAAC1G,IAAKmF,EAAEoB,OAAQwN,IAAK5O,EAAEwB,SAAUrF,MAAO,CAAChB,MAAO,SAAUC,OAAQ,YACtI,4EAA+B4E,QAA/B,IAA+BA,OAA/B,EAA+BA,EAAGwB,aAHPsB,UALpC,6V,UCNI,cAAO,IAAD,EACX+L,EAAWpV,iBAAO,MAClBqH,EAAQ/G,qBAAWgH,KACnBH,EAAO7G,qBAAW8G,KAExB,EAAwBnH,oBAAS,GAAjC,mBAAO6D,EAAP,KAAa0B,EAAb,KACA,EAA0BvF,mBAAS,GAAnC,6BAUA,SAASoV,IACL,IAAMC,EAAO/M,SAASG,eAAe,QACrC,GAAI4M,EAAJ,CAEA,IAAMC,EAAMD,EAAKE,cAAc,eAC/BD,EAAIE,UAAYF,EAAIG,cAQxB,OArBA9U,qBAAU,WAAQyU,MAAgB,CAAChO,EAAMsO,WAqBlC,qCACH,eAAC,EAAInM,KAAL,CAAUnK,QAAS,kBALnBmG,GAAQ,SAAA2I,GAAC,OAAKA,UACdhJ,WAAWkQ,EAAY,KAIiBnU,UAAWmG,EAAMxG,QAAzD,UAAkE,uEAAlE,UACA,cAAC,IAAD,CAAOlB,GAAG,OAAOuE,QAAS,CACtB,cAACwH,EAAA,EAAD,CAAM3K,UAAU,cAAc6U,YAAU,EAACtR,YAAW,UAAA8Q,EAASvU,eAAT,UAAkBQ,MAAMuG,QAAuBhC,SAtB3G,SAAsBhB,GAClBA,EAAEE,iBACFuC,EAAMwO,YAAYT,EAASvU,QAAQQ,OAC9B5D,MAAK,kBAAM2X,EAASvU,QAAQQ,MAAQ,OAmBrC,SACI,eAACyU,GAAA,EAAD,WACI,cAACpK,EAAA,EAAK3F,QAAN,CACIhG,IAAKqV,EACLlP,YAAY,yBACZ,aAAW,uBACX,mBAAiB,eACjBD,KAAK,UAAUN,KAAK,SAExB,cAAC3E,EAAA,EAAD,CAAQ2E,KAAK,SAAS1E,QAAQ,kBAAkBtB,GAAG,gBAAnD,SACI,gFAIbyO,SAAS,IAAIpK,aAAW,EAACH,KAAK,KAAWC,OAAM0B,UAAWzB,MAAO,4DAAM,uEAAN,WAfpE,SAgBI,iEACKsD,EAAMsO,SAASvM,KAAI,SAACrH,EAASgU,GAAV,OAAgB,mCAAGhU,EAAQgG,SAAU,mDAAuBhG,EAAQgG,WAAaZ,EAAKO,KAAKK,SAAW,OAAS,YAA1E,cACrD,cAAC,IAAD,CAAOhH,UAAU,sCAAsC+G,eAAa,EAAC1G,IAAKW,EAAQ4F,OAAQwN,IAAKpT,EAAQgG,WACvG,0EACI,yEACI,kEAA2BhG,EAAQgG,WAEnC,uBAAiCrF,MAAO,CAAEsT,QAAS,IAAnD,0DAA8D,WAC1D,IAAIpE,EAAI,IAAIqE,KAAKlU,EAAQmU,WACzB,MAAM,GAAN,OAAUtE,EAAEuE,WAAZ,YAA0BvE,EAAEwE,cAF8B,SAKjErU,EAAQsU,UAXiDN,GAchE,mEAA+BhU,EAAQsU,KAAvC,MAASN,YAjChB,w4BC9BI,cAAO,IAAD,EACXO,EAAYtW,iBAAO,MACnBK,EAAWC,qBAAWC,KAC5B,EAA0CN,oBAAS,GAAnD,mBAAOsW,EAAP,KAAuBC,EAAvB,KA0CA,OA/BA5V,qBAAU,WAAO,IAAD,EACN6V,EAAW,UAAGpW,EAAMkP,YAAYmH,wBAArB,QAAuC,GACxDF,EAAgBC,EAAYE,OAAO,SAAApQ,GAAC,OAAIA,EAAEqQ,cAC1C,CAACvW,EAAMkP,YAAP,UAAoBlP,EAAMK,gBAA1B,aAAoB,EAAgBR,QAExCU,qBAAU,WAAK,IAAD,EACJiW,EAAG,OAAGP,QAAH,IAAGA,GAAH,UAAGA,EAAWzV,eAAd,aAAG,EAAoB6L,WAAW,MAC3CmK,EAAIC,YAAgB,GAiBpB,IAAMnX,EAAKoX,uBAhBX,SAASC,IAELH,EAAII,UAAU,EAAG,EAAGJ,EAAIvK,OAAO5K,MAAOmV,EAAIvK,OAAO3K,QAEjD,IAAOuV,EAA4C,GAAjBL,EAAIvK,OAAO5K,MAAlCyV,EAAgE,GAApBN,EAAIvK,OAAO3K,OAA/CyV,EAAkF,GAAjBP,EAAIvK,OAAO5K,MAAxE2V,EAAqG,GAApBR,EAAIvK,OAAO3K,OAAxF2V,EAAwH,GAApBT,EAAIvK,OAAO3K,OACtI4V,EAAWV,EAAIW,qBAAqBN,EAAIC,EADmC,IAC3BC,EAAIC,EAAIC,GAC5DC,EAASE,aAAa,EAAG,4BACzBF,EAASE,aAAa,GAAK,4BAC3BF,EAASE,aAAa,GAAI,4BAC1BF,EAASE,aAAa,EAAG,4BAEzBZ,EAAIa,UAAYH,EAChBV,EAAIc,SAAS,EAAG,EAAGd,EAAIvK,OAAO5K,MAAOmV,EAAIvK,OAAO3K,QAEhDoV,sBAAsBC,MAI9B,OAAO,WACHY,qBAAqBjY,MAEvB,IAEK,qCACP,sBAAKA,GAAG,gBAA8C+C,MAAO,CAACmV,UAAW,QAASpJ,aAAc,SAAhG,uDACI,wBAAQ/M,MAAM,MAAMC,OAAO,MAAM5B,IAAKuW,EAAtC,mEACA,cAAC,EAAItV,OAAL,CAAY3B,QAzChB,WACC,IAAD,EAEUuX,GADW,UAAGvW,EAAMkP,YAAYmH,wBAArB,QAAuC,IAC5BC,OAAM,SAAAmB,GAA4C,OAAjCA,EAAMlB,SAAWL,IAAyBuB,EAAMlB,WAC7FJ,EAAgBI,IAqCkB9Q,MAAM,cAAc4D,YAAY,kCAAlE,SACI,gDAAc6M,EAAe,YAAY,mBAAzC,WAJD,ssB,UCsCIpT,IArEf,YAA0B,IAAD,wBACvBvC,qBAAU,WACRmX,SACA,IAGF,IAAMtU,EAAUC,cACVyD,EAAO7G,qBAAW8G,KAClBC,EAAQ/G,qBAAWgH,KACX0Q,EAAQhY,mBAAjBa,QAQL,MANI,wBAAyBwF,KAAK5C,EAAQ9G,SAASsb,YAAWD,EAAO,cAACnJ,EAAD,CAAMqJ,WAAS,KACnD,MAA9BzU,EAAQ9G,SAASsb,WAA0BD,EAAO,cAAC,GAAD,CAAOE,WAAS,KACpC,cAA9BzU,EAAQ9G,SAASsb,WAA0BD,EAAO,cAAC,GAAD,CAAQlU,MAAM,EAAMoU,WAAS,KAC9E,+BAAgC7R,KAAK5C,EAAQ9G,SAASsb,YAAaD,EAAO,cAAC,IAAD,CAAUxU,GAAG,OACvF,gCAAiC6C,KAAK5C,EAAQ9G,SAASsb,YAAYD,EAAO,cAAC,IAAD,CAAUxU,GAAG,OAEtF2D,EAAKI,UAAYJ,EAAKwJ,YAGlB,qCACP,8DAEE,cAACwH,EAAA,EAAD,CAAWC,MAAK,UAAEJ,SAAF,iBAAE,EAAMlY,aAAR,aAAE,EAAaoY,UAAWvY,GAAG,kBAA7C,SACCqY,IAGD,eAAC,EAAD,WACK3Q,EAAMxG,QAAS,cAAC,GAAD,IAAoB,cAAC,GAAD,IACpC,cAAC,GAAD,IACCwG,EAAMxG,QAAQ,cAAC,GAAD,IAAiB,cAAC,GAAD,IAChC,cAAC,GAAD,IACA,cAAC,GAAD,UAZC,2ZAFA,qBAAKE,UAAU,MAAMsB,SAAU,cAAC,EAAD,Q,iLCtC3B,MAA0B,oC,sBCO5BiF,EAAe+Q,0BACxB1C,EAAW,GACX2C,EAAU,GAEC,gBAA2B,IAAzBjW,EAAwB,EAAxBA,SACP8E,GAD+B,iBACrB7G,qBAAW8G,MACrB3D,EAAUC,cAEhB,EAAgCzD,mBAAS,IAAzC,mBAAOoH,EAAP,KAAckR,EAAd,KACA,EAAgCtY,oBAAS,GAAzC,mBAAOjC,EAAP,KAAcwa,EAAd,KACA,EAAgCvY,mBAAS,MAAzC,mBAAOY,EAAP,KAAgB4X,EAAhB,KACA,EAA0BxY,mBAAS,GAAnC,mBAAcyY,GAAd,WAEA,SAASC,EAAY/G,GACjB+D,EAAW/D,EACX8G,GAAS,SAAAvK,GAAC,OAAIA,EAAE,KAmCpB,SAASyK,IACLC,IAAcC,QAAQ,CAACpb,SAASqb,IAChCF,IAAcG,SAAS,CAACtb,SAASub,IAGrC,SAASC,EAAanR,EAAUoR,GAC/B,IAAD,IACUpE,EAAO,2BAAI1N,GAAJ,yBAAWxG,QAAX,IAAWA,OAAX,EAAWA,EAASoF,KAAMpF,IAASsY,GADpD,+BAEoBpE,QAFpB,IAEoBA,OAFpB,EAEoBA,EAAM3B,aAF1B,QAEiC,IAFjC,IAEI,IAAI,EAAJ,qBAAgC,CAAC,IAAzB1L,EAAwB,QAC5B,IAAO,OAAJA,QAAI,IAAJA,OAAA,EAAAA,EAAMK,YAAaA,EAClB,OAAO,GAJnB,8BAMI,OAAO,EAQX,SAASqR,EAAT,GAAqC,EAAblU,KAAM6P,KAC1B8D,IAAcC,QAAQ,CAACpb,SAASqb,IAChCF,IAAcG,SAAS,CAACtb,SAASub,IAGrC,SAASI,EAAT,GAAqC,EAAbnU,KAAM6P,KAC1B8D,IAAcC,QAAQ,CAACpb,SAASqb,IAChCF,IAAcG,SAAS,CAACtb,SAASub,IAGrC,SAASK,EAAT,GACC,IAEc,EAFf,IADsBpU,KAAMwC,EAC5B,EAD4BA,KAC5B,EADiCqN,MAE7B8D,IAAcC,QAAQ,CAACpb,SAASqb,IAC7BlY,KACC3B,YAAM,SAAD,OAAUwI,EAAKK,SAAf,WACL0Q,EAAW,2BAAK5X,GAAN,IAAeuS,MAAK,iBAAEvS,QAAF,IAAEA,OAAF,EAAEA,EAASuS,aAAX,QAAkB,GAAGM,QAAO,SAAA6F,GAAC,OAAEA,EAAExR,WAAWL,EAAKK,eAC/E4N,EAAS/R,KAAK,CAACyS,KAAK,SAAD,OAAU3O,EAAKK,SAAf,UAAiCmO,WAAW,IAAID,MAAOuD,iBAIlF,SAASC,EAAT,GACC,IAEc,EAFf,IADsBvU,KAAMwC,EAC5B,EAD4BA,KAC5B,EADiCqN,MAE7B8D,IAAcC,QAAQ,CAACpb,SAASqb,IAC7BlY,KACC3B,YAAM,SAAD,OAAUwI,EAAKK,SAAf,aACL0Q,EAAW,2BAAK5X,GAAN,IAAeuS,MAAK,iBAAEvS,QAAF,IAAEA,OAAF,EAAEA,EAASuS,aAAX,QAAkB,GAAGxP,KAAK8D,MACxDiO,EAAS/R,KAAK,CAACyS,KAAK,SAAD,OAAU3O,EAAKK,SAAf,YAAmCmO,WAAW,IAAID,MAAOuD,iBA5F/C,SA0GtBT,EA1GsB,8EA0GrC,uCAAAlU,EAAA,yDAAkCkQ,EAAlC,EAA2B7P,KAAO6P,KAC9B0D,EAAe,OAAJ1D,QAAI,IAAJA,KAAM9O,KAAN,eAAe8O,GAAM,MADpC,OAGOA,QAHP,IAGOA,MAAM9O,KAHb,yCAKwB8O,EAAK3B,aAL7B,QAKoC,IALpC,8DAKgB1L,EALhB,SAMoBC,OANpB,qEAO0B2Q,EAAQ5Q,EAAKK,iBAPvC,uEAO0DZ,EAAKuS,cAAchS,EAAKK,UAPlF,4BAOYL,EAAKC,OAPjB,KAQYD,EAAKC,OAASD,EAAKC,OAAOC,OACxBF,EAAKC,OACLgS,EAVd,+IAYWlW,EAAQ9G,SAASsb,WAAjB,uBAAuClD,QAAvC,IAAuCA,OAAvC,EAAuCA,EAAM9O,OACzCxC,EAAQG,KAAR,uBAAsBmR,QAAtB,IAAsBA,OAAtB,EAAsBA,EAAM9O,OAb3C,wBAiBQxC,EAAQG,KAAR,KAjBR,iEA1GqC,sBA+HrC,SAASqV,EAAT,GAAoC,IAAD,EAAR5R,EAAQ,EAAdnC,KAAMmC,MACnBuS,EAAK,GADsB,qBAEfvS,QAFe,IAEfA,IAAO,IAFQ,IAE/B,IAAI,EAAJ,0BAAQ0N,EAAR,QACI6E,EAAG7E,EAAK9O,MAAQ8O,GAHW,8BAI/BwD,EAASqB,GAGb,SAASC,EAAT,GAAqC,EAAZpP,MAAa,IAAPvF,EAAM,EAANA,KAC3B,GAAGrE,EAAQ,CACP,IAAM6G,EAAOxC,EAAKwC,KAClBiO,EAAS/R,KAAK,CAACyS,KAAK,SAAD,OAAU3O,EAAKK,SAAf,cAAqCmO,WAAW,IAAID,MAAOuD,iBAzIjD,SA6ItBM,EA7IsB,8EA6IrC,iCAAAjV,EAAA,2DAA2B4F,MAAOvF,EAAlC,EAAkCA,KAAlC,8DAGkBoT,EAAQpT,EAAK6C,iBAH/B,oEAGkDZ,EAAKuS,cAAcxU,EAAK6C,UAH1E,wKAGuF4R,EAHvF,QAGIzU,EAAKyC,OAHT,KAIIgR,EAAY,GAAD,mBAAKhD,GAAL,CAAczQ,KAJ7B,6CA7IqC,kEAoJrC,WAA2BmR,GAA3B,SAAAxR,EAAA,+EACW,IAAImM,SAAS,SAACC,EAASC,GACtBrQ,GAASqQ,IAKb2H,IAAckB,SAAS1D,EAAM,CAAC3Y,SAH9B,SAAuBwH,GACnB+L,WALZ,4CApJqC,sBAcrCrQ,qBAAW,WACP,GAAIuG,EAAKI,SAiBb,OAfIsR,IAAcmB,GAAGnB,IAAaoB,cAAmBX,GACjDT,IAAcmB,GAAGnB,IAAaqB,gBAAmBT,GACjDZ,IAAcmB,GAAGnB,IAAasB,YAAmBf,GACjDP,IAAcmB,GAAGnB,IAAauB,YAAmBf,GACjDR,IAAcmB,GAAGnB,IAAawB,aAAmBR,GACjDhB,IAAcmB,GAAGnB,IAAayB,WAAmB1B,GACjDC,IAAcmB,GAAGnB,IAAa0B,SAAmBT,GAGjDjB,IAAcG,SAAU,CAAEtb,SAAU,SAAC8c,GAASvB,EAAWuB,GACrD3B,IAAcC,QAAS,CAAEpb,SAAS,SAAC+c,GAAS1B,EAAU0B,GAClDjC,GAAS,SAId,WACHK,IAAc6B,IAAI7B,IAAaoB,cAAkBX,GACjDT,IAAc6B,IAAI7B,IAAaqB,gBAAkBT,GACjDZ,IAAc6B,IAAI7B,IAAasB,YAAkBf,GACjDP,IAAc6B,IAAI7B,IAAauB,YAAkBf,GACjDR,IAAc6B,IAAI7B,IAAawB,aAAkBR,GACjDhB,IAAc6B,IAAI7B,IAAa0B,SAAkBT,MACjD,CAAC3S,EAAKI,WAEV3G,qBAAU,WACFC,GACJ8Z,aAAaC,QAAQ,WAAYxN,KAAKC,UAAUsI,MAClD,CAACA,IA2KH,IAAMkF,EAAQne,OAAO2K,MAAQ,CACzBkM,SAxCJ,SAAkB4F,EAAUpU,GACxB,OAAO,IAAIiM,SAAQ,SAACC,EAASC,GACzB2H,IAActF,SAAS4F,EACvB,CACIpU,SAAQ,OAAEA,QAAF,IAAEA,IAAU,GACpBrH,SAAS,YAAmB,EAAjB+M,MAAkB,IAAXvF,EAAU,EAAVA,KACXA,EAAKxF,OAEJR,IAAMQ,MAAMwF,EAAKnD,SACjBmP,EAAOhM,EAAKnD,UAEXkP,EAAQ/L,EAAK6P,YAI7BtX,MAAO,SAACsX,GAAsD,OAA7C8D,IAAcC,QAAQ,CAACpb,SAASqb,IAAoBhE,KACrE/B,SAAS,WACN,IAAI8H,EAAIH,aAAaI,QAAQ,YACvBD,EAAHA,EAAK1N,KAAK4N,MAAMF,GACZ,GACPnC,EAAY,YAAImC,QAqBpB7F,UAjBJ,WACI,OAAO,IAAIjE,SAAQ,SAACC,EAASC,GACzB2H,IAAc5D,UAAU,CAACvX,SAAS,YAAmB,EAAjB+M,MAAkB,IAAXvF,EAAU,EAAVA,KACpCA,EAAKxF,MAAOwR,EAAOhM,EAAKnD,SACtBkP,EAAQ/L,EAAK6P,YAGzB/B,SAAU,SAAC+B,GAIZ,OAHI4D,EAAY,IACZE,IAAcC,QAAQ,CAACpb,SAASqb,IAChCF,IAAcG,SAAS,CAACtb,SAASub,IAC9BlE,MAOPD,WA3DJ,SAAoBqE,EAApB,GAA8D,IAA/BpU,EAA8B,EAA9BA,SAAUmO,EAAoB,EAApBA,OAAQzJ,EAAY,EAAZA,KAAM5F,EAAM,EAANA,KACnD,OAAO,IAAImN,SAAQ,SAACC,EAASC,GACzB2H,IAAc/D,WAAWqE,EAAU,CAC/BpU,SAAQ,OAAEA,QAAF,IAAEA,IAAU,GACpBmO,OAAM,OAAEA,QAAF,IAAEA,KACRrP,OACA4F,KAAMA,GAAQA,EAAK7B,OAAQ6B,EAArB,wCAA6D0P,EAA7D,YACNzb,SAAS,YAAmB,EAAjB+M,MAAkB,IAAXvF,EAAU,EAAVA,KACXA,EAAKxF,MAAOwR,EAAOhM,EAAKnD,SACtBkP,EAAQ/L,EAAK6P,YAI7BtX,MAAO,SAACsX,GAAsD,OAA7C8D,IAAcC,QAAQ,CAACpb,SAASqb,IAAoBhE,MA+CtE0D,aACAtJ,SA/JJ,SAAkBgK,GACjB,IAAD,EACI,OAAOD,EAAY,UAAC/R,EAAKO,YAAN,aAAC,EAAWK,SAAUoR,IA8JzCD,eACAhE,SA9HJ,SAAkBnN,GACVlH,GACJgY,IAAc3D,SAASnN,EAAU,CAACrK,SAAS,YAAkB,IAAhB+M,EAAe,EAAfA,MAAOvF,EAAQ,EAARA,KAChD,GAAW,UAARuF,EACC,OAAOvL,IAAMQ,MAAMwF,EAAKnD,SAE5B8W,IAAcC,QAAQ,CAACpb,SAASqb,QAyHpC/a,QACA6C,UACAgV,YAjOiC,4CAkOjCF,WACA/B,KAAMvM,GAGV,OAAO,cAACC,EAAa2T,SAAd,CAAuB5Z,MAAOwZ,EAAOxY,SAAUA,M,wLC3O7C+E,EAAciR,0BAEZ,gBAA2B,IAAzBhW,EAAwB,EAAxBA,SACb,GADqC,iBACCpC,mBAAS,OAA/C,mBAAQyH,EAAR,KAAqBwT,EAArB,KACA,EAAsCjb,mBAASmS,IAAQxU,IAAI,qBAA3D,mBAAQuG,EAAR,KAAqBgX,EAArB,KACA,EAAsClb,oBAAS,GAA/C,mBAAQsH,EAAR,KAAqB6T,EAArB,KACA,EAAsCnb,mBAAS,CAACob,KAAI,EAAOC,KAAI,IAA/D,mBAAQ3K,EAAR,KAAqB4K,EAArB,KACiBC,EAAqBxb,iBAAO,MAArCa,QACS4a,EAAqBzb,iBAAO,MAArCa,QACS6a,EAAqB1b,iBAAO,MAArCa,QACR,EAAsCZ,mBAAS,GAA/C,mBAAQ0b,EAAR,KAAiBC,EAAjB,KAgFA,SAASC,EAAQne,GACb,IAAO+M,EAAe/M,EAAf+M,MAAOvF,EAAQxH,EAARwH,KACd,GAAa,UAAVuF,EACC,GAES,MAFFvF,EAAKxF,MAGJR,IAAMQ,MAAMwF,EAAKnD,SACjByF,SAGAlJ,QAAQgI,KAAK,yBAA0BpB,GAlGlB,SAiItBsC,IAjIsB,2EAiIrC,sBAAA3C,EAAA,sDACIuN,IAAQI,IAAI,mBAAmB,MAAM,GACrCJ,IAAQI,IAAI,mBAAmB,MAAM,GACrC2I,EAAS,MACTC,GAAU,GACVlc,YAAM,cAEN2Z,IAAciD,aACdjD,IAAciD,aACdF,EAAW,GATf,4CAjIqC,+BA6ItBG,IA7IsB,2EA6IrC,sBAAAlX,EAAA,+EACW,IAAImM,SAAQ,SAACC,EAASC,GACzBlM,IAAKpH,IAAL,UAAYV,2CAAZ,aAAsD,CAACM,QAAQ,CAACwe,cAAc,UAAD,OAAW7X,MACvF1G,MAAM,SAAAC,GACH,OAAGA,QAAH,IAAGA,KAAUgC,MAAOwR,EAAOxT,GACtBuT,EAAQvT,MAEhBW,OAAM,SAAA+G,GAAG,OAAI8L,EAAO9L,UAP7B,4CA7IqC,kEAwJrC,WAA8BF,GAA9B,iBAAAL,EAAA,sEACuBkX,IADvB,UACU5c,EADV,2DAGQ8c,EAAW,GAGZ9c,EAAK4I,UAAY7C,EAAK6C,UACrBkU,EAASrY,KAAKoB,IAAKC,KAAL,UAAa/H,2CAAb,0BAAoE,CAACgI,KAAK,CAAC6C,SAAS7C,EAAK6C,WAAY,CAACvK,QAAQ,CAACwe,cAAc,UAAD,OAAW7X,OAGtJhF,EAAK4F,UAAYG,EAAKH,UACrBkX,EAASrY,KAAKoB,IAAKC,KAAL,UAAa/H,2CAAb,0BAAoE,CAACgI,KAAK,CAACH,SAASG,EAAKH,WAAY,CAACvH,QAAQ,CAACwe,cAAc,UAAD,OAAW7X,OAGtJhF,EAAKwI,QAAUzC,EAAKyC,QACnBsU,EAASrY,KAAKoB,IAAKC,KAAL,UAAa/H,2CAAb,wBAAkE,CAACgI,KAAK,CAACyC,OAAOzC,EAAKyC,SAAU,CAACnK,QAAQ,CAACwe,cAAc,UAAD,OAAW7X,OAGhJhF,EAAK8G,MAAQf,EAAKe,MACjBgW,EAASrY,KAAKoB,IAAKC,KAAL,UAAa/H,2CAAb,sBAAgE,CAACgI,KAAK,CAACe,KAAKf,EAAKe,OAAQ,CAACzI,QAAQ,CAACwe,cAAc,UAAD,OAAW7X,OAG1IhF,EAAK+I,SAAWhD,EAAKgD,SACpB+T,EAASrY,KAAKoB,IAAKC,KAAL,UAAa/H,2CAAb,yBAAmE,CAACgI,KAAK,CAAC+C,MAAM/C,EAAKgD,UAAW,CAAC1K,QAAQ,CAACwe,cAAc,UAAD,OAAW7X,OAGjJhF,EAAKgJ,WAAajD,EAAKiD,WACtB8T,EAASrY,KAAKoB,IAAKC,KAAL,UAAa/H,2CAAb,2BAAqE,CAACgI,KAAK,CAACgX,YAAYhX,EAAKiD,YAAa,CAAC3K,QAAQ,CAACwe,cAAc,UAAD,OAAW7X,OAEvI,IAApB8X,EAASrU,OA7BhB,0CA8Be1I,IAAMgD,QAAQ,qCA9B7B,iCAgCW8O,QAAQmL,IAAIF,GAClBxe,MAAK,SAAAC,GACF,GAAIA,EAAJ,CACA,IAAGA,EAAS0e,MAAK,SAAAzK,GAAC,cAAIA,QAAJ,IAAIA,OAAJ,EAAIA,EAAGjS,SAMzB,OADAR,IAAMgD,QAAQ,qBACPxE,EAJHwB,IAAMQ,MAAM,gCAMnBrB,OAAM,SAAA+G,GAAG,OAAIlG,IAAMQ,MAAN,uBAA4B0F,QA3C9C,6CAxJqC,kEAsMrC,WAA6B2C,GAA7B,SAAAlD,EAAA,+EACW,IAAImM,SAAQ,SAACC,EAASC,GACzBlM,IAAKpH,IAAL,UAAYV,2CAAZ,kBAAmD6K,EAAnD,WAAsE,CAACvK,QAAQ,CAACwe,cAAc,UAAD,OAAW7X,MACvG1G,MAAM,SAAAC,GACH,OAAGA,QAAH,IAAGA,KAAUgC,MAAOwR,EAAOxT,GACtBuT,EAAQvT,EAASiK,WAEzBtJ,OAAM,SAAA+G,GAAG,OAAI8L,EAAO9L,UAP7B,4CAtMqC,sBAWrCxE,qBAAW,WACP,SAASyb,IACL7U,IACA9K,OAAOuK,oBAAoB,SAAUoV,GAIzC,SAASC,IAA4Ff,GAAc,SAAAhV,GAAC,kCAASA,GAAT,IAAY8U,KAAI,OACpI,SAASkB,IAA4FhB,GAAc,SAAAhV,GAAC,kCAASA,GAAT,IAAY+U,KAAI,OACpI,SAASkB,IAAoBtd,YAAM,mBAAoB,CAACS,GAAG6b,EAAW/R,KAAK,eAAMhH,SAAS,MAAQ8Y,GAAc,SAAAhV,GAAC,kCAASA,GAAT,IAAY8U,KAAI,OACjI,SAASoB,IAAoBvd,YAAM,mBAAoB,CAACS,GAAG8b,EAAWhS,KAAK,eAAMhH,SAAS,MAAQ8Y,GAAc,SAAAhV,GAAC,kCAASA,GAAT,IAAY+U,KAAI,OAQrI,OAbI5e,OAAOW,iBAAiB,SAAUgf,GAOlCxD,IAAcmB,GAAGnB,IAAa6D,gBAAsBJ,GACpDzD,IAAcmB,GAAGnB,IAAa6D,gBAAsBH,GACpD1D,IAAcmB,GAAGnB,IAAa8D,mBAAsBH,GACpD3D,IAAcmB,GAAGnB,IAAa8D,mBAAsBF,GACpD5D,IAAcmB,GAAGnB,IAAa+D,MAAsBf,GAEjD,WACHhD,IAAc6B,IAAI7B,IAAa6D,gBAAqBJ,GACpDzD,IAAc6B,IAAI7B,IAAa6D,gBAAqBF,GACpD3D,IAAc6B,IAAI7B,IAAa8D,mBAAqBJ,GACpD1D,IAAc6B,IAAI7B,IAAa8D,mBAAqBF,GACpD5D,IAAc6B,IAAI7B,IAAa+D,MAAqBf,GAEpDQ,OAED,IAGHzb,qBAAW,YACH+P,EAAY0K,KAAOlX,GACnB0U,IAAcgE,QAAQ3f,0CAA+BiH,KAE1D,CAACwM,EAAY0K,IAAKlX,IAErBvD,qBAAW,YACH+P,EAAY2K,KAAOnX,GACnB,sBAAC,sBAAAU,EAAA,sEACmBkX,IACfte,MAAM,SAACC,GAGJ,OADAwd,EAAQxd,GACDA,KALd,cAOGmb,IAAcgE,QAAQ3f,wCAA+BiH,GAPxD,0CAAD,KAUL,CAACwM,EAAY2K,IAAKnX,IAErBvD,qBAAW,WACJ+P,EAAY2K,KAAO3K,EAAY0K,KAAOlX,IAAUoD,IAE/CmU,EAAYxc,IAAMiD,QAAN,wBAAuC,CAACM,SAASqa,MAC7Df,IACCte,MAAM,SAACC,GACJwB,IAAMgD,QAAN,kBAAyBxE,EAASuI,MAAQ,CAACtG,GAAG+b,EAAWjS,KAAK,SAAKhH,SAAS,MAC5EyY,EAAQxd,GACR0d,GAAU,MAEb/c,OAAO,YAAuB,IAArBqB,EAAoB,EAApBA,MAAOqC,EAAa,EAAbA,QACb7C,IAAMQ,MAAN,0BAA+BA,EAA/B,cAA0CqC,GAAW,CAACpC,GAAG+b,EAAWjS,KAAK,eAAMhH,SAAS,MACrFkZ,GAAW,EAAGnU,IAGbtI,aAAM,SAAC6d,GACH,MAA0B9c,mBAAsB,KAAb8c,EAAEta,UAArC,mBAAO0O,EAAP,KAAc6L,EAAd,KAIA,OAHApc,qBAAW,WAAM,IAAMqc,EAAcxe,aAAY,kBAAIue,GAAS,SAAA7O,GAAC,OAAEyB,KAAKC,IAAI,EAAE1B,EAAE,QAAK,KAC/E,OAAO,WAAM+O,cAAcD,GAAiBrB,GAAW,SAAArV,GAAC,OAAIA,EAAE,QAC9D,IACG,+BAAiB,IAAV4K,EAAA,iCAAwCA,EAAxC,YAChB,CAAC1O,SAAS,YAI1B,CAACkO,EAAY2K,KAAO3K,EAAY0K,IAAKlX,EAAOoD,EAAUoU,IA2HxD,IAAMd,EAAQne,OAAOyK,KAAO,CACxBO,OACCH,WACDoJ,YAAaA,EAAY0K,KAAO1K,EAAY2K,IAC5ChJ,MA9GJ,SAAerK,EAAOlD,GAClB,IAAM3F,EAAUF,IAAMiD,QAAQ,iBAG9B,OAFA8F,EAAQA,EAAMuI,cACd2K,EAAS,MACFnW,IAAKC,KAAL,UAAa/H,2CAAb,eAAyD,CAACgI,KAAK,CAAE+C,QAAOlD,cAC9EtH,KADM,uCACD,WAAMC,GAAN,mBAAAmH,EAAA,yDACEnH,EADF,8DAKS,OAARA,QAAQ,IAARA,KAAUgC,OAAS,OAAChC,QAAD,IAACA,MAAUyG,MAL/B,8BAOiB,CAACzG,EAASqE,SAASob,QAPpC,IAOE,IAAI,EAAJ,qBAAQC,EAAR,QACIle,IAAMQ,MAAN,yBAA8B0d,IARpC,qCASEle,IAAMme,QAAQje,GACd+F,WAAWqC,EAAO,KAVpB,kBAWS,MAXT,cAaFtI,IAAMgD,QAAQ,gBAAiB,CAAEvC,GAAIP,IACrC+b,EAASzd,EAASyG,OAdhB,kBAgBKzG,EAASyG,OAhBd,4CADC,uDAmBN9F,OAAM,SAAA+G,GAAG,OAAIlG,IAAMQ,MAAN,uBAA4B0F,GAAO,CAAEzF,GAAIP,QAwFvDoI,SACAuU,cACArC,cAxNiC,4CAyNjC4D,eAzNiC,6CA4NrC,OAAO,cAAClW,EAAY6T,SAAb,CAAsB5Z,MAAOwZ,EAA7B,SACFxY,M,4GChOM,gBAA0B,IAAxBA,EAAuB,EAAvBA,SAAYvC,EAAW,iBACpC,OAAO,cAAC,IAAD,aAAeuC,SAAUA,EAASkb,WAAW,KAAK,IAAKC,cAAe,CAACC,IAAWC,KAAeC,cAAe,CAACC,MAAgB9d,M,oBCN5I,IAAIsJ,EAAM,CACT,gBAAiB,CAChB,IACA,GAED,gBAAiB,CAChB,IACA,EACA,GAED,aAAc,CACb,IACA,EACA,GAED,eAAgB,CACf,IACA,GAED,eAAgB,CACf,IACA,IAGF,SAASyU,EAAoBC,GAC5B,IAAIC,EAAoBnX,EAAEwC,EAAK0U,GAC9B,OAAO9M,QAAQC,UAAUxT,MAAK,WAC7B,IAAImH,EAAI,IAAIgY,MAAM,uBAAyBkB,EAAM,KAEjD,MADAlZ,EAAEoZ,KAAO,mBACHpZ,KAIR,IAAIqZ,EAAM7U,EAAI0U,GAAMne,EAAKse,EAAI,GAC7B,OAAOjN,QAAQmL,IAAI8B,EAAIC,MAAM,GAAG9U,IAAI2U,EAAoBnZ,IAAInH,MAAK,WAChE,OAAOsgB,EAAoBpe,MAG7Bke,EAAoBjP,KAAO,WAC1B,OAAOD,OAAOC,KAAKxF,IAEpByU,EAAoBle,GAAK,IACzBwe,EAAOC,QAAUP,G,mGC9BFQ,EAZS,SAACC,GACnBA,GAAeA,aAAuBC,UACxC,+BAAqB9gB,MAAK,YAAkD,IAA/C+gB,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAQN,O,kCCEdO,IAASC,OACP,cAAC,IAAMC,WAAP,UACI,cAAC,IAAMC,SAAP,CAAgB3c,SAAU,cAAC,IAAD,IAAW4c,SAAU,cAACC,EAAA,EAAD,CAAane,UAAU,WAAWoe,UAAQ,EAACC,IAAK,UAEnG7W,SAASG,eAAe,SAW1B2V,K,6DCvBIrZ,EAAO,CACPpH,IAAI,WAAD,4BAAE,WAAe8P,GAAf,+BAAA7I,EAAA,6DAAoB7C,EAApB,+BAA8B,GACzBxE,EAAUmR,OAAO0Q,OAAO,CAC1B,eAAgB,oBADJ,UAEbrd,EAAQxE,eAFK,QAEM,IAHrB,kBAKMD,MAAMmQ,EAAK,CAAC4R,OAAQ,MAAM9hB,YAChCC,MAAK,SAAAC,GAAQ,OAAIA,EAAS6hB,UAC1BlhB,OAAM,SAAAqB,GAAK,OAAIpB,QAAQ2D,MAAMvC,OAP7B,2CAAF,mDAAC,GAUJuF,KAAK,WAAD,4BAAE,WAAeyI,GAAf,mCAAA7I,EAAA,6DAAoB7C,EAApB,+BAA8B,GAC1BxE,EAAUmR,OAAO0Q,OAAO,CAC1B,eAAgB,oBADJ,UAEbrd,EAAQxE,eAFK,QAEM,IAEhBuP,EAAOK,KAAKC,UAAL,UAAerL,EAAQkD,YAAvB,QAA+B,IAL1C,kBAOK3H,MAAMmQ,EAAK,CAAC4R,OAAQ,OAAO9hB,UAAQuP,SACzCtP,MAAK,SAAAC,GAAQ,OAAKA,EAAS6hB,UAC3BlhB,OAAM,SAAAqB,GAAK,OAAIpB,QAAQ2D,MAAMvC,OAT5B,2CAAF,mDAAC,IAaMsF,O,gKCpBFzE,EAAe8X,0BACb,gBAA2B,IAAzBhW,EAAwB,EAAxBA,SAEEmd,GAFsB,iBAEExf,iBAAO,GAAvCa,SACD4e,EAAiCzf,iBAAO,MAC9C,EAAuCC,oBAAS,GAAhD,mBAAOjC,EAAP,KAAcwa,EAAd,KACA,EAAuCvY,mBAAS,MAAhD,mBAAOyf,EAAP,KAAiBC,EAAjB,KACA,EAAuC1f,mBAAS,MAAhD,mBAAOS,EAAP,KAAiBkf,EAAjB,KACA,EAAuC3f,mBAAS,MAAhD,mBAAO4f,EAAP,KAAoBC,EAApB,KACA,EAAqCnZ,sBAAY,SAACtF,EAAO0e,GAGrD,OAFIN,GAAYA,EAAS5e,UACrB4e,EAAS5e,QAAQC,UAAYif,GAC1BA,IACRlH,IAAgBmH,aAJnB,mBAAKzQ,EAAL,KAAkB0Q,EAAlB,KA4DA,SAASC,IACLrH,IAAiBqH,aAGrB,SAASC,EAAT,GACC,IAD0BN,EAC3B,EAD2BA,YAAanf,EACxC,EADwCA,SAEpCkf,EAAY,eAAIlf,IAChBof,EAAeD,GAGnB,SAASO,EAAT,GACC,IADsClgB,EACvC,EADyBmgB,aAAmChU,EAC5D,EAD8CiU,aAAqB5f,EACnE,EADmEA,SAE/Dkf,EAAY,eAAIlf,IAChBif,EAAW,2BAAID,GAAL,IAAcxf,QAAOmM,WAGnC,SAASkU,EAAT,GACC,IADqB3gB,EACtB,EADsBA,OAAQc,EAC9B,EAD8BA,SAE1BhE,OAAOie,aAAaC,QAAQ,QAA5B,OAAqCla,QAArC,IAAqCA,OAArC,EAAqCA,EAAUR,OAC/CxD,OAAOie,aAAaC,QAAQ,QAA5B,OAAqCla,QAArC,IAAqCA,OAArC,EAAqCA,EAAU2L,OAC/C3P,OAAO6S,YAAcA,EAAc3P,EACnCggB,EAAY,eAAIlf,IAChBuf,EAAe1Q,GAGnB,SAASsM,EAAT,GAAmC,IAAjBnc,EAAgB,EAAhBA,MAAOqC,EAAS,EAATA,QACrB7C,IAAMQ,MAAN,UAAeA,EAAf,aAAyBqC,IAhF7BnB,qBAAW,WAyCP,SAASyb,IACLxD,IAAiB6B,IAAI7B,IAAe2H,UAAgBD,GACpD1H,IAAiB6B,IAAI7B,IAAe4H,WAAgBL,GACpDvH,IAAiB6B,IAAI7B,IAAe6H,YAAgB7E,GACpDhD,IAAiB6B,IAAI7B,IAAe8H,aAAgB9E,GACpDhD,IAAiB6B,IAAI7B,IAAe+H,eAAgBT,GACpDzjB,OAAOuK,oBAAoB,UAAWoV,GAG9C,OA/CI,sBAAC,8BAAAxX,EAAA,6DACGgU,IAAiBmB,GAAGnB,IAAe4H,WAAqBL,GACxDvH,IAAiBmB,GAAGnB,IAAe6H,YAAqB7E,GACxDhD,IAAiBmB,GAAGnB,IAAe8H,aAAqB9E,GACxDhD,IAAiBmB,GAAGnB,IAAe+H,eAAqBT,GAJ3D,SAMyBtH,IAAiBgI,QAN1C,0DAQc3hB,IAAMQ,MAAM,oCAR1B,cAWOQ,EAAQxD,OAAOie,aAAaI,QAAQ,SACpC1O,EAAQ3P,OAAOie,aAAaI,QAAQ,SAZ3C,UAcS,IAAI/J,SAAQ,SAACC,EAASC,GAKxB2H,IAAiBmB,GAAGnB,IAAe2H,WAJnC,SAASM,EAASlP,GACdiH,IAAiB6B,IAAI7B,IAAe2H,UAAWM,GAC/C7P,EAAQW,MAGZiH,IAAiBkI,SAAS1U,MAE7B5O,KAAK8iB,GAtBT,yBAwBS,IAAIvP,SAAQ,SAACC,EAASC,GAMxB2H,IAAiBmB,GAAGnB,IAAe2H,WALnC,SAASM,EAASlP,GACdiH,IAAiB6B,IAAI7B,IAAe2H,UAAWM,GAC/CjI,IAAiBmB,GAAGnB,IAAe2H,UAAWD,GAC9CtP,EAAQW,MAGZiH,IAAiBmI,SAAS9gB,MAE7BzC,KAAK8iB,GAjCT,QAmCG/H,GAAS,GAnCZ,2CAAD,GA8CA9b,OAAOW,iBAAiB,UAAcgf,GACnC,WACHA,OACA,IA4DJ,IAAMxB,EAAQne,OAAO2D,MAAQ,CACzBqf,UACAhf,WACAmf,cACAtQ,cACA0R,KAlCJ,WACQzB,GAAa,GAGbU,MAEFV,GA6BF0B,KA1BJ,aACM1B,GA0BFU,aACAa,SApBJ,SAAkBI,EAAQC,GACtBvI,IAAiBkI,SAASI,EAAQC,IAoBlCJ,SAjBJ,SAAkBG,GACdtI,IAAiBmI,SAASG,IAiB1B/gB,QAdJ,SAAiBO,GACb0gB,KAAK3gB,SAASC,KAAOA,GAcrB3C,SAGJ,OAAO,cAACuC,EAAa0a,SAAd,CAAuB5Z,MAAOwZ,EAAOxY,SAAUA,M,0SC/IpDif,EAAc,gEAEPC,EACb,CACC7E,gBAAwB,mBACxBC,mBAAwB,sBACrBC,MAAwB,QACxB4E,aAAwB,gBACxBC,aAAwB,gBACxBC,aAAwB,gBACxBC,WAAwB,cACxBC,WAAwB,cACxBC,WAAwB,eAiqBrB,SAASC,EAASpX,EAAQE,EAAQD,EAAQoX,GAG7C,IAAIC,EAAa,KACbC,EAAa,GACbC,EAAW,GACXC,GAAY,EA2DZC,EAAQ,uCAAG,4BAAAvd,EAAA,yDAENmd,EAFM,wDAOPK,EAAY,CAAE3X,OAAQA,EAAQE,OAAQA,EAAQD,OAAQA,GAP/C,SASEqX,EAAWI,SAAS,MAAM3kB,MAAK,SAAU6kB,GAGlD,IAAIC,EAAY,KAgChB,OA/BAD,EAAME,SAAQ,SAAAC,GAGU,mBAAhBA,EAAO9c,OAAkD,IAApB8c,EAAOzT,UAAsC,cAAjByT,EAAOzjB,QAExEujB,EAAYE,MAKhBF,GAEAD,EAAME,SAAQ,SAAAC,GAGV,MAOA,EARIA,EAAO9iB,KAAO4iB,EAAUG,mBAExBL,EAAUM,UAAYF,EAAOG,cAC7BP,EAAUQ,aAAV,UAAyBJ,EAAOK,eAAhC,QAA2CL,EAAOM,GAClDV,EAAUW,UAAYP,EAAOQ,KAC7BZ,EAAUa,cAAgBT,EAAOU,UAEjCV,EAAO9iB,KAAO4iB,EAAUa,oBAExBf,EAAUgB,WAAaZ,EAAOG,cAC9BP,EAAUiB,cAAV,UAA0Bb,EAAOK,eAAjC,QAA4CL,EAAOM,GACnDV,EAAUkB,WAAad,EAAOQ,KAC9BZ,EAAUmB,eAAiBf,EAAOU,aAKvCnS,QAAQC,QAAQoR,MA5ChB,mFAAH,qDAqbZ,MAAO,CACC3X,aAAW,OAAOA,GAClBE,aAAW,OAAOA,GAClBD,aAAW,OAAOA,GAClBoX,iBAAe,OAAOA,GAC1B0B,KA9eO,SAAUC,EAAgBC,GAEjC,OAAMD,aAA0BE,oBAMhCzB,EAAYwB,GADZ3B,EAAa0B,GAIFrmB,iBAAiB,eAAe,SAAUoN,GAEjDyX,EAASzX,EAAMoZ,QAAQ/d,OAAS2E,EAAMoZ,QAGtCpZ,EAAMoZ,QAAQxmB,iBAAiB,WAAW,SAAUoN,UAEzCyX,EAASzX,EAAMoZ,QAAQ/d,cAI/B,IAydPxG,MAndQ,WACZ,MACc,QAAV,EAAA0iB,SAAA,SAAY1iB,SAkdZqkB,YA5cc,WAEd,OAAOxB,GA2cP2B,SArcW,WAEX,OAAQ9B,EAAcA,EAAW+B,mBAAqB,UAoctD3B,WACA4B,aA5Ye,SAAUC,GAEpBjC,EAMDA,EAAWkC,gBAAgBD,GAJ3BhC,EAAWre,KAAKqgB,IAyYpBE,wBA9X0B,WAEtBlC,EAAWra,OAAS,IAEpBqa,EAAWO,SAAQ,SAAAyB,GAAS,OAAIjC,EAAWkC,gBAAgBD,MAC3DhC,EAAa,KA0XjBmC,qBAnXuB,SAAUlI,GAEjC,QAAK8F,IAKLA,EAAWoC,qBAAqBlI,IAEzB,IA2WPmI,aAlWe,SAAUC,GAEzB,IAAKtC,EAED,OAAO,EAGX,IAAIuC,EAAUvC,EAAWwC,aACzB,IAAKD,EAED,OAAO,EAGX,IAAK,IAAIxO,EAAI,EAAGA,EAAIwO,EAAQ3c,OAAQmO,IACpC,CACI,IAAI0O,EAASF,EAAQxO,GACjB2O,EAAaD,EAAOE,gBACnBD,EAAWE,YAEZF,EAAWE,UAAY,CAAC,KAG5BF,EAAWE,UAAU,GAAGC,WAAyB,IAAZP,EAErCG,EAAOK,cAAcJ,GAGzB,OAAO,GAwUPK,oBAlUsB,WAC1B,IADqCC,EACrC,uDAD6C,EAEzC,IAAKhD,EAED,OAAO,KAGX,IAAIiD,EAAYjD,EAAWkD,eAC3B,IAAKD,EAED,OAAO,KAIX,IADA,IAAIE,EAAS,GACJpP,EAAI,EAAGA,EAAIkP,EAAUrd,OAAQmO,IACtC,CACI,IAAIqP,EAAWH,EAAUlP,GACG,UAAxBqP,EAAStN,MAAMuN,MAEfF,EAAOvhB,KAAKwhB,EAAStN,OAI7B,OAAIkN,GAAS,GAAKA,EAAQG,EAAOvd,OAEtBud,EAAOH,GAGX,MAuSPM,oBAjSsB,WAC1B,IADqCN,EACrC,uDAD6C,EAEzC,IAAKhD,EAED,OAAO,KAGX,IAAIiD,EAAYjD,EAAWkD,eAC3B,IAAKD,EAED,OAAO,KAIX,IADA,IAAIE,EAAS,GACJpP,EAAI,EAAGA,EAAIkP,EAAUrd,OAAQmO,IACtC,CACI,IAAIqP,EAAWH,EAAUlP,GACG,UAAxBqP,EAAStN,MAAMuN,MAEfF,EAAOvhB,KAAKwhB,EAAStN,OAI7B,OAAIkN,GAAS,GAAKA,EAAQG,EAAOvd,OAEtBud,EAAOH,GAGX,MAsQPO,gBAhQkB,WAElB,IAAKvD,EAED,OAAO,KAGX,IAAIiD,EAAYjD,EAAWkD,eAC3B,IAAKD,EAED,OAAO,KAIX,IADA,IAAIE,EAAS,GACJpP,EAAI,EAAGA,EAAIkP,EAAUrd,OAAQmO,IACtC,CACI,IAAIqP,EAAWH,EAAUlP,GACrBqP,EAAStN,OAETqN,EAAOvhB,KAAKwhB,EAAStN,OAI7B,GAAsB,IAAlBqN,EAAOvd,OAEP,OAAO,KAIX,IADA,IAAIhI,EAAS,IAAI4lB,YACRzP,EAAI,EAAGA,EAAIoP,EAAOvd,OAAQmO,IACnC,CACI,IAAI+B,EAAQqN,EAAOpP,GACnBnW,EAAO6lB,SAAS3N,GAGpB,OAAOlY,GA8NP8lB,uBAxNyB,SAAU5N,GACvC,IAD8CkN,EAC9C,uDADsD,EAElD,IAAKhD,IAAelK,EAEhB,OAAO,EAKX,IAFA,IAAI6N,EAAe,GACfpB,EAAUvC,EAAWwC,aAChBzO,EAAI,EAAGA,EAAIwO,EAAQ3c,OAAQmO,IACpC,CACI,IAAI0O,EAASF,EAAQxO,GACjB0O,EAAO3M,OAA+B,UAAtB2M,EAAO3M,MAAMuN,MAE7BM,EAAa/hB,KAAK6gB,GAI1B,OAAIO,GAAS,GAAKA,EAAQW,EAAa/d,SAEnC+d,EAAaX,GAAOY,aAAa9N,IAC1B,IAoMX+N,uBA3LyB,SAAU/N,GACvC,IAD8CkN,EAC9C,uDADsD,EAElD,IAAKhD,IAAelK,EAEhB,OAAO,EAKX,IAFA,IAAIgO,EAAe,GACfvB,EAAUvC,EAAWwC,aAChBzO,EAAI,EAAGA,EAAIwO,EAAQ3c,OAAQmO,IACpC,CACI,IAAI0O,EAASF,EAAQxO,GACjB0O,EAAO3M,OAA+B,UAAtB2M,EAAO3M,MAAMuN,MAE7BS,EAAaliB,KAAK6gB,GAI1B,OAAIO,GAAS,GAAKA,EAAQc,EAAale,SAEnCke,EAAad,GAAOY,aAAa9N,IAC1B,IAuKXiO,YA5Jc,SAAUjgB,GAExB,IAAKkc,GAAclc,KAASoc,EAExB,OAAO,EAGX,IAAI2B,EAAU7B,EAAWgE,kBAAkBlgB,GAS3C,OARAoc,EAASpc,GAAS+d,EAGlBA,EAAQxmB,iBAAiB,WAAW,SAAUoN,UAEnCyX,EAAS2B,EAAQ/d,WAGrB,GA6IPmgB,aAvIe,SAAUngB,GAEzB,SAAKkc,KAAgBlc,KAASoc,MAKhBA,EAASpc,GACfxG,eACD4iB,EAASpc,IAET,IA6HPogB,cAvHgB,SAAUvd,GAE1B,QAAKqZ,IAKLA,EAAW3kB,iBAAiB,cAAesL,IAEpC,IA+GPwd,cAzGgB,SAAUrgB,EAAO6C,GAEjC,SAAKqZ,GAAgBlc,KAASoc,GAAevZ,aAAoB4V,YAKnD2D,EAASpc,GACfsgB,OAASzd,GAEV,IAgGP0d,eA1FiB,SAAUvgB,EAAO6C,GAElC,SAAKqZ,GAAgBlc,KAASoc,GAAevZ,aAAoB4V,YAKnD2D,EAASpc,GACfzI,iBAAiB,UAAWsL,IAE7B,IAiFP2d,eA3EiB,SAAUxgB,EAAO6C,GAElC,SAAKqZ,GAAgBlc,KAASoc,GAAevZ,aAAoB4V,YAKnD2D,EAASpc,GACfwL,QAAU3I,GAEX,IAkEP4d,iBA5DmB,SAAUzgB,EAAO6C,GAEpC,SAAKqZ,GAAgBlc,KAASoc,GAAevZ,aAAoB4V,YAKnD2D,EAASpc,GACf0gB,UAAY7d,GAEb,IAmDP8d,SA7CW,SAAU3gB,EAAOZ,GAE5B,IAAK8c,KAAgBlc,KAASoc,GAE1B,OAAO,EAGX,IAAI2B,EAAU3B,EAASpc,GACvB,MAA2B,SAAvB+d,EAAQ6C,aAKZ7C,EAAQ8C,KAAKzhB,IAEN,KChqCf,IACMoc,EAAc,iEAEPsF,EACb,CACIlK,gBAAwB,mBACxBC,mBAAwB,sBACxBC,MAAwB,QACxBiK,WAAwB,cACxBC,YAAwB,eACxB3M,YAAwB,eACxBC,YAAwB,eACxBF,gBAAwB,oBACxBD,cAAwB,kBACxBI,aAAwB,gBACxBC,WAAwB,cACxBC,SAAwB,a,mCChBtB+G,EAAc,gEAEPyF,EACb,CACCtG,WAAoB,cACpBE,aAAoB,gBACjBC,eAAoB,kBACpBJ,UAAoB,aACpBE,YAAoB,gBAgiBjB,SAASsG,IAEZ,IAAIC,EAAe,IAAIC,aAEnBC,EAAWF,EAAaG,aACxBC,EAAiBJ,EAAaK,mBAClCD,EAAexK,QAAQsK,GACvB,IAAII,EAAcJ,EAAStK,QAAQoK,EAAaO,gCAMhD,OAJAL,EAASM,KAAKC,eAAe,EAAGT,EAAaU,aAC7CN,EAAexG,QAEF0G,EAAY3nB,OAItB,SAASgoB,IAChB,IAD6BlmB,EAC7B,uDADqC,IAAKC,EAC1C,uDADmD,IAAKkmB,EACxD,uDADoE,EAE5Dvb,EAAS5P,OAAO6L,SAASgE,cAAc,UAC3CD,EAAO5K,MAAQA,EACf4K,EAAO3K,OAASA,EAEhB,IAAImmB,EAAUxb,EAAOI,WAAW,MAC5Bqb,EAAW,KACf,SAASjJ,IAEAgJ,EAMLA,EAAQnQ,SAAS,EAAG,EAAGjW,EAAOC,GAJ1BjF,OAAOwgB,cAAc6K,GAU7BA,EAAWrrB,OAAO+B,YAAYqgB,EAAS,EAAI+I,EAAa,KAExD,IAAIjoB,EAAS0M,EAAO0b,gBACpB,OAAOpoB,EC3kBX,IAAMqoB,EAAK,UAAG/qB,SAAH,EAEPgrB,EAAexrB,OAAOwrB,UAAe,IFWlC,WAEH,IAAIC,EAAY,GACZC,EAAS,GAETjkB,EAAQ,KACRkkB,EAAS,KACTC,EAAmB,KA0DnBC,EAAO,SAAU9d,GAEjB,IAAiD,GAA7CkE,OAAOkC,OAAO+V,GAAY9oB,QAAQ2M,GAElC,OAAO,EAGX,IAAI+d,EAAO,GAAGtK,MAAMuK,KAAKC,UAAW,GAEpC,GAA6B,kBAAlBN,EAAO3d,GAGd,IADA,IAAIke,EAAYP,EAAO3d,GAAOyT,QACrBnI,EAAI,EAAGA,EAAI4S,EAAU/gB,OAAQmO,IAElC4S,EAAU5S,GAAG6S,MAAMvH,KAAMmH,GAIjC,OAAO,GA2BPK,EAAS,SAAUpe,GAEnBnM,QAAQC,IAAI,gBAA2B+iB,EAAa+G,EAAO3a,KAC3Dob,IACAP,EAAK3B,EAAWlK,gBAAiB,CAAEhP,IAAK2a,EAAO3a,OAM/Cqb,EAAU,SAAUte,GAEpBnM,QAAQC,IAAI,mBAA8B+iB,EAAa+G,EAAO3a,KAC9Dsb,IACAT,EAAK3B,EAAWjK,mBAAoB,CAAEjP,IAAK2a,EAAO3a,OAMlDoM,EAAY,SAAUsD,GAEtB,IAAIrb,EAAUqL,KAAK4N,MAAMoC,EAAIlY,MAC7B,GAAsB,SAAlBnD,EAAQ0I,MAAZ,CAQA,GAHAnM,QAAQC,IAAI,UAAgB+iB,EAAavf,EAAQ0I,MAAO1I,EAAQmD,MAG5DnD,EAAQmD,KAAK+jB,QAAQd,EACzB,CACI,IAAIzqB,EAAWyqB,EAAUpmB,EAAQmD,KAAK+jB,MAItC,cAHOd,EAAUpmB,EAAQmD,KAAK+jB,aACvBlnB,EAAQmD,KAAK+jB,UACpBvrB,EAASqE,GAKbwmB,EAAKxmB,EAAQ0I,MAAO1I,KAMpB8T,EAAc,SAAU9T,EAASrE,GAEjC,IAAK2qB,GAAUA,EAAO3B,aAAewC,UAAUC,KAE3C,OAAO,EAIXpnB,EAAQmD,KAAKf,MAAQA,EAGrBpC,EAAQmD,KAAK+jB,KAAOA,IAGhBvrB,aAAoB6gB,WAEpB4J,EAAUpmB,EAAQmD,KAAK+jB,MAAQvrB,GAInC,IAAI0f,EAAMhQ,KAAKC,UAAUtL,GAOzB,OANAsmB,EAAO1B,KAAKvJ,GACU,SAAlBrb,EAAQ0I,OAERnM,QAAQC,IAAI,UAAgB+iB,EAAavf,EAAQ0I,MAAO2S,IAGrD,GAMP0L,EAAiB,SAAjBA,IAEKT,GAAUA,EAAO3B,aAAewC,UAAUC,OAK/CC,IAEAd,EAAmB5rB,OAAOyI,WAAW2jB,EA1NzB,OAgOZE,EAAgB,WAEhBtsB,OAAO8U,aAAa8W,IAMpBc,EAAO,WAOP,OAAOvT,EAJP,CACIpL,MAAO,OACPvF,KAAM,MA4HV+jB,EAAO,WAEP,OAAOI,KAOPA,EAAS,WAET,OAAQ,CAAC,MAAM,KAAK,KAAK,KAAK,MAAMC,QAAQ,UAAU,SAAAC,GAAC,OACpDA,EAAIC,OAAOC,gBAAgB,IAAIC,WAAW,IAAI,GAAK,IAAMH,EAAI,GAAGI,SAAS,QAIhF,MAAO,CACH3P,GA3VK,SAAUvP,EAAOmf,GAEtB,OAAiD,GAA7Cjb,OAAOkC,OAAO+V,GAAY9oB,QAAQ2M,KAKhCmf,aAAoBrL,WAKG,kBAAlB6J,EAAO3d,KAEd2d,EAAO3d,GAAS,IAGpB2d,EAAO3d,GAAO7G,KAAKgmB,IAEZ,KAyUPlP,IAnUM,SAAUjQ,EAAOmf,GAEvB,IAAiD,GAA7Cjb,OAAOkC,OAAO+V,GAAY9oB,QAAQ2M,GAElC,OAAO,EAGX,KAAMmf,aAAoBrL,UAEtB,OAAO,EAGX,GAA6B,kBAAlB6J,EAAO3d,GAClB,CACI,IAAIua,EAAQoD,EAAO3d,GAAO3M,QAAQ8rB,GAClC,GAAI5E,GAAS,EAGT,OADAoD,EAAO3d,GAAOof,OAAO7E,EAAO,IACrB,EAIf,OAAO,GA8SPnI,QAhRU,SAAUnP,EAAKoc,GAEzB3lB,EAAQ2lB,GACRzB,EAAS,IAAIa,UAAUxb,EAAM,UAAYvJ,IAElCiiB,OAASyC,EAChBR,EAAO7B,UAAY1M,EACnBuO,EAAO0B,QAAUhB,GA0QjBjN,WApQa,WACjB,MACU,QAAN,EAAAuM,SAAA,SAAQ/oB,SAmQRwZ,QAxIU,WACd,IADwB9W,EACxB,uDADkC,GAE1Bob,EACJ,CACI3S,MAAO,WACPvF,KAAM,IAEV,OAAO2Q,EAAYuH,EAAD,OAAMpb,QAAN,IAAMA,OAAN,EAAMA,EAAStE,WAkIjCsb,SA3HW,WACf,IADyBhX,EACzB,uDADmC,GAE3Bob,EACJ,CACI3S,MAAO,YACPvF,KAAM,IAEV,OAAO2Q,EAAYuH,EAAD,OAAMpb,QAAN,IAAMA,OAAN,EAAMA,EAAStE,WAqHjCoX,WA9Ga,SAAU7O,GAC3B,IADiCjE,EACjC,uDAD2C,GAEnCob,EACJ,CACI3S,MAAO,cACPvF,KACA,CACIe,KAAMA,EACNlB,SAAQ,OAAE/C,QAAF,IAAEA,OAAF,EAAEA,EAAS+C,SACnBmO,OAAM,OAAElR,QAAF,IAAEA,OAAF,EAAEA,EAASkR,OACjBrP,KAAI,OAAE7B,QAAF,IAAEA,OAAF,EAAEA,EAAS6B,KACf4F,KAAI,OAAEzH,QAAF,IAAEA,OAAF,EAAEA,EAASyH,OAGvB,OAAOoM,EAAYuH,EAAD,OAAMpb,QAAN,IAAMA,OAAN,EAAMA,EAAStE,WAiGjC6V,SA1FW,SAAUtN,GACzB,IAD+BjE,EAC/B,uDADyC,GAEjCob,EACJ,CACI3S,MAAO,YACPvF,KACA,CACIe,KAAMA,EACNlB,SAAQ,OAAE/C,QAAF,IAAEA,OAAF,EAAEA,EAAS+C,WAG3B,OAAO8Q,EAAYuH,EAAD,OAAMpb,QAAN,IAAMA,OAAN,EAAMA,EAAStE,WAgFjCuX,UAzEY,WAChB,IAD0BjT,EAC1B,uDADoC,GAE5Bob,EACJ,CACI3S,MAAO,aACPvF,KAAM,IAEV,OAAO2Q,EAAYuH,EAAD,OAAMpb,QAAN,IAAMA,OAAN,EAAMA,EAAStE,WAmEjCwX,SA5DW,SAAUzO,GACzB,IADiCzE,EACjC,uDAD2C,GAEnCob,EACJ,CACI3S,MAAO,YACPvF,KACA,CACIuB,OAAQA,IAGhB,OAAOoP,EAAYuH,EAAD,OAAMpb,QAAN,IAAMA,OAAN,EAAMA,EAAStE,WAmDjCqc,SA5CW,SAAU1D,GACzB,IAD+BrU,EAC/B,uDADyC,GAEjCob,EACJ,CACI3S,MAAO,YACPvF,KACA,CACImR,KAAMA,IAGd,OAAOR,EAAYuH,EAAD,OAAMpb,QAAN,IAAMA,OAAN,EAAMA,EAAStE,YE1VA,CAAgB,CAAEiB,MAAOspB,IAC9D+B,EAAettB,OAAOstB,aAAe,IDElC,WAEH,IAAI5B,EAAS,GAET6B,EAAc,KACdC,EAAc,KACdC,EAAc,KAEd9J,EAAe,GACfC,EAAe,GAEfT,EACJ,CACI,KAAgB,GAChB,UAAgB,CAAEne,MAAO,IAAKC,OAAQ,KACtC,UAAgB,CAAED,MAAO,IAAKC,OAAQ,KACtC,UAAgB,CAAED,MAAO,IAAKC,OAAQ,KACtC,WAAgB,CAAED,MAAO,KAAMC,OAAQ,KACvC,YAAgB,CAAED,MAAO,KAAMC,OAAQ,MACvC,YAAgB,CAAED,MAAO,KAAMC,OAAQ,MACvC,YAAgB,CAAED,MAAO,KAAMC,OAAQ,MACvC,YAAgB,CAAED,MAAO,KAAMC,OAAQ,MACvC,YAAgB,CAAED,MAAO,KAAMC,OAAQ,OAIvCyoB,EACJ,CACIlqB,MACA,CACImqB,SAAU,CAAEjnB,WAAO3C,KAIvB6pB,EACJ,CACIje,MACA,CACIge,SAAY,CAAEjnB,WAAO3C,GACrBiB,MAAY,CAAE0B,WAAO3C,GACrBkB,OAAY,CAAEyB,WAAO3C,GACrBonB,UAAY,CAAE0C,MAAO,MAIzB7pB,EACJ,CACIR,MAAgB,OAChBmM,MAAgB,OAChB+U,WAAgB,QAGhBoJ,EAA2B,KAC3BC,EAA2B,KA0D3BlC,EAAO,SAAU9d,GAEjB,IAAkD,IAA9CkE,OAAOkC,OAAOkW,GAAYjpB,QAAQ2M,GAElC,OAAO,EAGX,IAAI+d,EAAO,GAAGtK,MAAMuK,KAAKC,UAAW,GAEpC,GAA6B,kBAAlBN,EAAO3d,GAGd,IADA,IAAIke,EAAYP,EAAO3d,GAAOyT,QACrBnI,EAAI,EAAGA,EAAI4S,EAAU/gB,OAAQmO,IAElC4S,EAAU5S,GAAG6S,MAAMvH,KAAMmH,GAIjC,OAAO,GAMP3H,EAAK,uCAAG,sBAAAhc,EAAA,yDAEH7H,UAAU0tB,cAAiB1tB,UAAU0tB,aAAaC,iBAF/C,uBAIJrsB,QAAQoB,MAAM,kDAJV,mBAKG,GALH,cASRuqB,EAAc,IAAIjD,EAClBkD,EAAc,IAAItC,EAClBuC,EAAcS,EAAWX,EAAaC,GAX9B,SAaFxtB,OAAOM,UAAU0tB,aAAaG,aAAa,CAAE3qB,OAAO,IAAQ7B,OAAM,SAAAuG,GAAC,OAAItG,QAAQoB,MAAMkF,MAbnF,wBAcFlI,OAAOM,UAAU0tB,aAAaG,aAAa,CAAExe,OAAO,IAAQhO,OAAM,SAAAuG,GAAC,OAAItG,QAAQoB,MAAMkF,MAdnF,yBAeFkmB,IAfE,kCAiBD,GAjBC,4CAAH,qDAuBLA,EAAW,uCAAG,sBAAAjmB,EAAA,+EAEPqb,IAAaziB,KAAKstB,GAAY1sB,MAAM2sB,IAF7B,2CAAH,qDAQX9K,EAAa,WAEb,OAAOxjB,OAAOM,UAAU0tB,aAAaC,oBAMrCI,EAAa,SAAUE,GAGvB3K,EAAe,IADfD,EAAe,IAIH,KAAW,GACvBC,EAAY,KAAW,GAEvB,IARJ,EAQQzb,EAAI,EAAG0B,EAAI,EARnB,cAS2B0kB,GAT3B,IASI,2BACA,KADSC,EACT,QACI,GAAwB,eAApBA,EAAW7F,KACf,CACI,IAAIvf,EAA8B,KAArBolB,EAAWplB,MAAkB,eAAiBjB,EAAKqmB,EAAWplB,MAC3Eua,EAAava,GAASolB,EAAWb,SACjCxlB,IAGJ,GAAwB,eAApBqmB,EAAW7F,KACf,CACI,IAAIvf,EAA8B,KAArBolB,EAAWplB,MAAkB,eAAiBS,EAAK2kB,EAAWplB,MAC3Ewa,EAAaxa,GAASolB,EAAWb,SACjC9jB,MAtBZ,8BA0BIjI,QAAQC,IAAI,KAAOwoB,EAAWtG,WAAa,SAAUa,EAAalU,KAAKC,UAAUgT,GAAejT,KAAKC,UAAUiT,GAAelT,KAAKC,UAAU3M,IAC7IpC,QAAQC,IAAI,KAAOwoB,EAAWnG,eAAiB,OAAQU,EAAalU,KAAKC,UAAUwS,GAAczS,KAAKC,UAAU3M,IAEhH6nB,EAAKxB,EAAWtG,WAAY,CAAEJ,aAAcA,EAAcC,aAAcA,EAAc5f,SAAUA,IAChG6nB,EAAKxB,EAAWnG,eAAgB,CAAEf,YAAaA,EAAanf,SAAUA,KAMtEsqB,EAAe,SAAUtrB,GAEzB,IAAIqC,EAAU,4CACdzD,QAAQC,IAAI,sBAAiC+iB,EAAa5hB,EAAOqC,GACjEwmB,EAAKxB,EAAWpG,aAAc,CAAEjhB,MAAOA,EAAOqC,QAASA,KAoGvDopB,EAAiB,WAIjB,OAFAhB,EAAc,KACdiB,EAAWnB,GACJvtB,OAAOM,UAAU0tB,aAAaG,aAAaT,GAAkB3sB,KAAK4tB,GAAgBhtB,MAAMitB,IAM/FC,EAAiB,WAIjB,OAFApB,EAAc,KACdiB,EAAWlB,GACJxtB,OAAOM,UAAU0tB,aAAaG,aAAaP,GAAkB7sB,KAAK+tB,GAAgBntB,MAAMotB,IAM/FJ,EAAc,uCAAG,WAAgBzrB,GAAhB,SAAAiF,EAAA,yDAELjF,EAAO8W,iBAAiB,GAGxB5Q,SAASua,EALJ,gCAOPyK,IAPO,OAWjBpqB,EAASR,MAAQyO,OAAOC,KAAKyR,GAAcqL,MAAK,SAAApmB,GAAG,OAAI+a,EAAa/a,KAAS8kB,EAAiBlqB,MAAMmqB,SAASjnB,SAI7G+mB,EAAcS,EADdX,EAAcrqB,EACwBsqB,GAEtC5rB,QAAQC,IAAI,KAAOwoB,EAAWvG,UAAY,OAAQc,EAAa1hB,EAAQwN,KAAKC,UAAU3M,IACtF6nB,EAAKxB,EAAWvG,UAAW,CAAE5gB,OAAQuqB,EAAazpB,SAAUA,IAlB3C,2CAAH,sDAwBd8qB,EAAc,uCAAG,WAAgB5rB,GAAhB,uBAAAiF,EAAA,yDAEbiT,EAAQlY,EAAO+rB,iBAAiB,GAChCC,EAAgB9T,EAAM+T,cAGpB/T,EAAMhS,SAASwa,EANJ,gCAQPwK,IARO,OAYbppB,EAAQkqB,EAAclqB,MACtBC,EAASiqB,EAAcjqB,OAEtBke,EADDuB,EAAa1f,EAAQ,IAAMC,KAI3Bke,EAAYuB,GAAc,CAAE1f,MAAOA,EAAOC,OAAQA,GAGlDke,EAAclR,OAAOuB,QAAQ2P,GAAaiM,MAAK,SAACjnB,EAAGknB,GAAJ,OAAWlnB,EAAE,GAAGnD,OAASsqB,OAAOC,oBAAsBF,EAAE,GAAGrqB,OAASsqB,OAAOC,sBAAoBC,QAAO,SAACva,EAAD,0BAAKtI,EAAL,KAAQ9C,EAAR,wBAAC,eAAoBoL,GAArB,kBAAyBtI,EAAI9C,MAAM,IAExLjI,QAAQC,IAAI,KAAOwoB,EAAWnG,eAAiB,OAAQU,EAAalU,KAAKC,UAAUwS,GAAczS,KAAKC,UAAU3M,IAChH6nB,EAAKxB,EAAWnG,eAAgB,CAAEf,YAAaA,EAAanf,SAAUA,KAI1E4pB,EAAiBje,MAAM3K,MAAM0B,MAAQ1B,EACrC4oB,EAAiBje,MAAM1K,OAAOyB,MAAQzB,EAGtCjB,EAAS2L,MAAQsC,OAAOC,KAAK0R,GAAcoL,MAAK,SAAApmB,GAAG,OAAIgb,EAAahb,KAASglB,EAAiBje,MAAMge,SAASjnB,SAC7G1C,EAAS0gB,WAAaA,EACtB1gB,EAASgB,MAAQA,EACjBhB,EAASiB,OAASA,EAClBjB,EAASmnB,UAAY+D,EAAc/D,UACnCnnB,EAASyrB,YAAcP,EAAcO,YACrCzrB,EAAS0rB,WAAaR,EAAcQ,WAIpCjC,EAAcS,EAAWX,EADzBC,EAActqB,GAGdtB,QAAQC,IAAI,KAAOwoB,EAAWvG,UAAY,OAAQc,EAAa1hB,EAAQwN,KAAKC,UAAU3M,IACtF6nB,EAAKxB,EAAWvG,UAAW,CAAE5gB,OAAQuqB,EAAazpB,SAAUA,IA7C3C,4CAAH,sDAmDd2rB,EAAc,SAAU3sB,GA6BxB,MA1BmB,kBAAfA,EAAMuG,MAA2C,yBAAfvG,EAAMuG,KAE9B,4BAEU,qBAAfvG,EAAMuG,MAA8C,oBAAfvG,EAAMuG,KAEtC,0CAEU,yBAAfvG,EAAMuG,MAAkD,gCAAfvG,EAAMuG,KAG1C,0BAEU,oBAAfvG,EAAMuG,MAA6C,0BAAfvG,EAAMuG,KAErC,+BAEU,cAAfvG,EAAMuG,MAAuC,cAAfvG,EAAMuG,KAE/B,2BAIA,iBASdqlB,EAAmB,SAAU5rB,GAE7B,IAAIqC,EAAUsqB,EAAY3sB,GAC1BpB,QAAQC,IAAI,KAAOwoB,EAAWrG,YAAc,SAAUY,EAAa5hB,EAAOqC,EAASqL,KAAKC,UAAU3M,IAClG6nB,EAAKxB,EAAWrG,YAAa,CAAEhhB,MAAOA,EAAMuG,KAAMlE,QAASA,EAASrB,SAAUA,IAE1E8pB,IAEAJ,EAAmBkC,EAAM9B,GACzBA,EAA2B,KAC3BW,MAOJM,EAAmB,SAAU/rB,GAE7B,IAAIqC,EAAUsqB,EAAY3sB,GAC1BpB,QAAQC,IAAI,KAAOwoB,EAAWrG,YAAc,SAAUY,EAAa5hB,EAAOqC,EAASqL,KAAKC,UAAU3M,IAClG6nB,EAAKxB,EAAWrG,YAAa,CAAEhhB,MAAOA,EAAMuG,KAAMlE,QAASA,EAASrB,SAAUA,IAE1E+pB,IAEAH,EAAmBgC,EAAM7B,GACzBA,EAA2B,KAC3Bc,MAOJX,EAAa,SAAUX,EAAaC,GAEpC,IAAIqC,EAActC,EAAYvT,iBAC9B,IAAK6V,GAAsC,IAAvBA,EAAY3kB,OAE5B,OAAO,KAGX,IAAI4kB,EAActC,EAAYyB,iBAC9B,IAAKa,GAAsC,IAAvBA,EAAY5kB,OAE5B,OAAO,KAGX,IAAIhI,EAAS,IAAI4lB,YAIjB,OAHA5lB,EAAO6lB,SAAS8G,EAAY,IAC5B3sB,EAAO6lB,SAAS+G,EAAY,IAErB5sB,GAMPwrB,EAAa,SAAUxrB,GAEvBA,EAAO6sB,YAAYjK,SAAQ,SAAA1K,GAAK,OAAIA,EAAMoJ,WAM1CoL,EAAQ,SAAUI,GAElB,OAAOtf,KAAK4N,MAAM5N,KAAKC,UAAUqf,KAGrC,MAAO,CACH1S,GA3cK,SAAUvP,EAAOmf,GAEtB,OAAkD,IAA9Cjb,OAAOkC,OAAOkW,GAAYjpB,QAAQ2M,KAKhCmf,aAAoBrL,WAKG,kBAAlB6J,EAAO3d,KAEd2d,EAAO3d,GAAS,IAGpB2d,EAAO3d,GAAO7G,KAAKgmB,IAEZ,KAybPlP,IAnbM,SAAUjQ,EAAOmf,GAEvB,IAAkD,IAA9Cjb,OAAOkC,OAAOkW,GAAYjpB,QAAQ2M,GAElC,OAAO,EAGX,KAAMmf,aAAoBrL,UAEtB,OAAO,EAGX,GAA6B,kBAAlB6J,EAAO3d,GAClB,CACI,IAAIua,EAAQoD,EAAO3d,GAAO3M,QAAQ8rB,GAClC,GAAI5E,GAAS,EAGT,OADAoD,EAAO3d,GAAOof,OAAO7E,EAAO,IACrB,EAIf,OAAO,GA8ZPnE,QACAiK,cACA5K,aACAc,SA7SW,WACf,IADyBG,EACzB,uDADkC,OAE9B,KAAMA,KAAUd,GAChB,CACI,IAAI3gB,EAAQ,iBACRqC,EAAU,gBAAkBof,EAAS,aACzC7iB,QAAQC,IAAI,uBAAkC+iB,EAAa5hB,EAAOqC,EAASqL,KAAKC,UAAU3M,IAC1F6nB,EAAKxB,EAAWrG,YAAa,CAAEhhB,MAAOA,EAAOqC,QAASA,EAASrB,SAAUA,IACzEygB,EAAS,OAGb,GAAe,SAAXA,EAGAzgB,EAASR,MAAQihB,EAGjB8I,EAAc,IAAIjD,EAClBmD,EAAcS,EAAWX,EAAaC,GAEtC5rB,QAAQC,IAAI,mBAA8B+iB,EAAa6I,EAAa/c,KAAKC,UAAU3M,IACnF6nB,EAAKxB,EAAWvG,UAAW,CAAE5gB,OAAQuqB,EAAazpB,SAAUA,QAGhE,CAEI8pB,EAA2B8B,EAAMlC,GAGjC,IAAIC,EAAWhK,EAAac,GAC5BiJ,EAAiBlqB,MAAMmqB,SAASjnB,MAAQinB,EAExCc,MA8QJpK,SAvQW,WACf,IADyBI,EACzB,uDADkC,OAAQC,EAC1C,uDADuD,OAEnD,KAAMD,KAAUb,GAChB,CACI,IAAI5gB,EAAQ,iBACRqC,EAAU,gBAAkBof,EAAS,aAGzC,OAFA7iB,QAAQC,IAAI,KAAOwoB,EAAWrG,YAAc,SAAUY,EAAa5hB,EAAOqC,EAASqL,KAAKC,UAAU3M,SAClG6nB,EAAKxB,EAAWrG,YAAa,CAAEhhB,MAAOA,EAAOqC,QAASA,EAASrB,SAAUA,IAI7E,KAAM0gB,KAAcvB,GACpB,CACI,IAAIngB,EAAQ,qBACRqC,EAAU,cAAgBqf,EAAa,aAG3C,OAFA9iB,QAAQC,IAAI,KAAOwoB,EAAWrG,YAAe,SAAUY,EAAa5hB,EAAOqC,EAASqL,KAAKC,UAAU3M,SACnG6nB,EAAKxB,EAAWrG,YAAa,CAAEhhB,MAAOA,EAAOqC,QAASA,EAASrB,SAAUA,IAI7E,GAAe,SAAXygB,EACJ,CAEIzgB,EAAS2L,MAAQ8U,EACjBzgB,EAAS0gB,WAAaA,EAGtB,IAAI1f,EAAQme,EAAYuB,GAAY1f,MAChCC,EAASke,EAAYuB,GAAYzf,OACrCuoB,EAAc,IAAItC,EAAYlmB,EAAOC,GACrCwoB,EAAcS,EAAWX,EAAaC,GAEtC5rB,QAAQC,IAAI,KAAOwoB,EAAWvG,UAAY,OAAQc,EAAa6I,EAAa/c,KAAKC,UAAU3M,IAC3F6nB,EAAKxB,EAAWvG,UAAW,CAAE5gB,OAAQuqB,EAAazpB,SAAUA,QAGhE,CAEI+pB,EAA2B6B,EAAMhC,GAGjC,IAAID,EAAW/J,EAAaa,GAC5BmJ,EAAiBje,MAAMge,SAASjnB,MAAQinB,EACxC,IAAI3oB,EAAQme,EAAYuB,GAAY1f,MAChCC,EAASke,EAAYuB,GAAYzf,OACrC2oB,EAAiBje,MAAM3K,MAAM0B,MAAQ1B,EACrC4oB,EAAiBje,MAAM1K,OAAOyB,MAAQzB,EAEtC4pB,OCtT6B,CAAiB,CAAE5sB,MAAOspB,IAC/D0E,EAAejwB,OAAOiwB,YAAe,ICZlC,WAIH,IAAIC,EAAe,KACfC,EAAiB,KACjBC,EAAe,KACfC,EAAgB,KAChBC,EAAc,MAKO,WAErB,IAAI/F,EAAe,IAAIC,aAEnBC,EAAWF,EAAaG,aACPH,EAAaK,mBACnBzK,QAAQsK,GACvB,IAAII,EAAcJ,EAAStK,QAAQoK,EAAaO,gCAEhDqF,EAAiBtF,EAAY3nB,OAC7BmtB,EAAgBF,EAAenW,iBAAiB,GAwBpDuW,GAhBuB,WACvB,IADiCvrB,EACjC,uDADyC,IAAKC,EAC9C,uDADuD,IAE9CirB,IAEDA,EAAelwB,OAAO6L,SAASgE,cAAc,WAGjDqgB,EAAalrB,MAAQA,EACrBkrB,EAAajrB,OAASA,EACtB,IAAImmB,EAAU8E,EAAalgB,WAAW,MACtCob,EAAQnQ,SAAS,EAAG,EAAGjW,EAAOC,GAE9BmrB,EAAeF,EAAa5E,gBAC5BgF,EAAcF,EAAanB,iBAAiB,GAIhDuB,GACA,IAAIC,EAAU,IAAI3H,YAAY,CAACuH,EAAeC,IAiC9C,MAAO,CACHI,cA5BgB,WAEhB,OAAOL,GA2BPM,cApBgB,WAEhB,OAAOL,GAmBPhN,UAZY,WAEZ,OAAOmN,ID/D0B,CAAgB,CAAExuB,MAAOspB,IAC9DqF,EAAe5wB,OAAO4wB,UAAe,IHKlC,SAAoBC,GAGlBA,IAEDA,EAAgB,IAAI/H,aAGxB,IAAI2C,EAAY,GACZC,EAAS,GAETjkB,EAAQ,KACRqpB,EAAQ,GACRnF,EAAS,KACTC,EAAmB,KA4DnBC,EAAO,SAAU9d,GAEjB,IAA+C,GAA3CkE,OAAOkC,OAAO0Q,GAAUzjB,QAAQ2M,GAEhC,OAAO,EAGX,IAAI+d,EAAO,GAAGtK,MAAMuK,KAAKC,UAAW,GAEpC,GAA6B,kBAAlBN,EAAO3d,GAGd,IADA,IAAIke,EAAYP,EAAO3d,GAAOyT,QACrBnI,EAAI,EAAGA,EAAI4S,EAAU/gB,OAAQmO,IAElC4S,EAAU5S,GAAG6S,MAAMvH,KAAMmH,GAIjC,OAAO,GA2BPK,EAAS,SAAUpe,GAEnBnM,QAAQC,IAAI,gBAA2B+iB,EAAa+G,EAAO3a,KAC3Dob,IACAP,EAAKhH,EAAS7E,gBAAiB,CAAEhP,IAAK2a,EAAO3a,OAM7Cqb,EAAU,SAAUte,GAEpBnM,QAAQC,IAAI,mBAA8B+iB,EAAa+G,EAAO3a,KAC9Dsb,IACAT,EAAKhH,EAAS5E,mBAAoB,CAAEjP,IAAK2a,EAAO3a,OAMhDoM,EAAY,SAAUsD,GAEtB,IAAIrb,EAAUqL,KAAK4N,MAAMoC,EAAIlY,MAC7B,GAAsB,SAAlBnD,EAAQ0I,MAAZ,CAQA,OAHAnM,QAAQC,IAAI,UAAgB+iB,EAAavf,EAAQ0I,MAAO1I,EAAQmD,MAGxDnD,EAAQ0I,OAEZ,IAAK,gBAA2BgjB,EAAmB1rB,GAAqB,MACxE,IAAK,gBAA2B2rB,EAAmB3rB,GAAqB,MACxE,IAAK,gBAA2B4rB,EAAmB5rB,GAAqB,MACxE,IAAK,gBAA2B6rB,EAAmB7rB,GAAqB,MACxE,IAAK,eAA2B8rB,EAAkB9rB,GAAsB,MACxE,IAAK,gBAA2B+rB,EAAmB/rB,GAAqB,MACxE,IAAK,mBAA2BgsB,EAAsBhsB,GAAkB,MACxE,IAAK,cAA2BisB,EAAiBjsB,GAIrD,GAAIA,EAAQmD,KAAK+jB,QAAQd,EACzB,CACI,IAAIzqB,EAAWyqB,EAAUpmB,EAAQmD,KAAK+jB,MAItC,cAHOd,EAAUpmB,EAAQmD,KAAK+jB,aACvBlnB,EAAQmD,KAAK+jB,UACpBvrB,EAASqE,GAKbwmB,EAAKxmB,EAAQ0I,MAAO1I,KAMpB8T,EAAc,SAAU9T,EAASrE,GAEjC,IAAK2qB,GAAUA,EAAO3B,aAAewC,UAAUC,KAE3C,OAAO,EAIXpnB,EAAQmD,KAAKf,MAAQA,EAGrBpC,EAAQmD,KAAK+jB,KAAOA,IAGhBvrB,aAAoB6gB,WAEpB4J,EAAUpmB,EAAQmD,KAAK+jB,MAAQvrB,GAInC,IAAI0f,EAAMhQ,KAAKC,UAAUtL,GAOzB,OANAsmB,EAAO1B,KAAKvJ,GACU,SAAlBrb,EAAQ0I,OAERnM,QAAQC,IAAI,UAAgB+iB,EAAavf,EAAQ0I,MAAO2S,IAGrD,GAMP0L,EAAiB,SAAjBA,IAEKT,GAAUA,EAAO3B,aAAewC,UAAUC,OAK/CC,IAEAd,EAAmB5rB,OAAOyI,WAAW2jB,EA7OzB,OAmPZE,EAAgB,WAEhBtsB,OAAO8U,aAAa8W,IAMpBc,EAAO,WAOP,OAAOvT,EAJP,CACIpL,MAAO,OACPvF,KAAM,MA0CV+oB,EAAY,SAAUvjB,GAEtB,KAAMA,KAAU8iB,GAEZ,OAAO,EAGX,IAAI/E,EAAO+E,EAAM9iB,GAMjB,OALA+d,EAAKnpB,eACEkuB,EAAM9iB,GAEb6d,EAAKhH,EAASK,WAAY,CAAE6G,KAAMA,KAE3B,GAyDPyF,EAAS,SAAUxjB,GACvB,IAD+B1I,EAC/B,uDADyC,GAErC,GAAI0I,EACJ,CACI,IAAKujB,EAAUvjB,GAEX,OAAO,EAGX,IAAI0S,EACJ,CACI3S,MAAO,SACPvF,KACA,CACIwF,OAAQA,IAGhB,OAAOmL,EAAYuH,EAAD,OAAMpb,QAAN,IAAMA,OAAN,EAAMA,EAAStE,UAIjC,IAAK,IAAIiC,KAAM6tB,EAEX,GAAKS,EAAUtuB,GAAf,CAKA,IAAIyd,EACJ,CACI3S,MAAO,SACPvF,KACA,CACIwF,OAAQ/K,IAGhBkW,EAAYuH,GAKhB,OAFAoQ,EAAQ,IAED,GAQXvE,EAAO,WAEP,OAAOI,KAOPA,EAAS,WAET,OAAQ,CAAC,MAAM,KAAK,KAAK,KAAK,MAAMC,QAAQ,UAAU,SAAAC,GAAC,OACpDA,EAAIC,OAAOC,gBAAgB,IAAIC,WAAW,IAAI,GAAK,IAAMH,EAAI,GAAGI,SAAS,QAS5E8D,EAAqB,SAAUhjB,GAG/B,IAAIge,EAAO,IAAI3G,EAAQrX,EAAMvF,KAAKwF,OAAQD,EAAMvF,KAAK0F,OAAQH,EAAMvF,KAAKyF,OAAQyC,KAAK4N,MAAMvQ,EAAMvF,KAAK6c,aACtGyL,EAAM/E,EAAK/d,QAAU+d,GAMrBiF,EAAqB,SAAUjjB,GAG/B,IAAIge,EAAO,IAAI3G,EAAQrX,EAAMvF,KAAKwF,OAAQD,EAAMvF,KAAK0F,OAAQH,EAAMvF,KAAKyF,OAAQyC,KAAK4N,MAAMvQ,EAAMvF,KAAK6c,aACtGyL,EAAM/E,EAAK/d,QAAU+d,GAMrBkF,EAAqB,SAAUljB,GAG/B,IAAIge,EAAO+E,EAAM/iB,EAAMvF,KAAKwF,QACxByjB,EAAmB,CAAEpM,WAAY0G,EAAK1G,YACtC2B,EAAiB,IAAIE,kBAAkBuK,GAC3C1F,EAAKhF,KAAKC,GAAgB,GAG1BA,EAAe0K,2BAA6B,SAAUC,GAElDC,EAA+B7F,IAInC/E,EAAe6K,eAAiB,SAAUF,GAEtC,GAAKA,EAAMpK,WAAiC,KAApBoK,EAAMpK,UAA9B,CAKA,IAAI7G,EACJ,CACI3S,MAAO,YACPvF,KACA,CACIwF,OAAQD,EAAMvF,KAAKwF,OACnBuZ,UAAW7W,KAAKC,UAAUghB,EAAMpK,aAGxCpO,EAAYuH,KAGhBsG,EAAe8K,oBAAsB,SAAUH,GAG3C3K,EAAe+K,cAAchxB,MAAK,SAAUixB,GAGxChL,EAAeiL,oBAAoBD,GAEnC,IAAItR,EACJ,CACI3S,MAAO,QACPvF,KACA,CACIwF,OAAQD,EAAMvF,KAAKwF,OACnBkkB,MAAOxhB,KAAKC,UAAUqhB,KAG9B7Y,EAAYuH,OAKPmQ,EAAcd,YACpBjK,SAAQ,SAAA1K,GAAK,OAAI4L,EAAe+B,SAAS3N,MAGhD4L,EAAesC,kBAAkB,YAMjC4H,EAAqB,SAAUnjB,GAE/BwjB,EAAUxjB,EAAMvF,KAAKwF,SAMrBmjB,EAAoB,SAAUpjB,GAG9B,IAAIge,EAAO+E,EAAM/iB,EAAMvF,KAAKwF,QACxByjB,EAAmB,CAAEpM,WAAY0G,EAAK1G,YACtC2B,EAAiB,IAAIE,kBAAkBuK,GAC3C1F,EAAKhF,KAAKC,GAAgB,GAG1BA,EAAe0K,2BAA6B,SAAUC,GAElDC,EAA+B7F,IAInC/E,EAAeU,qBAAqBhX,KAAK4N,MAAMvQ,EAAMvF,KAAK0pB,QAG1DnG,EAAKtE,0BAGLT,EAAe6K,eAAiB,SAAUF,GAEtC,GAAKA,EAAMpK,WAAiC,KAApBoK,EAAMpK,UAA9B,CAKA,IAAI7G,EACJ,CACI3S,MAAO,YACPvF,KACA,CACIwF,OAAQD,EAAMvF,KAAKwF,OACnBuZ,UAAW7W,KAAKC,UAAUghB,EAAMpK,aAGxCpO,EAAYuH,KAIHmQ,EAAcd,YACpBjK,SAAQ,SAAA1K,GAAK,OAAI4L,EAAe+B,SAAS3N,MAGhDpb,OAAOyI,YAAW,WAEdue,EAAemL,eAAepxB,MAAK,SAAUixB,GAGzChL,EAAeiL,oBAAoBD,GAEnC,IAAItR,EACJ,CACI3S,MAAO,SACPvF,KACA,CACIwF,OAAQD,EAAMvF,KAAKwF,OACnBokB,OAAQ1hB,KAAKC,UAAUqhB,KAG/B7Y,EAAYuH,QAEjB,MAMH0Q,EAAqB,SAAUrjB,GAE/B,GAAIA,EAAMvF,KAAKwF,UAAU8iB,EACzB,CACI,IAAIsB,EAAS1hB,KAAK4N,MAAMvQ,EAAMvF,KAAK4pB,QAGnCtB,EAAM/iB,EAAMvF,KAAKwF,QAAQ0Z,qBAAqB0K,KAOlDf,EAAwB,SAAUtjB,GAElC,IAAIwZ,EAAY7W,KAAK4N,MAAMvQ,EAAMvF,KAAK+e,WACjCA,GAAcA,EAAUA,WAAqC,KAAxBA,EAAUA,YAKhDxZ,EAAMvF,KAAKwF,UAAU8iB,GAEVA,EAAM/iB,EAAMvF,KAAKwF,QACvBsZ,aAAaC,KAOtB+J,EAAmB,SAAUvjB,GAE7BwjB,EAAUxjB,EAAMvF,KAAKwF,SAMrB4jB,EAA8B,uCAAG,WAAgB7F,GAAhB,iBAAA5jB,EAAA,sDAE7B7F,EAAQypB,EAAK3E,WACjBxlB,QAAQC,IAAI,yBAAoC+iB,EAAamH,EAAK/d,OAAQ1L,GAHzC,KAKzBA,EALyB,OAOxB,WAPwB,MAQxB,iBARwB,MASxB,WATwB,OAcxB,QAdwB,MAexB,aAfwB,MAgBxB,cAhBwB,OAoBxB,cApBwB,8BAWzBkvB,EAAOzF,EAAK/d,QAXa,sEAsBrB9K,EAAS6oB,EAAKlD,kBAClBjnB,QAAQC,IAAI,KAAOgjB,EAASI,WAAa,OAAQL,EAAamH,EAAK/d,OAAQ9K,GAC3E2oB,EAAKhH,EAASI,WAAY,CAAE8G,KAAMA,EAAM7oB,OAAQA,IAxBvB,iEAAH,sDA+BlC,MAAO,CACHoa,GA5nBK,SAAUvP,EAAOmf,GAEtB,OAA+C,GAA3Cjb,OAAOkC,OAAO0Q,GAAUzjB,QAAQ2M,KAK9Bmf,aAAoBrL,WAKG,kBAAlB6J,EAAO3d,KAEd2d,EAAO3d,GAAS,IAGpB2d,EAAO3d,GAAO7G,KAAKgmB,IAEZ,KA0mBPlP,IApmBM,SAAUjQ,EAAOmf,GAEvB,IAA+C,GAA3Cjb,OAAOkC,OAAO0Q,GAAUzjB,QAAQ2M,GAEhC,OAAO,EAGX,KAAMmf,aAAoBrL,UAEtB,OAAO,EAGX,GAA6B,kBAAlB6J,EAAO3d,GAClB,CACI,IAAIua,EAAQoD,EAAO3d,GAAO3M,QAAQ8rB,GAClC,GAAI5E,GAAS,EAGT,OADAoD,EAAO3d,GAAOof,OAAO7E,EAAO,IACrB,EAIf,OAAO,GA+kBPnI,QAjjBU,SAAUnP,EAAKoc,GAEzB3lB,EAAQ2lB,GACRzB,EAAS,IAAIa,UAAUxb,EAAM,UAAYvJ,IAElCiiB,OAASyC,EAChBR,EAAO7B,UAAY1M,EACnBuO,EAAO0B,QAAUhB,GA2iBjBjN,WAriBa,WACjB,MACU,QAAN,EAAAuM,SAAA,SAAQ/oB,SAoiBRyvB,QA7ZU,SAAUrkB,GAEpB,OAAQA,KAAU8iB,EAASA,EAAM9iB,GAAU,MA4Z3CskB,SAtZW,WAEX,OAAOxB,GAqZP/E,KA9YO,SAAU9d,GACrB,IAD6B3I,EAC7B,uDADuC,GAE/Bob,EACJ,CACI3S,MAAO,OACPvF,KACA,CACIyF,OAAQA,EACRD,OAAM,OAAE1I,QAAF,IAAEA,OAAF,EAAEA,EAAS0I,SAGzB,OAAOmL,EAAYuH,EAAD,OAAMpb,QAAN,IAAMA,OAAN,EAAMA,EAAStE,WAoYjCuxB,WA1Wa,SAAUvkB,GAC3B,IADmC1I,EACnC,uDAD6C,GAEzC,KAAM0I,KAAU8iB,GAEZ,OAAO,EAGX,IAAI/E,EAAO+E,EAAM9iB,GAEb0S,EACJ,CACI3S,MAAO,cACPvF,KACA,CACIwF,OAAQ+d,EAAK/d,SAGrB,OAAOmL,EAAYuH,EAAD,OAAMpb,QAAN,IAAMA,OAAN,EAAMA,EAAStE,WA0VjCwxB,WAnVa,SAAUxkB,GAC3B,IADmC1I,EACnC,uDAD6C,GAEzC,KAAM0I,KAAU8iB,GAEZ,OAAO,EAIX,IAAI/E,EAAO+E,EAAM9iB,UACV8iB,EAAM9iB,GAEb,IAAI0S,EACJ,CACI3S,MAAO,cACPvF,KACA,CACIwF,OAAQ+d,EAAK/d,SAGrB,OAAOmL,EAAYuH,EAAD,OAAMpb,QAAN,IAAMA,OAAN,EAAMA,EAAStE,WAiUjCwwB,UG/pBiC,CAAcvB,EAAY3M,aAE/DmP,EAAWvI,EAEflqB,OAAOmc,IAAM,CACTsW,WACA5N,WACAwF,aACAuG,YACApF,YACA8B,eACA2C,gB,8KEjBAyC,EAAY,GAEHplB,EAAgBqO,0BACd,gBAA2B,IAAzBhW,EAAwB,EAAxBA,SACP8E,GAD+B,iBACvB7G,qBAAW8G,MACnBC,EAAQ/G,qBAAWgH,KACnBjH,EAAQC,qBAAWC,KAEzB,EAAsCN,mBAAS,GAA/C,mBAAcyY,GAAd,WACA,EAAsCzY,mBAAS,IAA/C,mBAAOkM,EAAP,KAAgBkjB,EAAhB,KACA,EAAsCpvB,mBAASI,EAAMkP,aAArD,mBAAOA,EAAP,KAAoB0Q,EAApB,KAoBA,SAASzV,EAASzC,EAAUY,EAAU2mB,GAAW,IAAD,EACtC5xB,EAAQ,OAAGiL,QAAH,IAAGA,IAAa,YAAmB,EAAjB8B,MAAkB,IAAXvF,EAAU,EAAVA,KACpBxF,GAAkBwF,EAA1BwF,OAA0BxF,EAAlBxF,OAAOqC,EAAWmD,EAAXnD,QACnBrC,GACCR,IAAMQ,MAAN,sBAA2BqC,GAAU,CAAC0H,KAAK,mBAAG1I,UAAU,sBAAuB0B,SAAU,OAI7F8sB,GAAS,UAAApoB,EAAKO,YAAL,eAAWK,UAAW,IAAMA,EAEzC,GAAGunB,EAAW,CACV,IAAME,EAAW3W,IAAckW,QAAQO,GACpCE,IACCD,EAASC,EAAS5kB,OAAS,IAAM2kB,GAIzC,OAAO1W,IAAc4P,KAAK1gB,EAAU,CAACrK,SAAUA,EAAUgN,OAAQ6kB,IAarE,SAASjkB,EAAWzB,GAChBgP,IAAcqV,OAAOrkB,GAUzB,SAAS4lB,EAAT,GAAsC,EAAbhlB,MAAc,IAAPvF,EAAM,EAANA,KACpBwF,EAAmBxF,EAAnBwF,OAAmBxF,EAAX0F,OAChBiO,IAAcoW,WAAWvkB,GAG7B,SAASglB,EAAcC,GACnB,IAAQlH,EAAiBkH,EAAjBlH,KAAM7oB,EAAW+vB,EAAX/vB,OACR8K,EAAS+d,EAAK/d,OAEpByB,EAAO,2BAAOA,GAAP,kBAAiBzB,EAAS9K,IACjCyvB,EAAWljB,GACX,IAAM7B,EAAmB8kB,EAAU1kB,GAEnC,GAAIJ,EAAkB,CAClB,IAAMslB,EAAuC,UAArBtlB,EAAgC5N,OAAO6S,YAAcpD,EAAQ7B,GACrF,IAAKslB,EAED,OADAtkB,EAAWZ,GACJxL,IAAMQ,MAAN,2BAAgCgL,EAAhC,uBAAqD+d,EAAK7d,OAA1D,uBAA+E6d,EAAK9d,OAApF,MAEXzL,IAAMgD,QAAN,qBAA4BwI,EAA5B,uBAAiD+d,EAAK7d,OAAtD,uBAA2E6d,EAAK9d,OAAhF,MACA,IAAMklB,EAAaD,EAAejE,iBAAiB,GAC7CmE,EAAaF,EAAelZ,iBAAiB,GACnD+R,EAAK5C,uBAAuBgK,GAC5BpH,EAAK/C,uBAAuBoK,GAC5B5wB,YAAM,oBAAqB,CAACuK,KAAK,mBAAG1I,UAAU,qBAI7C,CAGD,GAFA7B,IAAMgD,QAAN,yBAAgCwI,EAAhC,uBAAqD+d,EAAK7d,OAA1D,uBAA+E6d,EAAK9d,OAApF,OAEIjO,OAAO6S,YAAa,OACxB,IAAMsgB,EAAanzB,OAAO6S,YAAYoc,iBAAiB,GACjDmE,EAAapzB,OAAO6S,YAAYmH,iBAAiB,GACvD+R,EAAK5C,uBAAuBgK,GAC5BpH,EAAK/C,uBAAuBoK,GAC5B5wB,YAAM,aAAD,OAAckR,EAAU1F,IAAW,CAACjB,KAAK,mBAAG1I,UAAU,+BAInE,SAASgvB,EAAcJ,GACnB,IAAQlH,EAASkH,EAATlH,KACR,IAAKA,EACD,OAAOnqB,QAAQoB,MAAM,WAEzB,IAAMgL,EAAS+d,EAAK/d,OACpBslB,EAAqBtlB,UAEdyB,EAAQzB,GACf2kB,EAAW,eAAIljB,IACfjN,YAAM,aAAD,OAAckR,EAAU1F,GAAxB,WAA0C,CAACjB,KAAK,mBAAG1I,UAAU,wBAGtE,SAASkvB,EAAT,GAAsC,EAAdxlB,MAAe,IAC3BC,EAD0B,EAAPxF,KACnBwF,OAER,IAAKA,EACD,OAAOpM,QAAQoB,MAAM,WAEzBswB,EAAqBtlB,UACdyB,EAAQzB,GACf2kB,EAAW,eAAIljB,IAEfjN,YAAM,QAAD,OAASkR,EAAU1F,GAAnB,WAAqC,CAACjB,KAAK,mBAAG1I,UAAU,wBAGjE,SAASivB,EAAqBtlB,GAE1B,IADA,IAAIwlB,EAAS,KACb,MAAyBvhB,OAAOuB,QAAQkf,GAAxC,eAAoD,CAA/C,0BAAOe,EAAP,KAAYC,EAAZ,KACD,GAAI1lB,IAAWylB,GAAOC,IAAQ1lB,EAA9B,CAGAwlB,EAAS,CAACC,EAAKC,GACf,OAGJ,GAAIF,EAAQ,CACR,MAA0CA,EAA1C,mBAAO9lB,EAAP,iBACOglB,EAAUhlB,IAIzB,SAASgG,EAAUvG,GAAQ,IAAD,EAClBlK,EAAE,UAAGwH,EAAKO,YAAR,aAAG,EAAWK,SAChB0gB,EAAO5P,IAAcmW,WAAWnlB,GACpC,GAAe,UAAXA,GAAsB4e,EAAM,CAAC,IAAD,EACtB9d,EAAmB8d,EAAnB9d,OAAQC,EAAW6d,EAAX7d,OACdjL,EAAMgL,KAAM,UAAKxD,EAAKO,YAAV,aAAK,EAAWK,UAAY6C,EAASD,EAErD,OAAOhL,EApJXiB,qBAAW,WAKX,OAJIiY,IAAcmB,GAAGnB,IAAa2I,aAAciO,GAC5C5W,IAAcmB,GAAGnB,IAAa8I,WAAc+N,GAC5C7W,IAAcmB,GAAGnB,IAAa+I,WAAcmO,GAC5ClX,IAAcmB,GAAGnB,IAAagJ,WAAcoO,GACzC,WACHpX,IAAc6B,IAAI7B,IAAa2I,aAAciO,GAC7C5W,IAAc6B,IAAI7B,IAAa8I,WAAc+N,GAC7C7W,IAAc6B,IAAI7B,IAAa+I,WAAcmO,GAC7ClX,IAAc6B,IAAI7B,IAAagJ,WAAcoO,MAC7C,IAEJrvB,qBAAW,WACP8X,GAAS,SAAAvK,GAAC,OAAIA,EAAE,KAChBoB,EAAclP,EAAMkP,YACpB0Q,EAAe1Q,KAChB,CAAClP,EAAMkP,cAqKV,IAAMsL,EAAQne,OAAOqN,KAAO,CACxBS,WACA4E,aAjJJ,WAAwB,IAAD,MACbgE,EAAK,UAAG/L,EAAMxG,eAAT,iBAAG,EAAeuS,aAAlB,aAAG,EAAsBM,QAAO,SAACnN,EAAG8C,EAAGxE,GAAO,IAAD,EAAE,OAAO0B,IAAM,OAADA,QAAC,IAADA,OAAA,EAAAA,EAAGwB,aAAH,UAAgBZ,EAAKO,YAArB,aAAgB,EAAWK,aAD9E,qBAEFqL,QAFE,IAEFA,IAAS,IAFP,IAEnB,2BAA6B,CAAC,IAArB1L,EAAoB,QAErB8C,EAAQ,OAAC9C,QAAD,IAACA,OAAD,EAACA,EAAMK,WACf7I,IAAMQ,MAAN,gCAA8BgI,QAA9B,IAA8BA,OAA9B,EAA8BA,EAAMK,YALzB,gCAkJnBuD,aACA+D,cArIJ,WAEI,IADA,IACA,MADcV,OAAOC,KAAKiK,IAAcmW,YACxC,eAAyB,CACrB1jB,EADW,QAoIfT,YAlCJ,SAAqBwlB,EAAQ5pB,GACzB,IAAKA,IAAW4pB,EACZ,OAAO/xB,QAAQoB,MAAR,2CACX0vB,EAAU3oB,GAAU4pB,GAgCpBjgB,YACAjG,YA9BJ,SAAqBO,GACpB,IAAD,EACI,iBAAOiE,OAAOuB,QAAQkf,GAAW1D,MAAM,SAAAnlB,GAAC,OAAIA,EAAE,KAAOmE,YAArD,QAAiE,CAAC,KAAK,OA6BvE4E,cA1BJ,SAAuB1P,GACnB,IAAK,IAAM8K,KAAUmO,IAAcmW,WACnC,CACI,IAAI7gB,EAAIvO,EACF0K,EAAmB8kB,EAAU1kB,GAChCJ,GAAoB6B,EAAQ7B,KAE3B6D,EAAIhC,EAAQ7B,IAGhB,IAAIme,EAAO5P,IAAckW,QAAQrkB,GAC7BolB,EAAa3hB,EAAEuI,iBAAiB,GAChCmZ,EAAa1hB,EAAEwd,iBAAiB,GACpClD,EAAK5C,uBAAuBgK,GAC5BpH,EAAK/C,uBAAuBoK,KAahC3jB,QAAQ,2BAAKA,GAAN,IAAegE,MAAMZ,KAGhC,OAAO,cAACvF,EAAciR,SAAf,CAAwB5Z,MAAOwZ,EAAOxY,SAAUA,M,gCCpN5C,QAA0B,2C,gCCA1B,QAA0B,mC","file":"static/js/main.3f30b66e.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nimport React from 'react'\r\nimport toast from 'react-hot-toast'\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n\r\n        // Check for updates every 5 min.\r\n        setInterval(() => {\r\n          registration.update();\r\n          console.debug(\"Checked for update...\");\r\n        }, (1000 * 60) * 5);\r\n\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              );\r\n\r\n              toast.info(`Update available! To update, close all windows and reopen.`, {\r\n                toastId: \"appUpdateAvailable\", // Prevent duplicate toasts\r\n                onClick: () => window.close(), // Closes windows on click\r\n                autoClose: false // Prevents toast from auto closing\r\n              });\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/face-mask.c36f78ab.png\";","export default __webpack_public_path__ + \"static/media/torso-mask.39ecf74a.png\";","export default __webpack_public_path__ + \"static/media/body-mask.c74c2147.png\";","import { Button, Image } from 'react-bootstrap'\r\nimport { useContext, useEffect, useState, useRef } from 'react'\r\n\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\n\r\nimport face_mask from 'assets/img/face-mask.png'\r\nimport torso_mask from 'assets/img/torso-mask.png'\r\nimport body_mask from 'assets/img/body-mask.png'\r\n\r\nexport default ({id, stream, onClick, isLocal = false, ...props})=>{\r\n    let ref = useRef(null);\r\n\r\n    const [status, setStatus]   = useState({audio:true});\r\n    const [mask, setMask]       = useState('None');\r\n    const media                 = useContext(MediaContext);\r\n\r\n    useEffect(()=>{\r\n        if(stream && ref.current){\r\n            ref.current.srcObject = stream;\r\n        }\r\n\r\n    },[stream]);\r\n\r\n    function handleAudioClick() {\r\n        setStatus({...status, audio:!status.audio});\r\n    }\r\n\r\n    function handleMask(value) {\r\n        switch(value){\r\n            case 'Face':\r\n                return face_mask;\r\n            case 'Torso':\r\n                return torso_mask;\r\n            case 'Body':\r\n                return body_mask;\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    function handleMediaClick() {\r\n        if(onClick !== undefined) onClick();\r\n        else setMask(media.settings.mask);\r\n    }\r\n\r\n    function isValidMask() {\r\n        console.log(\"Mask is: \" + media.settings.mask );\r\n        return media.settings.mask && media.settings.mask !== 'None';\r\n    }\r\n    \r\n    return <>\r\n    <div className={`Video ${props.className??\"\"}`} >\r\n        <div className=\"stream-status position-absolute bottom-0 start-0\">\r\n            <span   className=\"status-user\"> {id} </span>\r\n            <Button className=\"status-audio\" variant=\"link\" disabled={isLocal} onClick={handleAudioClick}>\r\n                {isLocal? <i className={`bi bi-mic${!(isLocal||!status?.audio) ? \"\" : \"-mute\"}`} />\r\n                :<i className={`fs-4 bi bi-volume${!(isLocal||!status?.audio) ? \"-down\" : \"-mute\"}`} />}\r\n            </Button>\r\n        </div>\r\n        {isValidMask() && !onClick ? <Image className=\"mask-image\" onClick={handleMediaClick} src={handleMask(media.settings.mask)} width={media.settings.width} height={media.settings.height} /> : <></>}\r\n        <video autoPlay playsInline muted={isLocal || !status?.audio} ref={ref} onClick={handleMediaClick} />\r\n    </div>\r\n    <style global jsx>{`\r\n        @import 'src/variables.scss';\r\n\r\n        #carousel-col .Video{\r\n\r\n            background-clip: text;\r\n\r\n            &:hover, .selected{\r\n                opacity: 0.55;\r\n                -webkit-opacity: 0.55;\r\n                cursor: pointer;\r\n            }\r\n        }\r\n\r\n        .Video{\r\n\r\n            position: relative;\r\n            margin:1px;\r\n            padding:0;\r\n            transition:all .2s ease-in-out;\r\n            background-color: #333;\r\n\r\n            .stream-status{ \r\n                color:white !important;\r\n                z-index:1000;\r\n                .status-user{\r\n                    padding: 0rem 0.5rem;\r\n                    padding-right:0;\r\n                }\r\n                .status-audio{\r\n                    color:white !important;\r\n                    cursor:pointer;\r\n                    padding:0;\r\n                    margin-bottom: -1.2rem;\r\n                    margin-top: -1.4rem;\r\n                    margin-left: -0.2rem;                    \r\n                }\r\n            }\r\n\r\n            video{\r\n                width: calc(100%);\r\n                height:100%;\r\n                object-fit: cover;\r\n                margin-bottom: -9px;\r\n\r\n                transform: rotateY(180deg);\r\n                -webkit-transform:rotateY(180deg); /* Safari and Chrome */\r\n                -moz-transform:rotateY(180deg); /* Firefox */\r\n            }\r\n\r\n            .mask-image {\r\n                position: absolute;\r\n                z-index: 1;\r\n                width: auto;\r\n                height: 100%;\r\n                left: 0;\r\n                right: 0;\r\n                margin-left: auto;\r\n                margin-right: auto;\r\n            }\r\n        }\r\n\r\n        .Video.stream {\r\n            border: 3px inset #F33;\r\n        }\r\n\r\n    `}</style>\r\n    </>;\r\n}","import { Helmet } from \"react-helmet\"\r\nimport toast, { Toaster } from 'react-hot-toast'\r\nimport { BrowserRouter as Router, Switch, Route, Redirect } from \"react-router-dom\"\r\n\r\nimport App from 'views/App'\r\nimport Verified from 'views/verified'\r\nimport ResetPass from 'views/resetpassword'\r\nimport AboutModal from 'components/modal_about'\r\nimport ProfileModal from 'components/modal_profile'\r\nimport FullScreenBTN from 'components/btn_fullscreen'\r\nimport Title from 'partials/title'\r\n\r\nimport 'bootstrap/dist/js/bootstrap.bundle.min.js';\r\nimport 'style.scss'\r\n\r\nimport RoomsContext  from 'utils/ctx_rooms'\r\nimport StreamContext from 'utils/ctx_streaming'\r\nimport MediaContext from 'utils/ctx_mediadevices'\r\nimport AuthContext  from 'utils/ctx_authentication'\r\n\r\nwindow.toast  = toast;\r\nconst error   = toast.error;   toast.error   = (message, options) => { console.trace(message); return   error(message, options); }\r\nconst success = toast.success; toast.success = (message, options) => { console.log(message);   return success(message, options); }\r\nconst loading = toast.loading; toast.loading = (message, options) => { console.log(message);   return loading(message, options); }\r\nconst custom  = toast.custom;  toast.custom  = (message, options) => { console.log(message);   return  custom(message, options); }\r\n\r\nexport default ({ children, ...props }) => {\r\n  return <div id=\"layout\" className=\"\" {...props}>\r\n    <Toaster\r\n      id=\"toaster\"\r\n      position=\"bottom-right\"\r\n      reverseOrder={true}\r\n      toastOptions={{\r\n        duration: 2000,\r\n        style: {\r\n          background: '#333',\r\n          color: '#fff',\r\n        },\r\n      }}\r\n    />\r\n    <Router basename={process.env.REACT_APP_BASE}>\r\n    <AuthContext>\r\n    <RoomsContext>\r\n    <MediaContext>\r\n    <StreamContext>\r\n    \r\n    <Helmet>\r\n      <title>{process.env.REACT_APP_NAME}</title>\r\n      <meta property=\"og:url\" content={process.env.REACT_APP_OG_URL} />\r\n      <meta property=\"og:type\" content={process.env.REACT_APP_OG_TYPE} />\r\n      <meta property=\"og:title\" content={process.env.REACT_APP_OG_TITLE} />\r\n      <meta property=\"og:description\" content={process.env.REACT_APP_OG_DESC} />\r\n      <meta property=\"og:image\" content={process.envREACT_APP_OG_IMAGE} />\r\n    </Helmet>\r\n\r\n    <Title/>\r\n\r\n    <div className=\"z-top d-flex m-2 position-absolute top-0 end-0\">\r\n      <ProfileModal />\r\n      <AboutModal />\r\n      <FullScreenBTN />\r\n    </div>\r\n\r\n    <Switch>\r\n        <Route component={App}       exact path={[\"/\", \"/settings\", \"/about\", \"/users\", \"/chat\", \"/profile\", \"/room/:roomId\", \"/room/:roomId/chat\", \"/room/:roomId/guests\"]} />\r\n        <Route component={Verified}  exact path=\"/verify/:token\"/>\r\n        <Route component={ResetPass} exact path=\"/reset-password/:token\"/>\r\n        <Route> <Redirect to='/'/> </Route>\r\n    </Switch>\r\n    \r\n    </StreamContext>\r\n    </MediaContext>\r\n    </RoomsContext>\r\n    </AuthContext>\r\n    </Router>\r\n\r\n    <style global jsx>{`\r\n      @import \"src/variables.scss\";\r\n\r\n      #layout {\r\n        text-align:center;\r\n        background:$background;\r\n      }  \r\n\r\n      #title {\r\n        color:$text;\r\n        filter: invert(.5) brightness(0.5);\r\n        mix-blend-mode: luminosity;\r\n      }\r\n\r\n      .z-top{\r\n        z-index:1000;\r\n      }\r\n      \r\n    `}</style>\r\n  </div>\r\n}","import {Button} from 'react-bootstrap'\r\nimport { useHistory } from 'react-router-dom'\r\n\r\nimport MD from 'utils/md';\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default ()=>{\r\n    const history = useHistory();\r\n    function onHide(){\r\n        history.push('/') \r\n    }\r\n    return <>\r\n        <Modal size=\"md\" show={true} \r\n            title={<h2 className=\"user-select-none\">User verified!🎉</h2>}\r\n            closeButton\r\n            backdrop=\"static\"\r\n            onHide={ onHide }\r\n            buttons={[<Button onClick={onHide} >Return to Login</Button>]}\r\n        >\r\n            <MD className=\"user-select-none\">{`Account verified successfully in the system. You can now login on the application.`}</MD>\r\n        </Modal> \r\n    </>\r\n}","import toast from 'react-hot-toast'\r\nimport { useState, useEffect, useRef } from 'react'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport { Form, FloatingLabel, OverlayTrigger, Tooltip, Button} from 'react-bootstrap'\r\n\r\nimport http from 'utils/http'\r\nimport MD from 'utils/md'\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default ()=>{\r\n    let { token } = useParams();\r\n    const history = useHistory();\r\n\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated] = useState(undefined);\r\n    const [formvalues, setFormValues] = useState({formErrors:{}});\r\n\r\n    function handleUserInput (e) {\r\n        const name = e.target.name;\r\n        const value = e.target.value;\r\n        validateField(name, value);\r\n    }\r\n\r\n    function validateField(name, value){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(name){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                const pass_re =  /^[a-zA-Z]+(.){7,20}$/;\r\n                check = pass_re.test(value);\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default: console.warn(\"Invalid field name: \", name);\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n    \r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error?.length? '' : 'has-error');\r\n    }\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        const toastId = toast.loading('Resetting password...');\r\n        const password = formvalues.password;\r\n        await http.post(`${process.env.REACT_APP_API_URL}/reset-password/${token}`, {data:{password}})\r\n        .then( ({error, message }) => {\r\n            if (error) {\r\n                return toast.error(`onResetPassword: ${message}`, { id: toastId });\r\n            }\r\n            else{\r\n                toast.success('Success', {id: toastId});\r\n                setTimeout( ()=>history.push(`/`), 1000);\r\n            }\r\n        })\r\n        .catch(err => {\r\n            toast.error(`Error: ${err}`, {id: toastId});\r\n        });\r\n    }\r\n\r\n    return <>\r\n        <Modal closeButton show={true} \r\n            setShow={()=>history.push(`/`)}\r\n            onHide={() => history.push(\"/\")} \r\n            title={<h2 className=\"user-select-none\">Reset password</h2>}\r\n            buttons={[\r\n                <OverlayTrigger placement=\"bottom\"\r\n                overlay={\r\n                    <Tooltip className={`${validated?\"d-none\":\"\"} mt-2`}  id={`tooltip-bottom`}>\r\n                        Check form errors\r\n                    </Tooltip>\r\n                }\r\n                >\r\n                    <Button type=\"submit\" onClick={handleSubmit} disabled={!validated} > Proceed </Button>\r\n                </OverlayTrigger>\r\n            ]}\r\n        >\r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <MD className=\"user-select-none\">{ \"Please enter your new password.\"}</MD>\r\n                \r\n                <FloatingLabel controlId=\"floatingPassword\" label=\"New Password\">\r\n                    <Form.Control required name=\"password\" type=\"password\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.password??\"\"}/>\r\n                </FloatingLabel>\r\n            </Form> \r\n        </Modal> \r\n\r\n    </>\r\n}","import React, {useEffect, useState, useReducer} from 'react';\r\nimport { Button, Image } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport logo from 'assets/img/logo.png';\r\n\r\nexport default () => {\r\n    const [show, setShow] = useState(false);\r\n    const [proposal, dispatch] = useReducer((o,n)=>n, {proposalEvent : undefined});\r\n    useEffect(() => { \r\n            window.addEventListener('beforeinstallprompt',onBeforeInstallPrompt, 0);\r\n        return () => { \r\n            window.removeEventListener('beforeinstallprompt',onBeforeInstallPrompt, 0);\r\n        }\r\n    },[]);\r\n\r\n    function onBeforeInstallPrompt(e) \r\n    {\r\n        debugger;\r\n        e.preventDefault();\r\n        dispatch(state => ({...state, e}));\r\n    }\r\n\r\n    async function promptInstall()\r\n    {\r\n        if(!proposal?.proposalEvent) \r\n            return;\r\n\r\n        proposal.proposalEvent.prompt();\r\n        const { outcome } = await proposal.proposalEvent.userChoice;\r\n        if (outcome === 'accepted') {\r\n            dispatch(state => ({ ...state, proposalEvent: undefined }));\r\n        }\r\n    }\r\n\r\n    return <>\r\n        <Button variant=\"link\" onClick={ ()=>setShow(1) }>About</Button>\r\n        {/* <Button variant={`${proposal.proposalEvent?\"outline-primary\":\"outline-secondary\"}`}size=\"sm\" onClick={promptInstall} disabled={!proposal.proposalEvent}> {`${proposal.proposalEvent? \"Install PWA\" : \"Not available\"}`}</Button> */}\r\n        <Modal closeButton size=\"md\" {...{show, setShow}} title={<span>{process.env.REACT_APP_NAME} </span>}>\r\n        <Image className=\"me-2 float-end\" width={48} height={48} src={logo} />\r\n        <MD>{`\r\n        **AdMiRe** is an european project which goal is to develop, validate and demonstrate innovative solutions based on Mixed Reality (MR) technologies.\r\n\r\n        The application has the following features:\r\n        - Lobby management to create virtual productions\r\n        - Videoconferences to communicate users and operators\r\n        - Video streaming and routing capabilities\r\n        `}</MD>\r\n        </Modal>\r\n    </>;\r\n}","import React, {useState, useContext, useRef } from 'react';\r\nimport { Row, Col, Form, FloatingLabel, ButtonGroup, Button, Image } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\n\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\nimport profile_img from 'assets/img/profile_light.png'\r\n\r\nexport default () => {\r\n    const ref = useRef(null);\r\n    const auth = useContext(AuthContext);\r\n    const rooms = useContext(RoomsContext);\r\n    const [show, setShow] = useState(false);\r\n    \r\n    //introduction message to user settings panel\r\n    \r\n    async function submit(){\r\n        if ( !ref?.current || !show ) return;\r\n        let [username, email, bla, avatar, name, surname, birthdate] = Array.from(ref.current.elements).map(v => v.value);\r\n        auth.updateUserInfo({username, email, avatar, name, surname, birthdate});\r\n    }\r\n\r\n    async function clear() {\r\n        console.log(\"TODO: clear user info\");\r\n    }\r\n\r\n    if(!auth.isLogged || !rooms.current) return <></>;\r\n    return <>\r\n        <Button variant=\"link\" onClick={ ()=>setShow(1) }>Profile</Button>\r\n       \r\n\r\n        <Modal closeButton size=\"lg\" {...{show, setShow}} \r\n        title={ <h2 className=\"user-select-none\">Profile</h2>}\r\n        buttons={[\r\n        <Button onClick={auth.logout}><i className=\"bi bi-power\"></i> Sign out</Button>\r\n        ,      \r\n        \r\n        // <div align=\"center\" className=\"fw-bolder\">\r\n        // <ButtonGroup>\r\n        //     <Button onClick={submit} variant = \"outline-primary\">Save</Button>\r\n        //     <Button onClick={clear} variant = \"outline-secondary\">Discard</Button>\r\n        // </ButtonGroup>\r\n        // </div>\r\n        ]}\r\n        >\r\n        <Row>\r\n        <Col xs={6}>\r\n            <Col xs=\"auto\" className=\"text-center mb-2\">\r\n                <Image\r\n                    id=\"avatar-img\"\r\n                    src={ auth.user?.avatar.length? auth.user?.avatar : profile_img }\r\n                    roundedCircle\r\n                    //className='position-absolute top-0 start-50 bg-danger shadow'\r\n                    width=\"128\" height=\"128\"\r\n                />\r\n            </Col>\r\n            <Col>\r\n            <MD className=\"user-select-none\">{`\r\n                # Welcome ${auth.user.username}!\r\n                This panel is where you can change your profile information. You can also change your password.\r\n                If you have any questions, please contact us.\r\n                `}</MD>\r\n            </Col>\r\n        </Col>\r\n        <Col xs={6}>\r\n            <Form ref={ref}>\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"username\">     <Form.Control disabled name='username'   placeholder='username'   defaultValue={auth.user.username}/*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['username'  ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"email\">        <Form.Control disabled name='email'      placeholder='email'      defaultValue={auth.user.email}/*onChange={handleUserInput}*/ type=\"email\"     /*defaultValue={formvalues['email'     ]}*/     />      </FloatingLabel>} />{/*value={userEmail} onChange={event => setEmail(event.target.value)} isInvalid={!isEmailValid} /> */}\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"password\">     <Form.Control disabled name='password'   placeholder='password'   defaultValue={auth.user}/*onChange={handleUserInput}*/ type=\"password\"  /*defaultValue={formvalues['password'  ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"avatar URL\">   <Form.Control disabled name='avatar'     placeholder='avatar URL' defaultValue={auth.user.avatar}/*onChange={handleUserInput}*/ type=\"avatar\"    /*defaultValue={formvalues['avatar URL']}*/     />      </FloatingLabel>} />{/*value={image_url !== '' ? image_url : userEmail !== '' ? gravatar_url : ''} onChange={event => setImageURL(event.target.value)} */}\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"name\">         <Form.Control disabled name='name'       placeholder='name'       defaultValue={auth.user.name}/*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['name'      ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"surname\">      <Form.Control disabled name='surname'    placeholder='surname'    defaultValue={auth.user.surname}/*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['surname'   ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"birthddate\">   <Form.Control disabled name='birthdate'  placeholder='birthdate'  defaultValue={auth.user.birthdate}/*onChange={handleUserInput}*/ type=\"date\"      /*defaultValue={formvalues['birthdate' ]}*/     />      </FloatingLabel>} />\r\n            </Form>\r\n        </Col>\r\n  \r\n        </Row>\r\n        </Modal>\r\n        <style global jsx>{`\r\n\r\n            #avatar-img{\r\n                background: #444;\r\n            }\r\n\r\n        `}</style>\r\n    </>;\r\n}","import screenfull from 'screenfull'\r\nimport { Button } from 'react-bootstrap'\r\n\r\nexport default () => {  \r\n\r\n    function handleClick(){\r\n        screenfull.toggle();\r\n        document.inFullscreen = !document.inFullscreen;\r\n\r\n        const fsButton = document.getElementById('FS-Button');\r\n        if(fsButton) {\r\n            const icon = fsButton.children[0];\r\n            icon.className = document.inFullscreen ? \"bi bi-fullscreen-exit\" : \"bi bi-fullscreen\";\r\n        }\r\n    }\r\n\r\n    return <div id=\"btn_fullscreen\">\r\n        { screenfull.isEnabled && \r\n            <Button id=\"FS-Button\"\r\n            onClick={handleClick} variant=\"link\"> \r\n            {  <i className=\"bi bi-fullscreen\"/> }\r\n            </Button>    \r\n        }\r\n    </div>;\r\n}","import {useContext} from 'react'\r\nimport {Image} from 'react-bootstrap'\r\nimport logo from \"assets/img/logo.png\"\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\nexport default () => {\r\n    const rooms    = useContext(RoomsContext);\r\n\r\n    return <>\r\n        <div id=\"title\" variant=\"none\" className=\"d-flex m-3 position-absolute top-0 start-0 user-select-none\">\r\n            <Image className=\"me-2\" width={32} height={32} src={logo} />\r\n            <h1 id=\"app-name\" className=\"fs-3\">{process.env.REACT_APP_NAME}</h1>\r\n            {rooms?.current && <h1 className=\"fs-3\"> #{rooms?.current?.name}</h1>}\r\n        </div>\r\n\r\n        <style global jsx>{`\r\n            @import \"src/variables.scss\";\r\n\r\n            @media only screen and (orientation: portrait) {\r\n\r\n                #app-name {\r\n                    display: none;\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n\r\n    </>\r\n}","import React from 'react';\r\nimport { Modal, Button } from 'react-bootstrap';\r\n\r\nexport default ({title, children, show, setShow, callback, buttons, closeButton, ...props}) => {\r\n\r\n    function Hide() {\r\n        setShow(false);\r\n    }\r\n\r\n    return <>\r\n        <Modal\r\n            centered\r\n            show={show}\r\n            keyboard={true}\r\n            onHide={Hide}\r\n            dialogClassName=\"modal-partial modal-shadow-lg\"\r\n            {...props}\r\n        >\r\n            {(closeButton && title) && <Modal.Header closeButton={closeButton} >\r\n                <Modal.Title className=\"user-select-none\">{title}</Modal.Title>\r\n            </Modal.Header>}\r\n            \r\n            <Modal.Body>\r\n                {children}\r\n            </Modal.Body>\r\n\r\n            { (buttons || closeButton) && <Modal.Footer className=\"flex-nowrap\">\r\n                {buttons && buttons.map( (v,k,a) => v )}\r\n                {closeButton && <Button variant=\"outline-secondary\" onClick={Hide}> Close</Button>}\r\n            </Modal.Footer>} \r\n        </Modal>\r\n\r\n        <style global jsx>{`\r\n            @import 'src/variables.scss';\r\n\r\n            .modal-dialog{\r\n                max-height: calc(100vh - 1rem);\r\n                outline: none !important;\r\n            }\r\n            .modal-partial.modal-shadow-lg.modal-md.modal-dialog-centered:focus-visible {\r\n                outline: none;\r\n            }\r\n\r\n            .modal-content{\r\n                // max-height: 90vh;\r\n                //overflow: hidden;\r\n            }\r\n\r\n            .modal-lg > .modal-content{\r\n                min-height: 50vh;\r\n                //overflow-y: scroll;\r\n                //overflow-x: hidden;\r\n            }\r\n\r\n            .modal-partial {\r\n                .modal-title {\r\n                    font-weight: lighter;\r\n                    font-family: $header-font;\r\n\r\n                    h1,h2,h3,h4,h5,h6 {padding:0; margin:0}\r\n                }\r\n\r\n                .modal-header{\r\n                    padding-bottom: .2em;\r\n                }\r\n\r\n                .modal-footer{\r\n                    padding: 0 0.75rem;\r\n                }\r\n            }\r\n            \r\n\r\n            /* -----------------------------------------\r\n                Wearables\r\n            ----------------------------------------- */\r\n\r\n            /* ----------- Moto 360 Watch ----------- */\r\n            @media (max-device-width: 218px)and (max-device-height: 281px) { \r\n\r\n            }\r\n\r\n            /* ----------- Non-Retina Screens ----------- */\r\n            @media screen \r\n            and (min-device-width: 1200px) \r\n            and (max-device-width: 1600px) \r\n            and (-webkit-min-device-pixel-ratio: 1) { \r\n            }\r\n\r\n            /* ----------- Retina Screens ----------- */\r\n            @media screen \r\n            and (min-device-width: 1200px) \r\n            and (max-device-width: 1600px) \r\n            and (-webkit-min-device-pixel-ratio: 2)\r\n            and (min-resolution: 192dpi) { \r\n            }\r\n\r\n            /* Smartphones (landscape) ———– */\r\n            @media only screen\r\n            and (min-width : 321px) {\r\n            /* Styles */\r\n            }\r\n\r\n            /* Large Desktop and Laptop Screens (devices and browsers) */\r\n            @media only screen and (min-width: 1824px) {}\r\n\r\n            /* Tablet Devices, Desktop and Laptop Screens */\r\n            @media only screen and (max-width: 768px) {}\r\n\r\n            /* iPads (portrait and landscape) */\r\n            @media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {}\r\n\r\n            /* Smartphones (portrait and landscape) */\r\n            @media only screen and (min-device-width: 320px) and (max-device-width: 480px) {}\r\n\r\n            /* iPhone 4 */\r\n            @media only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen and (min-device-pixel-ratio: 1.5) {}\r\n\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {\r\n                .modal-content{\r\n                    //max-width: 38rem !important;\r\n                    //margin-right: 6.5rem !important;\r\n                }\r\n                .modal-md{\r\n                    max-width: 800px !important;\r\n                }\r\n                  /* Tablet Devices, Desktop and Laptop Screens */\r\n                @media only screen and (max-width: 674px) {\r\n                    .modal-dialog{\r\n                    //max-width: 38rem !important;\r\n                    margin-right: 6.5rem !important;\r\n                }\r\n                }\r\n            }\r\n            @media only screen and (orientation: portrait){\r\n\r\n            }      \r\n        `}</style>\r\n    </>;\r\n}","function Nav({children}){\r\n\r\n    return <>\r\n\r\n        <div className=\"nav-partial px-3 mb-1 d-flex justify-content-evenly align-items-center position-absolute start-50 translate-middle-x shadow rounded-5 bg-light\" style={{ zIndex: 1000}}>\r\n            { children.map( (v,k) => v && <div key={'nav-i-'+k}>{v}</div>) }\r\n        </div>\r\n\r\n        <style global jsx>{`\r\n            @import \"node_modules/bootstrap/scss/_functions.scss\";\r\n            @import \"node_modules/bootstrap/scss/_variables.scss\";\r\n            @import \"src/variables.scss\";\r\n\r\n            .rounded-5{\r\n                border-radius: .5em;\r\n            }\r\n            .nav-partial{\r\n                min-width: 1rem;\r\n                min-height: 1rem;\r\n                transition: all .2s ease-in-out;\r\n                bottom: 15px !important;\r\n            }\r\n            .nav-button, .nav-item{\r\n                color: $secondary;\r\n                cursor: pointer;\r\n                height: 100%;\r\n                width: auto;\r\n                user-select: none;\r\n                transition: all .2s ease-in-out;\r\n\r\n                & i{\r\n                    transform: scale(1.5);\r\n                    width: 50px;\r\n                    overflow: hidden;\r\n                    padding:0;\r\n                    margin:0;\r\n                    user-select: none;\r\n                    text-transform: capitalize;\r\n\r\n                }\r\n                &:hover{\r\n                    color:  lighten($danger,15%);\r\n                }\r\n            }\r\n\r\n            .nav-item{\r\n                height: 44px;\r\n            }\r\n\r\n            .nav-item-active{\r\n                color: red !important;\r\n            }\r\n\r\n            .nav-item-disabled{\r\n                opacity: .35;\r\n                user-select: none !important;\r\n                pointer-events:none;\r\n                cursor: not-allowed;\r\n                &:hover{\r\n                    opacity: .35;\r\n                }\r\n            }\r\n\r\n\r\n            .nav-button{\r\n                color: black !important;\r\n                height: 3.5rem;\r\n                width: 3.5rem;\r\n                line-height: 3rem;\r\n                margin-top: -1.5rem;\r\n                margin-bottom: 1.5rem;\r\n\r\n                &:hover{\r\n                    color:  lighten($danger,50%) !important;\r\n                }\r\n            }\r\n\r\n            .dark-mode{\r\n                &.navpartial, .nav-partial{\r\n                    background-color: transparent !important;\r\n                    border: 1px solid rgba(255,255,255, .25);\r\n\r\n                    .nav-item{\r\n                        color: invert($secondary,50%);\r\n                        &:hover{\r\n                            color:  lighten($danger,15%);\r\n                            filter: saturate(120%) drop-shadow(0 0 .1rem $danger);\r\n                        }\r\n                    }\r\n\r\n                    .nav-button{\r\n                        filter: saturate(80%);\r\n                        background: $color1 !important;\r\n                        line-height: 2.8rem;\r\n                        border: 2px solid $danger;\r\n                        color: $danger !important;\r\n\r\n                        &:hover{\r\n                            filter: saturate(120%) drop-shadow(0 0 .1rem $danger);\r\n                            color:  $danger !important;\r\n                            border: 2px solid $danger;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n                .nav-partial{\r\n                    flex-direction: column;\r\n                    //top: 50%;\r\n                    left: 100% !important;\r\n                    transform: translate(-100%, 0%) !important;\r\n                    margin-left: -1.1rem;\r\n                    padding:1.251rem 0 !important;\r\n\r\n                    .nav-button{\r\n                        margin:0;\r\n                        margin-left: -1.5rem;\r\n                        margin-right: 1.5rem;\r\n                    }\r\n                }\r\n            }\r\n            @media only screen and (orientation: portrait){\r\n\r\n            } \r\n        `}</style>\r\n    </>\r\n}\r\n\r\n\r\nNav.Item = function({children, icon, disabled, to, ...props}){\r\n    return <div to={to??\"/\"} className={`nav-item ${disabled?\"nav-item-disabled\":\"\"} ${props.appendclass??\"\"}`} {...props}>\r\n        <div className={`d-flex flex-column fs-6 fw-lighter`} >{children}</div>\r\n    </div>\r\n}\r\n\r\nNav.Button = function({children,...props}){\r\n    return <div className={`nav-button ${props.appendclass??\"\"}`} {...props}>\r\n        <div className=\" pt-1 fs-1 fw-lighter\">{children}</div>\r\n    </div>\r\n}\r\n\r\nexport default Nav;","import toast from 'react-hot-toast';\r\nimport {useState, useContext, useRef} from 'react'\r\nimport {Badge, Button, Form, FloatingLabel, Spinner} from 'react-bootstrap'\r\nimport Modal from 'partials/modal'\r\nimport { StreamContext } from 'utils/ctx_streaming'\r\n\r\nlet defaultMediaHubTarget = 'mediarouter';\r\n\r\nexport default ({callId, isForwardCall})=>{\r\n    const wrtc     = useContext(StreamContext);\r\n    const ref = useRef(null);\r\n    const [show, setShow] = useState(null);\r\n    const [fetching, setFetching] = useState(0);//0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n\r\n    let [mediaHubCallId, forwardedCallId] = wrtc.getLiveCall(callId); //eslint-disable-line\r\n    \r\n    function submit() {\r\n\r\n        if ( !ref?.current || !show )\r\n            return setShow(false);\r\n\r\n        setFetching(true);            \r\n\r\n        const [forwardingCallId, mediaHubtarget] = [callId, ref.current.value];\r\n\r\n        function callback({event, data}) {\r\n\r\n            defaultMediaHubTarget = mediaHubtarget;\r\n\r\n            const {callid, callee, caller, error, message} = data;\r\n            if(error)\r\n            {                \r\n                setFetching(3);           \r\n                setTimeout( () => { setFetching(0); } , 2000);\r\n                toast.error(`Mediahub Call response error: ${message}`, {duration: 5000});\r\n            }\r\n            else {\r\n                // Success\r\n                setFetching(2);   \r\n                setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n                wrtc.forwardCall(forwardingCallId, callid);\r\n            }\r\n        }\r\n\r\n        if(!wrtc.callUser(mediaHubtarget, callback, forwardingCallId))\r\n        {\r\n            setFetching(3);   \r\n            toast.error(`Call missed to backend`);\r\n            setTimeout( () => { setFetching(0); } , 2000);\r\n        }\r\n    }\r\n\r\n    function onKeyDown(e){\r\n        if(e.keyCode === 13)\r\n        submit()\r\n    }\r\n\r\n    let button;\r\n    switch(fetching){\r\n        case 1:  button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2:  button = <Button variant=\"outline-success\" >Done</Button>; break;\r\n        case 3:  button = <Button variant=\"outline-danger\"  >Error</Button>; break;\r\n        default: button = <Button variant=\"outline-primary\" onClick={submit} >Forward</Button>;\r\n    }\r\n\r\n    return <>\r\n        {isForwardCall ? <Badge style={{padding:\".44em .45em\"}} pill bg=\"danger\" onClick={() => wrtc.callHangup( mediaHubCallId )}><i className=\"bi bi-x\"></i></Badge>\r\n        :                <Badge style={{padding:\".44em .45em\"}} pill bg=\"danger\" onClick={() => setShow( callId )} className=\"cursor-pointer\"><i className=\"bi bi-cast\"></i></Badge>}\r\n        <Modal {...{show,setShow}}  buttons={[button]}  closeButton title=\"Forward stream\" onKeyDown={onKeyDown}>\r\n            Enter the destination ID you want to forward to:\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"targetId\" className=\"mb-3\">\r\n                <Form.Control ref={ref} name=\"targetId\" type=\"text\" defaultValue={defaultMediaHubTarget} placeholder=\"mediahub target id\"/>\r\n            </FloatingLabel>\r\n        </Modal>\r\n    </>;\r\n}","import { useState, useContext, useEffect, useRef } from 'react'\r\nimport { Row, Col, Button, FloatingLabel, Form, Spinner } from 'react-bootstrap'\r\n\r\nimport http from 'utils/http'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport { StreamContext } from 'utils/ctx_streaming'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\n\r\nlet lutResponse = null;\r\n\r\nconst F_NONE = 0;\r\nconst F_PROCESS = 1;\r\nconst F_SUCCESS = 2;\r\nconst F_ERROR = 3;\r\n\r\nexport default () => {\r\n    const videoARef = useRef(null);\r\n    const videoBRef = useRef(null);\r\n    const auth        = useContext(AuthContext);\r\n    const rooms       = useContext(RoomsContext);\r\n    const media       = useContext(MediaContext);\r\n    const wrtc        = useContext(StreamContext);\r\n    const [show, setShow] = useState(false);\r\n    const [A, setA] = useState('local');\r\n    const [B, setB] = useState('local');\r\n    const [fetching, setFetching] = useState(0);//0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n    useEffect(()=>{//Constructor\r\n        if(!rooms.ready || !media.ready) return;\r\n        return ()=>{//Destructor\r\n    }},[rooms.ready, media.ready]);\r\n\r\n    useEffect(()=>{//Constructor\r\n        if(!A || !videoARef.current) return;\r\n        videoARef.current.srcObject = wrtc.streams[A];\r\n        return ()=>{//Destructor\r\n    }},[A, wrtc.streams]);\r\n\r\n    useEffect(()=>{//Constructor\r\n        if(!B || !videoBRef.current) return;\r\n        videoBRef.current.srcObject = wrtc.streams[B];\r\n        return ()=>{//Destructor\r\n    }},[B, wrtc.streams]);\r\n    \r\n    function refreshStreams() {\r\n        if(A && videoARef.current)\r\n            videoARef.current.srcObject = wrtc.streams[A];\r\n        if(B && videoBRef.current)\r\n            videoBRef.current.srcObject = wrtc.streams[B];\r\n    }\r\n\r\n    function byteSize(str) {\r\n        if(str.constructor !== String)\r\n            str = JSON.stringify( str );\r\n        return new Blob([str]).size;\r\n    }\r\n\r\n    function onOpen() {\r\n        setShow(s => !s);\r\n        setTimeout( refreshStreams, 100 );\r\n    }\r\n\r\n    function snapshot(video)\r\n    {   \r\n        const canvas  = document.createElement('canvas');\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        const ctx      = canvas.getContext('2d');\r\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n        return canvas.toDataURL('image/png');\r\n    }\r\n\r\n    function submit(){\r\n        if(!A || !B) return;\r\n        const base64Studio = snapshot( videoARef.current );\r\n        const base64Actor = snapshot( videoBRef.current );\r\n\r\n        let body = {\r\n            studio: base64Studio,\r\n            actor: base64Actor\r\n        }\r\n\r\n        console.log(\"Request body size (bytes) \" + byteSize( body ));\r\n        setFetching(F_PROCESS);\r\n\r\n        http.post(\"https://admire-dev-iq.brainstorm3d.com/image/lut\", {data: body})\r\n        .then(response =>  { \r\n          \r\n            setFetching(F_SUCCESS);\r\n            setTimeout( () => { setFetching(F_NONE); } , 1500);\r\n            lutResponse = response;\r\n        }).catch(err => {\r\n            setFetching(F_ERROR);\r\n            console.error(err);\r\n        })\r\n    }\r\n\r\n    function downloadLUT()\r\n\t{\r\n\t\tif(!lutResponse)\r\n            throw(\"No LUT\");\r\n\r\n        let filename = A + \"_\" + B + \".lut\";\r\n\t\tlet file = new Blob( [lutResponse.lut], {type : 'text/plain'});\r\n\t\tvar url = URL.createObjectURL( file );\r\n\t\tvar element = document.createElement(\"a\");\r\n\t\telement.setAttribute('href', url);\r\n\t\telement.setAttribute('download', filename );\r\n\t\telement.style.display = 'none';\r\n\t\tdocument.body.appendChild(element);\r\n\t\telement.click();\r\n\t\tdocument.body.removeChild(element);\r\n\t\tsetTimeout( () => URL.revokeObjectURL( url ) , 1000 * 60 ); //wait one minute to revoke url\r\n\t}\r\n\r\n    let buttons = [];\r\n    let submitButton;\r\n\r\n    switch(fetching){\r\n        case F_PROCESS: submitButton = <Button variant=\"outline-primary\"><Spinner as=\"span\" animation=\"border\" size=\"sm\" role=\"status\" aria-hidden=\"true\"/></Button>; break;\r\n        case F_SUCCESS: submitButton = <Button variant=\"outline-success\">Done</Button>; break;\r\n        case F_ERROR: submitButton = <Button variant=\"outline-danger\">Error</Button>; break;\r\n        default: submitButton = <Button onClick={submit} >Submit</Button>;\r\n    }\r\n\r\n    if(lutResponse) {\r\n        buttons.push( <Button variant=\"link\" onClick={downloadLUT}>Download LUT <i className=\"bi bi-download\"/></Button> );\r\n    }\r\n\r\n\r\n    buttons.push( submitButton );\r\n\r\n    return <>\r\n        <Button className=\"lutButton\" onClick={onOpen} ><i className=\"bi bi-magic\"/> Color Calibration</Button>\r\n        <Modal buttons={buttons} id='configure' tabIndex=\"0\" closeButton size=\"lg\" {...{show, setShow}} _title={<span>Settings: Wizard</span>}>\r\n            <Row id='devices-row'>\r\n                <Col md={6}>\r\n                    <h4>Studio</h4>\r\n                    <video autoPlay muted className=\"lutVideo mirrored mx-auto d-block\" ref={videoARef} style={{width:\"100%\", marginBottom: \"6px\"}}/>\r\n                    {/*<Video muted fref={videoARef} stream={wrtc.streams[A]}/>*/}\r\n                    <FloatingLabel className=\"pb-1\" controlId=\"floatingSelect\" label={<span> <i className=\"bi bi-camera-video\" /> Video devices</span>}>\r\n                    <Form.Select value={A} onChange={({ target }) => {\r\n                        setA(target.value);\r\n                    }}>\r\n                    {Object.keys(wrtc.streams).map((v, k) => <option key={k} value={v}>{v}</option>)}\r\n                    </Form.Select>\r\n                    </FloatingLabel>\r\n                </Col>\r\n                <Col md={6}>\r\n                    <h4>Actor</h4>\r\n                    <video autoPlay muted className=\"lutVideo mirrored mx-auto d-block\" ref={videoBRef} style={{width:\"100%\", marginBottom: \"6px\"}}/>\r\n                    {/*<Video muted fref={videoBRef} stream={wrtc.streams[B]}/>*/}\r\n                    <FloatingLabel className=\"pb-1\" controlId=\"floatingSelect\" label={<span> <i className=\"bi bi-camera-video\" /> Video devices</span>}>\r\n                    <Form.Select value={B} onChange={({ target }) => {\r\n                        setB(target.value);\r\n                    }}>\r\n                   {Object.keys(wrtc.streams).map((v, k) => <option key={k} value={v}>{v}</option>)}\r\n                    </Form.Select>\r\n                    </FloatingLabel>\r\n                </Col>\r\n            </Row>\r\n        </Modal>\r\n        <style global jsx>{`\r\n\r\n            .my-float-left {\r\n                margin: 0 auto !important;\r\n                margin-left: 0px !important;\r\n            }\r\n\r\n            .mirrored {\r\n                transform: rotateY(180deg);\r\n                -webkit-transform:rotateY(180deg); /* Safari and Chrome */\r\n                -moz-transform:rotateY(180deg); /* Firefox */\r\n            }\r\n            \r\n            @media only screen and (orientation: portrait){\r\n\r\n                .lutButton {\r\n                    margin-bottom: 6px;\r\n                }\r\n\r\n                .lutVideo{\r\n                    width: 70% !important;\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </>;\r\n}","//import { useEffect } from 'react';\r\nimport { useParams } from \"react-router-dom\"\r\nimport { Row, Col, Badge, Button } from 'react-bootstrap'\r\nimport { useContext, useLayoutEffect, useEffect, useState, useRef } from 'react'\r\n\r\nimport Video from 'partials/video'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport { StreamContext } from 'utils/ctx_streaming'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport BadgeForwardCall from 'components/badge_forward'\r\nimport ButtonComposite from 'components/modal_composite'\r\n\r\n\r\nexport default function Room({ ...props }){\r\n    const {roomId}    = useParams();\r\n    const carouselRef = useRef();\r\n    const auth        = useContext(AuthContext);\r\n    const rooms       = useContext(RoomsContext);\r\n    const media       = useContext(MediaContext);\r\n    const wrtc        = useContext(StreamContext);\r\n    const [selected, setSelected] = useState(null);\r\n\r\n    useLayoutEffect(()=>{//Constructor\r\n        if(!rooms.imInRoom(roomId) || !rooms.ready || !media.ready) \r\n            return;\r\n\r\n        wrtc.callAllUsers();\r\n    return ()=>{//Destructor\r\n        wrtc.callHangupAll();\r\n    }},[rooms.ready, media.ready]);\r\n\r\n    useEffect( ()=>{\r\n        wrtc.replaceStream(media.localStream);\r\n    },[media.localStream]);\r\n\r\n    function scrollLeft() {\r\n        let carousel = document.getElementById('carousel');\r\n        const videoItem = document.querySelectorAll('.carouselVideoItem')[0];\r\n        carousel.scrollLeft = Math.max( carousel.scrollLeft - videoItem.clientWidth - 4, 0 );\r\n    }\r\n\r\n    function scrollRight() {\r\n        let carousel = document.getElementById('carousel');\r\n        const videoItem = document.querySelectorAll('.carouselVideoItem')[0];\r\n        carousel.scrollLeft = Math.min( carousel.scrollLeft + videoItem.clientWidth + 4, carousel.scrollWidth );\r\n    }\r\n\r\n    return <div id=\"room\" className=\"overflow-hidden m-auto\" style={{zIndex:1000}}>\r\n        <Row  id=\"content-row\" className=\"g-2\" style={{ height:\"100%\" }}>\r\n            <Col xs=\"auto\" id=\"carousel-col\" ref={carouselRef}>\r\n                <Button onClick={ scrollLeft } className=\"float-start scrollButton\" variant=\"outline-light\"><i className=\"bi bi-caret-left-fill\" /></Button>\r\n                {auth.user.username === rooms.current?.master.username && <ButtonComposite/>}\r\n                <Button onClick={ scrollRight } className=\"float-end scrollButton\" variant=\"outline-light\"><i className=\"bi bi-caret-right-fill\" /></Button>\r\n                <div id=\"carousel\" className=\"d-flex flex-column\" >\r\n                {  Object.entries({local:media.localStream, ...wrtc.streams}).map(([callId, stream], k)=>{\r\n\r\n                    let id = wrtc.getUserId(callId);\r\n                    let imMaster = auth.user.username === rooms.current?.master.username;\r\n                    let [mediaHubCallId, forwardedCallId] = wrtc.getLiveCall(callId); //eslint-disable-line\r\n                    let isForwardCall = !!forwardedCallId;\r\n                    let isMediahubCall = mediaHubCallId === callId;\r\n                    let isSelected = selected === callId || (!selected && k === 0);\r\n\r\n                    return <div key={k} className=\"carouselVideoItem\">\r\n                        <div className=\"stream-forward\">\r\n                            { imMaster && <BadgeForwardCall callId={callId} isForwardCall={isForwardCall}/> }\r\n                            { isSelected && <Badge pill bg=\"primary\"><i className=\"bi bi-eye active\"/></Badge> }\r\n                        </div>\r\n                        {!isMediahubCall && <Video isLocal={id === auth.user.username} key={callId} id={id} stream={stream} className={!isSelected?\"cursor-pointer\":\"\"} onClick={()=>{setSelected(callId)}}/>}\r\n                    </div>\r\n                })}\r\n                </div>\r\n            </Col>\r\n            <Col id=\"main-col\">\r\n                <Video isLocal={wrtc.getUserId(selected) === auth.user.username} className=\"main-video\" id={wrtc.getUserId(selected)} stream={wrtc.streams[selected]??media.localStream} />\r\n            </Col>\r\n        </Row>\r\n\r\n        <style global jsx>{`\r\n            @import \"src/variables.scss\";\r\n\r\n            .scrollButton {\r\n                display: none;\r\n            }\r\n\r\n            #room{\r\n                height:calc(100vh - 3rem - 4.5rem);\r\n\r\n                #main-col {\r\n                    height: 100%;\r\n                    overflow: hidden;\r\n\r\n                    .Video\r\n                    {\r\n                        width: calc( 100% - 1px);\r\n                        height:100%;\r\n                        object-fit: cover;\r\n                    }\r\n                }\r\n\r\n                #carousel-col {\r\n                    height: 100%;\r\n                    width:166px;\r\n                    \r\n                    #carousel{\r\n                        overflow-x: hidden;\r\n                        overflow-y: scroll;\r\n                        height:100%;\r\n                        padding-bottom: 63px;\r\n\r\n                        .Video{\r\n                            padding-right: 1px;\r\n                            padding-bottom: 2px;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                .carouselVideoItem {\r\n                    margin-top: 8px;\r\n                    border: none;\r\n                    border-bottom: 1px solid $color4;\r\n                }\r\n\r\n                .carouselVideoItem:hover{\r\n                    margin-top: 8px;\r\n                    border-bottom: none;\r\n                }\r\n\r\n                .stream-forward{\r\n                    height:1.9rem;\r\n                    position:relative;\r\n                    margin-bottom:-1.9rem;\r\n                    text-align:left;\r\n                    padding:3px 6px;\r\n                    z-index:1000;\r\n                }\r\n\r\n                .stream-controls{\r\n                    margin-bottom: 5.5rem;\r\n                }\r\n            }\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n                #room{\r\n                    height:calc(100vh - 2rem);\r\n                }\r\n                \r\n                .stream-controls{\r\n                    margin-bottom: .5rem !important;\r\n                }\r\n        \r\n            }\r\n\r\n            @media only screen and (orientation: portrait){\r\n\r\n                .scrollButton {\r\n                    display: block;\r\n                }\r\n\r\n                .carouselVideoItem {\r\n                    margin-top: 0px !important;\r\n                    margin-right: 3px;\r\n                }\r\n\r\n                .stream-controls{\r\n                    margin-bottom: 5.5rem !important;\r\n                }\r\n\r\n                .stream-status {\r\n                    margin-bottom: 6px;\r\n                }\r\n\r\n                #content-row{ flex-direction: column; }\r\n                #carousel-col{\r\n                    overflow-x: scroll;\r\n                    overflow-y: hidden;\r\n                    height: 170px !important;\r\n                    width: 100% !important;\r\n\r\n                    #carousel{\r\n                        flex-direction: row !important;\r\n                        border:none;\r\n                        padding-bottom: 44px !important;\r\n\r\n                        .Video, .Video video{ \r\n                            width: 166px; \r\n                            height:124px; \r\n                            object-fit: cover;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </div>;\r\n}\r\n\r\n","import React, {useState, useContext, useEffect, useRef  } from 'react';\r\nimport { Button, Form, FloatingLabel, OverlayTrigger, Tooltip } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport toast from 'react-hot-toast';\r\nimport http from 'utils/http'\r\n\r\nexport default () => {\r\n    const formRef = useRef(null);\r\n    const [show, setShow] = useState(false);\r\n    const auth = useContext(AuthContext);\r\n\r\n    const [formvalues, setFormValues] = useState({formErrors:{}});\r\n    const [validated, setValidated] = useState(undefined);\r\n   \r\n    function handleUserInput (e) {\r\n        const name = e.target.name;\r\n        const value = e.target.value;\r\n        validateField(name, value);\r\n    }\r\n\r\n    function validateField(name, value){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(name){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default: console.warn(\"Invalid field name: \", name);\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n\r\n\r\n    useEffect(()=>{\r\n        function validateForm(){\r\n            let isValid = true;\r\n            for( let key in formvalues ){\r\n                if( key.indexOf('_check') !== -1 )\r\n                    isValid &= formvalues[key];\r\n            }\r\n            setValidated( isValid?true:false );\r\n        }\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        const email = formvalues.email.toLowerCase();\r\n        const toastId = toast.loading('Resetting password...');\r\n        await http.post(`${process.env.REACT_APP_API_URL}/forgot-password`, { data: {email} })\r\n        .then(({error, message}) => {\r\n            if (error) {\r\n                return toast.error(`onSubmitRecovery: ${message}`, { id: toastId });\r\n            }\r\n            setShow(false);\r\n            toast.success('Success', { id: toastId });\r\n        })\r\n        .catch(err => {\r\n            toast.error(`onSubmitRecovery: ${err}`, { id: toastId });\r\n        });\r\n    }\r\n\r\n    function hasError(error){\r\n        if(!error) return \"\";\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n    const button =  <OverlayTrigger placement=\"bottom\"\r\n    overlay={\r\n        <Tooltip className={`${validated?\"d-none\":\"\"}`}  id={`tooltip-bottom`}>\r\n            {Object.entries(formvalues.formErrors).map(([key, value]) => { return <span>{key}: {value}</span> }) }\r\n        </Tooltip>\r\n    }\r\n    >\r\n        <span style={{padding:\"10px 0\"}}>\r\n            <Button type=\"submit\" onClick={handleSubmit} disabled={!validated && auth.isConnected} > Send password reset email </Button>\r\n        </span>\r\n    </OverlayTrigger>\r\n\r\n    return <>\r\n        <Button size=\"sm\" className=\"mt-4 forgot-button\" variant=\"link\" onClick={ ()=>setShow(1) }><i className=\"bi bi-lock\"></i> Forgot password?</Button>\r\n        <Modal size=\"md\" closeButton {...{show, setShow}} \r\n        buttons={[button]} \r\n        title={<h2 className=\"user-select-none\">Forgot Password</h2>} \r\n        >\r\n            <MD className=\"user-select-none\">{`Enter your email adress, on a couple of minutes you will receive an email with a link to reset your password.`}</MD>\r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingInput\" label=\"Email address\" className=\"mb-3\">\r\n                    <Form.Control required className={ hasError(formvalues.formErrors?.email)} name=\"email\" type=\"email\" placeholder=\" \" onChange={handleUserInput} />\r\n                </FloatingLabel>\r\n            </Form>\r\n        </Modal>\r\n\r\n        <style global jsx>{`\r\n        @import \"src/variables.scss\";\r\n            \r\n            .forgot-button {\r\n                float: right;\r\n            }\r\n        `}</style>\r\n    </>;\r\n}","import Gravatar from 'gravatar'\r\nimport toast from 'react-hot-toast'\r\nimport React, {useState, useEffect, useRef  } from 'react'\r\nimport { Spinner, Button, Form, FloatingLabel, OverlayTrigger, Tooltip, Card, Image as ReactImage } from 'react-bootstrap'\r\n\r\nimport MD from 'utils/md';\r\nimport http from 'utils/http'\r\nimport Modal from 'partials/modal'\r\nimport profile_img from 'assets/img/profile_light.png'\r\n\r\n\r\nexport default () => {\r\n    const formRef = useRef(null);\r\n    const [show, setShow] = useState(false);\r\n\r\n    const [fetching, setFetching]       = useState(false);\r\n    const [validated, setValidated]     = useState(undefined);\r\n    const [formvalues, setFormValues]   = useState({formErrors:{}});\r\n   \r\n    function handleUserInput (e) {\r\n        const name  = e.target.name;\r\n        const type  = e.target.type;\r\n        const value = type===\"checkbox\"?e.target.checked:e.target.value;\r\n        validateField(name, value, type);\r\n    }\r\n\r\n    function validateField(name, value, type = \"any\"){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n        let values = {...formvalues};\r\n\r\n        function testImage(url, timeoutT) {\r\n            return new Promise(function (resolve, reject) {\r\n                var timeout = timeoutT || 5000;\r\n                var timer, img = new Image();\r\n                img.onerror = img.onabort = function () {\r\n                    clearTimeout(timer);\r\n                    reject(\"Error: the url provided is not an image\");\r\n                };\r\n                img.onload = function () {\r\n                    clearTimeout(timer);\r\n                    resolve(\"success\");\r\n                };\r\n                timer = setTimeout(function () {\r\n                    // reset .src to invalid URL so it stops previous\r\n                    // loading, but doesn't trigger new load\r\n                    img.src = \"//!!!!/test.jpg\";\r\n                    reject(\"timeout\");\r\n                }, timeout);\r\n                img.src = url;\r\n            });\r\n        }\r\n\r\n        switch(type){\r\n            case 'email':\r\n                const email_re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = email_re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                values = { ...values, [name]:value, [`${name}_check`]:check, formErrors };\r\n                if(check){\r\n                    const url = \"https:\"+Gravatar.url(value, { s: '256', r: 'pg', d: '404' });\r\n                    testImage(url, 2000)\r\n                    .then( (v) => { \r\n                        setFormValues( { ...values, gravatar:url,  [`gravatar_check`]:check, formErrors } );\r\n                    })\r\n                    .catch((err) => {\r\n                        setFormValues( { ...values, gravatar:null,  [`gravatar_check`]:check, formErrors } );\r\n                    });\r\n                }else{\r\n                    values = { ...values, gravatar:null,  [`gravatar_check`]:check, formErrors };\r\n                }\r\n\r\n                break;\r\n\r\n            case 'password':\r\n                const pass_re =  /^[a-zA-Z]+(.){7,20}$/;\r\n                check = pass_re.test(value);\r\n                formErrors[name] = check ? '': ' is too short';\r\n\r\n                let confirm = formvalues[\"password\"] === formvalues[\"password1\"];\r\n                formErrors = {...formErrors, confirm: `${!confirm?\"Password and confirmation do not match\":\"\"}`};\r\n                values = {...values, confirm, formErrors };\r\n                break;\r\n\r\n            default:\r\n                check = true;\r\n                formErrors[name] = '';\r\n                break;\r\n        }\r\n        setFormValues( { ...values, [name]:value, [`${name}_check`]:check, formErrors } );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        function validateForm(){\r\n            let isValid = true;\r\n            for( let key in formvalues ){\r\n                if( key.indexOf('_check') !== -1 )\r\n                    isValid &= formvalues[key];\r\n            }\r\n            setValidated( isValid?true:false );\r\n        }\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        let {username, email, password, avatar, gravatar, name, surname, birthdate, role} = formvalues;\r\n        // avatar = avatar?.length? avatar : gravatar??profile_img;\r\n        const toastId = toast.loading('Registering...');\r\n        \r\n        await http.post(`${process.env.REACT_APP_API_URL}/register`, {data:{ username, email, password, avatar, name, surname, birthdate, role }})\r\n        .then(({ error, message, status }) => {\r\n            if(error){\r\n                return toast.error(`onRegister: ${message}`, { id: toastId });\r\n            }\r\n            toast.success('Success', { id: toastId });\r\n            setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n        })\r\n        .catch(err => {\r\n            toast.error(`Error: ${err}`, { id: toastId });\r\n        });\r\n    }\r\n\r\n    function hasError(error){\r\n        return(error?.length ? '' : 'has-error');\r\n    }\r\n\r\n    let button = <Button onClick={handleSubmit} type=\"submit\" disabled={!validated} variant={validated?\"outline-primary\":\"outline-secondary\"}>Sign up</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" >Done</Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\" >Error</Button>; break;\r\n        default: break;\r\n    }\r\n\r\n    return <>\r\n        <Card.Footer className=\"text-center user-select-none\" onClick={ ()=>setShow(1) }> Sign up </Card.Footer>\r\n        <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n        <Modal className=\"py-4\" closeButton {...{show, setShow}} \r\n        title={<h2 className=\"user-select-none\">Create account</h2>}\r\n        backdrop=\"static\"\r\n        buttons={[\r\n            <OverlayTrigger placement=\"top\"\r\n            overlay={\r\n                <Tooltip className={`${validated?\"d-none\":\"\"}`}  id={`tooltip-top`}>\r\n                    {Object.entries(formvalues.formErrors).map(([key, value], k) => { return value.length?<p key={k}>{key}: {value}</p>:\"\" }) }\r\n                </Tooltip>\r\n            }>\r\n            <div>\r\n                {button}\r\n            </div>\r\n            </OverlayTrigger>\r\n        ]}\r\n        >\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"username\">     <Form.Control name='username'       className={ hasError(formvalues.formErrors?.username)}  placeholder='username'   onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['username'  ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"email\">        <Form.Control name='email'          className={ hasError(formvalues.formErrors?.email)}     placeholder='email'      onChange={handleUserInput} type=\"email\"     defaultValue={formvalues['email'     ]}     />      </FloatingLabel>} />{}\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"password\">     <Form.Control name='password'       className={ hasError(formvalues.formErrors?.password)}  placeholder='password'   onChange={handleUserInput} type=\"password\"  defaultValue={formvalues['password'  ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"confirm password\"> <Form.Control name='password2'  className={ hasError(formvalues.formErrors?.password2)} placeholder='password2'  onChange={handleUserInput} type=\"password\"  defaultValue={formvalues['password2'  ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"avatar URL\">   <Form.Control name='avatar'         className={ hasError(formvalues.formErrors?.avatar)}    placeholder='avatar URL' onChange={handleUserInput} type=\"avatar\"    defaultValue={formvalues['avatar URL']}     />  \r\n                <ReactImage\r\n                    id=\"avatar-img\"\r\n                    src={formvalues.avatar ?? formvalues.gravatar ?? profile_img}\r\n                    roundedCircle\r\n                    className='bg-danger shadow'\r\n                    width=\"48\" height=\"48\"\r\n                /></FloatingLabel>} />{}\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"name\">         <Form.Control name='name'       className={ hasError(formvalues.formErrors?.name)}      placeholder='name'       onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['name'      ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"surname\">      <Form.Control name='surname'    className={ hasError(formvalues.formErrors?.surname)}   placeholder='surname'    onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['surname'   ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"birthddate\">   <Form.Control name='birthdate'  className={ hasError(formvalues.formErrors?.birthdate)} placeholder='birthdate'  onChange={handleUserInput} type=\"date\"      defaultValue={formvalues['birthdate' ]}     />      </FloatingLabel>} />\r\n            \r\n            <div className=\"form-floating\">\r\n                <select className=\"form-select\" id=\"floatingSelect\" aria-label=\"Floating label select example\">\r\n                    <option value=\"0\">User</option>\r\n                    <option value=\"1\">Admin</option>\r\n                </select>\r\n                <label htmlFor=\"floatingSelect\"> User role</label>\r\n            </div>\r\n        </Modal>\r\n        </Form>\r\n        <style global jsx>{`\r\n            #avatar-img{\r\n                margin-top: -53px;\r\n                float: right;\r\n                margin-right: 15px;\r\n            }\r\n        `}</style>\r\n    </>;\r\n}","//https://learnetto.com/blog/react-form-validation\r\n\r\nimport { useContext, useRef, useState, useEffect } from 'react';\r\nimport { Row, Col, Card,Form, FloatingLabel, Button, Spinner, OverlayTrigger, Tooltip } from \"react-bootstrap\"\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport RecoveryModal from 'components/modal_recovery'\r\nimport RegisterModal from 'components/modal_register'\r\nimport logo from 'assets/img/logo.png';\r\nimport toast from 'react-hot-toast';\r\nimport cookies from '@h3r/cookies'\r\n\r\nexport default () => {\r\n    const auth = useContext(AuthContext);\r\n\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated] = useState(undefined);\r\n    const [formvalues, setFormValues] = useState({formErrors:{}, email: cookies.get(\"admire_app_email\"), remember: !!cookies.get(\"admire_app_email\")});\r\n    const [fetching, setFetching] = useState(false);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        setFetching(true);\r\n        auth.login(formvalues.email, formvalues.password)\r\n        .then(  app_token => {\r\n            setFetching(false);\r\n            if(formvalues.remember){\r\n                cookies.set('admire_app_token', app_token, process.env.REACT_APP_COOKIES_EXPIRE_TIME);\r\n                cookies.set(\"admire_app_email\", formvalues.email, process.env.REACT_APP_COOKIES_EXPIRE_TIME);\r\n            }\r\n        })\r\n        .catch( err => {\r\n            setFetching(false);\r\n        })\r\n        ;\r\n    }\r\n\r\n    function handleUserInput (e) {\r\n        const name  = e.target.name;\r\n        const type  = e.target.type;\r\n        const value = type===\"checkbox\"?e.target.checked:e.target.value;\r\n\r\n        validateField(name, value, type);\r\n    }\r\n\r\n    function validateField(name, value, type = \"any\"){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(type){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default:\r\n                check = true;\r\n                formErrors[name] = '';\r\n                break;\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n    \r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n\r\n    return <>\r\n    <Card id=\"login\" bg=\"light\" className=\"flex-column text-center position-absolute start-50 top-50 translate-middle\" style={{ width: '24rem' }}>\r\n\r\n        <Col>\r\n            <Card.Img variant=\"top\" className=\"mt-4 user-select-none\" src={logo}/>\r\n            <h1 className=\"text-start ps-4 mb-0 mt-3 user-select-none\">{process.env.REACT_APP_NAME}</h1>\r\n            <div className=\"divider\"><span/></div>\r\n        </Col>\r\n\r\n        <Col>\r\n            <Card.Body as={Col} className=\"text-start px-4 pb-4\">\r\n\r\n            <Card.Text className=\"user-select-none\">Enter your e-mail address and your password.</Card.Text>\r\n            \r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingInput\" label=\"Email address\" className=\"mb-3\">\r\n                    <Form.Control required name=\"email\" type=\"email\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.email??\" \"}/>\r\n                </FloatingLabel>\r\n                <FloatingLabel controlId=\"floatingPassword\" label=\"Password\">\r\n                    <Form.Control required name=\"password\" type=\"password\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.password??\"\"}/>\r\n                </FloatingLabel>\r\n\r\n                <Form.Switch id=\"remember-switch\" label=\"Remember me\" className=\"user-select-none remember-switch-form\" name=\"remember\" onChange={handleUserInput} defaultChecked={formvalues.remember??false}/>\r\n\r\n                <OverlayTrigger placement=\"bottom\"\r\n                    overlay={\r\n                        <Tooltip className={`${validated?\"d-none\":\"\"} mt-2`}  id={`tooltip-bottom`}>\r\n                            Check form errors\r\n                        </Tooltip>\r\n                    }\r\n                    >\r\n                        <span style={{padding:\"10px 0\"}}>\r\n                            <Button size=\"sm\" className=\"mt-4\" type=\"submit\" disabled={!(validated && !fetching)} > \r\n                                {!fetching?\r\n                                <><i className=\"bi bi-box-arrow-in-left\"/> Sign in </>\r\n                                : <><Spinner as=\"span\"animation=\"grow\" size=\"sm\" role=\"status\" aria-hidden=\"true\"/> Logging in... </>\r\n                            }</Button>\r\n                        </span>\r\n                    </OverlayTrigger>\r\n                    \r\n                <RecoveryModal/>\r\n            </Form>\r\n\r\n\r\n            </Card.Body>\r\n            <RegisterModal/>\r\n        </Col>\r\n    </Card>\r\n\r\n    <style global jsx>{`\r\n        @import \"src/variables.scss\";\r\n\r\n        .remember-switch-form {\r\n\r\n            label {\r\n                font-size: 0.9em;\r\n                color: #777;\r\n            }\r\n\r\n            margin-top: 7px;\r\n        }\r\n\r\n        .divider {\r\n                border-bottom: 1px solid #FFF;\r\n                background-color: #DADADA;\r\n                height: 2px;\r\n                margin: 0.5em 0px 1.5em;\r\n\r\n                & span{\r\n                    position:relative;\r\n                    display: block;\r\n                    width: 75px;\r\n                    height: 3px;\r\n                    background-color: $color4;\r\n                    transform:translatey(-25%);\r\n                    left: 6%;\r\n                }\r\n        }\r\n\r\n        #login{\r\n            max-height: calc(100vh- 1rem);\r\n            border:none;\r\n            img {\r\n                width: 192px;\r\n                filter: \r\n                    hue-rotate(260deg)\r\n                ;\r\n            }\r\n\r\n            .card-footer{\r\n                color:$text;\r\n                background:$color4;\r\n                transition: all 0.1s ease-in-out; \r\n                &:hover{\r\n                    background:darken($color4, 10%);\r\n                    font-weight:bold;\r\n                    cursor:pointer;\r\n                }\r\n            }\r\n        } \r\n\r\n        @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n            #login{\r\n                width: 40rem !important;\r\n                flex-direction: row !important;\r\n                .col{\r\n                    align-self: end;\r\n                }\r\n            }\r\n        }\r\n        @media only screen and (orientation: portrait){\r\n\r\n        }    \r\n    `}</style>\r\n    </>;\r\n}\r\n","export default __webpack_public_path__ + \"static/media/TeenyiconsPasswordOutline.ab4b0486.svg\";","import React, {useContext, useRef, useEffect, useState} from 'react'\r\nimport { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\n\r\nimport MD from 'utils/md'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\nexport default ({show, setShow, onSubmit, ...props}) => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const ref                     = useRef(null);\r\n    const [isValid, setValid]     = useState(true);             // eslint-disable-line\r\n    const [fetching, setFetching] = useState(0);                // 0: not fetching, 1: fetching, 2: success, 3: failed\r\n\r\n    useEffect(()=>{\r\n       \r\n        if ( !ref?.current || !show ) return;\r\n\r\n        ref.current.addEventListener(\"submit\", (e) => { \r\n            e.preventDefault();\r\n        });\r\n    },[])\r\n\r\n    function submit(event) {\r\n\r\n        event.preventDefault();\r\n\r\n        if ( !ref?.current || !show ) return;\r\n        let [password] = Array.from(ref.current.elements).map(v => v.value);\r\n\r\n        onSubmit(password)\r\n        .then( () => setShow(false) )\r\n        .catch( () => setFetching(3) )\r\n        .finally( () => {\r\n            setTimeout( () => setFetching(0), 1000);\r\n        })\r\n    }\r\n\r\n    let button = <Button disabled={!isValid} variant={isValid?\"outline-primary\":\"outline-secondary\"} onClick={submit} >Proceed</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" >Done</Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\"  >Error</Button>; break;\r\n        default: break;\r\n    }\r\n\r\n    return <>       \r\n        \r\n        <Modal className=\"py-4\" tabIndex=\"0\" buttons={[button]} closeButton {...{show, setShow}} title=\"Room password\" >\r\n        <MD>{``}</MD>\r\n        <Form ref={ref} onSubmit={submit}>\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"password\" className=\"mb-3\">\r\n                <Form.Control name=\"password\" type=\"password\" placeholder=\"password\"/>\r\n            </FloatingLabel>\r\n        </Form>\r\n        </Modal>\r\n        <style global jsx>{`\r\n            #new-room-card {\r\n                cursor: pointer;\r\n                opacity: .5;\r\n                border: 2px dashed white;\r\n\r\n                .card-img-top{\r\n                    display: none;\r\n                }\r\n                .card-body{\r\n                    height: 155px;\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </>;\r\n}","import { useContext, useEffect, useState } from 'react'\r\nimport { useHistory } from 'react-router-dom'\r\nimport { Row, Col, Card, Badge } from 'react-bootstrap'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport lock from 'assets/img/TeenyiconsPasswordOutline.svg'\r\nimport RoomPasswordModal from 'components/modal_room_password'\r\n\r\nfunction RoomTile({id, name,icon, hidden, master, users, secured : hasPassword, ...props}){\r\n    const [show, setShow] = useState(false);\r\n    const rooms = useContext(RoomsContext);\r\n\r\n    function onClick(){\r\n        \r\n        // Password modal is open ...\r\n        if(show)\r\n        return;\r\n\r\n        if(hasPassword){\r\n            setShow(true);\r\n        }\r\n        else\r\n            enterRoom();\r\n    }\r\n    function enterRoom(password){\r\n        return rooms.joinRoom(name, password)\r\n    }\r\n\r\n    if(hidden){\r\n        return <></>\r\n    }\r\n\r\n    // window.setShow = setShow;\r\n    return <div onClick={onClick}>\r\n    \r\n        <Card className=\"bg-dark text-light\" {...props}>\r\n            <Card.Img variant=\"top\" src={icon} />\r\n            {hasPassword && <Badge style={{padding:\".44em .25em .44em .45em\", margin:\".25rem\"}} bg=\"white\" className=\"position-absolute end-0 top-0\" pill><img width=\"18\" src={lock} style={{filter:\"invert(.5)\"}}/></Badge>}\r\n            <Card.Body>\r\n                <Card.Title>#{name}</Card.Title>\r\n            </Card.Body>\r\n        </Card>\r\n        <RoomPasswordModal \r\n            show = { show }\r\n            setShow = { setShow } \r\n            onSubmit = { enterRoom }\r\n        />\r\n\r\n        <style global jsx>{`\r\n            @import 'src/variables.scss';\r\n\r\n            .card {\r\n                cursor: pointer;\r\n                user-select: none;\r\n                transition: all 0.075s ease-in-out;\r\n\r\n                &:hover {\r\n                    .card-body{\r\n                        background: lighten($dark,25%);\r\n                    }\r\n                        \r\n                    box-shadow: 0 0 0px 2px rgba(255, 255, 255, .5) !important;\r\n                }\r\n\r\n                .card-body{\r\n                    transition: all 0.075s ease-in-out;\r\n                    overflow-x: hidden;\r\n                    .card-title{\r\n                        margin:0;\r\n                        font-size: 0.9rem;\r\n                        white-space: nowrap;\r\n                       transition: 2s;\r\n                    }\r\n\r\n                    .card-title:hover {\r\n                       margin-left: -25px;\r\n                    }\r\n                }\r\n\r\n                .card-img-top{\r\n                    width: 100%;\r\n                    height: 100px;\r\n                    object-fit: cover;\r\n                }\r\n            }\r\n        `}</style>\r\n    </div>\r\n}\r\n\r\nfunction onKeyPress(){\r\n}\r\n\r\nexport default ()=>{\r\n    \r\n    const history = useHistory();\r\n    const rooms = useContext(RoomsContext);\r\n\r\n    useEffect( ()=>{\r\n\r\n    }, [rooms.list])\r\n\r\n    return <>\r\n        <Row onKeyPress={onKeyPress} id=\"lobby\" className=\"h-100 m-auto\">\r\n            <Col xs={12} sm={{span:10, offset:1}} >\r\n        \r\n            <h1 className=\"text-light lobby-title\">Lobby</h1>    \r\n            <Row xs={2} sm={3} lg={3} xl={5} className=\"g-3\">\r\n            { [...Object.values(rooms.list)].map((v,k) => <Col key={k}>\r\n                    <RoomTile /*name={` ${v?.name || 'Room '+k}`}*/ {...v} />\r\n                </Col>\r\n            )}\r\n            </Row>\r\n\r\n            </Col>\r\n        </Row>\r\n        <style global jsx>{`\r\n            #lobby{\r\n                min-height: 19rem;\r\n                height: calc(100vh - 3rem) !important;\r\n                overflow-y: scroll !important;\r\n                padding-bottom: 4rem !important;\r\n\r\n                .lobby-title{\r\n                    margin-bottom: 20px;\r\n                }\r\n            }    \r\n        `}</style>\r\n    </>\r\n}","import { useState, useEffect } from 'react'\r\nimport Gesture from 'rc-gesture'\r\n\r\nexport default ({show, setShow, ...props}) => {\r\n    const pages = [\"Devices\",\"Battery\", \"Pose\"]; // , \"Selfie\"\r\n    const [selected, setSelected] = useState(0);\r\n    const [page, setPage] = useState(null);\r\n    const [views, setViews] = useState([]);\r\n\r\n    //use useEffect to fetch page views dynamically\r\n    useEffect(() => {\r\n        (async () => {\r\n            let vs = [];\r\n            for (let p of pages)\r\n                await import(`pages/${p}.jsx`).then(v => vs.push(<v.default />))\r\n            setViews([...vs]);\r\n            setPage(vs[selected]);\r\n        })();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        setPage(views[selected]);\r\n    }, [selected]);\r\n\r\n    function onKeyPressed(e)\r\n    {\r\n        switch(e?.keyCode)\r\n        {\r\n            case 37: return setSelected( s => (s-1 < 0)? pages.length-1 : s-1 );\r\n            case 39: return setSelected( s => (s+1)%pages.length );\r\n        }\r\n    }\r\n\r\n    useEffect(()=>{\r\n            document.addEventListener(\"keydown\", onKeyPressed)\r\n        return ()=>{\r\n            document.removeEventListener(\"keydown\", onKeyPressed)\r\n        }\r\n    }, [])\r\n\r\n    return <div>\r\n        <Gesture\r\n            onSwipeLeft={ () => setSelected( s => (s+1)%pages.length ) } \r\n            onSwipeRight={() => setSelected( s => (s-1 < 0)? pages.length-1 : s-1 ) }\r\n            \r\n        >\r\n\r\n            <div>\r\n                <ul className=\"nav nav-tabs justify-content-start mb-2\">\r\n                { pages.map( (v,k) => <li key={k} className=\"nav-item\">\r\n                        <div className={`nav-link ${selected === k?\"active\":\"\"}`} onClick={()=>setSelected(k)}>{v}</div>  \r\n                </li>)}\r\n            </ul>\r\n\r\n            {page}\r\n            </div>\r\n\r\n        </Gesture>\r\n        <style global jsx>{`\r\n            @import 'src/variables.scss';\r\n\r\n            #wizard{\r\n                .nav-tabs{\r\n                    width: calc(100% + 24px);\r\n                    margin-left: -12px;\r\n                    margin-top: -3.6rem;\r\n                    //margin-top: -1rem;\r\n\r\n                    & .nav-item{\r\n                        margin-right: 2px;\r\n                    }\r\n\r\n                    & .nav-link{\r\n                        background-color: rgba(60, 60, 60, 0.75) !important;\r\n                        color: white;\r\n                        font-weight: 500;\r\n\r\n                        &.active{\r\n                            color: $color4 !important;\r\n                            background-color: #fff !important;\r\n                        }\r\n                    }\r\n\r\n                    \r\n                }\r\n\r\n                .modal-content{\r\n                    margin-top: 1.5rem;\r\n                    max-height: calc( 100 - 4rem );                \r\n                }\r\n\r\n                .modal-body {\r\n                    padding-top: 63px;\r\n                    overflow-y: scroll;\r\n                }\r\n            }    \r\n        `}</style>\r\n    </div>;\r\n}","import React, {useState, useContext, useRef } from 'react';\r\nimport { Row, Col, Form, FloatingLabel, ButtonGroup, Button, Image } from 'react-bootstrap';\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\n\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport Nav from 'partials/nav'\r\n\r\nimport profile_img from 'assets/img/profile_light.png'\r\n\r\nexport default () => {\r\n    const ref = useRef(null);\r\n    const auth = useContext(AuthContext);\r\n    const [show, setShow] = useState(false);\r\n    \r\n    //introduction message to user settings panel\r\n    \r\n    async function submit(){\r\n        if ( !ref?.current || !show ) return;\r\n        let [username, email, bla, avatar, name, surname, birthdate] = Array.from(ref.current.elements).map(v => v.value);\r\n        auth.updateUserInfo({username, email, avatar, name, surname, birthdate});\r\n    }\r\n\r\n    async function clear() {\r\n        console.log(\"TODO: clear user info\");\r\n        // Array.from(ref.current.elements).forEach(v => {\r\n        //     debugger;\r\n        // });\r\n        // toast.success('User info restored');\r\n    }\r\n\r\n\r\n    if(!auth.isLogged) return <></>;\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(1)} ><i className=\"bi bi-person-circle\"/>Profile</Nav.Item>\r\n        {/* <Button variant=\"link\" onClick={ ()=>setShow(1) }>Profile</Button> */}\r\n       \r\n\r\n        <Modal closeButton size=\"lg\" {...{show, setShow}} \r\n        title={ <h2 className=\"user-select-none\">Profile</h2>}\r\n        buttons={[\r\n        <Button onClick={auth.logout}><i className=\"bi bi-power\"></i> Sign out</Button>\r\n        ,      \r\n        \r\n        // <div align=\"center\" className=\"fw-bolder\">\r\n        // <ButtonGroup>\r\n        //     <Button onClick={submit} variant = \"outline-primary\">Save</Button>\r\n        //     <Button onClick={clear} variant = \"outline-secondary\">Discard</Button>\r\n        // </ButtonGroup>\r\n        // </div>\r\n        ]}\r\n        >\r\n        <Row>\r\n        <Col xs={6}>\r\n            <Col xs=\"auto\" className=\"text-center mb-2\">\r\n                <Image\r\n                    id=\"avatar-img\"\r\n                    src={ auth.user?.avatar.length? auth.user?.avatar : profile_img }\r\n                    roundedCircle\r\n                    //className='position-absolute top-0 start-50 bg-danger shadow'\r\n                    width=\"128\" height=\"128\"\r\n                />\r\n            </Col>\r\n            <Col>\r\n            <MD className=\"user-select-none\">{`\r\n                # Welcome ${auth.user.username}!\r\n                This panel is where you can change your profile information. You can also change your password.\r\n                If you have any questions, please contact us.\r\n                `}</MD>\r\n            </Col>\r\n        </Col>\r\n        <Col xs={6}>\r\n            <Form ref={ref}>\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"username\">     <Form.Control disabled name='username'   placeholder='username'   defaultValue={auth.user.username}/*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['username'  ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"email\">        <Form.Control disabled name='email'      placeholder='email'      defaultValue={auth.user.email}/*onChange={handleUserInput}*/ type=\"email\"     /*defaultValue={formvalues['email'     ]}*/     />      </FloatingLabel>} />{/*value={userEmail} onChange={event => setEmail(event.target.value)} isInvalid={!isEmailValid} /> */}\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"password\">     <Form.Control disabled name='password'   placeholder='password'   defaultValue={auth.user}/*onChange={handleUserInput}*/ type=\"password\"  /*defaultValue={formvalues['password'  ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"avatar URL\">   <Form.Control disabled name='avatar'     placeholder='avatar URL' defaultValue={auth.user.avatar}/*onChange={handleUserInput}*/ type=\"avatar\"    /*defaultValue={formvalues['avatar URL']}*/     />      </FloatingLabel>} />{/*value={image_url !== '' ? image_url : userEmail !== '' ? gravatar_url : ''} onChange={event => setImageURL(event.target.value)} */}\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"name\">         <Form.Control disabled name='name'       placeholder='name'       defaultValue={auth.user.name}/*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['name'      ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"surname\">      <Form.Control disabled name='surname'    placeholder='surname'    defaultValue={auth.user.surname}/*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['surname'   ]}*/     />      </FloatingLabel>} />\r\n            <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"birthddate\">   <Form.Control disabled name='birthdate'  placeholder='birthdate'  defaultValue={auth.user.birthdate}/*onChange={handleUserInput}*/ type=\"date\"      /*defaultValue={formvalues['birthdate' ]}*/     />      </FloatingLabel>} />\r\n            </Form>\r\n        </Col>\r\n\r\n  \r\n        </Row>\r\n        </Modal>\r\n        <style global jsx>{`\r\n\r\n            #avatar-img{\r\n                background: #444;\r\n            }\r\n\r\n        `}</style>\r\n    </>;\r\n}","import toast from 'react-hot-toast'\r\nimport React, {useContext, useRef, useEffect, useState} from 'react'\r\nimport { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\n\r\nimport MD from 'utils/md'\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const ref                     = useRef(null);\r\n    const [show, setShow]         = useState(false);\r\n    const [isValid, setValid]     = useState(true);//eslint-disable-line\r\n    const [fetching, setFetching] = useState(0);               //0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n    function submit() {\r\n        if ( !ref?.current || !show ) return;\r\n            \r\n        let [roomname, password, size, icon, hidden] = Array.from(ref.current.elements).map(v => v.value);\r\n        \r\n        rooms.createRoom(roomname.toLowerCase(), {password, size, icon, hidden})\r\n        .then( room =>{\r\n            toast.success(`Created room ${room.name}`); \r\n            setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n            setFetching(2);   \r\n        }) \r\n        .catch( err =>{\r\n            toast.error(`onCreateRoom: ${err}`); \r\n            setFetching(3);   \r\n            setTimeout( () => { setFetching(0); } , 1000);\r\n        }) \r\n    }\r\n\r\n    function handleUserInput(e){\r\n        //setValid(ref?.current?.value.length > 3);\r\n    }\r\n\r\n    let button = <Button disabled={!isValid} variant={isValid?\"outline-primary\":\"outline-secondary\"} onClick={submit} >Create</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" >Done</Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\"  >Error</Button>; break;\r\n        default: break;\r\n    }\r\n\r\n\r\n    return <>\r\n        <Nav.Button onClick={()=>setShow(1)} title=\"Create room\" label=\"Create room\" appendclass=\"shadow rounded-circle bg-danger\" >\r\n            <i className=\"bi bi-plus-lg\"></i> \r\n        </Nav.Button>\r\n        \r\n        <Modal size=\"sm\" onKeyDown={ (e)=> (e.keyCode === 13) && submit() } tabIndex=\"0\" buttons={[button]} closeButton {...{show, setShow}} title={<span>Room settings</span>}>\r\n        <MD>{``}</MD>\r\n        <Form ref={ref}>\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"roomId\" className=\"mb-3\">\r\n                <Form.Control onChange={handleUserInput} required name=\"roomId\" type=\"text\" placeholder=\"roomId\"/>\r\n            </FloatingLabel>\r\n\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"password\" className=\"mb-3\">\r\n                <Form.Control name=\"password\" type=\"password\" placeholder=\"password\"/>\r\n            </FloatingLabel>\r\n\r\n\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"size\" className=\"mb-3\">\r\n                <Form.Control name=\"size\" min=\"1\" step=\"1\" type=\"number\" placeholder=\"max users\" defaultValue=\"8\"/>\r\n            </FloatingLabel>\r\n\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"icon\" className=\"mb-3\">\r\n                <Form.Control name=\"icon\" type=\"text\" placeholder=\"icon URL\"/>\r\n            </FloatingLabel>\r\n\r\n            <Form.Switch id=\"hidden-switch\" label=\"Hidden\" name=\"hidden\" defaultValue={false}/>\r\n        </Form>\r\n        </Modal>\r\n        <style global jsx>{`\r\n            #new-room-card {\r\n                cursor: pointer;\r\n                opacity: .5;\r\n                border: 2px dashed white;\r\n\r\n                .card-img-top{\r\n                    display: none;\r\n                }\r\n                .card-body{\r\n                    height: 155px;\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </>;\r\n}","import React, {useContext, useState} from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport Nav from 'partials/nav'\r\nimport MD from 'utils/md';\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms = useContext(RoomsContext);\r\n    const [show, setShow] = useState(false);\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(1)} label=\"Leave room\" >\r\n            <i className=\"bi bi-door-open-fill\"></i>Leave\r\n        </Nav.Item>\r\n        <Modal buttons={[<Button size=\"lg\" onClick={()=>rooms.leaveRoom()}>Confirm</Button>]} closeButton size=\"md\" {...{show, setShow}} title={<span>Leaving {rooms.current.name}</span>}>\r\n            \r\n            <MD>{`\r\n            Are you sure you want to leave this room? Any call in progress will be lost and any active stream will be stopped.\r\n            `}</MD>\r\n            \r\n        </Modal>\r\n    </>;\r\n}","import { useState } from 'react'\r\n\r\nimport Nav from 'partials/nav'\r\nimport Wizard from 'views/wizard'\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default () => {\r\n    const [show, setShow]         = useState(false);\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} ><i className=\"bi bi-gear-wide-connected\"/>Settings</Nav.Item>\r\n        <Modal id='wizard' tabIndex=\"0\" closeButton size=\"lg\" {...{show, setShow}} _title={<span>Settings: Wizard</span>}>\r\n            <Wizard/>\r\n        </Modal>\r\n    </>;\r\n}","import React, {useContext, useEffect, useState} from 'react'\r\nimport {Image} from 'react-bootstrap'\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const [show, setShow]         = useState(false);\r\n\r\n    //useEffect(() => {},[rooms.current]);// eslint-disable-line\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} disabled={!rooms.current} ><i className=\"bi bi-people\"/>Users</Nav.Item>\r\n        <Modal tabIndex=\"0\" closeButton size=\"md\" {...{show, setShow}} title={<span><i className=\"bi bi-people\"/> Users</span>}>\r\n            <ul id=\"user-list\">\r\n                {rooms.current?.users?.map( (v,k,a) => v && \r\n                <li className=\"user-item\" key={k}>\r\n                    <span onClick={()=>rooms.kickUser(v?.username)}>❌</span>\r\n                    <Image className=\"border border-light border-2 shadow\" roundedCircle src={v.avatar} alt={v.username} style={{width: \"1.5rem\", height: \"1.5rem\"}}/>\r\n                    <p className=\"user-item-name\">{v?.username}</p>\r\n                </li> )}\r\n            </ul>            \r\n        </Modal>\r\n        <style jsx>{`\r\n\r\n            .user-item {\r\n                display: flex;\r\n\r\n                .user-item-name {\r\n                    margin-left: 0.2em;\r\n                }\r\n            }\r\n\r\n            #user-list {\r\n                list-style: none;\r\n                padding:0;\r\n\r\n                & span{\r\n                    cursor:pointer;\r\n                }\r\n            }\r\n        `}</style>\r\n    </>;\r\n}","import React, { useContext, useEffect, useState, useRef } from 'react'\r\nimport { Image, Button, Form, InputGroup } from 'react-bootstrap'\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\n\r\nexport default () => {\r\n    const inputRef = useRef(null);\r\n    const rooms = useContext(RoomsContext);\r\n    const auth = useContext(AuthContext);\r\n\r\n    const [show, setShow] = useState(false);\r\n    const [state, setState] = useState(0);\r\n\r\n    useEffect(() => { scrollDown() }, [rooms.messages]);\r\n\r\n    function handleSubmit(e) {\r\n        e.preventDefault();\r\n        rooms.sendMessage(inputRef.current.value)\r\n            .then(() => inputRef.current.value = \"\")\r\n    }\r\n\r\n    function scrollDown() {\r\n        const chat = document.getElementById(\"chat\");\r\n        if(!chat)\r\n        return;\r\n        const div = chat.querySelector(\".modal-body\");\r\n        div.scrollTop = div.scrollHeight;\r\n    }\r\n\r\n    function handleOpen() {\r\n        setShow(s => !s);\r\n        setTimeout(scrollDown, 50);\r\n    }\r\n\r\n    return <>\r\n        <Nav.Item onClick={() => handleOpen() } disabled={!rooms.current}><i className=\"bi bi-chat-square-text\" />Chat</Nav.Item>\r\n        <Modal id=\"chat\" buttons={[\r\n            <Form className=\"flex-grow-1\" noValidate validated={inputRef.current?.value.length ? true : false} onSubmit={handleSubmit}>\r\n                <InputGroup >\r\n                    <Form.Control\r\n                        ref={inputRef}\r\n                        placeholder=\"Type a message to send\"\r\n                        aria-label=\"Recipient's username\"\r\n                        aria-describedby=\"basic-addon2\"\r\n                        name=\"message\" type=\"text\"\r\n                    />\r\n                    <Button type=\"submit\" variant=\"outline-primary\" id=\"button-addon2\">\r\n                        <i className=\"bi bi-arrow-return-left\" />\r\n                    </Button>\r\n                </InputGroup>\r\n            </Form>\r\n        ]} tabIndex=\"0\" closeButton size=\"lg\" {...{ show, setShow }} title={<span><i className=\"bi bi-chat-square-text\" /> Chat</span>}>\r\n            <ul className=\"messages\">\r\n                {rooms.messages.map((message, i) => <>{message.username? <li key={i} className={message.username === auth.user.username ? \"sent\" : \"replies\"}>\r\n                    <Image className=\"border border-light border-2 shadow\" roundedCircle src={message.avatar} alt={message.username} />\r\n                    <p className=\"rounded-3 shadow\">\r\n                        <span className=\"meta d-block\">\r\n                            <span className=\"fw-bold\">{message.username}</span>\r\n\r\n                            <span className=\"float-end ps-3\" style={{ opacity: .5 }}>   {(() => {\r\n                                let d = new Date(message.timestamp);\r\n                                return `${d.getHours()}:${d.getMinutes()}`\r\n                            })()}</span>\r\n                        </span>\r\n                        {message.text}\r\n                    </p>\r\n                     </li>\r\n                : <li key={i} className=\"meta\"> {message.text} </li>}</>\r\n                )}\r\n\r\n            </ul>\r\n        </Modal>\r\n        <style global jsx>{`\r\n\r\n            #chat .modal-body {\r\n                height: 50vh;\r\n                overflow-y: scroll;\r\n            }\r\n\r\n            #chat .modal-footer {\r\n                /*position: sticky;\r\n                bottom: 0px;*/\r\n                background: #fff;\r\n            }\r\n\r\n            .messages {\r\n                padding-left:0;\r\n                img{\r\n                    width: 2rem;\r\n                    height: 2rem;\r\n                }\r\n                \r\n                li{\r\n                    margin-top: .25rem;\r\n                    display: flex;\r\n                    flex-direction: row;\r\n                    flex-wrap: nowrap;\r\n                    align-items: top;\r\n                    \r\n                    & p{\r\n                        max-width: 60%;\r\n                        padding: .125rem .5rem;\r\n                        margin: .125rem .5rem;\r\n                    }\r\n            \r\n            \r\n                    @media screen and (max-width: 735px) {\r\n                        & p{\r\n                            max-width: 75%;\r\n                        }\r\n                    }\r\n                }\r\n                .sent{\r\n                    flex-direction: row-reverse;\r\n                    //float: right;\r\n                    & p{\r\n                        background-color: #f5f5f5;\r\n                    }\r\n                }\r\n                .replies{\r\n                    \r\n                    //float: left;\r\n                    & p{\r\n                        background-color: #435F7A;\r\n                        color: white;\r\n                    }\r\n                }\r\n\r\n            }\r\n        `}</style>\r\n    </>;\r\n}","import { useEffect, useState, useContext, useRef } from 'react'\r\n\r\nimport Nav from \"partials/nav\"\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\n\r\n\r\nexport default () => {\r\n    const canvasRef = useRef(null);\r\n    const media    = useContext(MediaContext);\r\n    const [isAudioEnabled, setAudioEnabled] = useState(false);\r\n    //const videotracks = media.localStream.getVideoTracks()??[];\r\n    //const [isVideoEnabled, setVideoEnabled] = useState(videotracks.every( v => v.enabled ));\r\n\r\n    function handleClick()\r\n    {\r\n        const audiotracks = media.localStream.getAudioTracks()??[];\r\n        const enabled = audiotracks.every(track => { track.enabled = !isAudioEnabled; return !!track.enabled;});\r\n        setAudioEnabled(enabled); \r\n    }\r\n\r\n    useEffect(() => {\r\n        const audiotracks = media.localStream.getAudioTracks()??[];\r\n        setAudioEnabled(audiotracks.every( v => v.enabled ))\r\n    } , [media.localStream, media.settings?.audio]);\r\n\r\n    useEffect(()=>{\r\n        const ctx = canvasRef?.current?.getContext('2d');\r\n        ctx.globalAlpha   = 0.5;\r\n        function draw()\r\n        {\r\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n            \r\n            const [x0, y0, r0, x1, y1, r1] = [ctx.canvas.width*.5, ctx.canvas.height * .5, 135, ctx.canvas.width*.5,ctx.canvas.height * .5,ctx.canvas.height * .5];\r\n            let gradient = ctx.createRadialGradient(x0, y0, r0, x1, y1, r1);\r\n            gradient.addColorStop(0, \"rgba(255, 255, 255, 0.0)\");\r\n            gradient.addColorStop(0.1, \"rgba(255, 255, 255, 0.5)\");\r\n            gradient.addColorStop(.5, \"rgba(255, 255, 255, 0.1)\");\r\n            gradient.addColorStop(1, \"rgba(255, 255, 255, 0.0)\");\r\n\r\n            ctx.fillStyle = gradient;\r\n            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n            requestAnimationFrame(draw)\r\n        }\r\n        const id = requestAnimationFrame(draw);\r\n        \r\n    return ()=>{\r\n        cancelAnimationFrame(id);\r\n    }\r\n    },[])\r\n\r\n    return <>\r\n    <div id='pulse-wrapper'className=\"p-4 rounded-circle\" style={{marginTop: '-4rem', marginBottom: '-4rem'}}>\r\n        <canvas width='512' height='512' ref={canvasRef} className='position-absolute top-0 rounded-circle'/>\r\n        <Nav.Button onClick={handleClick} label=\"Create room\" appendclass=\"shadow rounded-circle bg-danger\" >\r\n            <i className={isAudioEnabled?\"bi bi-mic\":\"bi bi-mic-mute\"}></i>\r\n        </Nav.Button>\r\n    </div>\r\n    \r\n    <style global jsx>{`\r\n        #pulse-wrapper {\r\n            //border: 1px dashed #ccc;\r\n            margin: -3rem -1.5rem 0rem -1.5rem !important;\r\n            overflow:hidden !important;\r\n\r\n            .nav-button{\r\n                margin-top: 0;\r\n                margin-bottom: 0;\r\n            }\r\n\r\n            canvas {\r\n                pointer-events: none;\r\n                margin-top: .35rem;\r\n                width: 5rem;\r\n                height:5rem;\r\n                transform:translate(-50%,-50%) scale(1.3) !important;\r\n            }\r\n    \r\n        }\r\n        @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n            #pulse-wrapper {\r\n                margin: -1.5rem 1rem -1.5rem -4rem !important;\r\n                .nav-button{\r\n                    margin-left: 0;\r\n                    margin-right: 0;\r\n                }\r\n                canvas {\r\n                    top: 50% !important;\r\n                    margin-top: 0rem;\r\n                }\r\n            }\r\n        }\r\n        @media only screen and (orientation: portrait){\r\n\r\n        } \r\n    \r\n    `}</style>\r\n    {/*\r\n    <Nav.Button>\r\n        <ButtonToolbar>\r\n            \r\n            <Button onClick={()=>{ \r\n                const enabled = audiotracks.every(track => { track.enabled = !isAudioEnabled; return !!track.enabled;});\r\n                setAudioEnabled(enabled); \r\n            }}><i className={isAudioEnabled?\"bi bi-mic-mute\":\"bi bi-mic-mute\"}></i></Button>\r\n            \r\n            <Button onClick={()=>{ \r\n                const enabled = videotracks.every(track => { track.enabled = !isVideoEnabled; return !!track.enabled;});\r\n                setVideoEnabled(enabled); \r\n            }}><i className={isVideoEnabled?\"bi bi-camera-video\":\"bi bi-camera-video-off\"}></i></Button>\r\n        \r\n        </ButtonToolbar>\r\n    </Nav.Button>\r\n    */}\r\n    </>\r\n}\r\n","import { useContext, useRef, useEffect } from 'react'\r\nimport { Container } from \"react-bootstrap\"\r\nimport { useHistory, Redirect } from \"react-router-dom\"\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\nimport Nav from \"partials/nav\"\r\nimport Room  from 'views/room'\r\nimport Login  from 'views/login'\r\nimport Lobby  from 'views/lobby'\r\nimport Wizard from 'views/wizard'\r\nimport ProfileNavModal from 'components/modal_nav_profile'\r\nimport CreateRoomModal from 'components/modal_create_room'\r\nimport LeaveRoomModal from 'components/modal_leave_room'\r\nimport WizardModal from 'components/modal_wizard'\r\nimport UsersModal from 'components/modal_users'\r\nimport ChatModal from 'components/modal_chat'\r\nimport StreamButtons from 'components/btngrp_stream';\r\nimport * as serviceWorkerRegistration from 'serviceWorkerRegistration';\r\n\r\nfunction App({...props}) {\r\n  useEffect(()=>{\r\n    serviceWorkerRegistration.register();\r\n  },[])\r\n\r\n\r\n  const history = useHistory();\r\n  const auth = useContext(AuthContext);\r\n  const rooms = useContext(RoomsContext);\r\n  let {current: view} = useRef();\r\n\r\n  if((/^\\/room\\/[a-zA-Z0-9]+/).test(history.location.pathname)) view = <Room container/>\r\n  if(history.location.pathname === '/'        ) view = <Lobby container/> \r\n  if(history.location.pathname === '/settings') view = <Wizard show={true} container/>\r\n  if((/^\\/room\\/[a-zA-Z0-9]+\\/chat$/).test(history.location.pathname)  ) view = <Redirect to=\"/\"/>\r\n  if((/^\\/room\\/[a-zA-Z0-9]+\\/users$/).test(history.location.pathname) ) view = <Redirect to=\"/\"/>\r\n\r\n  if(!(auth.isLogged && auth.isConnected))\r\n    return <div className=\"App\" children={<Login />}/>\r\n  else\r\n    return <>\r\n    <div className=\"App\">\r\n        \r\n      <Container fluid={view?.props?.container} id=\"content-wrapper\" > \r\n      {view}\r\n      </Container>\r\n\r\n      <Nav>\r\n          {rooms.current? <LeaveRoomModal/> : <ProfileNavModal/>} \r\n          <WizardModal/>\r\n          {rooms.current?<StreamButtons/>:<CreateRoomModal/>}\r\n          <UsersModal/>\r\n          <ChatModal/>\r\n      </Nav>\r\n \r\n \r\n    </div>\r\n    <style global jsx>{`\r\n      \r\n      html, body, .App{\r\n        overflow: hidden;\r\n        min-height:330px;\r\n      }\r\n\r\n      #content-wrapper{\r\n        height: 100%;\r\n        margin-bottom: 6rem;\r\n        margin-top: 3.5rem;\r\n        overflow-y: scroll;\r\n        overflow-x: hidden;\r\n        & .container-fluid{\r\n          margin:0 !important;\r\n        }\r\n      }\r\n\r\n      @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n          #content-wrapper{\r\n            margin-bottom: 1rem;\r\n            margin-top: 1rem;\r\n            margin-right:3rem;\r\n          }\r\n      }\r\n      @media only screen and (orientation: portrait){\r\n\r\n      }    \r\n    `}</style>\r\n  </>\r\n}\r\n\r\nexport default App;\r\n","export default __webpack_public_path__ + \"static/media/UilUser.9ef7755c.svg\";","import * as BRA from 'lib_bra'\r\nimport toast from  'react-hot-toast'\r\nimport { useHistory, useParams, useRef } from 'react-router-dom'\r\nimport React, { createContext, useContext, useEffect, useState } from 'react'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport avatar_img from 'assets/img/UilUser.svg'\r\n\r\nexport const RoomsContext = createContext(); \r\nlet messages = []\r\nlet avatars = {}\r\n\r\nexport default ({children, ...props}) => {\r\n    const auth    = useContext(AuthContext);\r\n    const history = useHistory();\r\n    \r\n    let   [rooms, setRooms]       = useState({});\r\n    const [ready, setReady]       = useState(false);\r\n    let   [current, setCurrent]   = useState(null);\r\n    const [state, setState] = useState(0);\r\n\r\n    function setMessages(d){\r\n        messages = d;\r\n        setState(s => s+1);\r\n    }\r\n    \r\n    useEffect( ()=>{ \r\n        if(!auth.isLogged) return;\r\n        \r\n        BRA.appClient.on(BRA.APPEvent.GuestLeftRoom,     onGuestLeft);\r\n        BRA.appClient.on(BRA.APPEvent.GuestJoinedRoom,   onGuestJoin);\r\n        BRA.appClient.on(BRA.APPEvent.RoomCreated,       onRoomCreated);\r\n        BRA.appClient.on(BRA.APPEvent.RoomDeleted,       onRoomDeleted);\r\n        BRA.appClient.on(BRA.APPEvent.UserRejoined,      onUserRejoined);\r\n        BRA.appClient.on(BRA.APPEvent.UserKicked,        onUserKicked);\r\n        BRA.appClient.on(BRA.APPEvent.ChatText,          onMessage);\r\n\r\n        //Initial fetch of rooms\r\n        BRA.appClient.getRooms( { response: (m1) => { onGetRooms(m1)\r\n            BRA.appClient.getRoom( { response:(m2) => { onGetRoom(m2); \r\n                setReady(true);\r\n            }});\r\n        }});\r\n\r\n    return ()=>{\r\n        BRA.appClient.off(BRA.APPEvent.GuestLeftRoom,    onGuestLeft);\r\n        BRA.appClient.off(BRA.APPEvent.GuestJoinedRoom,  onGuestJoin);\r\n        BRA.appClient.off(BRA.APPEvent.RoomCreated,      onRoomCreated);\r\n        BRA.appClient.off(BRA.APPEvent.RoomDeleted,      onRoomDeleted);\r\n        BRA.appClient.off(BRA.APPEvent.UserRejoined,     onUserRejoined);\r\n        BRA.appClient.off(BRA.APPEvent.ChatText,         onMessage);\r\n    }}, [auth.isLogged]);\r\n\r\n    useEffect(()=>{\r\n        if(!current) return;\r\n        localStorage.setItem('messages', JSON.stringify(messages));\r\n    },[messages]);\r\n\r\n    function onUserKicked(){\r\n        BRA.appClient.getRoom({response:onGetRoom});\r\n        BRA.appClient.getRooms({response:onGetRooms});\r\n    }\r\n\r\n    function isUserInRoom(username, roomName)\r\n    {\r\n        const room = {...rooms,[current?.name]:current}[roomName];\r\n        for(let user of room?.users??[]){\r\n            if(user?.username === username) \r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function imInRoom(roomName)\r\n    {\r\n        return isUserInRoom(auth.user?.username, roomName);\r\n    }\r\n\r\n    function onRoomCreated({data:{room}}){\r\n        BRA.appClient.getRoom({response:onGetRoom});\r\n        BRA.appClient.getRooms({response:onGetRooms});\r\n    }\r\n\r\n    function onRoomDeleted({data:{room}}){\r\n        BRA.appClient.getRoom({response:onGetRoom});\r\n        BRA.appClient.getRooms({response:onGetRooms});\r\n    }\r\n\r\n    function onGuestLeft({data:{user,room}})\r\n    {\r\n        BRA.appClient.getRoom({response:onGetRoom});\r\n        if(current){\r\n            toast(`User '${user.username}' left`);\r\n            setCurrent( {...current, users: current?.users??[].filter(u=>u.username!==user.username)} );\r\n            messages.push({text:`User '${user.username}' left`, timestamp: new Date().toISOString()});\r\n        }\r\n    }    \r\n    \r\n    function onGuestJoin({data:{user,room}})\r\n    {\r\n        BRA.appClient.getRoom({response:onGetRoom});\r\n        if(current){\r\n            toast(`User '${user.username}' joined`);\r\n            setCurrent( {...current, users: current?.users??[].push(user)} );\r\n            messages.push({text:`User '${user.username}' joined`, timestamp: new Date().toISOString()});\r\n        }\r\n    }\r\n\r\n    function kickUser(username){\r\n        if(!current) return;\r\n        BRA.appClient.kickUser(username, {response:({event, data})=>{\r\n            if(event==='error'){\r\n                return toast.error(data.message);\r\n            }\r\n            BRA.appClient.getRoom({response:onGetRoom})\r\n        }});\r\n    }\r\n    \r\n    async function onGetRoom({ data: {room} }){\r\n        setCurrent(room?.name?{...room}:null);\r\n\r\n        if(room?.name)\r\n        {\r\n            for(let user of room.users??[]){\r\n                if(user.avatar) continue;\r\n                user.avatar = avatars[user.username] ?? await auth.getUserAvatar(user.username)\r\n                user.avatar = user.avatar.length\r\n                ? user.avatar \r\n                : avatar_img;\r\n            }\r\n            if(history.location.pathname !== `/room/${room?.name}`){\r\n                   history.push(`/room/${room?.name}`);\r\n            }\r\n        }\r\n        else{\r\n            history.push(`/`);\r\n        }\r\n    }\r\n\r\n    function onGetRooms({data:{rooms}}){\r\n        let rs = {};\r\n        for(let room of rooms??[])\r\n            rs[room.name] = room;\r\n        setRooms(rs);\r\n    }\r\n\r\n    function onUserRejoined({event,data}){\r\n        if(current){\r\n            const user = data.user;\r\n            messages.push({text:`User '${user.username}' rejoined`, timestamp: new Date().toISOString()});\r\n        }\r\n    }\r\n\r\n    async function onMessage({ event, data }) {\r\n        if (!data) return;\r\n        //const {text, timestamp, username} = data;\r\n        data.avatar = avatars[data.username] ?? await auth.getUserAvatar(data.username) ?? avatar_img;\r\n        setMessages([...messages,data])\r\n    }\r\n\r\n    async function sendMessage(text){\r\n        return new Promise( (resolve, reject) => {\r\n            if(!current) reject();\r\n\r\n            function onSendMessage(data){\r\n                resolve();\r\n            }\r\n            BRA.appClient.sendText(text, {response:onSendMessage});\r\n        })\r\n    }\r\n\r\n    function createRoom(roomName, {password, hidden, icon, size}){\r\n        return new Promise((resolve, reject)=>{\r\n            BRA.appClient.createRoom(roomName, {\r\n                password: password??\"\",\r\n                hidden: hidden??false,\r\n                size,\r\n                icon: icon && icon.length? icon : `https://unsplash.it/seed/test-${roomName}/160/100`,\r\n                response:({event, data}) => {\r\n                    if(data.error) reject(data.message);\r\n                    else resolve(data.room);\r\n                }\r\n            });\r\n        })\r\n        .then(  (room)=>{ BRA.appClient.getRoom({response:onGetRoom}); return room; } )\r\n        //.catch( (e) => toast.error(e) );\r\n    }\r\n\r\n    function joinRoom(roomName, password){\r\n        return new Promise((resolve, reject) => {\r\n            BRA.appClient.joinRoom(roomName,\r\n            {\r\n                password: password??\"\",\r\n                response:({event, data}) => {\r\n                    if(data.error) \r\n                    {\r\n                        toast.error(data.message)\r\n                        reject(data.message);\r\n                    }\r\n                    else resolve(data.room);\r\n                }\r\n            });\r\n        })    \r\n        .then(  (room)=>{ BRA.appClient.getRoom({response:onGetRoom}); return room; } )\r\n        .finally( ()=>{\r\n            let m = localStorage.getItem('messages');\r\n            if(m) m=JSON.parse(m);\r\n            else m=[];\r\n            setMessages([...m]);\r\n        })\r\n    }\r\n\r\n    function leaveRoom(){\r\n        return new Promise((resolve, reject)=>{\r\n            BRA.appClient.leaveRoom({response:({event, data}) => {\r\n                if(data.error) reject(data.message);\r\n                else resolve(data.room);\r\n            }});\r\n        })\r\n        .finally(  (room)=>{ \r\n            setMessages([]);\r\n            BRA.appClient.getRoom({response:onGetRoom});\r\n            BRA.appClient.getRooms({response:onGetRooms}); \r\n        return room; } )\r\n        //.catch( (e)=> toast.error(e) );\r\n    }\r\n\r\n    const store = window.rooms = {\r\n        joinRoom,\r\n        leaveRoom,\r\n        createRoom,\r\n        setCurrent,\r\n        imInRoom,\r\n        isUserInRoom,\r\n        kickUser,\r\n        ready,\r\n        current,\r\n        sendMessage,\r\n        messages,\r\n        list: rooms,\r\n    }\r\n\r\n    return <RoomsContext.Provider value={store} children={children}/>\r\n}","import http from \"utils/http\"\r\nimport * as BRA from \"lib_bra\";\r\nimport cookies from '@h3r/cookies'\r\nimport toast from 'react-hot-toast'\r\nimport { createContext, useEffect, useState, useRef, } from 'react'\r\n\r\nexport const AuthContext = createContext()\r\n\r\nexport default ({children, ...props}) => {\r\n    const [ user,        setUser      ] = useState(null);\r\n    const [ token,       setToken     ] = useState(cookies.get(\"admire_app_token\"));\r\n    const [ isLogged,    setLogged    ] = useState(false);\r\n    const [ isConnected, setConnected ] = useState({app:false, rtc:false});\r\n    let   { current: toast_app }        = useRef(null);\r\n    let   { current: toast_rtc }        = useRef(null);\r\n    let   { current: toast_usr }        = useRef(null);\r\n    const [ retries, setRetries ]       = useState(0);        \r\n\r\n\r\n    useEffect( ()=>{ //Constructor\r\n        function onUnload(){\r\n            logout();   \r\n            window.removeEventListener('unload', onUnload);\r\n        }\r\n        window.addEventListener('unload', onUnload);\r\n\r\n        function onAppConnect    (){ /*toast(\"App Connected\",    {id:toast_app, icon:'⚡', duration:2000});*/ setConnected( v => ({...v, app:true })); }\r\n        function onRtcConnect    (){ /*toast(\"RTC Connected\",    {id:toast_rtc, icon:'⚡', duration:2000});*/ setConnected( v => ({...v, rtc:true })); }\r\n        function onAppDisconnect (){ toast(\"App Disconnected\", {id:toast_app, icon:'⚠️', duration:2000}); setConnected( v => ({...v, app:false})); }\r\n        function onRtcDisconnect (){ toast(\"RTC Disconnected\", {id:toast_rtc, icon:'⚠️', duration:2000}); setConnected( v => ({...v, rtc:false})); }\r\n\r\n        BRA.appClient.on(BRA.APPEvent.ClientConnected,      onAppConnect    );\r\n        BRA.rtcClient.on(BRA.RTCEvent.ClientConnected,      onRtcConnect    );\r\n        BRA.appClient.on(BRA.APPEvent.ClientDisconnected,   onAppDisconnect );\r\n        BRA.rtcClient.on(BRA.RTCEvent.ClientDisconnected,   onRtcDisconnect );\r\n        BRA.appClient.on(BRA.APPEvent.Error,                onError );\r\n\r\n    return ()=>{ //Destructor\r\n        BRA.appClient.off(BRA.APPEvent.ClientConnected,     onAppConnect    );\r\n        BRA.appClient.off(BRA.RTCEvent.ClientConnected,     onAppDisconnect );\r\n        BRA.rtcClient.off(BRA.APPEvent.ClientDisconnected,  onRtcConnect    );\r\n        BRA.rtcClient.off(BRA.RTCEvent.ClientDisconnected,  onRtcDisconnect );\r\n        BRA.appClient.off(BRA.APPEvent.Error,               onError );\r\n\r\n        onUnload();\r\n    }\r\n    }, []);\r\n\r\n\r\n    useEffect( ()=>{\r\n        if(!isConnected.app && token){\r\n            BRA.appClient.connect(process.env.REACT_APP_APP_URL, token);\r\n        }\r\n    }, [isConnected.app, token]);\r\n\r\n    useEffect( ()=>{\r\n        if(!isConnected.rtc && token){\r\n            (async ()=>{\r\n                const u = await getUserInfo()\r\n                .then( (response) => {\r\n                    // toast.success(`Success`, {id:toast_usr, icon:'⚡', duration:2000});\r\n                    setUser(response);\r\n                    return response;\r\n                })\r\n                BRA.rtcClient.connect(process.env.REACT_APP_RTC_URL, token);\r\n            })()\r\n        }\r\n    }, [isConnected.rtc, token]);\r\n\r\n    useEffect( ()=>{\r\n        if(isConnected.rtc && isConnected.app && token && !isLogged) //Im properly connected\r\n        {\r\n            toast_usr = toast.loading(`Fetching user info...`, {duration:Infinity});\r\n            getUserInfo()\r\n            .then( (response) => {\r\n                toast.success(`Welcome ${response.name}`, {id:toast_usr, icon:'⚡', duration:4000});\r\n                setUser(response);\r\n                setLogged(true);\r\n            })\r\n            .catch( ({error, message}) => {\r\n                toast.error(`onGetUserInfo(e:${error}): ${message}`, {id:toast_usr, icon:'⚠️', duration:4000});\r\n                if(retries >= 3) logout();\r\n                else \r\n                {\r\n                    toast((t) => {\r\n                        const [timer, setTimer] = useState(t.duration * .001);\r\n                        useEffect( ()=>{ const interval_id = setInterval(()=>setTimer(s=>Math.max(0,s-1)), 1000);   //Toast Constructor\r\n                            return ()=>{ clearInterval(interval_id);    setRetries(v => v+1);                       //Toast Destructor\r\n                        }}, []);\r\n                        return <span>{timer === 0 ? `Retrying`:`Retrying in ${timer}s...`}</span>\r\n                    },{duration:5000});\r\n                }\r\n            });\r\n        }\r\n    },[isConnected.rtc && isConnected.app, token, isLogged, retries]);\r\n\r\n    function onError(response){\r\n        const {event, data} = response;\r\n        if(event === 'error'){\r\n            switch(data.error)\r\n            {\r\n                case 101: \r\n                    toast.error(data.message);\r\n                    logout(); \r\n                break;\r\n                default:\r\n                    console.warn(\"error type not handled\", data);\r\n            }\r\n        }\r\n    }\r\n\r\n    function login(email, password){\r\n        const toastId = toast.loading('Logging in...');\r\n        email = email.toLowerCase();\r\n        setToken(null);\r\n        return http.post(`${process.env.REACT_APP_API_URL}/auth/basic`, {data:{ email, password }})\r\n        .then(async response => {\r\n            if(!response){\r\n                throw(`onLogin error: no response`);\r\n            }\r\n\r\n            if(response?.error || !response?.token)\r\n            {\r\n                for(let msg of [response.message].flat()) \r\n                    toast.error(`onLogin error: ${msg}`);\r\n                toast.dismiss(toastId);\r\n                setTimeout(logout,2000)\r\n                return null;\r\n            }\r\n            toast.success('Success login', { id: toastId });\r\n            setToken(response.token);\r\n\r\n            return response.token;\r\n        })\r\n        .catch(err => toast.error(`Error catch: ${err}`, { id: toastId }));\r\n    }\r\n\r\n    async function logout(){\r\n        cookies.set(\"admire_app_email\",null,-1);\r\n        cookies.set(\"admire_app_token\",null,-1);\r\n        setToken(null);\r\n        setLogged(false);\r\n        toast('Logged out');\r\n        \r\n        BRA.rtcClient.disconnect();\r\n        BRA.appClient.disconnect(); \r\n        setRetries(0);\r\n    }\r\n\r\n    async function getUserInfo(){\r\n        return new Promise((resolve, reject) => {\r\n            http.get(`${process.env.REACT_APP_API_URL}/users/me`, {headers:{Authorization:`Bearer ${token}`}})\r\n            .then( response => {\r\n                if(response?.error) reject(response);\r\n                else resolve(response);\r\n            })\r\n            .catch(err => reject(err));\r\n        });\r\n    }\r\n\r\n    async function updateUserInfo(data){\r\n        const info = await getUserInfo();\r\n        if(!info) return;\r\n        let promises = [];\r\n        \r\n        ///users/update/username\r\n        if(info.username != data.username)\r\n            promises.push(http.post(`${process.env.REACT_APP_API_URL}/users/update/username`, {data:{username:data.username}}, {headers:{Authorization:`Bearer ${token}`}}));\r\n\r\n        ///users/update/password\r\n        if(info.password != data.password)\r\n            promises.push(http.post(`${process.env.REACT_APP_API_URL}/users/update/password`, {data:{password:data.password}}, {headers:{Authorization:`Bearer ${token}`}}));\r\n\r\n        ///users/update/avatar\r\n        if(info.avatar != data.avatar)\r\n            promises.push(http.post(`${process.env.REACT_APP_API_URL}/users/update/avatar`, {data:{avatar:data.avatar}}, {headers:{Authorization:`Bearer ${token}`}}));\r\n\r\n        ///users/update/name\r\n        if(info.name != data.name)\r\n            promises.push(http.post(`${process.env.REACT_APP_API_URL}/users/update/name`, {data:{name:data.name}}, {headers:{Authorization:`Bearer ${token}`}}));\r\n\r\n        ///users/update/surname\r\n        if(info.surname != data.surname)\r\n            promises.push(http.post(`${process.env.REACT_APP_API_URL}/users/update/surname`, {data:{email:data.surname}}, {headers:{Authorization:`Bearer ${token}`}}));\r\n\r\n        ///users/update/birthdate\r\n        if(info.birthdate != data.birthdate)\r\n            promises.push(http.post(`${process.env.REACT_APP_API_URL}/users/update/birthdate`, {data:{description:data.birthdate}}, {headers:{Authorization:`Bearer ${token}`}}));\r\n\r\n        if(promises.length === 0) \r\n            return toast.success('No changes on user info detected');\r\n\r\n        return Promise.all(promises)\r\n        .then(response => {\r\n            if(!response) return;\r\n            if(response.some(r => r?.error))\r\n            {\r\n                toast.error('Error updating user info');\r\n                return;\r\n            }\r\n            toast.success('User info updated');\r\n            return response;\r\n        })\r\n        .catch(err => toast.error(`Error catch: ${err}`));\r\n    }\r\n\r\n    async function getUserAvatar(username){\r\n        return new Promise((resolve, reject) => {\r\n            http.get(`${process.env.REACT_APP_API_URL}/users/${username}/avatar`, {headers:{Authorization:`Bearer ${token}`}})\r\n            .then( response => {\r\n                if(response?.error) reject(response);\r\n                else resolve(response.avatar);\r\n            })\r\n            .catch(err => reject(err));\r\n        });\r\n    }\r\n    \r\n    const store = window.auth = {\r\n        user       \r\n        ,isLogged\r\n       ,isConnected: isConnected.app && isConnected.rtc\r\n       ,login\r\n       ,logout\r\n       ,getUserInfo\r\n       ,getUserAvatar\r\n       ,updateUserInfo\r\n   }\r\n \r\n    return <AuthContext.Provider value={store}> \r\n        {children}\r\n    </AuthContext.Provider>\r\n}","import rehypeRaw from 'rehype-raw'\r\nimport remarkGfm from 'remark-gfm'\r\nimport remarkBreaks from 'remark-breaks'\r\nimport ReactMarkdown from 'react-markdown'\r\n\r\nexport default ({children,...props}) => {\r\n    return <ReactMarkdown children={children.replaceAll(\"  \",\"\")} remarkPlugins={[remarkGfm, remarkBreaks]} rehypePlugins={[rehypeRaw]} {...props}/>\r\n}","var map = {\n\t\"./Battery.jsx\": [\n\t\t305,\n\t\t4\n\t],\n\t\"./Devices.jsx\": [\n\t\t306,\n\t\t3,\n\t\t5\n\t],\n\t\"./Pose.jsx\": [\n\t\t303,\n\t\t9,\n\t\t6\n\t],\n\t\"./Selfie.jsx\": [\n\t\t307,\n\t\t7\n\t],\n\t\"./Shader.jsx\": [\n\t\t304,\n\t\t8\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 286;\nmodule.exports = webpackAsyncContext;","const reportWebVitals = (onPerfEntry) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\n\r\nimport Layout from 'partials/layout'\r\nimport {ProgressBar} from 'react-bootstrap';\r\n\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n      <React.Suspense children={<Layout/>} fallback={<ProgressBar className=\"start-50\" animated now={100} />}/>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://cra.link/PWA\r\n//serviceWorkerRegistration.register();\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","\r\nlet http = {\r\n    get: async function(url, options = {}) {\r\n        const headers = Object.assign({\r\n            'Content-Type': 'application/json'\r\n        }, options.headers ?? {});\r\n\r\n        return fetch(url, {method: 'GET',headers})\r\n        .then(response => response.json())\r\n        .catch(error => console.trace(error));\r\n    },\r\n\r\n    post: async function(url, options = {}) {\r\n        const headers = Object.assign({\r\n            'Content-Type': 'application/json'\r\n        }, options.headers ?? {});\r\n\r\n        const body = JSON.stringify(options.data ?? {});\r\n\r\n        return fetch(url, {method: 'POST',headers,body})\r\n        .then(response =>  response.json())\r\n        .catch(error => console.trace(error));\r\n    },\r\n}\r\n\r\nexport default http;","import * as BRA from \"lib_bra\"\r\nimport toast from 'react-hot-toast'\r\nimport { useState, useContext, useReducer, useEffect, createContext, useRef } from 'react'\r\n\r\n\r\nexport const MediaContext = createContext(); \r\nexport default ({children, ...props}) => {\r\n\r\n    let   {current:init_evts}            = useRef(0);\r\n    const videoRef                       = useRef(null);\r\n    const [ready, setReady ]             = useState(false);\r\n    const [devices , setDevices]         = useState(null);\r\n    const [settings, setSettings ]       = useState(null);\r\n    const [resolutions, setResolutions ] = useState(null);\r\n    let [localStream, setLocalStream ] = useReducer( (value, newvalue)=>{\r\n        if( videoRef && videoRef.current )\r\n            videoRef.current.srcObject = newvalue;\r\n        return newvalue;\r\n    }, BRA.dummyStream.getStream() );\r\n    \r\n    useEffect( ()=>{ \r\n      \r\n     \r\n        (async ()=>{\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.GotDevices,          onGotDevices );\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.ErrorStream,         onError);\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.ErrorDevices,        onError);\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.GotResolutions,      onGotResolutions );\r\n  \r\n            let supported = await BRA.mediaAdapter.start();\r\n            if( !supported )\r\n                return toast.error(\"Media devices are not available\");\r\n            \r\n\r\n            let audio = window.localStorage.getItem(\"audio\");\r\n            let video = window.localStorage.getItem(\"video\");               \r\n            \r\n            await new Promise((resolve, reject)=>{\r\n                function onStream(d){\r\n                    BRA.mediaAdapter.off(BRA.MediaEvent.GotStream, onStream );\r\n                    resolve(d);\r\n                }\r\n                BRA.mediaAdapter.on(BRA.MediaEvent.GotStream, onStream );\r\n                BRA.mediaAdapter.setVideo(video);\r\n            })\r\n            .then(onGotStream);\r\n\r\n            await new Promise((resolve, reject)=>{\r\n                function onStream(d){\r\n                    BRA.mediaAdapter.off(BRA.MediaEvent.GotStream, onStream );\r\n                    BRA.mediaAdapter.on(BRA.MediaEvent.GotStream, onGotStream );\r\n                    resolve(d);\r\n                }\r\n                BRA.mediaAdapter.on(BRA.MediaEvent.GotStream, onStream );\r\n                BRA.mediaAdapter.setAudio(audio);\r\n            })\r\n            .then(onGotStream)        \r\n           \r\n            setReady(true);\r\n        })();\r\n            \r\n        function onUnload(){\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.GotStream,      onGotStream );\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.GotDevices,     onGotDevices );\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.ErrorStream,    onError);\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.ErrorDevices,   onError);\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.GotResolutions, onGotResolutions );\r\n            window.removeEventListener('unload ', onUnload);\r\n        }\r\n        window.addEventListener('unload ',    onUnload);\r\n    return ()=>{\r\n        onUnload();\r\n    }}, []);\r\n\r\n    function getDevices(){\r\n        BRA.mediaAdapter.getDevices();\r\n    }\r\n\r\n    function onGotResolutions({resolutions, settings})\r\n    { \r\n        setSettings({...settings});\r\n        setResolutions(resolutions); \r\n    }\r\n    \r\n    function onGotDevices ({ audioDevices: audio, videoDevices: video, settings }) \r\n    { \r\n        setSettings({...settings});\r\n        setDevices({...devices, audio, video});\r\n    }\r\n\r\n    function onGotStream({stream, settings})\r\n    { \r\n        window.localStorage.setItem(\"audio\", settings?.audio);\r\n        window.localStorage.setItem(\"video\", settings?.video);\r\n        window.localStream = localStream = stream;\r\n        setSettings({...settings});\r\n        setLocalStream(localStream);\r\n    }\r\n\r\n    function onError({error, message}){\r\n        toast.error(`${error}: ${message}`);\r\n    }\r\n\r\n    function init(){\r\n        if( init_evts <= 0 ){\r\n            //start the thing\r\n            //BRA.mediaAdapter.start();\r\n            getDevices();\r\n        }\r\n        ++init_evts;\r\n    }\r\n\r\n    function stop(){\r\n        --init_evts;\r\n        if( init_evts <= 0 ){\r\n            //BRA.mediaAdapter.stop();\r\n            //stop the thing\r\n        }\r\n    }\r\n\r\n    function setVideo(device, resolution){\r\n        BRA.mediaAdapter.setVideo(device, resolution);\r\n    }\r\n    \r\n    function setAudio(device){\r\n        BRA.mediaAdapter.setAudio(device);\r\n    }\r\n\r\n    function setMask(mask){\r\n        this.settings.mask = mask;\r\n    }\r\n\r\n    const store = window.media = {\r\n        devices,\r\n        settings, \r\n        resolutions,\r\n        localStream,\r\n        init,\r\n        stop,\r\n        getDevices,\r\n        setVideo,\r\n        setAudio,\r\n        setMask,\r\n        ready,\r\n    }\r\n\r\n    return <MediaContext.Provider value={store} children={children}/>\r\n}","\"use strict\";\r\n\r\nconst PING_PERIOD = 5 * 1000;\r\nconst DEBUG_STYLE = \"background: hsla(0, 0%, 13%, 1); color: hsla(74, 64%, 60%, 1)\";\r\n\r\nexport const RTCEvent =\r\n{\r\n\tClientConnected:        \"client_connected\",\r\n\tClientDisconnected:     \"client_disconnected\",\r\n    Error:                  \"error\",\r\n    IncomingCall:           \"incoming_call\",\r\n    CallAccepted:           \"call_accepted\",\r\n    CallCanceled:           \"call_canceled\",\r\n    CallOpened:             \"call_opened\",\r\n    CallClosed:             \"call_closed\",\r\n    CallHangup:             \"call_hangup\"\r\n};\r\n\r\nexport function RTCClient( defaultStream )\r\n{\r\n//#region Variables\r\n    if( !defaultStream )\r\n    {\r\n        defaultStream = new MediaStream();\r\n    }\r\n\r\n    let responses = { };\r\n    let events = { };\r\n\r\n    let token = null;\r\n    let calls = { };\r\n    let socket = null;\r\n    let keepAliveTimeout = null;\r\n//#endregion\r\n\r\n//#region Methods\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n \r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n \r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Connect to the server.\r\n     */\r\n    let connect = function( url, accessToken )\r\n    {\r\n        token = accessToken;\r\n        socket = new WebSocket(url + \"?token=\" + token);\r\n\r\n        socket.onopen = onOpen;\r\n        socket.onmessage = onMessage;\r\n        socket.onclose = onClose;\r\n    };\r\n\r\n    /**\r\n     * Disconnect from the server.\r\n     */\r\n    let disconnect = function()\r\n    {\r\n        socket?.close();\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is opened.\r\n     */\r\n    let onOpen = function( event )\r\n    {\r\n        console.log(\"%c\" + \"connected\" + \"%o\", DEBUG_STYLE, socket.url);\r\n        startKeepAlive();\r\n        emit(RTCEvent.ClientConnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is closed.\r\n     */\r\n    let onClose = function( event )\r\n    {\r\n        console.log(\"%c\" + \"disconnected\" + \"%o\", DEBUG_STYLE, socket.url);\r\n        stopKeepAlive();\r\n        emit(RTCEvent.ClientDisconnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when a message is received from the server.\r\n     */\r\n    let onMessage = function( msg )\r\n    {\r\n        let message = JSON.parse(msg.data);\r\n        if( message.event === \"pong\" )\r\n        {\r\n            return;\r\n        }\r\n\r\n        console.log(\" %c%s\" + \"%o\", DEBUG_STYLE, message.event, message.data);\r\n\r\n        // Check whether the message needs internal handling.\r\n        switch( message.event )\r\n        {\r\n            case \"call_response\":           handleCallResponse(message);            break;\r\n            case \"incoming_call\":           handleIncomingCall(message);            break;\r\n            case \"call_accepted\":           handleCallAccepted(message);            break;\r\n            case \"call_canceled\":           handleCallCanceled(message);            break;\r\n            case \"remote_offer\":            handleRemoteOffer(message);             break;\r\n            case \"remote_answer\":           handleRemoteAnswer(message);            break;\r\n            case \"remote_candidate\":        handleRemoteCandidate(message);         break;\r\n            case \"call_hangup\":             handleCallHangup(message);              break;\r\n        }\r\n\r\n        // Check whether the message has a response listener.\r\n        if( message.data.uuid in responses )\r\n        {\r\n            let response = responses[message.data.uuid];\r\n            delete responses[message.data.uuid];\r\n            delete message.data.uuid;\r\n            response(message);\r\n            return;\r\n        }\r\n\r\n        // Check whether the message has an event.\r\n        emit(message.event, message);\r\n    };\r\n\r\n    /**\r\n     * Send a message to the server.\r\n     */\r\n    let sendMessage = function( message, response )\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Set the token.\r\n        message.data.token = token;\r\n\r\n        // Generate a UUID.\r\n        message.data.uuid = uuid();\r\n\r\n        // Add the response listener.\r\n        if( response instanceof Function )\r\n        {\r\n            responses[message.data.uuid] = response;\r\n        }\r\n\r\n        // Send the message.\r\n        let msg = JSON.stringify(message);\r\n        socket.send(msg);\r\n        if( message.event !== \"ping\" )\r\n        {\r\n            console.log(\" %c%s\" + \"%o\", DEBUG_STYLE, message.event, msg);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start a keep alive timeout.\r\n     */\r\n    let startKeepAlive = function()\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return;\r\n        }\r\n\r\n        ping();\r\n\r\n        keepAliveTimeout = window.setTimeout(startKeepAlive, PING_PERIOD);\r\n    };\r\n\r\n    /**\r\n     * Stop the keep alive timeout.\r\n     */\r\n    let stopKeepAlive = function()\r\n    {\r\n        window.clearTimeout(keepAliveTimeout);\r\n    };\r\n\r\n    /**\r\n     * Send a ping to the server.\r\n     */\r\n    let ping = function()\r\n    {\r\n        let message =\r\n        {\r\n            event: \"ping\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Get the specified call.\r\n     */\r\n    let getCall = function( callid )\r\n    {\r\n        return (callid in calls) ? calls[callid] : null;\r\n    };\r\n\r\n    /**\r\n     * Get all the calls.\r\n     */\r\n    let getCalls = function()\r\n    {\r\n        return calls;\r\n    };\r\n\r\n    /**\r\n     * Call a user.\r\n     * @param {Object} options - Optional parameters: callid, response.\r\n     */\r\n    let call = function( callee, options = {} )\r\n    {\r\n        let msg =\r\n        {\r\n            event: \"call\",\r\n            data:\r\n            {\r\n                callee: callee,\r\n                callid: options?.callid\r\n            }\r\n        };\r\n        return sendMessage(msg, options?.response);\r\n    };\r\n\r\n    /**\r\n     * Close a call.\r\n     */\r\n    let closeCall = function( callid )\r\n    {\r\n        if( !(callid in calls) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let call = calls[callid];\r\n        call.close();\r\n        delete(calls[callid]);\r\n\r\n        emit(RTCEvent.CallClosed, { call: call });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Accept a call.\r\n     * @param {Object} options - Optional parameters: response.\r\n     */\r\n    let acceptCall = function( callid, options = {} )\r\n    {\r\n        if( !(callid in calls) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let call = calls[callid];\r\n\r\n        let msg =\r\n        {\r\n            event: \"accept_call\",\r\n            data:\r\n            {\r\n                callid: call.callid\r\n            }\r\n        };\r\n        return sendMessage(msg, options?.response);\r\n    };\r\n\r\n    /**\r\n     * Cancel a call.\r\n     * @param {Object} options - Optional parameters: response.\r\n     */\r\n    let cancelCall = function( callid, options = {} )\r\n    {\r\n        if( !(callid in calls) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Delete the call.\r\n        let call = calls[callid];\r\n        delete calls[callid];\r\n\r\n        let msg =\r\n        {\r\n            event: \"cancel_call\",\r\n            data:\r\n            {\r\n                callid: call.callid\r\n            }\r\n        };\r\n        return sendMessage(msg, options?.response);\r\n    };\r\n\r\n    /**\r\n     * Hang up a call. If call ID is undefined then all calls are hang up.\r\n     * @param {Object} options - Optional parameters: response.\r\n     */\r\n    let hangup = function( callid, options = {} )\r\n    {\r\n        if( callid ) // Close the call.\r\n        {\r\n            if( !closeCall(callid) )\r\n            {\r\n                return false;\r\n            }\r\n\r\n            let msg =\r\n            {\r\n                event: \"hangup\",\r\n                data:\r\n                {\r\n                    callid: callid\r\n                }\r\n            };\r\n            return sendMessage(msg, options?.response);\r\n        }\r\n        else // Close all the calls.\r\n        {\r\n            for( let id in calls )\r\n            {\r\n                if( !closeCall(id) )\r\n                {\r\n                    continue;\r\n                }\r\n\r\n                let msg =\r\n                {\r\n                    event: \"hangup\",\r\n                    data:\r\n                    {\r\n                        callid: id\r\n                    }\r\n                };\r\n                sendMessage(msg);\r\n            }\r\n\r\n            calls = { };\r\n\r\n            return true;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier.\r\n     * Reference: RFC 4122 https://www.ietf.org/rfc/rfc4122.txt\r\n     */\r\n    let uuid = function()\r\n    {\r\n        return uuidv4();\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier v4.\r\n     * Reference: https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\r\n     */\r\n    let uuidv4 = function()\r\n    {\r\n        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\r\n          (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\r\n        );\r\n    };\r\n//#endregion\r\n\r\n//#region EventHandlers\r\n    /**\r\n     * Call response event handler.\r\n     */\r\n    let handleCallResponse = function( event )\r\n    {\r\n        // Create the call.\r\n        let call = new RTCCall(event.data.callid, event.data.caller, event.data.callee, JSON.parse(event.data.iceServers));\r\n        calls[call.callid] = call;\r\n    };\r\n\r\n    /**\r\n     * Incoming call event handler.\r\n     */\r\n    let handleIncomingCall = function( event )\r\n    {\r\n        // Create the call.\r\n        let call = new RTCCall(event.data.callid, event.data.caller, event.data.callee, JSON.parse(event.data.iceServers));\r\n        calls[call.callid] = call;\r\n    };\r\n\r\n    /**\r\n     * Call accepted event handler.\r\n     */\r\n    let handleCallAccepted = function( event )\r\n    {\r\n        // Create the peer connection.\r\n        let call = calls[event.data.callid];\r\n        let rtcConfiguration = { iceServers: call.iceServers };\r\n        let peerConnection = new RTCPeerConnection(rtcConfiguration);\r\n        call.bind(peerConnection, true);\r\n\r\n        // Handle the peer connection lifecycle.\r\n        peerConnection.oniceconnectionstatechange = function( other )\r\n        {\r\n            handleIceConnectionStateChange(call);\r\n        }\r\n\r\n        // Generate candidates.\r\n        peerConnection.onicecandidate = function( other )\r\n        {\r\n            if( !other.candidate || other.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n            {\r\n                return;\r\n            }\r\n\r\n            let msg =\r\n            {\r\n                event: \"candidate\",\r\n                data:\r\n                {\r\n                    callid: event.data.callid,\r\n                    candidate: JSON.stringify(other.candidate)\r\n                }\r\n            };\r\n            sendMessage(msg);\r\n        };\r\n\r\n        peerConnection.onnegotiationneeded = function( other )\r\n        {\r\n            // Generate offer.\r\n            peerConnection.createOffer().then(function( sdp )\r\n            {\r\n                // Set caller local description.\r\n                peerConnection.setLocalDescription(sdp);\r\n\r\n                let msg =\r\n                {\r\n                    event: \"offer\",\r\n                    data:\r\n                    {\r\n                        callid: event.data.callid,\r\n                        offer: JSON.stringify(sdp)\r\n                    }\r\n                };\r\n                sendMessage(msg);\r\n            });\r\n        };\r\n\r\n        // Add the tracks. This action triggers the ICE negotiation process.\r\n        let tracks = defaultStream.getTracks();\r\n        tracks.forEach(track => peerConnection.addTrack(track));\r\n\r\n        // Create a default data channel to avoid renegotiation.\r\n        peerConnection.createDataChannel(\"default\");\r\n    };\r\n\r\n    /**\r\n     * Call canceled event handler.\r\n     */\r\n    let handleCallCanceled = function( event )\r\n    {\r\n        closeCall(event.data.callid);\r\n    };\r\n\r\n    /**\r\n     * Remote offer event handler.\r\n     */\r\n    let handleRemoteOffer = function( event )\r\n    {\r\n        // Create the peer connection.\r\n        let call = calls[event.data.callid];\r\n        let rtcConfiguration = { iceServers: call.iceServers };\r\n        let peerConnection = new RTCPeerConnection(rtcConfiguration);\r\n        call.bind(peerConnection, false);\r\n\r\n        // Handle the peer connection lifecycle.\r\n        peerConnection.oniceconnectionstatechange = function( other )\r\n        {\r\n            handleIceConnectionStateChange(call);\r\n        }\r\n\r\n        // Set the callee remote description.\r\n        peerConnection.setRemoteDescription(JSON.parse(event.data.offer));\r\n\r\n        // Gather the pending candidates.\r\n        call.gatherPendingCandidates();\r\n\r\n        // Generate the candidates.\r\n        peerConnection.onicecandidate = function( other )\r\n        {\r\n            if( !other.candidate || other.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n            {\r\n                return;\r\n            }\r\n\r\n            let msg =\r\n            {\r\n                event: \"candidate\",\r\n                data:\r\n                {\r\n                    callid: event.data.callid,\r\n                    candidate: JSON.stringify(other.candidate)\r\n                }\r\n            };\r\n            sendMessage(msg);\r\n        };\r\n\r\n        // Add the tracks.\r\n        let tracks = defaultStream.getTracks();\r\n        tracks.forEach(track => peerConnection.addTrack(track));\r\n\r\n        // Create the answer.\r\n        window.setTimeout(function()\r\n        {\r\n            peerConnection.createAnswer().then(function( sdp )\r\n            {\r\n                // Set the callee local description.\r\n                peerConnection.setLocalDescription(sdp);\r\n\r\n                let msg =\r\n                {\r\n                    event: \"answer\",\r\n                    data:\r\n                    {\r\n                        callid: event.data.callid,\r\n                        answer: JSON.stringify(sdp)\r\n                    }\r\n                };\r\n                sendMessage(msg);\r\n            });\r\n        }, 500);\r\n    };\r\n\r\n    /**\r\n     * Remote answer event handler.\r\n     */\r\n    let handleRemoteAnswer = function( event )\r\n    {\r\n        if( event.data.callid in calls )\r\n        {\r\n            let answer = JSON.parse(event.data.answer);\r\n\r\n            // Set the caller remote description.\r\n            calls[event.data.callid].setRemoteDescription(answer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Remote candidate event handler.\r\n     */\r\n    let handleRemoteCandidate = function( event )\r\n    {\r\n        let candidate = JSON.parse(event.data.candidate);\r\n        if( !candidate || !candidate.candidate || candidate.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n        {\r\n            return;\r\n        }\r\n\r\n        if( event.data.callid in calls )\r\n        {\r\n            let call = calls[event.data.callid];\r\n            call.addCandidate(candidate);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Call hangup event handler.\r\n     */\r\n    let handleCallHangup = function( event )\r\n    {\r\n        closeCall(event.data.callid);\r\n    };\r\n\r\n    /**\r\n     * ICE connection state change event handler.\r\n     */\r\n    let handleIceConnectionStateChange = async function( call )\r\n    {\r\n        let state = call.getState();\r\n        console.log(\"%c\" + \"Connection State\" + \"%o%o\", DEBUG_STYLE, call.callid, state);\r\n\r\n        switch( state )\r\n        {\r\n            case \"failed\":\r\n            case \"disconnected\":\r\n            case \"closed\":\r\n            {\r\n                hangup(call.callid);\r\n                break;\r\n            }\r\n            case \"new\":\r\n            case \"checking\":\r\n            case \"completed\":\r\n            {\r\n                break;\r\n            }\r\n            case \"connected\":\r\n            {\r\n                let stream = call.getRemoteStream();\r\n                console.log(\"%c\" + RTCEvent.CallOpened + \"%o%o\", DEBUG_STYLE, call.callid, stream);\r\n                emit(RTCEvent.CallOpened, { call: call, stream: stream });\r\n                break;\r\n            }\r\n        }\r\n    };\r\n//#endregion\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        connect,\r\n        disconnect,\r\n        getCall,\r\n        getCalls,\r\n        call,\r\n        acceptCall,\r\n        cancelCall,\r\n        hangup\r\n    };\r\n}\r\n\r\nexport function RTCCall( callid, caller, callee, iceServers )\r\n{\r\n//#region Variables\r\n    let connection = null;\r\n    let candidates = [];\r\n    let channels = { };\r\n    let initiator = false;\r\n//#endregion\r\n\r\n//#region Methods\r\n    /**\r\n     * Bind the call to a peer connection.\r\n     */\r\n    let bind = function( peerConnection, isInitiator )\r\n    {\r\n        if( !(peerConnection instanceof RTCPeerConnection) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection = peerConnection;\r\n        initiator = isInitiator;\r\n\r\n        // Handle the data channel event internally to track the data channels lifecycle.\r\n        connection.addEventListener(\"datachannel\", function( event )\r\n        {\r\n            channels[event.channel.label] = event.channel;\r\n\r\n            // Handle the close event.\r\n            event.channel.addEventListener(\"onclose\", function( event )\r\n            {\r\n                delete channels[event.channel.label];\r\n            });\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Close the call.\r\n     */\r\n    let close = function()\r\n    {\r\n        connection?.close();\r\n    };\r\n\r\n    /**\r\n     * Return whether the user is the initiator.\r\n     */\r\n    let isInitiator = function()\r\n    {\r\n        return initiator;\r\n    };\r\n\r\n    /**\r\n     * Get the call state.\r\n     */\r\n    let getState = function()\r\n    {\r\n        return (connection) ? connection.iceConnectionState : \"closed\";\r\n    };\r\n\r\n    /**\r\n     * Get the call stats.\r\n     */\r\n    let getStats = async function()\r\n    {\r\n        if( !connection )\r\n        {\r\n            return;\r\n        }\r\n\r\n        let callStats = { callid: callid, caller: caller, callee: callee };\r\n\r\n        return await connection.getStats(null).then(function( stats )\r\n        {\r\n            // Get the stats of the succeeded candidate pair.\r\n            let pairStats = null;\r\n            stats.forEach(report =>\r\n            {\r\n                //console.log(report);\r\n                if( report.type === \"candidate-pair\" && (report.selected === true || report.state === \"succeeded\") )\r\n                {\r\n                    pairStats = report;\r\n                }\r\n            });\r\n\r\n            // Get the stats of the local and remote candidates.\r\n            if( pairStats )\r\n            {\r\n                stats.forEach(report =>\r\n                {\r\n                    if( report.id === pairStats.localCandidateId )\r\n                    {\r\n                        callStats.localType = report.candidateType;\r\n                        callStats.localAddress = report.address ?? report.ip;\r\n                        callStats.localPort = report.port;\r\n                        callStats.localProtocol = report.protocol;\r\n                    }\r\n                    if( report.id === pairStats.remoteCandidateId )\r\n                    {\r\n                        callStats.remoteType = report.candidateType;\r\n                        callStats.remoteAddress = report.address ?? report.ip;\r\n                        callStats.remotePort = report.port;\r\n                        callStats.remoteProtocol = report.protocol;\r\n                    }\r\n                });\r\n            }\r\n\r\n            return Promise.resolve(callStats);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Add a candidate or save it for gathering.\r\n     */\r\n    let addCandidate = function( candidate )\r\n    {\r\n        if( !connection )\r\n        {\r\n            candidates.push(candidate);\r\n        }\r\n        else\r\n        {\r\n            connection.addIceCandidate(candidate);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Gather the pending candidates.\r\n     */\r\n    let gatherPendingCandidates = function()\r\n    {\r\n        if( candidates.length > 0 )\r\n        {\r\n            candidates.forEach(candidate => connection.addIceCandidate(candidate));\r\n            candidates = [];\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set the remote session description.\r\n     */\r\n    let setRemoteDescription = function( description )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection.setRemoteDescription(description);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * [NYI] Set the stream's bandwidth.\r\n     * References:\r\n     * https://webrtchacks.com/limit-webrtc-bandwidth-sdp/\r\n     * https://stackoverflow.com/questions/57653899/how-to-increase-the-bitrate-of-webrtc\r\n     */\r\n    let setBandwidth = function( bandwidth )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let senders = connection.getSenders();\r\n        if( !senders )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            let parameters = sender.getParameters();\r\n            if( !parameters.encodings )\r\n            {\r\n                parameters.encodings = [{ }];\r\n            }\r\n\r\n            parameters.encodings[0].maxBitrate = bandwidth * 1000;\r\n\r\n            sender.setParameters(parameters);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Get the remote audio track specified by index.\r\n     */\r\n    let getRemoteAudioTrack = function ( index = 0 )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track.kind === \"audio\" )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < tracks.length )\r\n        {\r\n            return tracks[index];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Get the remote video track specified by index.\r\n     */\r\n    let getRemoteVideoTrack = function ( index = 0 )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track.kind === \"video\" )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < tracks.length )\r\n        {\r\n            return tracks[index];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Get the remote stream of the peer connection composed by all the audio and video tracks.\r\n     */\r\n    let getRemoteStream = function()\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( tracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let stream = new MediaStream();\r\n        for( let i = 0; i < tracks.length; i++ )\r\n        {\r\n            let track = tracks[i];\r\n            stream.addTrack(track);\r\n        }\r\n\r\n        return stream;\r\n    };\r\n\r\n    /**\r\n     * Replace the local audio track specified by index.\r\n     */\r\n    let replaceLocalAudioTrack = function( track, index = 0 )\r\n    {\r\n        if( !connection || !track )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let audioSenders = [];\r\n        let senders = connection.getSenders();\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            if( sender.track && sender.track.kind === \"audio\" )\r\n            {\r\n                audioSenders.push(sender);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < audioSenders.length )\r\n        {\r\n            audioSenders[index].replaceTrack(track);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Replace the local video track specified by index.\r\n     */\r\n    let replaceLocalVideoTrack = function( track, index = 0 )\r\n    {\r\n        if( !connection || !track )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let videoSenders = [];\r\n        let senders = connection.getSenders();\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            if( sender.track && sender.track.kind === \"video\" )\r\n            {\r\n                videoSenders.push(sender);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < videoSenders.length )\r\n        {\r\n            videoSenders[index].replaceTrack(track);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n//#endregion\r\n\r\n//#region DataChannel\r\n    /**\r\n     * Open a data channel.\r\n     */\r\n    let openChannel = function( label )\r\n    {\r\n        if( !connection || label in channels )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = connection.createDataChannel(label);\r\n        channels[label] = channel;\r\n\r\n        // Handle the close event.\r\n        channel.addEventListener(\"onclose\", function( event )\r\n        {\r\n            delete channels[channel.label];\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Close a data channel.\r\n     */\r\n    let closeChannel = function( label )\r\n    {\r\n        if( !connection || !(label in channels) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.close();\r\n        delete channels[label];\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback for the data channel event.\r\n     */\r\n    let onDataChannel = function( callback )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection.addEventListener(\"datachannel\", callback);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel open event.\r\n     */\r\n    let onChannelOpen = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onopen = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel close event.\r\n     */\r\n    let onChannelClose = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.addEventListener(\"onclose\", callback);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel error event.\r\n     */\r\n    let onChannelError = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onerror = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel message event.\r\n     */\r\n    let onChannelMessage = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onmessage = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Send data through an opened channel.\r\n     */\r\n    let sendData = function( label, data )\r\n    {\r\n        if( !connection || !(label in channels) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        if( channel.readyState !== \"open\" )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        channel.send(data);\r\n\r\n        return true;\r\n    };\r\n//#endregion\r\n\r\n    return {\r\n        get callid() { return callid; },\r\n        get caller() { return caller; },\r\n        get callee() { return callee; },\r\n        get iceServers() { return iceServers; },\r\n        bind,\r\n        close,\r\n        isInitiator,\r\n        getState,\r\n        getStats,\r\n        addCandidate,\r\n        gatherPendingCandidates,\r\n        setRemoteDescription,\r\n        setBandwidth,\r\n        getRemoteAudioTrack,\r\n        getRemoteVideoTrack,\r\n        getRemoteStream,\r\n        replaceLocalAudioTrack,\r\n        replaceLocalVideoTrack,\r\n        openChannel,\r\n        closeChannel,\r\n        onDataChannel,\r\n        onChannelOpen,\r\n        onChannelClose,\r\n        onChannelError,\r\n        onChannelMessage,\r\n        sendData\r\n    };\r\n}","\"use strict\";\r\n\r\nconst PING_PERIOD = 5 * 1000;\r\nconst DEBUG_STYLE = \"background: hsla(0, 0%, 13%, 1); color: hsla(180, 89%, 45%, 1)\";\r\n\r\nexport const LobbyEvent =\r\n{\r\n    ClientConnected:        \"client_connected\",\r\n    ClientDisconnected:     \"client_disconnected\",\r\n    Error:                  \"error\",\r\n    UserOnline:             \"user_online\",\r\n    UserOffline:            \"user_offline\",\r\n    RoomCreated:            \"room_created\",\r\n    RoomDeleted:            \"room_deleted\",\r\n    GuestJoinedRoom:        \"guest_joined_room\",\r\n    GuestLeftRoom:          \"guest_left_room\",\r\n    UserRejoined:           \"user_rejoined\",\r\n    UserKicked:             \"user_kicked\",\r\n    ChatText:               \"chat_text\"\r\n};\r\n\r\nexport function LobbyClient()\r\n{\r\n    let responses = { };\r\n    let events = { };\r\n\r\n    let token = null;\r\n    let socket = null;\r\n    let keepAliveTimeout = null;\r\n\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n \r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n \r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Connect to the server.\r\n     */\r\n    let connect = function( url, accessToken )\r\n    {\r\n        token = accessToken;\r\n        socket = new WebSocket(url + \"?token=\" + token);\r\n\r\n        socket.onopen = onOpen;\r\n        socket.onmessage = onMessage;\r\n        socket.onclose = onClose;\r\n    };\r\n\r\n    /**\r\n     * Disconnect from the server.\r\n     */\r\n    let disconnect = function()\r\n    {\r\n        socket?.close();\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is opened.\r\n     */\r\n    let onOpen = function( event )\r\n    {\r\n        console.log(\"%c\" + \"connected\" + \"%o\", DEBUG_STYLE, socket.url);\r\n        startKeepAlive();\r\n        emit(LobbyEvent.ClientConnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is closed.\r\n     */\r\n    let onClose = function( event )\r\n    {\r\n        console.log(\"%c\" + \"disconnected\" + \"%o\", DEBUG_STYLE, socket.url);\r\n        stopKeepAlive();\r\n        emit(LobbyEvent.ClientDisconnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when a message is received from the server.\r\n     */\r\n    let onMessage = function( msg )\r\n    {\r\n        let message = JSON.parse(msg.data);\r\n        if( message.event === \"pong\" )\r\n        {\r\n            return;\r\n        }\r\n\r\n        console.log(\" %c%s\" + \"%o\", DEBUG_STYLE, message.event, message.data);\r\n\r\n        // Check whether the message has a response listener.\r\n        if( message.data.uuid in responses )\r\n        {\r\n            let response = responses[message.data.uuid];\r\n            delete responses[message.data.uuid];\r\n            delete message.data.uuid;\r\n            response(message);\r\n            return;\r\n        }\r\n\r\n        // Check whether the message has an event.\r\n        emit(message.event, message);\r\n    };\r\n\r\n    /**\r\n     * Send a message to the server.\r\n     */\r\n    let sendMessage = function( message, response )\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Set the token.\r\n        message.data.token = token;\r\n\r\n        // Generate a UUID.\r\n        message.data.uuid = uuid();\r\n\r\n        // Add the response listener.\r\n        if( response instanceof Function )\r\n        {\r\n            responses[message.data.uuid] = response;\r\n        }\r\n\r\n        // Send the message.\r\n        let msg = JSON.stringify(message);\r\n        socket.send(msg);\r\n        if( message.event !== \"ping\" )\r\n        {\r\n            console.log(\" %c%s\" + \"%o\", DEBUG_STYLE, message.event, msg);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start a keep alive timeout.\r\n     */\r\n    let startKeepAlive = function()\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return;\r\n        }\r\n\r\n        ping();\r\n\r\n        keepAliveTimeout = window.setTimeout(startKeepAlive, PING_PERIOD);\r\n    };\r\n\r\n    /**\r\n     * Stop the keep alive timeout.\r\n     */\r\n    let stopKeepAlive = function()\r\n    {\r\n        window.clearTimeout(keepAliveTimeout);\r\n    };\r\n\r\n    /**\r\n     * Send a ping to the server.\r\n     */\r\n    let ping = function()\r\n    {\r\n        let msg =\r\n        {\r\n            event: \"ping\",\r\n            data: { }\r\n        };\r\n        return sendMessage(msg);\r\n    };\r\n\r\n    /**\r\n     * Get the user's room.\r\n     * @param {Object} options - Optional parameters: response.\r\n     */\r\n    let getRoom = function( options = {} )\r\n    {\r\n        let msg =\r\n        {\r\n            event: \"get_room\",\r\n            data: { }\r\n        };\r\n        return sendMessage(msg, options?.response);\r\n    };\r\n\r\n    /**\r\n     * Get the lobby rooms.\r\n     * @param {Object} options - Optional parameters: response.\r\n     */\r\n    let getRooms = function( options = {} )\r\n    {\r\n        let msg =\r\n        {\r\n            event: \"get_rooms\",\r\n            data: { }\r\n        };\r\n        return sendMessage(msg, options?.response);\r\n    };\r\n\r\n    /**\r\n     * Create a room.\r\n     * @param {Object} options - Optional parameters: password, hidden, size, icon, response.\r\n     */\r\n    let createRoom = function( name, options = {} )\r\n    {\r\n        let msg =\r\n        {\r\n            event: \"create_room\",\r\n            data:\r\n            {\r\n                name: name,\r\n                password: options?.password,\r\n                hidden: options?.hidden,\r\n                size: options?.size,\r\n                icon: options?.icon\r\n            }\r\n        };\r\n        return sendMessage(msg, options?.response);\r\n    };\r\n\r\n    /**\r\n     * Join a room.\r\n     * @param {Object} options - Optional parameters: password, response.\r\n     */\r\n    let joinRoom = function( name, options = {} )\r\n    {\r\n        let msg =\r\n        {\r\n            event: \"join_room\",\r\n            data:\r\n            {\r\n                name: name,\r\n                password: options?.password\r\n            }\r\n        };\r\n        return sendMessage(msg, options?.response);\r\n    };\r\n\r\n    /**\r\n     * Leave a room.\r\n     * @param {Object} options - Optional parameters: response.\r\n     */\r\n    let leaveRoom = function( options = {} )\r\n    {\r\n        let msg =\r\n        {\r\n            event: \"leave_room\",\r\n            data: { }\r\n        };\r\n        return sendMessage(msg, options?.response);\r\n    };\r\n\r\n    /**\r\n     * Kick a user from the room.\r\n     * @param {Object} options - Optional parameters: response.\r\n     */\r\n    let kickUser = function( target, options = {} )\r\n    {\r\n        let msg =\r\n        {\r\n            event: \"kick_user\",\r\n            data:\r\n            {\r\n                target: target\r\n            }\r\n        };\r\n        return sendMessage(msg, options?.response);\r\n    };\r\n\r\n    /**\r\n     * Send a text message to the room.\r\n     * @param {Object} options - Optional parameters: response.\r\n     */\r\n    let sendText = function( text, options = {} )\r\n    {\r\n        let msg =\r\n        {\r\n            event: \"send_text\",\r\n            data:\r\n            {\r\n                text: text\r\n            }\r\n        };\r\n        return sendMessage(msg, options?.response);\r\n    }\r\n\r\n    /**\r\n     * Generate a universally unique identifier.\r\n     * Reference: RFC 4122 https://www.ietf.org/rfc/rfc4122.txt\r\n     */\r\n    let uuid = function()\r\n    {\r\n        return uuidv4();\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier v4.\r\n     * Reference: https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\r\n     */\r\n    let uuidv4 = function()\r\n    {\r\n        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\r\n          (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\r\n        );\r\n    };\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        connect,\r\n        disconnect,\r\n        getRoom,\r\n        getRooms,\r\n        createRoom,\r\n        joinRoom,\r\n        leaveRoom,\r\n        kickUser,\r\n        sendText\r\n    };\r\n}","\"use strict\";\r\n\r\nconst DEBUG_STYLE = \"background: hsla(0, 0%, 13%, 1); color: hsla(13, 89%, 45%, 1)\";\r\n\r\nexport const MediaEvent =\r\n{\r\n\tGotDevices:         \"got_devices\",\r\n\tErrorDevices:       \"error_devices\",\r\n    GotResolutions:     \"got_resolutions\",\r\n    GotStream:          \"got_stream\",\r\n    ErrorStream:        \"error_stream\"\r\n};\r\n\r\nexport function MediaAdapter()\r\n{\r\n    let events = { };\r\n\r\n    let audioStream = null;\r\n    let videoStream = null;\r\n    let mediaStream = null;\r\n\r\n    let audioDevices = { }; // audioDevices[label] = deviceId\r\n    let videoDevices = { }; // videoDevices[label] = deviceId\r\n\r\n    let resolutions =\r\n    {\r\n        \"Auto\":         { },\r\n        \"320x240\":      { width: 320,\theight: 240 },\t// QVGA 4:3\r\n        \"640x360\":      { width: 640,\theight: 360 },\t// nHD 16:9\r\n        \"640x480\":      { width: 640,\theight: 480 },\t// VGA 4:3\r\n        \"1280x720\":     { width: 1280,\theight: 720 },\t// HD 16:9\r\n        \"1440x1080\":    { width: 1440,\theight: 1080 },\t// 4:3\r\n        \"1920x1080\":    { width: 1920,\theight: 1080 },\t// FullHD 16:9\r\n        \"2016x1512\":    { width: 2016,\theight: 1512 },\t// 4:3\r\n        \"3264x2448\":    { width: 3264,\theight: 2448 },\t// 4:3\r\n        \"3840x2160\":    { width: 3840,\theight: 2160 },\t// 4k 16:9\r\n        //\"7680x4320\":    { width: 7680,\theight: 4320 }\t// 8k 16:9\r\n    };\r\n\r\n    let audioConstraints =\r\n    {\r\n        audio:\r\n        {\r\n            deviceId: { exact: undefined }\r\n        }\r\n    };\r\n\r\n    let videoConstraints =\r\n    {\r\n        video:\r\n        {\r\n            deviceId:   { exact: undefined },\r\n            width:      { exact: undefined },\r\n            height:     { exact: undefined },\r\n            frameRate:  { ideal: 30 }\r\n        }\r\n    };\r\n\r\n    let settings =\r\n    {\r\n        audio:          \"None\",         // label\r\n        video:          \"None\",         // label\r\n        resolution:     \"Auto\",         // resolutions key\r\n    };\r\n\r\n    let previousAudioConstraints = null;\r\n    let previousVideoConstraints = null;\r\n\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) === -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) === -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) === -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start the media adapter.\r\n     */\r\n    let start = async function()\r\n    {\r\n        if( !navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices )\r\n        {\r\n            console.error(\"Your browser does not support getUserMedia API\");\r\n            return false;\r\n        }\r\n\r\n        // Create a dummy stream.\r\n        audioStream = new SilenceStream();\r\n        videoStream = new BlackStream();\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        await window.navigator.mediaDevices.getUserMedia({ audio: true }).catch(e => console.error(e));\r\n        await window.navigator.mediaDevices.getUserMedia({ video: true }).catch(e => console.error(e));\r\n        await findDevices();\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Find the available input and output devices.\r\n     */\r\n    let findDevices = async function()\r\n    {\r\n        return getDevices().then(gotDevices).catch(errorDevices);\r\n    };\r\n\r\n    /**\r\n     * Request a list of the available input and output devices.\r\n     */\r\n    let getDevices = function()\r\n    {\r\n        return window.navigator.mediaDevices.enumerateDevices();\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get devices function.\r\n     */\r\n    let gotDevices = function( deviceInfos )\r\n    {\r\n        audioDevices = { };\r\n        videoDevices = { };\r\n\r\n        // Add inputs for silence and black streams.\r\n        audioDevices[\"None\"] = \"\";\r\n        videoDevices[\"None\"] = \"\";\r\n\r\n        let a = 0, v = 0;\r\n        for( let deviceInfo of deviceInfos )\r\n        {\r\n            if( deviceInfo.kind === \"audioinput\" )\r\n            {\r\n                let label = (deviceInfo.label === \"\" ) ? (\"Audio input \" + a) : deviceInfo.label;\r\n                audioDevices[label] = deviceInfo.deviceId;\r\n                a++;\r\n            }\r\n\r\n            if( deviceInfo.kind === \"videoinput\" )\r\n            {\r\n                let label = (deviceInfo.label === \"\" ) ? (\"Video input \" + v) : deviceInfo.label;\r\n                videoDevices[label] = deviceInfo.deviceId;\r\n                v++;\r\n            }\r\n        }\r\n\r\n        console.log(\"%c\" + MediaEvent.GotDevices + \"%o%o%o\", DEBUG_STYLE, JSON.stringify(audioDevices), JSON.stringify(videoDevices), JSON.stringify(settings));\r\n        console.log(\"%c\" + MediaEvent.GotResolutions + \"%o%o\", DEBUG_STYLE, JSON.stringify(resolutions), JSON.stringify(settings));\r\n\r\n        emit(MediaEvent.GotDevices, { audioDevices: audioDevices, videoDevices: videoDevices, settings: settings });\r\n        emit(MediaEvent.GotResolutions, { resolutions: resolutions, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get devices function.\r\n     */\r\n    let errorDevices = function( error )\r\n    {\r\n        let message = \"Device request not allowed in the browser\";\r\n        console.log(\"%c\" + \"error_devices\" + \"%o%o\", DEBUG_STYLE, error, message);\r\n        emit(MediaEvent.ErrorDevices, { error: error, message: message });\r\n    };\r\n\r\n    /**\r\n     * Set the audio device.\r\n     */\r\n    let setAudio = function( device = \"None\" )\r\n    {\r\n        if( !(device in audioDevices) )\r\n        {\r\n            let error = \"DeviceNotFound\";\r\n            let message = \"Audio device \" + device + \" not found\";\r\n            console.log(\"%c\" + \"error_stream\" + \"%o%o%o\", DEBUG_STYLE, error, message, JSON.stringify(settings));\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            device = \"None\";\r\n        }\r\n\r\n        if( device === \"None\" )\r\n        {\r\n            // Update settings.\r\n            settings.audio = device;\r\n\r\n            // Get dummy stream.\r\n            audioStream = new SilenceStream();\r\n            mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n            console.log(\"%c\" + \"got_stream\" + \"%o%o\", DEBUG_STYLE, mediaStream, JSON.stringify(settings));\r\n            emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n        }\r\n        else\r\n        {\r\n            // Save previous constraints.\r\n            previousAudioConstraints = clone(audioConstraints);\r\n\r\n            // Update constraints.\r\n            let deviceId = audioDevices[device];\r\n            audioConstraints.audio.deviceId.exact = deviceId;\r\n\r\n            getAudioStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set the video device and resolution.\r\n     */\r\n    let setVideo = function( device = \"None\", resolution = \"Auto\" )\r\n    {\r\n        if( !(device in videoDevices) )\r\n        {\r\n            let error = \"DeviceNotFound\";\r\n            let message = \"Video device \" + device + \" not found\";\r\n            console.log(\"%c\" + MediaEvent.ErrorStream + \"%o%o%o\", DEBUG_STYLE, error, message, JSON.stringify(settings));\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            return;\r\n        }\r\n\r\n        if( !(resolution in resolutions) )\r\n        {\r\n            let error = \"ResolutionNotFound\";\r\n            let message = \"Resolution \" + resolution + \" not found\";\r\n            console.log(\"%c\" + MediaEvent.ErrorStream  + \"%o%o%o\", DEBUG_STYLE, error, message, JSON.stringify(settings));\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            return;\r\n        }\r\n\r\n        if( device === \"None\" )\r\n        {\r\n            // Update settings.\r\n            settings.video = device;\r\n            settings.resolution = resolution;\r\n\r\n            // Get dummy stream.\r\n            let width = resolutions[resolution].width;\r\n            let height = resolutions[resolution].height;\r\n            videoStream = new BlackStream(width, height);\r\n            mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n            console.log(\"%c\" + MediaEvent.GotStream + \"%o%o\", DEBUG_STYLE, mediaStream, JSON.stringify(settings));\r\n            emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n        }\r\n        else\r\n        {\r\n            // Save previous constraints.\r\n            previousVideoConstraints = clone(videoConstraints);\r\n\r\n            // Update constraints.\r\n            let deviceId = videoDevices[device];\r\n            videoConstraints.video.deviceId.exact = deviceId;\r\n            let width = resolutions[resolution].width;\r\n            let height = resolutions[resolution].height;\r\n            videoConstraints.video.width.exact = width;\r\n            videoConstraints.video.height.exact = height;\r\n\r\n            getVideoStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Request an audio stream.\r\n     */\r\n    let getAudioStream = function()\r\n    {\r\n        mediaStream = null;\r\n        stopStream(audioStream);\r\n        return window.navigator.mediaDevices.getUserMedia(audioConstraints).then(gotAudioStream).catch(errorAudioStream);\r\n    };\r\n\r\n    /**\r\n     * Request a video stream.\r\n     */\r\n    let getVideoStream = function()\r\n    {\r\n        mediaStream = null;\r\n        stopStream(videoStream);\r\n        return window.navigator.mediaDevices.getUserMedia(videoConstraints).then(gotVideoStream).catch(errorVideoStream);\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get audio stream function.\r\n     */\r\n    let gotAudioStream = async function( stream )\r\n    {\r\n        let track = stream.getAudioTracks()[0];\r\n\r\n        // Check whether the label is listed, enumerateDevices returns an empty label if the permission for accessing the mediadevice is not given.\r\n        if( !(track.label in audioDevices) )\r\n        {\r\n            await findDevices();\r\n        }\r\n\r\n        // Update settings.\r\n        settings.audio = Object.keys(audioDevices).find(key => audioDevices[key] === audioConstraints.audio.deviceId.exact);\r\n\r\n        // Update stream.\r\n        audioStream = stream;\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        console.log(\"%c\" + MediaEvent.GotStream + \"%o%o\", DEBUG_STYLE, stream, JSON.stringify(settings));\r\n        emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get video stream function.\r\n     */\r\n    let gotVideoStream = async function( stream )\r\n    {\r\n        let track = stream.getVideoTracks()[0];\r\n        let trackSettings = track.getSettings();\r\n\r\n        // Check whether the label is listed, enumerateDevices returns an empty label if the permission for accessing the mediadevice is not given.\r\n        if( !(track.label in videoDevices) )\r\n        {\r\n            await findDevices();\r\n        }\r\n\r\n        // Check whether the resolution is already listed.\r\n        let width = trackSettings.width;\r\n        let height = trackSettings.height;\r\n        let resolution = width + \"x\" + height;\r\n        if( !resolutions[resolution] )\r\n        {\r\n            // Add the resolution.\r\n            resolutions[resolution] = { width: width, height: height };\r\n\r\n            // Sort resolutions.\r\n            resolutions = Object.entries(resolutions).sort((a, b) => (a[1].width || Number.NEGATIVE_INFINITY) > (b[1].width || Number.NEGATIVE_INFINITY)).reduce((r, [k, v]) => ({ ...r, [k]: v }), {});\r\n\r\n            console.log(\"%c\" + MediaEvent.GotResolutions + \"%o%o\", DEBUG_STYLE, JSON.stringify(resolutions), JSON.stringify(settings));\r\n            emit(MediaEvent.GotResolutions, { resolutions: resolutions, settings: settings });\r\n        }\r\n\r\n        // Update video constraints.\r\n        videoConstraints.video.width.exact = width;\r\n        videoConstraints.video.height.exact = height;\r\n\r\n        // Update settings.\r\n        settings.video = Object.keys(videoDevices).find(key => videoDevices[key] === videoConstraints.video.deviceId.exact);\r\n        settings.resolution = resolution;\r\n        settings.width = width;\r\n        settings.height = height;\r\n        settings.frameRate = trackSettings.frameRate;\r\n        settings.aspectRatio = trackSettings.aspectRatio;\r\n        settings.facingMode = trackSettings.facingMode;\r\n\r\n        // Update stream.\r\n        videoStream = stream;\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        console.log(\"%c\" + MediaEvent.GotStream + \"%o%o\", DEBUG_STYLE, stream, JSON.stringify(settings));\r\n        emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Return a semantic error string from the specified error.\r\n     */\r\n    let errorStream = function( error )\r\n    {\r\n        let message = \"\";\r\n        if( error.name === \"NotFoundError\" || error.name === \"DevicesNotFoundError\" )\r\n        {\r\n            message = \"Required track is missing\";\r\n        }\r\n        else if( error.name === \"NotReadableError\" || error.name === \"TrackStartError\" )\r\n        {\r\n            message = \"Microphone or Webcam are already in use\";\r\n        }\r\n        else if( error.name === \"OverconstrainedError\" || error.name === \"ConstraintNotSatisfiedError\" )\r\n        {\r\n            //message = \"Constraints cannot be satisfied\";\r\n            message = \"Invalid device settings\";\r\n        }\r\n        else if( error.name === \"NotAllowedError\" || error.name === \"PermissionDeniedError\" )\r\n        {\r\n            message = \"Permission denied in browser\";\r\n        }\r\n        else if( error.name === \"TypeError\" || error.name === \"TypeError\" )\r\n        {\r\n            message = \"Empty constraints object\";\r\n        }\r\n        else\r\n        {\r\n            message = \"Unknown error\";\r\n        }\r\n\r\n        return message;\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get audio stream function.\r\n     */\r\n    let errorAudioStream = function( error )\r\n    {\r\n        let message = errorStream(error);\r\n        console.log(\"%c\" + MediaEvent.ErrorStream + \"%o%o%o\", DEBUG_STYLE, error, message, JSON.stringify(settings));\r\n        emit(MediaEvent.ErrorStream, { error: error.name, message: message, settings: settings });\r\n\r\n        if( previousAudioConstraints )\r\n        {\r\n            audioConstraints = clone(previousAudioConstraints);\r\n            previousAudioConstraints = null;\r\n            getAudioStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get video stream function.\r\n     */\r\n    let errorVideoStream = function( error )\r\n    {\r\n        let message = errorStream(error);\r\n        console.log(\"%c\" + MediaEvent.ErrorStream + \"%o%o%o\", DEBUG_STYLE, error, message, JSON.stringify(settings));\r\n        emit(MediaEvent.ErrorStream, { error: error.name, message: message, settings: settings });\r\n\r\n        if( previousVideoConstraints )\r\n        {\r\n            videoConstraints = clone(previousVideoConstraints);\r\n            previousVideoConstraints = null;\r\n            getVideoStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Mix two streams with 1 audio and 1 video tracks into one.\r\n     */\r\n    let mixStreams = function( audioStream, videoStream )\r\n    {\r\n        let audioTracks = audioStream.getAudioTracks();\r\n        if( !audioTracks || audioTracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let videoTracks = videoStream.getVideoTracks();\r\n        if( !videoTracks || videoTracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let stream = new MediaStream();\r\n        stream.addTrack(audioTracks[0]);\r\n        stream.addTrack(videoTracks[0]);\r\n\r\n        return stream;\r\n    };\r\n\r\n    /**\r\n     * Stop a stream, stopping its tracks.\r\n     */\r\n    let stopStream = function( stream )\r\n    {\r\n        stream.getTracks().forEach(track => track.stop());\r\n    };\r\n\r\n    /**\r\n     * Return a clone of the object.\r\n     */\r\n    let clone = function( object )\r\n    {\r\n        return JSON.parse(JSON.stringify(object));\r\n    };\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        start,\r\n        findDevices,\r\n        getDevices,\r\n        setAudio,\r\n        setVideo\r\n    };\r\n}\r\n\r\nexport function SilenceTrack()\r\n{\r\n    let stream = new SilenceStream();\r\n    let track = stream.getAudioTracks()[0];\r\n    return track;\r\n}\r\n\r\nexport function BlackTrack( width = 320, height = 240, frameRate = 1 )\r\n{\r\n    let stream = new BlackStream(width, height, frameRate);\r\n    let track = stream.getVideoTracks()[0];\r\n    return track;\r\n}\r\n\r\nexport function SilenceStream()\r\n{\r\n    let audioContext = new AudioContext();\r\n\r\n    let gainNode = audioContext.createGain();\r\n    let oscillatorNode = audioContext.createOscillator();\r\n    oscillatorNode.connect(gainNode);\r\n    let destination = gainNode.connect(audioContext.createMediaStreamDestination());\r\n\r\n    gainNode.gain.setValueAtTime(0, audioContext.currentTime);\r\n    oscillatorNode.start();\r\n\r\n    let stream = destination.stream;\r\n    return stream;\r\n}\r\n\r\nexport function BlackStream( width = 320, height = 240, frameRate = 1 )\r\n{\r\n    let canvas = window.document.createElement(\"canvas\");\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    let context = canvas.getContext(\"2d\");\r\n    let interval = null;\r\n    function render()\r\n    {\r\n        if( !context )\r\n        {\r\n            window.clearInterval(interval);\r\n            return;\r\n        }\r\n\r\n        context.fillRect(0, 0, width, height);\r\n        // context.beginPath();\r\n        // context.rect(0, 0, width, height);\r\n        // context.fillStyle = \"blue\";\r\n        // context.fill();\r\n    }\r\n    interval = window.setInterval(render, (1 / frameRate) * 1000);\r\n\r\n    let stream = canvas.captureStream();\r\n    return stream;\r\n}\r\n\r\nexport function DummyStream()\r\n{\r\n    let silenceStream = new SilenceStream();\r\n    let blackStream = new BlackStream();\r\n    let silenceTrack = silenceStream.getAudioTracks()[0];\r\n    let blackTrack = blackStream.getVideoTracks()[0];\r\n    let stream = new MediaStream([silenceTrack, blackTrack]);\r\n\r\n    /**\r\n     * Return the audio track.\r\n     */\r\n    let getAudioTrack = function()\r\n    {\r\n        return silenceTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the video track.\r\n     */\r\n    let getVideoTrack = function()\r\n    {\r\n        return blackTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the stream.\r\n     */\r\n    let getStream = function()\r\n    {\r\n        return stream;\r\n    };\r\n\r\n    return {\r\n        getAudioTrack,\r\n        getVideoTrack,\r\n        getStream\r\n    };\r\n}","// eslint-disable\r\n\r\n//import AdapterJS from 'adapterjs';\r\nimport { RTCEvent,   RTCClient }    from \"./rtcClient.js\";  // eslint-disable-line\r\nimport { LobbyEvent, LobbyClient }  from './lobbyClient.js';      // eslint-disable-line\r\nimport { MediaEvent, MediaAdapter } from \"./mediaAdapter.js\";   // eslint-disable-line\r\nimport { DummyStream }  from \"./dummyStream.js\";\r\n\r\nconst DEBUG = process.env.REACT_APP_DEBUG ?? false;\r\n\r\nlet appClient    = window.appClient    = new LobbyClient({ debug: DEBUG }),\r\n    mediaAdapter = window.mediaAdapter = new MediaAdapter({ debug: DEBUG }),\r\n    dummyStream  = window.dummyStream  = new DummyStream({ debug: DEBUG }),\r\n    rtcClient    = window.rtcClient    = new RTCClient(dummyStream.getStream());\r\n\r\nlet APPEvent = LobbyEvent;\r\n\r\nwindow.BRA = {\r\n    APPEvent,\r\n    RTCEvent,\r\n    MediaEvent,\r\n    rtcClient, \r\n    appClient,\r\n    mediaAdapter,\r\n    dummyStream\r\n}\r\n\r\nexport {\r\n   APPEvent,\r\n   RTCEvent,\r\n   MediaEvent,\r\n   rtcClient, \r\n   appClient,\r\n   mediaAdapter,\r\n   dummyStream\r\n}","export function DummyStream()\r\n{\r\n//#region PRIVATE\r\n\r\n    let _blackCanvas = null;\r\n    let _silenceStream = null;\r\n    let _blackStream = null;\r\n    let _silenceTrack = null\r\n    let _blackTrack = null;\r\n\r\n    /**\r\n     * Create a silence audio track.\r\n     */\r\n    let createSilenceTrack = function()\r\n    {\r\n        let audioContext = new AudioContext();\r\n\r\n        let gainNode = audioContext.createGain();\r\n        let oscillatorNode = audioContext.createOscillator();\r\n        oscillatorNode.connect(gainNode);\r\n        let destination = gainNode.connect(audioContext.createMediaStreamDestination());\r\n\r\n        _silenceStream = destination.stream;\r\n        _silenceTrack = _silenceStream.getAudioTracks()[0];\r\n    };\r\n\r\n    /**\r\n     * Create a black video track.\r\n     * @param {Number} width - The video width.\r\n     * @param {Number} height - The video height.\r\n     */\r\n    let createBlackTrack = function( width = 320, height = 240 )\r\n    {\r\n        if( !_blackCanvas )\r\n        {\r\n            _blackCanvas = window.document.createElement(\"canvas\");\r\n        }\r\n\r\n        _blackCanvas.width = width;\r\n        _blackCanvas.height = height;\r\n        let context = _blackCanvas.getContext(\"2d\");\r\n        context.fillRect(0, 0, width, height);\r\n\r\n        _blackStream = _blackCanvas.captureStream();\r\n        _blackTrack = _blackStream.getVideoTracks()[0];\r\n    };\r\n\r\n    createSilenceTrack();\r\n    createBlackTrack();\r\n    let _stream = new MediaStream([_silenceTrack, _blackTrack]);\r\n\r\n    /**\r\n     * Return the audio track.\r\n     * @returns {MediaStreamTrack} The audio track.\r\n     */\r\n    let getAudioTrack = function()\r\n    {\r\n        return _silenceTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the video track.\r\n     * @returns {MediaStreamTrack} The video track.\r\n     */\r\n    let getVideoTrack = function()\r\n    {\r\n        return _blackTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the stream.\r\n     * @returns {MediaStream} The stream.\r\n     */\r\n    let getStream = function()\r\n    {\r\n        return _stream;\r\n    };\r\n\r\n//#endregion\r\n\r\n//#region PUBLIC\r\n\r\n    return {\r\n        getAudioTrack,\r\n        getVideoTrack,\r\n        getStream\r\n    };\r\n\r\n//#endregion\r\n}","import * as BRA from \"lib_bra\"\r\nimport toast from 'react-hot-toast'\r\nimport { useState, useContext, useEffect, createContext } from 'react'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\nlet liveCalls = [];\r\n\r\nexport const StreamContext = createContext(); \r\nexport default ({children, ...props}) => {\r\n    const auth  = useContext(AuthContext);\r\n    const rooms = useContext(RoomsContext);\r\n    const media = useContext(MediaContext);\r\n\r\n    const [state, setState]             = useState(0);\r\n    let   [streams, setStreams]         = useState({});\r\n    let   [localStream, setLocalStream] = useState(media.localStream);\r\n\r\n    useEffect( ()=>{ \r\n        BRA.rtcClient.on(BRA.RTCEvent.IncomingCall, onIncomingCall);\r\n        BRA.rtcClient.on(BRA.RTCEvent.CallOpened,   onCallOpened);\r\n        BRA.rtcClient.on(BRA.RTCEvent.CallClosed,   onCallClosed);\r\n        BRA.rtcClient.on(BRA.RTCEvent.CallHangup,   onCallHangup);\r\n    return ()=>{\r\n        BRA.rtcClient.off(BRA.RTCEvent.IncomingCall, onIncomingCall);\r\n        BRA.rtcClient.off(BRA.RTCEvent.CallOpened,   onCallOpened);\r\n        BRA.rtcClient.off(BRA.RTCEvent.CallClosed,   onCallClosed);\r\n        BRA.rtcClient.off(BRA.RTCEvent.CallHangup,   onCallHangup);\r\n    }}, []);\r\n\r\n    useEffect( ()=>{\r\n        setState(s => s+1);\r\n        localStream = media.localStream;\r\n        setLocalStream(localStream);\r\n    }, [media.localStream]);\r\n\r\n    function callUser(username, callback, fwdCallId){\r\n        const response = callback ?? (({event, data}) => {\r\n            const {callid, error, message} = data;\r\n            if(error){\r\n                toast.error(`Call error: ${message}`,{icon:<i className=\"bi bi-telephone-x\"/>, duration: 5000});\r\n            }\r\n        });\r\n\r\n        let callID = auth.user?.username + \"_\" + username;\r\n\r\n        if(fwdCallId) {\r\n            const fwd_call = BRA.rtcClient.getCall(fwdCallId);\r\n            if(fwd_call) {\r\n                callID = fwd_call.caller + \"_\" + callID;\r\n            }\r\n        }\r\n\r\n        return BRA.rtcClient.call(username, {response: response, callid: callID});\r\n    }\r\n\r\n    function callAllUsers(){\r\n        const users = rooms.current?.users?.filter((v, k, a) => { return v && v?.username !== auth.user?.username });\r\n        for (let user of users ?? []){\r\n            \r\n            if(!callUser(user?.username)){\r\n                toast.error(`Call missed to ${user?.username}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    function callHangup(callId){\r\n        BRA.rtcClient.hangup(callId);\r\n    }\r\n\r\n    function callHangupAll(){\r\n        const calls = Object.keys(BRA.rtcClient.getCalls())\r\n        for (let callId of calls){\r\n            callHangup(callId);\r\n        }\r\n    }\r\n\r\n    function onIncomingCall({event, data}){\r\n        const { callid, caller } = data;\r\n        BRA.rtcClient.acceptCall(callid);\r\n    }\r\n\r\n    function onCallOpened( request ) {\r\n        const { call, stream } = request;\r\n        const callid = call.callid;\r\n        \r\n        streams = {...streams, [callid]: stream}\r\n        setStreams(streams);\r\n        const forwardingCallId = liveCalls[callid];   //Live call\r\n\r\n        if (forwardingCallId) {\r\n            const forward_stream = (forwardingCallId === \"local\") ? window.localStream : streams[forwardingCallId];\r\n            if (!forward_stream) {\r\n                callHangup(callid);\r\n                return toast.error(`Live Call Error: ${callid}, callerId: ${call.caller}, calleeId: ${call.callee} `);;\r\n            }\r\n            toast.success(`Live Call: ${callid}, callerId: ${call.caller}, calleeId: ${call.callee} `);\r\n            const videotrack = forward_stream.getVideoTracks()[0];\r\n            const audiotrack = forward_stream.getAudioTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n            toast(`Forwarding stream`, {icon:<i className=\"bi bi-cast\"/>});\r\n        }\r\n\r\n        //Regular call\r\n        else {\r\n            toast.success(`Incoming Call: ${callid}, callerId: ${call.caller}, calleeId: ${call.callee} `);\r\n            //TODO:esto no deberia estar en window!!!!\r\n            if(!window.localStream) return;\r\n            const videotrack = window.localStream.getVideoTracks()[0];\r\n            const audiotrack = window.localStream.getAudioTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n            toast(`Call from ${getUserId(callid)}`, {icon:<i className=\"bi bi-telephone-inbound\"/>});\r\n        }\r\n    }\r\n\r\n    function onCallClosed( request ){\r\n        const { call } = request;\r\n        if (!call)\r\n            return console.error(\"No call\");\r\n\r\n        const callid = call.callid;\r\n        manageLiveCallClosed(callid);\r\n\r\n        delete streams[callid];\r\n        setStreams({...streams});\r\n        toast(`Call from ${getUserId(callid)} closed`, {icon:<i className=\"bi bi-telephone-x\"/>});\r\n    }\r\n\r\n    function onCallHangup( {event, data} ){\r\n        const { callid } = data;\r\n\r\n        if (!callid)\r\n            return console.error(\"No call\");\r\n\r\n        manageLiveCallClosed(callid);\r\n        delete streams[callid];\r\n        setStreams({...streams});\r\n\r\n        toast(`User ${getUserId(callid)} hangup`, {icon:<i className=\"bi bi-telephone-x\"/>});\r\n    }\r\n\r\n    function manageLiveCallClosed(callid) {\r\n        let result = null;\r\n        for (const [mId, fId] of Object.entries(liveCalls)) {\r\n            if (callid !== mId && fId !== callid)\r\n                continue;\r\n\r\n            result = [mId, fId];\r\n            break;\r\n        }\r\n\r\n        if (result) {\r\n            const [mediaHubCallId, forwardedCallId] = result;\r\n            delete liveCalls[mediaHubCallId];\r\n        }\r\n    }\r\n\r\n    function getUserId(callId){\r\n        let id = auth.user?.username;\r\n        let call = BRA.rtcClient.getCalls()[callId];\r\n        if (callId !== \"local\" && call) {\r\n            let { callee, caller } = call;\r\n            id = (callee === auth.user?.username) ? caller : callee;\r\n        }\r\n        return id;\r\n    }\r\n\r\n    //TODO:check this\r\n    function forwardCall(source, target) {\r\n        if (!target || !source)\r\n            return console.error(`source or target callId's are undefined`);\r\n        liveCalls[target] = source;\r\n    }\r\n\r\n    function getLiveCall(callid)\r\n    {\r\n        return Object.entries(liveCalls).find( v => v[1] === callid ) ?? [null,null];\r\n    }\r\n\r\n    function replaceStream(stream){\r\n        for( const callid in BRA.rtcClient.getCalls() )\r\n        {\r\n            let s = stream;\r\n            const forwardingCallId = liveCalls[callid];   //Live call\r\n            if(forwardingCallId && streams[forwardingCallId])\r\n            {\r\n                s = streams[forwardingCallId];\r\n            }\r\n\r\n            let call = BRA.rtcClient.getCall(callid);\r\n            let audiotrack = s.getAudioTracks()[0];\r\n            let videotrack = s.getVideoTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n        }\r\n    }\r\n\r\n    const store = window.wrtc = {\r\n        callUser,\r\n        callAllUsers,\r\n        callHangup,\r\n        callHangupAll,\r\n        forwardCall,\r\n        getUserId,\r\n        getLiveCall,\r\n        replaceStream,\r\n        streams: {...streams, local:localStream},\r\n    }\r\n\r\n    return <StreamContext.Provider value={store} children={children}/>\r\n}","export default __webpack_public_path__ + \"static/media/profile_light.7c82d8ab.png\";","export default __webpack_public_path__ + \"static/media/logo.f23962e9.png\";"],"sourceRoot":""}