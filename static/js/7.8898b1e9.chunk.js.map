{"version":3,"sources":["assets/img/selfie.png","assets/img/snipping.png","assets/img/score.png","pages/Selfie.jsx"],"names":["console","warn","images","Array","fill","style","width","src","selfie","alt","Pose","videoRef","useRef","media","useContext","MediaContext","useState","setState","makeSelfie","event","current","canvas","document","createElement","videoWidth","height","videoHeight","getContext","drawImage","img","Image","toDataURL","target","id","score","Math","random","toFixed","transform","s","http","post","data","actor","studio","then","response","catch","error","useEffect","ready","srcObject","localStream","play","map","v","parseFloat","props","sort","max","Row","Col","md","muted","ref","className","k","position","onClick","Badge","bg"],"mappings":"6OAAe,MAA0B,mC,GCA1B,ICAA,I,cCWfA,QAAQC,KAAO,aACf,IAAIC,EAAS,IAAIC,MAAM,GAAGC,KAAK,qBAAKC,MAAO,CAACC,MAAM,QAAQC,IAAKC,EAAQC,IAAI,OAE5D,SAASC,IACpB,IAAMC,EAAWC,iBAAO,MAClBC,EAAQC,qBAAWC,KACzB,EAA0BC,mBAAS,GAAnC,mBAAcC,GAAd,WAcA,SAASC,EAAWC,GAChB,GAAIR,EAASS,QAAb,CACA,IAAMC,EAASC,SAASC,cAAc,UACtCF,EAAOf,MAAQK,EAASS,QAAQI,WAChCH,EAAOI,OAASd,EAASS,QAAQM,YACrBL,EAAOM,WAAW,MAC1BC,UAAUjB,EAASS,QAAS,EAAG,EAAGC,EAAOf,MAAOe,EAAOI,QAC3D,IAAMI,EAAM,IAAIC,MAChBD,EAAItB,IAAMc,EAAOU,UAAU,aAC3BZ,EAAMa,OAAOzB,IAAMsB,EAAItB,IACvBY,EAAMa,OAAOvB,IAAM,IACnBP,EAAOiB,EAAMa,OAAOC,IAAM,qBAAK1B,IAAKsB,EAAItB,IAAK2B,MAAOC,KAAKC,SAASC,QAAQ,GAAIhC,MAAO,CAACiC,UAAU,gBAChGrB,GAAS,SAAAsB,GAAC,OAAIA,EAAE,KAEhBC,IAAKC,KAAK,uDAAwD,IAElED,IAAKC,KAAK,uDAAwD,CAACC,KAAK,CAAEC,MAAOd,EAAItB,IAAKqC,OAAQf,EAAItB,OACrGsC,MAAK,SAAAC,OACLC,OAAM,SAAAC,QAkBXC,qBAAU,WACFpC,EAAMqC,QACVvC,EAASS,QAAQ+B,UAAYtC,EAAMuC,YACnCzC,EAASS,QAAQiC,UAClB,CAACxC,EAAMqC,MAAOrC,EAAMuC,cAGvB,IAKA,EAAsBlD,EAAOoD,KAAK,SAAAC,GAAC,aAAIC,WAAU,UAACD,EAAEE,MAAMvB,aAAT,QAAkB,MAAIwB,OAAvE,mBAAeC,GAAf,gBACA,OAAO,qCACP,sBAAK1B,GAAG,SAAR,qCACI,6DAAqB,sFACrB,eAAC2B,EAAA,EAAD,WACA,cAACC,EAAA,EAAD,CAAKC,GAAI,EAAT,SACI,uBAAOC,OAAK,EAAC1D,MAAO,CAAEiC,UAAW,kBAAmBhC,MAAM,QAAU0D,IAAKrD,EAAzE,+BAGJ,eAACkD,EAAA,EAAD,CAAKC,GAAI,EAAT,UACI,cAAC,IAAD,CAAIG,UAAU,mBAAd,SAfG,sQAgBH,qBAAKhC,GAAG,WAAR,2DACE/B,EAAOoD,KAAK,SAACC,EAAEW,GAAH,iBAAS,sBAAK7D,MAAO,CAAC8D,SAAS,WAAY7D,MAAO,mBAA4B8D,QAASlD,EAA9E,qCACnB,qBAAKX,IAAG,UAAEgD,EAAEhD,WAAJ,QAAWgD,EAAEE,MAAMlD,IAAKE,IAAG,iBAAYyD,GAAK7D,MAAOkD,EAAElD,MAAO4B,GAAIiC,EAAxE,6BACA,cAACG,EAAA,EAAD,CAAOC,GAAId,WAAU,UAACD,EAAEE,MAAMvB,aAAT,QAAkB,KAAOyB,EAAI,UAAU,YAA5D,mBAA0EJ,EAAErB,aAA5E,QAAqFqB,EAAEE,MAAMvB,UAFRgC,iBAX1F","file":"static/js/7.8898b1e9.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/selfie.7ba22bd2.png\";","export default __webpack_public_path__ + \"static/media/snipping.9b2d355a.png\";","export default __webpack_public_path__ + \"static/media/score.b94429f1.png\";","//https://github.com/google/mediapipe/issues/2346#issuecomment-888062233\r\n\r\nimport { useState, useRef, useEffect, useContext, useCallback  } from 'react'\r\nimport { Row, Col, ProgressBar, Form, Image as ReactImage, Button, Badge } from 'react-bootstrap'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport MD from 'utils/md'\r\nimport selfie from 'assets/img/selfie.png'\r\nimport img1 from 'assets/img/snipping.png'\r\nimport img2 from 'assets/img/score.png'\r\nimport http from 'utils/http'\r\n\r\nconsole.warn = ()=>{}\r\nlet images = new Array(3).fill(<img style={{width:\"100%\"}}src={selfie} alt=\"0\"/>);\r\n\r\nexport default function Pose() {\r\n    const videoRef = useRef(null);\r\n    const media = useContext(MediaContext);\r\n    const [state, setState] = useState(0);\r\n\r\n    function DataURIToBlob(dataURI) {\r\n        const splitDataURI = dataURI.split(',')\r\n        const byteString = splitDataURI[0].indexOf('base64') >= 0 ? atob(splitDataURI[1]) : decodeURI(splitDataURI[1])\r\n        const mimeString = splitDataURI[0].split(':')[1].split(';')[0]\r\n\r\n        const ia = new Uint8Array(byteString.length)\r\n        for (let i = 0; i < byteString.length; i++)\r\n            ia[i] = byteString.charCodeAt(i)\r\n\r\n        return new Blob([ia], { type: mimeString })\r\n      }\r\n\r\n    function makeSelfie(event) {\r\n        if(!videoRef.current) return;\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = videoRef.current.videoWidth;\r\n        canvas.height = videoRef.current.videoHeight;\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\r\n        const img = new Image();\r\n        img.src = canvas.toDataURL('image/png');\r\n        event.target.src = img.src;\r\n        event.target.alt = '1';\r\n        images[event.target.id] = <img src={img.src} score={Math.random().toFixed(2)} style={{transform:'scaleX(-1)'}}/>\r\n        setState(s => s+1);\r\n\r\n        http.post(\"https://admire-dev-iq.brainstorm3d.com/image/analyze\", {});\r\n\r\n        http.post(\"https://admire-dev-iq.brainstorm3d.com/image/analyze\", {data:{ actor: img.src, studio: img.src }})\r\n        .then(response =>  {debugger})\r\n        .catch(error => {debugger})\r\n\r\n        /*const formData = new FormData();\r\n        formData.append('user',   DataURIToBlob(img.src), 'selfie.jpg');\r\n        formData.append('studio', DataURIToBlob(img.src), 'selfie2.jpg');\r\n\r\n        const headers = {\r\n            'Content-Type': 'multipart/form-data',\r\n        }\r\n\r\n        return fetch(\"https://admire-dev-iq.brainstorm3d.com/image/analyze\", \r\n        {method: 'POST',headers,formData})*/\r\n\r\n\r\n    \r\n        //send to server\r\n    }\r\n\r\n    useEffect(() => {\r\n        if(!media.ready) return;\r\n        videoRef.current.srcObject = media.localStream;\r\n        videoRef.current.play();\r\n    }, [media.ready, media.localStream]);\r\n\r\n    //intro message for the selfie for image quality assesment step\r\n    let message = `\r\n    The image quality assessment step will score if the image <b>has enough light</b> and <b>enough contrast</b>.\r\n    Take <b>3 selfies</b> with your face facing towards the camera. \r\n    The highlighted number shows the <b>best scored</b> capture.\r\n    `;\r\n    const [min,med,max] = images.map( v => parseFloat(v.props.score ?? 0)).sort()\r\n    return <>\r\n    <div id='selfie'>\r\n        <h3 className=\"pt-2\"><b>Step 4: Lighting Quality</b></h3>\r\n        <Row>\r\n        <Col md={6}>\r\n            <video muted style={{ transform: \"rotateY(180deg)\", width:\"100%\" }} ref={videoRef}></video>\r\n\r\n        </Col>\r\n        <Col md={6}>\r\n            <MD className=\"user-select-none\">{message}</MD>\r\n            <div id=\"carousel\" className=\"d-flex flex-horizontal\">\r\n            { images.map( (v,k) => <div style={{position:'relative', width: \"calc( 100% / 3)\"}} key={k} onClick={makeSelfie}>\r\n                <img src={v.src ?? v.props.src} alt={`Selfie ${k}`} style={v.style} id={k}/>\r\n                <Badge bg={parseFloat(v.props.score ?? 0) === max?\"success\":\"secondary\"}>{v.score ?? v.props.score}</Badge>\r\n            </div> )}\r\n            </div>\r\n        </Col>\r\n        </Row>\r\n    </div>\r\n\r\n    <style global jsx>{`\r\n        @import \"src/variables.scss\";\r\n        #selfie {\r\n            #carousel{\r\n                height: 100px; \r\n                &:nth-child(1) \r\n                {\r\n                    margin-left: 0px;\r\n                }\r\n                img {\r\n                    width: 100%;\r\n                    height: 100%;\r\n                    object-fit: cover;\r\n                    border: 1px solid rgba(0,0,0,0.1);\r\n                    margin-left: 1px;\r\n                    filter: opacity(80%);\r\n                    transition: all .25s ease-in-out;\r\n                    &:hover {\r\n                        filter: opacity(100%);\r\n                    }\r\n                }\r\n\r\n                .badge{\r\n                    position: absolute;\r\n                    top: .24rem;\r\n                    margin-left: .25rem;\r\n                }\r\n            }\r\n            \r\n        }\r\n\r\n        @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n   \r\n            #selfie {\r\n\r\n\r\n                .row{\r\n                    flex-direction: row !important;\r\n                    .col{\r\n                        align-self: start;\r\n                    }\r\n                }\r\n            }\r\n        }  \r\n    `}</style>\r\n    </>\r\n}"],"sourceRoot":""}