{"version":3,"sources":["utils/http.js","assets/img/logo.png","partials/video.jsx","partials/modal.jsx","components/layout.jsx","views/verified.jsx","views/resetpassword.jsx","components/modal_about.jsx","components/modal_profile.jsx","components/btn_fullscreen.jsx","partials/nav.jsx","components/badge_forward.jsx","views/room.jsx","components/modal_recovery.jsx","components/modal_register.jsx","views/login.jsx","views/lobby.jsx","views/wizard.jsx","components/modal_create_room.jsx","components/modal_leave_room.jsx","components/modal_wizard.jsx","components/modal_users.jsx","components/modal_chat.jsx","components/btngrp_stream.jsx","views/App.jsx","utils/md.jsx","utils/ctx_rooms.jsx","utils/ctx_authentication.jsx","pages lazy /^/.*/.jsx$/ groupOptions: {} namespace object","reportWebVitals.js","serviceWorkerRegistration.js","index.js","utils/ctx_mediadevices.jsx","utils/ctx_streaming.jsx","../lib/bra/rtcClient.js","../lib/bra/index.js","../lib/bra/lobbyClient.js","../lib/bra/mediaAdapter.js","../lib/bra/dummyStream.js"],"names":["http","get","url","a","fetch","then","response","json","post","data","method","headers","body","JSON","stringify","id","stream","onClick","isLocal","props","ref","useRef","useState","audio","status","setStatus","useEffect","current","srcObject","className","variant","autoPlay","playsInline","muted","title","children","show","setShow","buttons","callback","closeButton","centered","keyboard","onHide","dialogClassName","Header","Title","Body","Footer","map","v","k","window","toast","position","reverseOrder","toastOptions","duration","basename","process","property","content","REACT_APP_OG_TYPE","envREACT_APP_OG_IMAGE","width","height","src","logo","component","App","exact","path","Verified","ResetPass","to","history","useHistory","size","button_tittle","push","token","useParams","formRef","undefined","validated","setValidated","formErrors","formvalues","setFormValues","e","preventDefault","toastId","loading","password","description","message","success","setTimeout","error","warn","catch","err","isValid","key","indexOf","validateForm","onSubmit","controlId","label","Control","required","name","type","placeholder","onChange","value","check","test","length","console","validateField","target","defaultValue","placement","overlay","style","padding","disabled","useReducer","o","n","proposalEvent","proposal","dispatch","onBeforeInstallPrompt","state","prompt","userChoice","outcome","addEventListener","removeEventListener","auth","useContext","AuthContext","isLogged","logout","setState","f","screenfull","on","off","isEnabled","toggle","document","fullscreen","Nav","setActive","i","onKeyPressed","keyCode","zIndex","filter","ret","Item","icon","appendclass","Button","callId","isForwardCall","wrtc","StreamContext","getLiveCall","mediaHubCallId","Badge","pill","bg","callHangup","roomId","carouselRef","rooms","RoomsContext","media","MediaContext","selected","setSelected","unload","leaveRoom","init","stop","scrollHorizontal","this","scrollLeft","deltaY","useLayoutEffect","ready","room","getRoomInfo","master","guests","includes","user","joinRoom","setCurrent","isConnected","callHangupAll","callAllUsers","streams","BRA","getStream","Row","Col","xs","Object","entries","local","localStream","getUserId","isSelected","Form","event","alert","FloatingLabel","OverlayTrigger","Tooltip","Spinner","as","animation","role","Card","email","cookies","remember","login","app_token","set","handleUserInput","checked","Img","Text","Switch","defaultChecked","RoomTile","sm","span","offset","lg","xl","values","list","pages","page","setPage","views","setViews","s","vs","p","default","onSwipeLeft","onSwipeRight","setValid","fetching","setFetching","submit","createRoom","toLowerCase","button","onKeyDown","tabIndex","_title","audiotracks","getAudioTracks","every","enabled","isAudioEnabled","setAudioEnabled","videotracks","getVideoTracks","isVideoEnabled","setVideoEnabled","ButtonToolbar","track","view","location","pathname","container","Container","fluid","replaceAll","remarkPlugins","remarkGfm","remarkBreaks","rehypePlugins","rehypeRaw","createContext","setReady","setRooms","onGetRoom","roomInfo","onGetRooms","roomInfos","getRooms","interval","setInterval","clearInterval","store","Promise","resolve","reject","onJoinRoom","arguments","msg","onLeaveRoom","onCreateRoom","Provider","isAdmin","setAdmin","setLogged","app","rtc","setConnected","setUser","avatar","toast_app","toast_rtc","access_token","onLogin","userId","userType","register","onLogOut","unregister","onUnload","disconnect","onAppConnect","onAppDisconnect","onRtcConnect","onRtcDisconnect","Infinity","connect","webpackAsyncContext","req","__webpack_require__","Error","code","ids","keys","module","exports","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","log","onUpdate","onSuccess","ReactDOM","render","StrictMode","Suspense","fallback","ProgressBar","animated","now","getElementById","URL","href","origin","contentType","reload","checkValidServiceWorker","serviceWorkerRegistration","init_evts","videoRef","devices","setDevices","settings","setSettings","resolutions","setResolutions","newvalue","setLocalStream","getDevices","onGotResolutions","onGotDevices","audioDevices","video","videoDevices","onGotStream","onError","start","setVideo","device","resolution","setAudio","setStreams","liveCalls","setLiveCalls","callUser","call","hangup","onIncomingCall","callerId","acceptCall","onCallOpened","forwardingCallId","forward_stream","calleeId","videotrack","audiotrack","replaceLocalVideoTrack","replaceLocalAudioTrack","onCallClosed","manageLiveCallClosed","onUserHangup","result","mId","fId","IncomingCall","CallOpened","CallClosed","UserHangup","getCalls","getCall","users","forwardCall","source","find","RTCEvent","ClientConnected","ClientDisconnected","CallAccepted","CallCanceled","RTCCall","connection","candidates","channels","initiator","getStats","callStats","stats","pairStats","forEach","report","localCandidateId","localType","candidateType","localAddress","address","ip","localPort","port","localProtocol","protocol","remoteCandidateId","remoteType","remoteAddress","remotePort","remoteProtocol","bind","peerConnection","isInitiator","RTCPeerConnection","channel","close","getState","iceConnectionState","addCandidate","candidate","addIceCandidate","gatherPendingCandidates","setRemoteDescription","setBandwidth","bandwidth","senders","getSenders","sender","parameters","getParameters","encodings","maxBitrate","setParameters","getRemoteAudioTrack","index","receivers","getReceivers","tracks","receiver","kind","getRemoteVideoTrack","getRemoteStream","MediaStream","addTrack","audioSenders","replaceTrack","videoSenders","openChannel","createDataChannel","closeChannel","onDataChannel","onChannelOpen","onopen","onChannelClose","onChannelError","onerror","onChannelMessage","onmessage","sendData","readyState","send","appClient","assign","debug","debugStyle","pingPeriod","_events","_token","_socket","_keepAliveTimeout","_userId","_channels","emit","args","slice","listeners","apply","onOpen","keepAlive","onMessage","parse","HANDLERS","sendMessage","onClose","clearTimeout","ping","validateId","RegExp","channelId","listener","splice","WebSocket","onclose","getRoom","enableChannel","disableChannel","joinChannel","leaveChannel","forwardMessage","isDisconnected","isInChannel","mediaAdapter","events","blackCanvas","audioStream","videoStream","mediaStream","audioConstraints","deviceId","videoConstraints","frameRate","ideal","streamSettings","previousAudioConstraints","previousVideoConstraints","findDevices","gotDevices","errorDevices","setDefaultDevices","localStorage","getItem","removeItem","mediaDevices","enumerateDevices","deviceInfos","deviceInfo","setItem","getSilenceStream","mixStreams","clone","getAudioStream","getBlackStream","getVideoStream","getSilenceTrack","audioContext","AudioContext","gainNode","createGain","oscillatorNode","createOscillator","destination","createMediaStreamDestination","gain","setValueAtTime","currentTime","getBlackTrack","createElement","context","getContext","fillRect","captureStream","videoTrack","stopStream","getUserMedia","gotAudioStream","errorAudioStream","gotVideoStream","errorVideoStream","audioTrack","audioTrackSettings","getSettings","videoTrackSettings","sort","b","Number","NEGATIVE_INFINITY","reduce","r","errorStream","audioTracks","videoTracks","getTracks","object","initialize","catchCallback","trace","dummyStream","_blackCanvas","_silenceStream","_blackStream","_silenceTrack","_blackTrack","createSilenceTrack","createBlackTrack","_stream","getAudioTrack","getVideoTrack","rtcClient","defaultSettings","defaultStream","responses","calls","socket","keepAliveTimeout","rtcConfiguration","iceServers","startKeepAlive","stopKeepAlive","handleRegisterResponse","handleUnregisterResponse","handleCallResponse","handleIncomingCall","handleCallAccepted","handleCallCanceled","handleRemoteOffer","handleRemoteAnswer","handleRemoteCandidate","handleUserHangup","uuid","OPEN","closeCall","uuidv4","replace","c","crypto","getRandomValues","Uint8Array","toString","oniceconnectionstatechange","other","handleIceConnectionStateChange","onicecandidate","onnegotiationneeded","createOffer","sdp","setLocalDescription","offer","createAnswer","answer","CLOSED","username","cancelCall","DEBUG"],"mappings":"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","file":"static/js/main.89e31e83.chunk.js","sourcesContent":["\r\nlet http = {\r\n    get: async function(url) {\r\n        return fetch(url)\r\n        .then(response => response.json());\r\n    },\r\n\r\n    post: async function(url, data) {\r\n        return fetch(url, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n            body: JSON.stringify(data)\r\n        }).then( response => response.json() );\r\n    },\r\n}\r\n\r\nexport default http;","export default __webpack_public_path__ + \"static/media/logo.f23962e9.png\";","import {Button} from 'react-bootstrap'\r\nimport { useEffect, useState, useRef } from 'react'\r\n\r\nexport default ({id, stream, onClick, isLocal = false, ...props})=>{\r\n\r\n\r\n    let ref = useRef(null);\r\n    const [status, setStatus] = useState({audio:false});\r\n\r\n    useEffect(()=>{\r\n        if(stream && ref.current){\r\n            ref.current.srcObject = stream;\r\n        }\r\n    },[stream]);\r\n\r\n    function handleClick(){\r\n        setStatus({...status, audio:!status.audio});\r\n    }\r\n    \r\n    return <>\r\n    <div className={`Video ${props.className??\"\"}`} >\r\n        <div className=\"stream-status position-absolute bottom-0 start-0\">\r\n            <span   className=\"status-user\"> {id} </span>\r\n            <Button className=\"status-audio\" variant=\"link\" onClick={handleClick}><i className={`bi bi-mic${status?.audio ? \"\" : \"-mute\"}`} /></Button>\r\n        </div>\r\n        <video autoPlay playsInline muted={isLocal || !status?.audio} ref={ref} {...{onClick}}/>\r\n    </div>\r\n    <style global jsx>{`\r\n        @import 'src/variables.scss';\r\n\r\n        .Video{\r\n            position: relative;\r\n            margin:0;\r\n            padding:0;\r\n            border:1px solid $secondary;\r\n            transition:all .2s ease-in-out;\r\n\r\n            &:hover, .selected{\r\n                border:1px solid $primary;\r\n            }\r\n\r\n            .stream-status{ \r\n                color:white !important;\r\n                z-index:1000;\r\n                .status-user{\r\n                    padding: 0.375rem 0.75rem;\r\n                    padding-right:0;\r\n\r\n                }\r\n                .status-audio{\r\n                    color:white !important;\r\n                    cursor:pointer;\r\n                    padding:0;\r\n                    margin-bottom:.35rem;\r\n                }\r\n            }\r\n\r\n            video{\r\n                width:100%;\r\n                height:100%;\r\n                object-fit: cover;\r\n                margin-bottom: -4px;\r\n            }\r\n        }\r\n\r\n    `}</style>\r\n    </>;\r\n}","import React from 'react';\r\nimport { Modal, Button } from 'react-bootstrap';\r\n\r\nexport default ({title, children, show, setShow = ()=>{}, callback, buttons, closeButton, ...props}) => {\r\n    return <>\r\n        <Modal\r\n            centered\r\n            show={show}\r\n            keyboard={true}\r\n            //backdrop={closeButton?\"\":\"static\"}\r\n            onHide={() => setShow(false)}\r\n            dialogClassName=\"modal-partial modal-shadow-lg\"\r\n            {...props}\r\n        >\r\n            {(closeButton && title) && <Modal.Header closeButton={closeButton} >\r\n                <Modal.Title className=\"user-select-none\">{title}</Modal.Title>\r\n            </Modal.Header>}\r\n            \r\n            <Modal.Body>\r\n                {children}\r\n            </Modal.Body>\r\n\r\n            { (buttons || closeButton) && <Modal.Footer>\r\n                {buttons && buttons.map( (v,k,a) => <div key={k}>{v}</div> )}\r\n                {closeButton && <Button variant=\"outline-secondary\" onClick={() => setShow(false)}> Close</Button>}\r\n            </Modal.Footer>} \r\n        </Modal>\r\n\r\n        <style global jsx>{`\r\n            @import 'src/variables.scss';\r\n\r\n            .modal-partial.modal-shadow-lg.modal-md.modal-dialog-centered:focus-visible {\r\n                outline: none;\r\n            }\r\n\r\n            .modal-partial {\r\n                .modal-title {\r\n                    font-weight: lighter;\r\n                    font-family: $header-font;\r\n\r\n                    h1,h2,h3,h4,h5,h6 {padding:0; margin:0}\r\n                }\r\n\r\n                .modal-header{\r\n                    padding-bottom: .2em;\r\n                }\r\n            }\r\n            \r\n\r\n            /* -----------------------------------------\r\n                Wearables\r\n            ----------------------------------------- */\r\n\r\n            /* ----------- Moto 360 Watch ----------- */\r\n            @media (max-device-width: 218px)and (max-device-height: 281px) { \r\n\r\n            }\r\n\r\n            /* ----------- Non-Retina Screens ----------- */\r\n            @media screen \r\n            and (min-device-width: 1200px) \r\n            and (max-device-width: 1600px) \r\n            and (-webkit-min-device-pixel-ratio: 1) { \r\n            }\r\n\r\n            /* ----------- Retina Screens ----------- */\r\n            @media screen \r\n            and (min-device-width: 1200px) \r\n            and (max-device-width: 1600px) \r\n            and (-webkit-min-device-pixel-ratio: 2)\r\n            and (min-resolution: 192dpi) { \r\n            }\r\n\r\n            /* Smartphones (landscape)  */\r\n            @media only screen\r\n            and (min-width : 321px) {\r\n            /* Styles */\r\n            }\r\n\r\n            /* Large Desktop and Laptop Screens (devices and browsers) */\r\n            @media only screen and (min-width: 1824px) {}\r\n\r\n            /* Tablet Devices, Desktop and Laptop Screens */\r\n            @media only screen and (max-width: 768px) {}\r\n\r\n            /* iPads (portrait and landscape) */\r\n            @media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {}\r\n\r\n            /* Smartphones (portrait and landscape) */\r\n            @media only screen and (min-device-width: 320px) and (max-device-width: 480px) {}\r\n\r\n            /* iPhone 4 */\r\n            @media only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen and (min-device-pixel-ratio: 1.5) {}\r\n\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {\r\n                .modal-dialog{\r\n                    max-width: 38rem !important;\r\n                }\r\n            }\r\n            @media only screen and (orientation: portrait){\r\n\r\n            }      \r\n        `}</style>\r\n    </>;\r\n}","import { Helmet } from \"react-helmet\"\r\nimport { Image } from 'react-bootstrap'\r\nimport toast, { Toaster } from 'react-hot-toast'\r\nimport { BrowserRouter as Router, Switch, Route, Redirect } from \"react-router-dom\"\r\n\r\nimport App from 'views/App'\r\nimport Verified from 'views/verified'\r\nimport ResetPass from 'views/resetpassword'\r\nimport AboutModal from 'components/modal_about'\r\nimport ProfileModal from 'components/modal_profile'\r\nimport FullScreenBTN from 'components/btn_fullscreen'\r\n\r\nimport logo from \"assets/img/logo.png\"\r\nimport 'bootstrap/dist/js/bootstrap.bundle.min.js';\r\nimport 'style.scss'\r\n\r\nimport RoomsContext  from 'utils/ctx_rooms'\r\nimport StreamContext from 'utils/ctx_streaming'\r\nimport MediaContext from 'utils/ctx_mediadevices'\r\nimport AuthContext  from 'utils/ctx_authentication'\r\n\r\nwindow.toast = toast;\r\nexport default ({ children, ...props }) => {\r\n  return <div id=\"layout\" {...props}>\r\n    <Toaster\r\n      id=\"toaster\"\r\n      position=\"bottom-right\"\r\n      reverseOrder={true}\r\n      toastOptions={{\r\n        duration: 2000,\r\n      }}\r\n    />\r\n    <Router basename={process.env.REACT_APP_BASE}>\r\n    <AuthContext>\r\n    <RoomsContext>\r\n    <MediaContext>\r\n    <StreamContext>\r\n    \r\n    <Helmet>\r\n      <title>{process.env.REACT_APP_NAME}</title>\r\n      <title>{props.title}</title>\r\n      <meta property=\"og:url\" content={process.env.REACT_APP_OG_URL} />\r\n      <meta property=\"og:type\" content={process.env.REACT_APP_OG_TYPE} />\r\n      <meta property=\"og:title\" content={process.env.REACT_APP_OG_TITLE} />\r\n      <meta property=\"og:description\" content={process.env.REACT_APP_OG_DESC} />\r\n      <meta property=\"og:image\" content={process.envREACT_APP_OG_IMAGE} />\r\n    </Helmet>\r\n\r\n\r\n\r\n    <div id=\"title\" variant=\"none\" className=\"d-flex m-3 position-absolute top-0 start-0 user-select-none\">\r\n      <Image className=\"me-2\" width={32} height={32} src={logo} />\r\n      <h1 className=\"fs-3\">{process.env.REACT_APP_NAME}</h1>\r\n    </div>\r\n\r\n    <div className=\"z-top d-flex m-2 position-absolute top-0 end-0\">\r\n      <ProfileModal />\r\n      <AboutModal />\r\n      <FullScreenBTN />\r\n    </div>\r\n\r\n    <Switch>\r\n        <Route component={App}       exact path={[\"/\", \"/settings\", \"/about\", \"/users\", \"/chat\", \"/profile\", \"/room/:roomId\", \"/room/:roomId/chat\", \"/room/:roomId/guests\"]} />\r\n        <Route component={Verified}  exact path=\"/verified/:token\"/>\r\n        <Route component={ResetPass} exact path=\"/reset-password/:token\"/>\r\n        <Route> <Redirect to='/'/> </Route>\r\n    </Switch>\r\n    \r\n    </StreamContext>\r\n    </MediaContext>\r\n    </RoomsContext>\r\n    </AuthContext>\r\n    </Router>\r\n\r\n    <style global jsx>{`\r\n      @import \"src/variables.scss\";\r\n\r\n      #layout {\r\n        text-align:center;\r\n        background:$background;\r\n      }  \r\n\r\n      #title {\r\n        color:$text;\r\n        filter: invert(.5) brightness(0.5);\r\n        mix-blend-mode: luminosity;\r\n      }\r\n\r\n      .z-top{\r\n        z-index:1000;\r\n      }\r\n      \r\n    `}</style>\r\n  </div>\r\n}","import { useHistory } from 'react-router-dom'\r\n\r\nimport MD from 'utils/md';\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default ()=>{\r\n    const history = useHistory();\r\n\r\n    return <>\r\n        <Modal size=\"md\" show={true} \r\n            title={<h2 className=\"user-select-none\">User verified!</h2>}\r\n            button_tittle=\"Understood\"\r\n            callback={ ()=>{ history.push('/') } }\r\n        >\r\n            <MD className=\"user-select-none\">{`Account verified successfully in the system. You can now login on the application.`}</MD>\r\n        </Modal> \r\n    </>\r\n}","import toast from 'react-hot-toast'\r\nimport { useState, useEffect, useRef } from 'react'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport { Form, FloatingLabel, OverlayTrigger, Tooltip, Button} from 'react-bootstrap'\r\n\r\nimport http from 'utils/http'\r\nimport MD from 'utils/md'\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default ()=>{\r\n    let { token } = useParams();\r\n    const history = useHistory();\r\n\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated] = useState(undefined);\r\n    const [formvalues, setFormValues] = useState({formErrors:{}});\r\n\r\n    function handleUserInput (e) {\r\n        const name = e.target.name;\r\n        const value = e.target.value;\r\n        validateField(name, value);\r\n    }\r\n\r\n    function validateField(name, value){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(name){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default: console.warn(\"Invalid field name: \", name);\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n    \r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        const toastId = toast.loading('Resetting password...');\r\n        const password = formvalues.password;\r\n        await http.post(`${process.env.REACT_APP_API_URL}/reset-password/${token}`, {password})\r\n        .then( ({status, description, message }) => {\r\n            switch (status) {\r\n                case 'ok':\r\n                    toast.success('Success', {id: toastId});\r\n                    setTimeout( ()=>history.push(`/`), 1000);\r\n                    break;\r\n                case 400: toast.error(message, {id: toastId}); break;\r\n                case 'error': toast.error(description, {id: toastId}); break;\r\n                default: toast.warn(description, {id: toastId});\r\n            }\r\n        })\r\n        .catch(err => {\r\n            toast.error(`Error: ${err}`, {id: toastId});\r\n        });\r\n    }\r\n\r\n    return <>\r\n        <Modal size=\"md\" show={true} \r\n            title={<h2 className=\"user-select-none\">Reset password</h2>}\r\n        >\r\n            <MD className=\"user-select-none\">{ \"Please enter your new password.\"}</MD>\r\n            \r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingPassword\" label=\"New Password\">\r\n                    <Form.Control required name=\"password\" type=\"password\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.password??\"\"}/>\r\n                </FloatingLabel>\r\n\r\n                <OverlayTrigger placement=\"bottom\"\r\n                overlay={\r\n                    <Tooltip className={`${validated?\"d-none\":\"\"} mt-2`}  id={`tooltip-bottom`}>\r\n                        Check form errors\r\n                    </Tooltip>\r\n                }\r\n                >\r\n                    <span style={{padding:\"10px 0\"}}>\r\n                        <Button className=\"mt-4\" type=\"submit\" disabled={!validated} > Proceed </Button>\r\n                    </span>\r\n                </OverlayTrigger>\r\n\r\n            </Form>\r\n\r\n        </Modal> \r\n    </>\r\n}","import React, {useEffect, useState, useReducer} from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\n\r\nexport default () => {\r\n    const [show, setShow] = useState(false);\r\n    const [proposal, dispatch] = useReducer((o,n)=>n, {proposalEvent : undefined});\r\n    useEffect(() => { \r\n            window.addEventListener('beforeinstallprompt',onBeforeInstallPrompt, 0);\r\n        return () => { \r\n            window.removeEventListener('beforeinstallprompt',onBeforeInstallPrompt, 0);\r\n        }\r\n    },[]);\r\n\r\n    function onBeforeInstallPrompt(e) \r\n    {\r\n        debugger;\r\n        e.preventDefault();\r\n        dispatch(state => ({...state, e}));\r\n    }\r\n\r\n    async function promptInstall()\r\n    {\r\n        if(!proposal?.proposalEvent) \r\n            return;\r\n\r\n        proposal.proposalEvent.prompt();\r\n        const { outcome } = await proposal.proposalEvent.userChoice;\r\n        if (outcome === 'accepted') {\r\n            dispatch(state => ({ ...state, proposalEvent: undefined }));\r\n        }\r\n    }\r\n\r\n    return <>\r\n        <Button variant=\"link\" onClick={ ()=>setShow(1) }>About</Button>\r\n        <Modal closeButton size=\"md\" {...{show, setShow}} title={<span>{process.env.REACT_APP_NAME} - Offline capable <Button variant={`${proposal.proposalEvent?\"outline-primary\":\"outline-secondary\"}`}size=\"sm\" onClick={promptInstall} disabled={!proposal.proposalEvent}> {`${proposal.proposalEvent? \"Install PWA\" : \"Not available\"}`}</Button></span>}>\r\n        <MD>{`\r\n        An offline-capable AdMiRe version is available, wich is a [Progressive Web App](https://docs.microsoft.com/en-us/microsoft-edge/progressive-web-apps-chromium/).\r\n\r\n        The app serves the following features:\r\n        - Offline-capable (with [Service Workers](https://developers.google.com/web/fundamentals/primers/service-workers/))\r\n        - \"Add to Home Screen\" feature on Android and iOS supported devices to launch the app from the home screen.\r\n        - Dark Mode.\r\n        - Privacy-focused - We don't collect any personal data.\r\n        - Lightweight - The app is only ~5MB.\r\n\r\n        Hope you liked using this app \r\n\r\n        <div align=\"center\" className=\"fw-bolder\">Made with  by <a href=\"https://www.upf.edu/web/gti\"> UPF-GTI</a> </div>\r\n        `}</MD>\r\n        </Modal>\r\n    </>;\r\n}\r\n//<Button onClick={handleClick}>Install {import.meta.env.NAME}</Button>","import React, {useState, useContext } from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\n\r\nexport default () => {\r\n    const [show, setShow] = useState(false);\r\n    const auth = useContext(AuthContext);\r\n    const user = \"h3R\"\r\n\r\n    if(!auth.isLogged) return <></>;\r\n    return <>\r\n        <Button variant=\"link\" onClick={ ()=>setShow(1) }>Profile</Button>\r\n        <Modal closeButton size=\"lg\" {...{show, setShow}} title={<h2 className=\"user-select-none\">{user}</h2>}>\r\n        <MD className=\"user-select-none\">{`\r\n        An offline-capable AdMiRe version is available, wich is a [Progressive Web App](https://docs.microsoft.com/en-us/microsoft-edge/progressive-web-apps-chromium/).\r\n\r\n        The app serves the following features:\r\n        - Offline-capable (with [Service Workers](https://developers.google.com/web/fundamentals/primers/service-workers/))\r\n        - \"Add to Home Screen\" feature on Android and iOS supported devices to launch the app from the home screen.\r\n        - Dark Mode.\r\n        - Privacy-focused - We don't collect any personal data.\r\n        - Lightweight - The app is only ~5MB.\r\n\r\n        Hope you liked using this app \r\n\r\n        <div align=\"center\" className=\"fw-bolder\">Made with  by <a href=\"https://www.upf.edu/web/gti\"> UPF-GTI</a> </div>\r\n        `}</MD>\r\n\r\n        <Button onClick={auth.logout}><i className=\"bi bi-power\"></i> Log me out</Button>\r\n        </Modal>\r\n    </>;\r\n}","import screenfull from 'screenfull'\r\nimport { Button } from 'react-bootstrap'\r\nimport { useState, useEffect } from 'react'\r\n\r\n\r\nexport default () => {  \r\n    let [state, setState] = useState(0);\r\n\r\n    function handleClick(){\r\n        /*let promise\r\n        if (document.fullscreenElement) {\r\n            promise = document.exitFullscreen();\r\n        } else {\r\n            promise = document.documentElement.requestFullscreen();\r\n        }\r\n        promise.then( ()=>setState(++state) );*/\r\n        screenfull.toggle();\r\n    }\r\n\r\n    useEffect(()=>{\r\n        const f = () => setState(++state);\r\n        screenfull.on('change', f);\r\n    return ()=>{\r\n        screenfull.off('change', f);\r\n    }\r\n    },[])\r\n    \r\n//window.document.documentElement.webkitRequestFullScreen\r\n\r\n    return <div id=\"btn_fullscreen\">\r\n        { screenfull.isEnabled && \r\n            <Button \r\n            onClick={handleClick} variant=\"link\"> \r\n                {  document.fullscreen && <i className=\"bi bi-fullscreen-exit\"/> }\r\n                { !document.fullscreen && <i className=\"bi bi-fullscreen\"/> }\r\n            </Button>    \r\n        }\r\n    </div>;\r\n}","import { useState, useEffect } from 'react'\r\nimport { NavLink, useHistory } from \"react-router-dom\"\r\n\r\nfunction Nav({buttons, children}){\r\n    const history = useHistory()\r\n    const [active, setActive] = useState(0);\r\n    let i = 0;\r\n    \r\n    function onKeyPressed(e)\r\n    {\r\n        const v = e.keyCode-49;\r\n        \r\n        if(v >= 0 && v < children.length && !children[v].props.disabled)\r\n        {\r\n            history.push(children[v].props.to ?? \"/\");\r\n        }\r\n    }\r\n\r\n    useEffect(()=>{\r\n        document.addEventListener(\"keydown\", onKeyPressed)\r\n    return ()=>{\r\n        document.removeEventListener(\"keydown\", onKeyPressed)\r\n    }}, [])\r\n\r\n    return <>\r\n        <div className=\"nav-partial px-3 d-flex justify-content-evenly align-items-center position-absolute bottom-0 start-50 translate-middle-x mb-3 shadow rounded-5 bg-light\" style={{ zIndex: 1100}}>\r\n            {children.filter( (v,k,a) => k < a.length/2 ).map( (v,k,a) => { \r\n                const ret = <div id={k} key={k} onClick={ !v.props.disabled? (() => setActive(k)) : undefined }>{v}</div>\r\n                ++i;\r\n                return ret;\r\n            })}\r\n            {buttons && buttons}\r\n            {children.filter( (v,k,a) => k >= a.length/2 ).map( (v,k,a) => { \r\n                const ret = <div id={k+i} key={k+i} onClick={ !v.props.disabled? (() => setActive(k+i)) : undefined }>{v}</div>\r\n                return ret;\r\n            })}\r\n        </div>\r\n        <style global jsx>{`\r\n            @import \"node_modules/bootstrap/scss/_functions.scss\";\r\n            @import \"node_modules/bootstrap/scss/_variables.scss\";\r\n            @import \"src/variables.scss\";\r\n\r\n            .rounded-5{\r\n                border-radius: .5em;\r\n            }\r\n            .nav-partial{\r\n                min-width: 1rem;\r\n                min-height: 4rem;\r\n                transition: all .2s ease-in-out;\r\n            }\r\n            .nav-button, .nav-item{\r\n                color: $secondary;\r\n                cursor: pointer;\r\n                height: 100%;\r\n                width: auto;\r\n                user-select: none;\r\n\r\n                &:hover{\r\n                    color:  lighten($danger,29.5%);\r\n                }\r\n            }\r\n\r\n            .nav-item-active{\r\n                color: red !important;\r\n            }\r\n\r\n            .nav-item-disabled{\r\n                color: lighten($btn-link-disabled-color,27.5%);\r\n                user-select: none !important;\r\n                pointer-events:none;\r\n                cursor: not-allowed;\r\n                &:hover{\r\n                    color:  lighten($btn-link-disabled-color,27.5%);\r\n                }\r\n            }\r\n\r\n            .nav-button i, .nav-item i{\r\n                transform: scale(1.5);\r\n                width:100%;\r\n                padding:0;\r\n                margin:0;\r\n                user-select: none;\r\n                text-transform: capitalize;\r\n            }\r\n            .nav-button{\r\n                color: black !important;\r\n                height: 4rem;\r\n                width: 4rem;\r\n                line-height: 3.5rem;\r\n                margin-top: -1.5rem;\r\n                margin-bottom: 1.5rem;\r\n            }\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n                .nav-partial{\r\n                    flex-direction: column;\r\n                    //top: 50%;\r\n                    left: 100% !important;\r\n                    transform: translate(-100%, 0%) !important;\r\n                    margin-left: -1.1rem;\r\n                    padding:1.251rem 0 !important;\r\n\r\n                    .nav-button{\r\n                        margin:0;\r\n                        margin-left: -1.5rem;\r\n                        margin-right: 1.5rem;\r\n                    }\r\n                }\r\n            }\r\n            @media only screen and (orientation: portrait){\r\n\r\n            } \r\n        `}</style>\r\n    </>\r\n}\r\n\r\n\r\nNav.Item = function({children, icon, disabled, to, ...props}){\r\n    return <div to={to??\"/\"} className={`nav-item ${disabled?\"nav-item-disabled\":\"\"} ${props.appendclass??\"\"}`} {...props}>\r\n        <div className={`d-flex my-0 mx-2 flex-column fs-6 fw-lighter`} >{children}</div>\r\n    </div>\r\n}\r\n\r\nNav.Button = function({children,...props}){\r\n    return <div className={`nav-button ${props.appendclass??\"\"}`} {...props}>\r\n        <div className=\" pt-1 fs-1 fw-lighter\">{children}</div>\r\n    </div>\r\n}\r\n\r\nexport default Nav;","import {useState, useContext} from 'react'\r\nimport Modal from 'partials/modal'\r\nimport {Badge} from 'react-bootstrap'\r\n\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport { StreamContext } from 'utils/ctx_streaming'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\n\r\n\r\nexport default ({callId, isForwardCall})=>{\r\n    const [show, setShow] = useState(null);\r\n    const wrtc     = useContext(StreamContext);\r\n\r\n    let [mediaHubCallId, forwardedCallId] = wrtc.getLiveCall(callId);\r\n\r\n    return <>\r\n        {isForwardCall ? <Badge style={{padding:\".44em .45em\"}} pill bg=\"danger\" onClick={() => wrtc.callHangup( mediaHubCallId )}><i className=\"bi bi-x\"></i></Badge>\r\n        :                <Badge style={{padding:\".44em .45em\"}} pill bg=\"danger\" onClick={() => setShow( callId )} className=\"cursor-pointer\"><i className=\"bi bi-cast\"></i></Badge>}\r\n        <Modal {...{show,setShow}} closeButton title=\"Ready to forward?\">\r\n            Enter the destination ID you want to forward to\r\n        </Modal>\r\n    </>;\r\n}\r\n\r\n//{ imMaster && (!isForwardCall && id !== roomInfo?.master && id !== user.id) && <Badge pill bg=\"danger\" onClick={() => setShowModal( callId )}><i class=\"bi bi-cast\"></i></Badge> }","//import { useEffect } from 'react';\r\nimport { Row, Col, Badge } from 'react-bootstrap'\r\nimport { useContext, useEffect,useLayoutEffect, useState, useRef } from 'react'\r\nimport { useParams, useHistory } from \"react-router-dom\"\r\n\r\nimport * as BRA from 'lib_bra'\r\nimport Video from 'partials/video'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport { StreamContext } from 'utils/ctx_streaming'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport BadgeForwardCall from 'components/badge_forward'\r\n\r\nexport default ({ ...props }) => {\r\n    const history  = useHistory();\r\n    const {roomId} = useParams();\r\n    const carouselRef = useRef();\r\n    const auth     = useContext(AuthContext);\r\n    const rooms    = useContext(RoomsContext);\r\n    const media    = useContext(MediaContext);\r\n    const wrtc     = useContext(StreamContext);\r\n    const [selected, setSelected] = useState(null);\r\n    \r\n    useEffect(() => {\r\n        function unload(){\r\n            rooms.leaveRoom();\r\n            document.body.addEventListener('unload', unload);\r\n        }\r\n        document.body.addEventListener('unload', unload);\r\n        media.init();\r\n    return ()=>{\r\n        media.stop();\r\n        //unload();\r\n    }},[])\r\n\r\n    /*const room = rooms.getRoomInfo(roomId);\r\n    useEffect(() => {\r\n        if(room)\r\n        rooms.setCurrent(room);\r\n    },[...Object.values(room??{})])//TODO: ESTO ES MU MU MU FEO\r\n    */\r\n   \r\n    useEffect(() => {\r\n        function scrollHorizontal(e){\r\n            this.scrollLeft += e.deltaY;\r\n        }\r\n        carouselRef.current?.removeEventListener('wheel', scrollHorizontal)\r\n        carouselRef.current?.addEventListener('wheel', scrollHorizontal)\r\n\r\n        return ()=>{\r\n            carouselRef.current?.removeEventListener('wheel', scrollHorizontal)\r\n        }\r\n    },[carouselRef]);\r\n\r\n    useLayoutEffect(()=>{\r\n        if(!rooms.ready) return;\r\n\r\n        (async ()=>{\r\n            const room = rooms.getRoomInfo(roomId);\r\n            if(!room){\r\n                return history.push('/')\r\n            }\r\n            \r\n            if(![ room.master, ...room.guests].includes(auth.user)){\r\n                await rooms.joinRoom(roomId)\r\n                .catch( ()=> {\r\n                    history.push('/')\r\n                })\r\n            }\r\n\r\n            rooms.setCurrent(room);\r\n        })();\r\n\r\n    },[rooms.ready, roomId]);\r\n\r\n    useLayoutEffect(()=>{\r\n        if(!(auth.isLogged && auth.isConnected) || !rooms.current) return;\r\n\r\n        //By this point i can guarantee im in the room where it happens\r\n        wrtc.callHangupAll();\r\n        wrtc.callAllUsers(rooms.current);\r\n    },[auth.isLogged && auth.isConnected, rooms.current]);\r\n\r\n    useEffect(()=>{},[wrtc.streams])\r\n\r\n\r\n    \r\n    \r\n    const dummy = BRA.dummyStream.getStream();\r\n\r\n    return <div id=\"room\" className=\"overflow-hidden m-auto\" style={{zIndex:1000}}>\r\n        <Row id=\"content-row\" className=\"g-1\" style={{ height:\"100%\" }}>\r\n  \r\n            <Col xs=\"auto\" id=\"carousel-col\" ref={carouselRef}>\r\n                <div id=\"carousel\" className=\"d-flex flex-column\" >\r\n                {  Object.entries({local:media.localStream, ...wrtc.streams}).map(([callId, stream], k)=>{\r\n\r\n                    let id = wrtc.getUserId(callId);\r\n                    let imMaster = auth.user === rooms.current?.master && id !== rooms.current?.master && id !== auth.user;\r\n                    let [mediaHubCallId, forwardedCallId] = wrtc.getLiveCall(callId);\r\n                    let isForwardCall = !!forwardedCallId;\r\n                    let isSelected = selected === callId || (!selected && k === 0);\r\n\r\n                    return <>\r\n                    <div className=\"stream-forward\">\r\n                    <BadgeForwardCall callId={callId} isForwardCall={isForwardCall}/>\r\n                    { isSelected && <Badge pill bg=\"primary\"><i className=\"bi bi-eye active\"/></Badge> }\r\n                    </div>\r\n                    <Video key={callId} id={id} stream={stream} className={!isSelected?\"cursor-pointer\":\"\"} onClick={()=>{setSelected(callId)}}/>\r\n                    </>\r\n                })}\r\n                </div>\r\n            </Col>\r\n            <Col id=\"main-col\">\r\n                <Video className=\"main-video\" id={wrtc.getUserId(selected)} stream={wrtc.streams[selected]??media.localStream} />\r\n            </Col>\r\n        </Row>\r\n        <style global jsx>{`\r\n            @import \"src/variables.scss\";\r\n\r\n            #room{\r\n                height:calc(100vh - 3rem - 3rem);\r\n                \r\n                #main-col {\r\n                    height: 100%;\r\n                    overflow: hidden;\r\n\r\n                    .Video\r\n                    {\r\n                        width:100%;\r\n                        height:100%;\r\n                        object-fit: cover;\r\n                    }\r\n                }\r\n\r\n                #carousel-col {\r\n                    height: 100%;\r\n                    width:166px;\r\n                    overflow-x: hidden;\r\n                    overflow-y: scroll;\r\n\r\n                    #carousel{\r\n                        height:100%;\r\n                    }\r\n                }\r\n\r\n                .stream-forward{\r\n                    height:1.9rem;\r\n                    position:relative;\r\n                    margin-bottom:-1.9rem;\r\n                    text-align:left;\r\n                    padding:3px 6px;\r\n                    z-index:10000;\r\n                }\r\n            }\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n                #room{\r\n                    height:calc(100vh - 2rem);\r\n                }\r\n            }\r\n\r\n            @media only screen and (orientation: portrait){\r\n                #content-row{ flex-direction: column; }\r\n                #carousel-col{\r\n                    overflow-x: scroll;\r\n                    overflow-y: hidden;\r\n                    height: 126px !important;\r\n                    width: 100% !important;\r\n                    #carousel{\r\n                        flex-direction: row !important;\r\n                        border:none;\r\n                        .Video, .Video video{ \r\n                            width: 166px; \r\n                            height:124px; \r\n                            object-fit: cover;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </div>;\r\n}\r\n\r\n","import React, {useState, useContext, useEffect, useRef  } from 'react';\r\nimport { Button, Form, FloatingLabel, Spinner, OverlayTrigger, Tooltip } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\n\r\nexport default () => {\r\n    const formRef = useRef(null);\r\n    const [show, setShow] = useState(false);\r\n    const auth = useContext(AuthContext);\r\n    const user = \"h3R\"\r\n\r\n    const [formvalues, setFormValues] = useState({formErrors:{}});\r\n    const [validated, setValidated] = useState(undefined);\r\n   \r\n    function handleUserInput (e) {\r\n        const name = e.target.name;\r\n        const value = e.target.value;\r\n        validateField(name, value);\r\n    }\r\n\r\n    function validateField(name, value){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(name){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default: console.warn(\"Invalid field name: \", name);\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function handleSubmit(event){\r\n        alert(\"NO IMPLEMENTATION\")\r\n    }\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n\r\n\r\n    return <>\r\n        <Button size=\"sm\" className=\"mt-4\" variant=\"link\" onClick={ ()=>setShow(1) }><i className=\"bi bi-lock\"></i>Forgot password?</Button>\r\n        <Modal closeButton size=\"lg\" {...{show, setShow}} title={<h2 className=\"user-select-none\">Forgot Password</h2>} size=\"md\">\r\n            <MD className=\"user-select-none\">{`Enter your email adress, on a couple of minutes you will receive an email with a link to reset your password.`}</MD>\r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingInput\" label=\"Email address\" className=\"mb-3\">\r\n                    <Form.Control required name=\"email\" type=\"email\" placeholder=\" \" \r\n                    onChange={handleUserInput} />\r\n                </FloatingLabel>\r\n\r\n                <OverlayTrigger placement=\"bottom\"\r\n                overlay={\r\n                    <Tooltip className={`${validated?\"d-none\":\"\"}`}  id={`tooltip-bottom`}>\r\n                        Enter your email address first.\r\n                    </Tooltip>\r\n                }\r\n                >\r\n                    <span style={{padding:\"10px 0\"}}>\r\n                        <Button type=\"submit\" disabled={!validated && auth.isConnected} > \r\n                        {auth.isConnected? \r\n                            <> Send password reset email </>\r\n                            : <><Spinner as=\"span\"animation=\"grow\" role=\"status\" aria-hidden=\"true\"/> Connecting </>\r\n                        }</Button>\r\n                    </span>\r\n                </OverlayTrigger>\r\n\r\n            </Form>\r\n        </Modal>\r\n    </>;\r\n}","import React, {useState, useContext, useEffect, useRef  } from 'react';\r\nimport { Button, Form, FloatingLabel, Spinner, OverlayTrigger, Tooltip, Card } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\n\r\nexport default () => {\r\n    const formRef = useRef(null);\r\n    const [show, setShow] = useState(false);\r\n    const auth = useContext(AuthContext);\r\n    const user = \"h3R\"\r\n\r\n    const [formvalues, setFormValues] = useState({formErrors:{}});\r\n    const [validated, setValidated] = useState(undefined);\r\n   \r\n    function handleUserInput (e) {\r\n        const name = e.target.name;\r\n        const value = e.target.value;\r\n        validateField(name, value);\r\n    }\r\n\r\n    function validateField(name, value){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(name){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default: console.warn(\"Invalid field name: \", name);\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function handleSubmit(event){\r\n        alert(\"NO IMPLEMENTATION\")\r\n    }\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n\r\n\r\n    return <>\r\n        <Card.Footer className=\"text-center user-select-none\" onClick={ ()=>setShow(1) }> Create an account </Card.Footer>\r\n        <Modal closeButton {...{show, setShow}} title={<h2 className=\"user-select-none\">Let's create your account</h2>}>\r\n            <MD className=\"user-select-none\">{`Create your account. It's free and only takes a minute.`}</MD>\r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingInput\" label=\"Email address\" className=\"mb-3\">\r\n                    <Form.Control required name=\"email\" type=\"email\" placeholder=\" \" \r\n                    onChange={handleUserInput} />\r\n                </FloatingLabel>\r\n\r\n                <OverlayTrigger placement=\"bottom\"\r\n                overlay={\r\n                    <Tooltip className={`${validated?\"d-none\":\"\"}`}  id={`tooltip-bottom`}>\r\n                        Enter your email address first.\r\n                    </Tooltip>\r\n                }\r\n                >\r\n                    <span style={{padding:\"10px 0\"}}>\r\n                        <Button type=\"submit\" disabled={!validated && auth.isConnected} > \r\n                        {auth.isConnected? \r\n                            <> CREATE ACCOUNT </>\r\n                            : <><Spinner as=\"span\"animation=\"grow\" role=\"status\" aria-hidden=\"true\"/> Connecting </>\r\n                        }</Button>\r\n                    </span>\r\n                </OverlayTrigger>\r\n\r\n            </Form>\r\n        </Modal>\r\n    </>;\r\n}","//https://learnetto.com/blog/react-form-validation\r\n\r\nimport { useContext, useRef, useState, useEffect } from 'react';\r\nimport { Row, Col, Card,Form, FloatingLabel, Button, Spinner, OverlayTrigger, Tooltip } from \"react-bootstrap\"\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport RecoveryModal from 'components/modal_recovery'\r\nimport RegisterModal from 'components/modal_register'\r\nimport logo from 'assets/img/logo.png';\r\nimport toast from 'react-hot-toast';\r\nimport cookies from '@h3r/cookies'\r\nimport * as BRA from 'lib_bra'\r\n\r\nexport default () => {\r\n    const auth = useContext(AuthContext);\r\n\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated] = useState(undefined);\r\n    const [formvalues, setFormValues] = useState({formErrors:{}, email: cookies.get(\"admire_app_email\"), remember: !!cookies.get(\"admire_app_email\")});\r\n   \r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        auth.login(formvalues.email, formvalues.password)\r\n        .then(  app_token => {\r\n            if(formvalues.remember){\r\n                cookies.set('admire_app_token', app_token, process.env.REACT_APP_COOKIES_EXPIRE_TIME);\r\n                cookies.set(\"admire_app_email\", formvalues.email, process.env.REACT_APP_COOKIES_EXPIRE_TIME);\r\n            }\r\n        });\r\n    }\r\n\r\n    function handleUserInput (e) {\r\n        const name  = e.target.name;\r\n        const type  = e.target.type;\r\n        const  value = type===\"checkbox\"?e.target.checked:e.target.value;\r\n\r\n        validateField(name, value, type);\r\n    }\r\n\r\n    function validateField(name, value, type = \"any\"){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(type){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default:\r\n                check = true;\r\n                formErrors[name] = '';\r\n                break;\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n    \r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n\r\n    return <>\r\n    <Card id=\"login\" bg=\"light\" className=\"flex-column text-center position-absolute start-50 top-50 translate-middle\" style={{ width: '24rem' }}>\r\n\r\n        <Col>\r\n            <Card.Img variant=\"top\" className=\"mt-4 user-select-none\" src={logo}/>\r\n            <h1 className=\"text-start ps-4 mb-0 mt-3 user-select-none\">{process.env.REACT_APP_NAME}</h1>\r\n            <div className=\"divider\"><span/></div>\r\n        </Col>\r\n\r\n        <Col>\r\n            <Card.Body as={Col} className=\"text-start px-4 pb-4\">\r\n\r\n            <Card.Text className=\"user-select-none\">Enter your e-mail adress and your password.</Card.Text>\r\n            \r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingInput\" label=\"Email address\" className=\"mb-3\">\r\n                    <Form.Control required name=\"email\" type=\"email\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.email??\" \"}/>\r\n                </FloatingLabel>\r\n                <FloatingLabel controlId=\"floatingPassword\" label=\"Password\">\r\n                    <Form.Control required name=\"password\" type=\"password\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.password??\"\"}/>\r\n                </FloatingLabel>\r\n\r\n                <Form.Switch id=\"remember-switch\" label=\"Remember me\" className=\"user-select-none\" name=\"remember\" onChange={handleUserInput} defaultChecked={formvalues.remember??false}/>\r\n\r\n\r\n                <OverlayTrigger placement=\"bottom\"\r\n                    overlay={\r\n                        <Tooltip className={`${validated?\"d-none\":\"\"} mt-2`}  id={`tooltip-bottom`}>\r\n                            Check form errors\r\n                        </Tooltip>\r\n                    }\r\n                    >\r\n                        <span style={{padding:\"10px 0\"}}>\r\n                            <Button size=\"sm\" className=\"mt-4\" type=\"submit\" disabled={!validated && auth.isConnected} > \r\n                                {auth.isConnected?\r\n                                <><i className=\"bi bi-box-arrow-in-left\"/> Log me in </>\r\n                                : <><Spinner as=\"span\"animation=\"grow\" size=\"sm\" role=\"status\" aria-hidden=\"true\"/> Connecting </>\r\n                            }</Button>\r\n                        </span>\r\n                    </OverlayTrigger>\r\n                    \r\n                <RecoveryModal/>\r\n            </Form>\r\n\r\n\r\n            </Card.Body>\r\n            <RegisterModal/>\r\n        </Col>\r\n    </Card>\r\n\r\n    <style global jsx>{`\r\n        @import \"src/variables.scss\";\r\n        .divider {\r\n                border-bottom: 1px solid #FFF;\r\n                background-color: #DADADA;\r\n                height: 2px;\r\n                margin: 0.5em 0px 1.5em;\r\n\r\n                & span{\r\n                    position:relative;\r\n                    display: block;\r\n                    width: 75px;\r\n                    height: 3px;\r\n                    background-color: $color4;\r\n                    transform:translatey(-25%);\r\n                    left: 6%;\r\n                }\r\n        }\r\n\r\n        #login{\r\n            border:none;\r\n            img {\r\n                width: 192px;\r\n                filter: \r\n                    hue-rotate(260deg)\r\n                ;\r\n            }\r\n\r\n            .card-footer{\r\n                color:$text;\r\n                background:$color4;\r\n                transition: all 0.1s ease-in-out; \r\n                &:hover{\r\n                    background:darken($color4, 10%);\r\n                    font-weight:bold;\r\n                    cursor:pointer;\r\n                }\r\n            }\r\n        } \r\n\r\n        @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n            #login{\r\n                width: 40rem !important;\r\n                flex-direction: row !important;\r\n                .col{\r\n                    align-self: end;\r\n                }\r\n            }\r\n        }\r\n        @media only screen and (orientation: portrait){\r\n\r\n        }    \r\n    `}</style>\r\n    </>;\r\n}\r\n","import { useContext } from 'react'\r\nimport {useHistory} from 'react-router-dom'\r\nimport {Row, Col, Card} from 'react-bootstrap'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nfunction RoomTile({id, name, ...props}){\r\n    return <div>\r\n    \r\n        <Card className=\"bg-dark text-light\" {...props}>\r\n            <Card.Img variant=\"top\" src={`https://unsplash.it/seed/test/160/100`} />\r\n            <Card.Body>\r\n            <Card.Title>#{name}</Card.Title>\r\n            {/*<Card.Text></Card.Text>*/}\r\n            </Card.Body>\r\n        </Card>\r\n\r\n        <style global jsx>{`\r\n            @import 'src/variables.scss';\r\n\r\n            .card {\r\n                cursor: pointer;\r\n                user-select: none;\r\n                transition: all 0.075s ease-in-out;\r\n\r\n                &:hover {\r\n                    .card-body{\r\n                        background: lighten($dark,25%);\r\n                    }\r\n                        \r\n                    box-shadow: 0 0 0px 2px rgba(255, 255, 255, .5) !important;\r\n                }\r\n\r\n                .card-body{\r\n                    transition: all 0.075s ease-in-out;\r\n                    .card-title{\r\n                        margin:0;\r\n                        font-size: 1rem;\r\n                        white-space: nowrap;\r\n                    }\r\n                }\r\n            }\r\n        `}</style>\r\n    </div>\r\n}\r\n\r\n\r\nexport default ()=>{\r\n    const history = useHistory();\r\n    const rooms = useContext(RoomsContext);\r\n    \r\n    return <>\r\n        <Row id=\"lobby\" className=\"h-100 m-auto\">\r\n            <Col xs={12} sm={{span:10, offset:1}} >\r\n        \r\n            <h1 className=\"text-light\">Lobby</h1>    \r\n            <Row xs={2} sm={4} lg={4} xl={5} className=\"g-4\">\r\n            { Object.values(rooms.list).map((v,k) => <Col key={k}>\r\n                    <RoomTile name={` ${v?.id || 'Room '+k}`} onClick={()=>history.push(`/room/${v?.id}`)}/>\r\n                </Col>\r\n            )}\r\n            </Row>\r\n\r\n            </Col>\r\n        </Row>\r\n        <style global jsx>{`\r\n            #lobby{\r\n                min-height: 19rem;\r\n            }    \r\n        `}</style>\r\n    </>\r\n}","import { useState, useEffect } from 'react'\r\nimport { Row, Col } from 'react-bootstrap'\r\nimport MD from 'utils/md'\r\nimport Gesture from 'rc-gesture'\r\nimport { findByDisplayValue } from '.pnpm/@testing-library+dom@8.10.1/node_modules/@testing-library/dom'\r\nimport Modal from 'partials/modal'\r\n\r\nexport default ({show, setShow, ...props}) => {\r\n    const pages = [\"Devices\",\"p1\", \"p2\", \"p3\"];\r\n    const [selected, setSelected] = useState(0);\r\n    const [page, setPage] = useState(null);\r\n    const [views, setViews] = useState([]);\r\n\r\n    //use useEffect to fetch page views dynamically\r\n    useEffect(() => {\r\n        (async () => {\r\n            let vs = [];\r\n            for (let p of pages)\r\n                await import(`pages/${p}.jsx`).then(v => vs.push(<v.default />))\r\n            setViews([...vs]);\r\n            setPage(vs[selected]);\r\n        })();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        setPage(views[selected]);\r\n    }, [selected]);\r\n\r\n    function onKeyPressed(e)\r\n    {\r\n        switch(e?.keyCode)\r\n        {\r\n            case 37: return setSelected( s => (s-1 < 0)? pages.length-1 : s-1 );\r\n            case 39: return setSelected( s => (s+1)%pages.length );\r\n        }\r\n    }\r\n\r\n    useEffect(()=>{\r\n            document.addEventListener(\"keydown\", onKeyPressed)\r\n        return ()=>{\r\n            document.removeEventListener(\"keydown\", onKeyPressed)\r\n        }\r\n    }, [])\r\n\r\n    return <div id=\"wizard\">\r\n        <Gesture\r\n            onSwipeLeft={ () => setSelected( s => (s+1)%pages.length ) } \r\n            onSwipeRight={() => setSelected( s => (s-1 < 0)? pages.length-1 : s-1 ) }\r\n            \r\n        >\r\n            {/*\r\n            <Row id=\"wizard\" className=\"pt-5 h-100 m-auto\">\r\n                <Col sm={12} md={{ span: 10, offset: 1 }} lg={{ span: 8, offset: 2 }} xl={{ span: 6, offset: 3 }} className=\"pt-3 bg-light shadow-lg rounded-bottom\" style={{zIndex:1000}}>\r\n            */}\r\n                <div>\r\n                    <ul className=\"nav nav-tabs justify-content-start mb-2\">\r\n                    { pages.map( (v,k) => <li key={k} className=\"nav-item\">\r\n                            <div className={`nav-link ${selected === k?\"active\":\"\"}`} onClick={()=>setSelected(k)}>{v}</div>  \r\n                    </li>)}\r\n                </ul>\r\n\r\n                {page}\r\n                </div>\r\n            {/*\r\n                </Col>\r\n            </Row>\r\n            */}\r\n        </Gesture>\r\n        <style global jsx>{`\r\n            #wizard{\r\n                .nav-tabs{\r\n                    width: calc(100% + 24px);\r\n                    margin-left: -12px;\r\n                    margin-top: -3.6rem;\r\n                    //margin-top: -1rem;\r\n                }\r\n            }    \r\n        `}</style>\r\n    </div>;\r\n}\r\n\r\n//xs={12} md={{span:6, offset:3}} lg={{span:8, offset:2}}","import { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\nimport React, {useContext, useRef, useEffect, useState, useReducer} from 'react'\r\n\r\nimport MD from 'utils/md';\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const ref                     = useRef(null);\r\n    const [show, setShow]         = useState(false);\r\n    const [isValid, setValid]        = useState(false);\r\n    const [fetching, setFetching] = useState(0);               //0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n    function submit() {\r\n        if ( !ref?.current || !show ) return;\r\n            \r\n        rooms.createRoom(ref.current.value.toLowerCase())\r\n        .then( ()=>{\r\n            setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n            setFetching(2);   \r\n        }) \r\n        .catch( ()=>{\r\n            setFetching(3);   \r\n        }) \r\n        //setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n    }\r\n\r\n    function onKeyDown(e) {\r\n        if ( e.keyCode === 13 )\r\n            submit();\r\n    }\r\n\r\n    function handleUserInput(e){\r\n        setValid(ref?.current?.value.length > 3);\r\n    }\r\n\r\n    let button = <Button disabled={!isValid} variant={isValid?\"outline-primary\":\"outline-secondary\"} onClick={submit} >Proceed!</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" >  Succeed! </Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\"  >  Error </Button>; break;\r\n        default: break;\r\n    }\r\n\r\n\r\n    return <>\r\n        <Nav.Button onClick={()=>setShow(1)} label=\"Create room\" appendclass=\"shadow rounded-circle bg-danger\" >\r\n            <i className=\"bi bi-plus-lg\"></i> \r\n        </Nav.Button>\r\n        <Modal onKeyDown={onKeyDown} tabIndex=\"0\" buttons={[button]} closeButton size=\"md\" {...{show, setShow}} title={<span>Let's create a room</span>}>\r\n        <MD>{``}</MD>\r\n        <FloatingLabel controlId=\"floatingInput\" label=\"roomId\" className=\"mb-3\">\r\n                <Form.Control ref={ref} onChange={handleUserInput} required name=\"roomId\" type=\"text\" placeholder=\"roomId\"/>\r\n            </FloatingLabel>\r\n        </Modal>\r\n    </>;\r\n}","import React, {useContext, useEffect, useState, useReducer} from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport Nav from 'partials/nav'\r\nimport MD from 'utils/md';\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms = useContext(RoomsContext);\r\n    const [show, setShow] = useState(false);\r\n\r\n    \r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(1)} label=\"Leave room\" >\r\n            <i className=\"bi bi-telephone-x\"></i>Leave\r\n        </Nav.Item>\r\n        <Modal buttons={[<Button size=\"lg\" onClick={()=>rooms.leaveRoom()}>Yes, leave</Button>]} closeButton size=\"md\" {...{show, setShow}} title={<span>Hey! Are you sure?</span>}>\r\n            \r\n            <MD>{`\r\n            Are you sure you want to leave this room? Any call in progress will be lost and any active stream will be stopped.\r\n            `}</MD>\r\n            \r\n        </Modal>\r\n    </>;\r\n}","import { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\nimport React, {useContext, useRef, useEffect, useState, useReducer} from 'react'\r\n\r\nimport MD from 'utils/md';\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport Wizard from 'views/wizard'\r\n\r\n\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const ref                     = useRef(null);\r\n    const [show, setShow]         = useState(false);\r\n    const [isValid, setValid]        = useState(false);\r\n    const [fetching, setFetching] = useState(0);               //0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n    function submit() {\r\n        if ( !ref?.current || !show ) return;\r\n            \r\n        rooms.createRoom(ref.current.value.toLowerCase())\r\n        .then( ()=>{\r\n            setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n            setFetching(2);   \r\n        }) \r\n        .catch( ()=>{\r\n            setFetching(3);   \r\n        }) \r\n        //setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n    }\r\n\r\n    function onKeyDown(e) {\r\n        if ( e.keyCode === 13 )\r\n            submit();\r\n    }\r\n\r\n    function handleUserInput(e){\r\n        setValid(ref?.current?.value.length > 3);\r\n    }\r\n\r\n    let button = <Button disabled={!isValid} variant={isValid?\"outline-primary\":\"outline-secondary\"} onClick={submit} >Proceed!</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" >  Succeed! </Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\"  >  Error </Button>; break;\r\n        default: break;\r\n    }\r\n\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} ><i className=\"bi bi-magic\"/>Settings</Nav.Item>\r\n        <Modal onKeyDown={onKeyDown} tabIndex=\"0\" buttons={[button]} closeButton size=\"md\" {...{show, setShow}} _title={<span>Settings: Wizard</span>}>\r\n            <Wizard/>\r\n        </Modal>\r\n    </>;\r\n}","import { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\nimport React, {useContext, useRef, useEffect, useState, useReducer} from 'react'\r\n\r\nimport MD from 'utils/md';\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const [show, setShow]         = useState(false);\r\n\r\n    useEffect(() => {},[rooms.current?.guests]);\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} disabled={!rooms.current} ><i className=\"bi bi-people\"/>Users</Nav.Item>\r\n        <Modal tabIndex=\"0\" closeButton size=\"md\" {...{show, setShow}} title={<span>Users</span>}>\r\n            <ul>\r\n            {<li key={-1}>{rooms.current?.master}</li>}\r\n            {rooms.current?.guests.map( (v,k,a) => <li key={k}>{v}</li>)}\r\n            </ul>            \r\n        </Modal>\r\n    </>;\r\n}","import { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\nimport React, {useContext, useRef, useEffect, useState, useReducer} from 'react'\r\n\r\nimport MD from 'utils/md';\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const [show, setShow]         = useState(false);\r\n\r\n    useEffect(() => {},[rooms.current?.guests]);\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} disabled={!rooms.current}><i className=\"bi bi-chat-dots\"/>Chat</Nav.Item>\r\n        <Modal tabIndex=\"0\" closeButton size=\"md\" {...{show, setShow}} title={<span>Chat</span>}>\r\n            <ul>\r\n                {<li key={-1}>{rooms.current?.master}</li>}\r\n                {rooms.current?.guests.map( (v,k,a) => <li key={k}>{v}</li>)}\r\n            </ul>            \r\n        </Modal>\r\n    </>;\r\n}","import Nav from \"partials/nav\"\r\nimport { useState, useContext } from 'react'\r\nimport { ButtonToolbar, Button } from 'react-bootstrap'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\n\r\n\r\nexport default () => {\r\n    const media    = useContext(MediaContext);\r\n    \r\n    const audiotracks = media.localStream.getAudioTracks()??[];\r\n    const [isAudioEnabled, setAudioEnabled] = useState(audiotracks.every( v => v.enabled ));\r\n    \r\n    const videotracks = media.localStream.getVideoTracks()??[];\r\n    const [isVideoEnabled, setVideoEnabled] = useState(videotracks.every( v => v.enabled ));\r\n    \r\n    return <>\r\n    <Nav.Button>\r\n        <ButtonToolbar>\r\n            \r\n            <Button onClick={()=>{ \r\n                const enabled = audiotracks.every(track => { track.enabled = !isAudioEnabled; return !!track.enabled;});\r\n                setAudioEnabled(enabled); \r\n            }}><i className={isAudioEnabled?\"bi bi-mic-mute\":\"bi bi-mic-mute\"}></i></Button>\r\n            \r\n            <Button onClick={()=>{ \r\n                const enabled = videotracks.every(track => { track.enabled = !isVideoEnabled; return !!track.enabled;});\r\n                setVideoEnabled(enabled); \r\n            }}><i className={isVideoEnabled?\"bi bi-camera-video\":\"bi bi-camera-video-off\"}></i></Button>\r\n        \r\n        </ButtonToolbar>\r\n    </Nav.Button>\r\n    </>\r\n}\r\n\r\n/*\r\n        <Nav.Button onClick={()=>setShow(1)} label=\"Create room\" appendclass=\"shadow rounded-circle bg-danger\" >\r\n            <i className=\"bi bi-plus-lg\"></i> \r\n        </Nav.Button>\r\n*/","import { useContext, useRef, useEffect } from 'react'\r\nimport { Container } from \"react-bootstrap\"\r\nimport { useHistory, Redirect } from \"react-router-dom\"\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nimport Nav from \"partials/nav\"\r\nimport Room  from 'views/room'\r\nimport Login  from 'views/login'\r\nimport Lobby  from 'views/lobby'\r\nimport Wizard from 'views/wizard'\r\nimport CreateRoomModal from 'components/modal_create_room'\r\nimport LeaveRoomModal from 'components/modal_leave_room'\r\nimport WizardModal from 'components/modal_wizard'\r\nimport UsersModal from 'components/modal_users'\r\nimport ChatModal from 'components/modal_chat'\r\nimport StreamButtons from 'components/btngrp_stream';\r\n\r\n\r\nfunction App({...props}) {\r\n  const history = useHistory();\r\n  const auth = useContext(AuthContext);\r\n  const rooms = useContext(RoomsContext);\r\n  let {current: view} = useRef();\r\n\r\n  if((/^\\/room\\/[a-zA-Z0-9]+/).test(history.location.pathname)) view = <Room container/>\r\n  if(history.location.pathname === '/'        ) view = <Lobby container/> \r\n  if(history.location.pathname === '/settings') view = <Wizard show={true} container/>\r\n  if((/^\\/room\\/[a-zA-Z0-9]+\\/chat$/).test(history.location.pathname)  ) view = <Redirect to=\"/\"/>\r\n  if((/^\\/room\\/[a-zA-Z0-9]+\\/users$/).test(history.location.pathname) ) view = <Redirect to=\"/\"/>\r\n\r\n  if(!auth?.isLogged)\r\n    return <div className=\"App\" children={<Login />}/>\r\n  else\r\n    return <>\r\n    <div className=\"App\">\r\n        \r\n      <Container fluid={view?.props?.container} id=\"content-wrapper\" > \r\n      {view}\r\n      </Container>\r\n\r\n      <Nav buttons={rooms.current?<StreamButtons/>:<CreateRoomModal/>}>\r\n          {rooms.current? <LeaveRoomModal/>\r\n                        : <Nav.Item><i className=\"bi bi-house\"/>Lobby</Nav.Item>}\r\n          <WizardModal/>\r\n          <UsersModal/>\r\n          <ChatModal/>\r\n      </Nav>\r\n \r\n    </div>\r\n    <style global jsx>{`\r\n      \r\n      html, body, .App{\r\n        overflow: hidden;\r\n        min-height:330px;\r\n      }\r\n\r\n      #content-wrapper{\r\n        height: 100%;\r\n        margin-bottom: 6rem;\r\n        margin-top: 3.5rem;\r\n        overflow-y: scroll;\r\n        overflow-x: hidden;\r\n        & .container-fluid{\r\n          margin:0 !important;\r\n        }\r\n      }\r\n\r\n      @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n          #content-wrapper{\r\n            margin-bottom: 1rem;\r\n            margin-top: 1rem;\r\n            margin-right:3rem;\r\n          }\r\n      }\r\n      @media only screen and (orientation: portrait){\r\n\r\n      }    \r\n    `}</style>\r\n  </>\r\n}\r\n\r\nexport default App;\r\n","import rehypeRaw from 'rehype-raw'\r\nimport remarkGfm from 'remark-gfm'\r\nimport remarkBreaks from 'remark-breaks'\r\nimport ReactMarkdown from 'react-markdown'\r\n\r\nexport default ({children,...props}) => {\r\n    return <ReactMarkdown children={children.replaceAll(\"  \",\"\")} remarkPlugins={[remarkGfm, remarkBreaks]} rehypePlugins={[rehypeRaw]} {...props}/>\r\n}","import * as BRA from 'lib_bra'\r\nimport toast from  'react-hot-toast'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport React, { createContext, useContext, useEffect, useState } from 'react'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\n\r\n\r\nexport const RoomsContext = createContext(); \r\n\r\nexport default ({children, ...props}) => {\r\n    const auth = useContext(AuthContext);\r\n    const history = useHistory();\r\n    const [ready, setReady] = useState(false); \r\n    let   [rooms, setRooms] = useState({}); \r\n    const [current, setCurrent] = useState(null);\r\n    \r\n    useEffect( ()=>{ \r\n        if(!auth.isLogged) return;\r\n\r\n        BRA.appClient.on('get_room_response',       onGetRoom);\r\n        BRA.appClient.on('get_rooms_response',      onGetRooms);\r\n        BRA.appClient.getRooms();\r\n        const interval = setInterval(() => {BRA.appClient.getRooms();} , 2000);\r\n    return ()=>{\r\n        BRA.appClient.off('get_room_response',  onGetRoom);\r\n        BRA.appClient.off('get_rooms_response', onGetRooms);\r\n\r\n        clearInterval(interval);\r\n    }}, [auth.isLogged]);\r\n\r\n    function createRoom(roomId){\r\n        return new Promise((resolve, reject)=>{\r\n            function onCreateRoom({status, description}){\r\n                BRA.appClient.off('create_room_response', onCreateRoom); \r\n                switch(status){\r\n                    case \"ok\":    \r\n                        toast.success(`Created room ${roomId}`); \r\n                        history.push(`/rooms/${roomId}`);\r\n                        resolve(arguments);\r\n                        break;\r\n                        \r\n                    case \"error\": \r\n                        const msg = `onCreateRoom: ${description}`\r\n                        toast.error(msg); \r\n                        reject(msg);\r\n                        break;\r\n        \r\n                    default: break;\r\n                }\r\n            }\r\n            BRA.appClient.on('create_room_response', onCreateRoom);\r\n            BRA.appClient.createRoom(roomId);\r\n        })\r\n    }\r\n\r\n    function joinRoom(roomId){\r\n        return new Promise((resolve, reject) => {\r\n\r\n            function onJoinRoom({status, description}){\r\n                BRA.appClient.off('join_room_response', onJoinRoom);\r\n                switch(status){\r\n                    case \"ok\":    \r\n                        setCurrent(rooms[roomId]);\r\n                        toast.success(`Joined room`); \r\n                        resolve(arguments);\r\n                        break;\r\n                        \r\n                    case \"error\": \r\n                        const msg = `onJoinRoom: ${description}`\r\n                        toast.error(msg); \r\n                        reject(msg);\r\n                        break;\r\n        \r\n                    default: break;\r\n                }\r\n            }\r\n            BRA.appClient.on('join_room_response', onJoinRoom);\r\n            BRA.appClient.joinRoom(roomId);\r\n        });\r\n    }\r\n\r\n    function leaveRoom(){\r\n        return new Promise((resolve, reject)=>{\r\n            function onLeaveRoom({status, description}){\r\n                BRA.appClient.off('leave_room_response', onLeaveRoom); \r\n                switch(status){\r\n                    case \"ok\":    \r\n                        history.push(`/`);\r\n                        setCurrent(null);\r\n                        toast.success(`Leaved room`); \r\n                        resolve(arguments);\r\n                        break;\r\n                        \r\n                    case \"error\": \r\n                        const msg = `onLeaveRoom: ${description}`;\r\n                        setCurrent(null);\r\n                        history.push(`/`);\r\n                        toast.error(msg); \r\n                        reject(msg);\r\n                        break;\r\n        \r\n                    default: break;\r\n                }\r\n            }\r\n            BRA.appClient.on('leave_room_response', onLeaveRoom);\r\n            BRA.appClient.leaveRoom();\r\n        })\r\n    }\r\n\r\n    function onGetRoom({ status, description, roomInfo }){\r\n        if(status === 'error')\r\n            return toast.error(`onGetRoom: ${description}`);\r\n        setRooms({...roomInfo, [roomInfo?.id]: roomInfo});\r\n    }\r\n\r\n    function onGetRooms({status, description, roomInfos}){\r\n        if(status === 'error')\r\n            return toast.error(`onGetRooms: ${description}`);\r\n        rooms = {...roomInfos}\r\n        setRooms(rooms);\r\n        setReady(true);        \r\n    }\r\n\r\n    const store = window.rooms = {\r\n        joinRoom,\r\n        leaveRoom,\r\n        createRoom,\r\n        getRoomInfo: (roomId) => rooms[roomId],\r\n        setCurrent,\r\n        ready,\r\n        current,\r\n        list: rooms,\r\n    }\r\n\r\n    return <RoomsContext.Provider value={store} children={children}/>\r\n}","import http from \"utils/http\"\r\nimport * as BRA from \"lib_bra\";\r\nimport cookies from '@h3r/cookies'\r\nimport toast from 'react-hot-toast'\r\nimport { useHistory, useParams  } from 'react-router-dom'\r\nimport { createContext, useEffect, useState, useRef } from 'react'\r\nimport { Spinner } from 'react-bootstrap'\r\n\r\nimport Dialog from 'partials/dialog.jsx'\r\nexport const AuthContext = createContext()\r\n\r\nexport default ({children, ...props}) => {\r\n    const history                       = useHistory();\r\n    const { current: action }           = useParams(null);\r\n    const [ isAdmin,     setAdmin     ] = useState(false);\r\n    const [ isLogged,    setLogged    ] = useState(false);\r\n    const [ isConnected, setConnected ] = useState({app:false, rtc:false});\r\n    const [ user,        setUser      ] = useState(null);\r\n    const [ avatar,      setAvatar    ] = useState(null);\r\n    let   {current: toast_app}          = useRef(null);\r\n    let   {current: toast_rtc}          = useRef(null);\r\n\r\n    const store = window.auth = {\r\n         user       \r\n        ,avatar     \r\n        ,isAdmin    \r\n        ,isConnected: isConnected.app && isConnected.rtc\r\n        ,isLogged\r\n        ,login\r\n        ,logout\r\n    }\r\n\r\n    async function login(email, password){\r\n        const toastId = toast.loading('Logging in...');\r\n        email = email.toLowerCase();\r\n        return http.post(`${process.env.REACT_APP_API_URL}/auth/basic`, { email, password })\r\n        .then(response => {\r\n            switch (response.status) {\r\n                case 404: toast.error(`Error ${response.error}: ${response.message}`, { id: toastId }); break;\r\n                default:  toast.success('Success', { id: toastId });\r\n                    BRA.appClient.login(response.access_token);\r\n                    return response.access_token;\r\n            }\r\n        })\r\n        .catch(err => toast.error(`Error catch: ${err}`, { id: toastId }));\r\n    }\r\n\r\n    async function logout(){\r\n        cookies.set(\"admire_app_email\",null,-1);\r\n        cookies.set(\"admire_app_token\",null,-1);\r\n        return await BRA.appClient.logout();\r\n    }\r\n\r\n    function onLogin({ status, userId, userType, description, roomInfo }) {\r\n        switch (status) {\r\n            case 'ok': toast.success(`Logged in as '${userId}'`);\r\n                setUser(userId);\r\n                setAdmin(userType ?? true);\r\n                setLogged(true);\r\n                BRA.rtcClient.register(userId);\r\n                if(roomInfo){\r\n                    return history.push(`/room/${roomInfo.id}`);\r\n                }\r\n                break;\r\n\r\n            case 'error': \r\n                toast.error(description); \r\n                cookies.set(\"admire_app_token\",null,-1);\r\n                break;\r\n            default: toast.warn(description);\r\n        }\r\n    }\r\n\r\n    function onLogOut(){\r\n        setLogged(false);\r\n        toast.success('Logged out');\r\n        BRA.rtcClient.unregister();\r\n    }\r\n\r\n    useEffect( ()=>{\r\n\r\n        function onUnload(){\r\n            window.removeEventListener('unload', onUnload);\r\n            BRA.rtcClient.disconnect();\r\n            BRA.appClient.disconnect(); \r\n        }\r\n        window.addEventListener('unload', onUnload);\r\n\r\n        let onAppConnect, onAppDisconnect, onRtcConnect, onRtcDisconnect;\r\n        BRA.appClient.on('client_connected',      onAppConnect      = () => { toast(\"App Connected\",    {id:toast_app, icon:'', duration:2000}); setConnected( v => ({...v, app:true })); });\r\n        BRA.rtcClient.on('client_connected',      onRtcConnect      = () => { toast(\"RTC Connected\",    {id:toast_rtc, icon:'', duration:2000}); setConnected( v => ({...v, rtc:true })); });\r\n        BRA.appClient.on('client_disconnected',   onAppDisconnect   = () => { toast(\"App Disconnected\", {id:toast_app, icon:'', duration:2000}); setConnected( v => ({...v, app:false})); });\r\n        BRA.rtcClient.on('client_disconnected',   onRtcDisconnect   = () => { toast(\"RTC Disconnected\", {id:toast_rtc, icon:'', duration:2000}); setConnected( v => ({...v, rtc:false})); });\r\n        BRA.appClient.on(\"login_response\",        onLogin);\r\n        BRA.appClient.on(\"logout_response\",       onLogOut);\r\n\r\n    return ()=>{\r\n        BRA.appClient.off('client_connected',     onAppConnect      );\r\n        BRA.appClient.off('client_disconnected',  onAppDisconnect   );\r\n        BRA.rtcClient.off('client_connected',     onRtcConnect      );\r\n        BRA.rtcClient.off('client_disconnected',  onRtcDisconnect   );\r\n        BRA.appClient.off(\"login_response\",       onLogin);\r\n        BRA.appClient.off(\"logout_response\",      onLogOut);\r\n\r\n        onUnload();\r\n    }\r\n    }, []);\r\n\r\n\r\n    useEffect( ()=>{\r\n        if(!isConnected.app){\r\n            toast_app = toast.loading(`Connecting lobby server`,{duration:Infinity}); //This may never disappear if no response is given from the server\r\n            BRA.appClient.connect(process.env.REACT_APP_APP_URL);\r\n        }\r\n    }, [isConnected.app])\r\n\r\n    useEffect( ()=>{\r\n        if(!isConnected.rtc){\r\n            toast_rtc = toast.loading(`Connecting rtc server`,{duration:Infinity}); //This may never disappear if no response is given from the server\r\n            BRA.rtcClient.connect(process.env.REACT_APP_RTC_URL);\r\n        }\r\n    }, [isConnected.rtc])\r\n\r\n    useEffect( ()=>{\r\n        if(isConnected.app && isConnected.rtc && !isLogged)\r\n        {\r\n            const token = cookies.get(\"admire_app_token\");\r\n            if(token)\r\n                BRA.appClient.login(token);\r\n        }\r\n    }, [isConnected.app && isConnected.rtc && !isLogged]);\r\n\r\n\r\n \r\n    return <AuthContext.Provider value={store}> \r\n        {/*<Dialog show={!isConnected.app || !isConnected.rtc} {...props} title=\"OOPS! Connection Lost!\">\r\n            <table>\r\n                <tr>\r\n                    <td><b>APP:</b> </td>\r\n                    <td>{isConnected.app?\"connected .\":<>{\"connecting... \"}<Spinner variant=\"primary\" animation=\"border\" size=\"sm\" /> </>}</td>\r\n                </tr>\r\n                <tr>\r\n                    <td><b>RTC:</b></td>\r\n                    <td>{isConnected.rtc?\"connected .\":<>{\"  connecting... \"}<Spinner variant=\"primary\" animation=\"border\" size=\"sm\" /> </>}</td>\r\n                </tr>\r\n            </table>\r\n        </Dialog>*/}\r\n\r\n        {children}\r\n    </AuthContext.Provider>\r\n}","var map = {\n\t\"./Devices.jsx\": [\n\t\t460,\n\t\t3\n\t],\n\t\"./p1.jsx\": [\n\t\t457,\n\t\t4\n\t],\n\t\"./p2.jsx\": [\n\t\t458,\n\t\t5\n\t],\n\t\"./p3.jsx\": [\n\t\t459,\n\t\t6\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 449;\nmodule.exports = webpackAsyncContext;","const reportWebVitals = (onPerfEntry) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\n\r\nimport Layout from 'components/layout'\r\nimport {ProgressBar} from 'react-bootstrap';\r\n\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n      <React.Suspense children={<Layout/>} fallback={<ProgressBar className=\"start-50\" animated now={100} />}/>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://cra.link/PWA\r\nserviceWorkerRegistration.register();\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","import * as BRA from \"lib_bra\"\r\nimport toast from 'react-hot-toast'\r\nimport { useState, useContext, useReducer, useEffect, createContext, useRef } from 'react'\r\n\r\n\r\nexport const MediaContext = createContext(); \r\nexport default ({children, ...props}) => {\r\n\r\n    let {current:init_evts}               = useRef(0);\r\n    const videoRef                        = useRef(null);\r\n    const [devices , setDevices]          = useState(null);\r\n    const [settings, setSettings ]        = useState(null);\r\n    const [resolutions, setResolutions ]  = useState(null);\r\n    const [localStream, setLocalStream ] = useReducer( (value, newvalue)=>{\r\n        if( videoRef && videoRef.current )\r\n            videoRef.current.srcObject = newvalue;\r\n        return newvalue;\r\n    }, BRA.dummyStream.getStream() );\r\n    \r\n    useEffect( ()=>{ \r\n        BRA.mediaAdapter.on(\"got_stream\",         onGotStream );\r\n        BRA.mediaAdapter.on('got_devices',        onGotDevices );\r\n        BRA.mediaAdapter.on(\"error_stream\",       onError);\r\n        BRA.mediaAdapter.on(\"error_devices\",      onError);\r\n        BRA.mediaAdapter.on(\"got_resolutions\",    onGotResolutions );\r\n        BRA.mediaAdapter.start();\r\n        getDevices();\r\n\r\n        function onUnload(){\r\n            BRA.mediaAdapter.off(\"got_stream\",        onGotStream );\r\n            BRA.mediaAdapter.off('got_devices',       onGotDevices );\r\n            BRA.mediaAdapter.off(\"error_stream\",      onError);\r\n            BRA.mediaAdapter.off(\"error_devices\",     onError);\r\n            BRA.mediaAdapter.off(\"got_resolutions\",   onGotResolutions );\r\n            window.removeEventListener('unload ', onUnload);\r\n        }\r\n        window.addEventListener('unload ',    onUnload);\r\n    return ()=>{\r\n        onUnload();\r\n    }}, []);\r\n\r\n    function getDevices(){\r\n        BRA.mediaAdapter.getDevices();\r\n    }\r\n\r\n    function onGotResolutions({resolutions, settings})\r\n    { \r\n        setSettings({...settings});\r\n        setResolutions(resolutions); \r\n    }\r\n    \r\n    function onGotDevices ({ audioDevices: audio, videoDevices: video, settings }) \r\n    { \r\n        setSettings({...settings});\r\n        setDevices({...devices, audio, video});\r\n    }\r\n\r\n    function onGotStream( {stream, settings})\r\n    { \r\n        setSettings({...settings});\r\n        setLocalStream(stream);\r\n    }\r\n\r\n    function onError({description}){\r\n        toast.error(\"Error:\", description);\r\n    }\r\n\r\n    function init(){\r\n        if( init_evts <= 0 ){\r\n            //start the thing\r\n            //BRA.mediaAdapter.start();\r\n            getDevices();\r\n        }\r\n        ++init_evts;\r\n    }\r\n\r\n    function stop(){\r\n        --init_evts;\r\n        if( init_evts <= 0 ){\r\n            //BRA.mediaAdapter.stop();\r\n            //stop the thing\r\n        }\r\n    }\r\n\r\n    function setVideo(device, resolution){\r\n        BRA.mediaAdapter.setVideo(device, resolution);\r\n    }\r\n    function setAudio(device){\r\n        BRA.mediaAdapter.setAudio(device);\r\n    }\r\n\r\n    const store = window.media = {\r\n        devices,\r\n        settings, \r\n        resolutions,\r\n        localStream,\r\n        init,\r\n        stop,\r\n        getDevices,\r\n        setVideo,\r\n        setAudio,\r\n    }\r\n\r\n    return <MediaContext.Provider value={store} children={children}/>\r\n}","import * as BRA from \"lib_bra\"\r\nimport toast from 'react-hot-toast'\r\nimport { useState, useContext, useEffect, createContext } from 'react'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\n\r\n\r\nexport const StreamContext = createContext(); \r\nexport default ({children, ...props}) => {\r\n    const auth                          = useContext(AuthContext);\r\n    const media                         = useContext(MediaContext);\r\n    const [streams, setStreams]         = useState({});\r\n    const [liveCalls, setLiveCalls]     = useState({});\r\n    const [localStream, setLocalStream] = useState(media.localStream);\r\n\r\n    useEffect( ()=>{ \r\n        BRA.rtcClient.on(BRA.RTCEvent.IncomingCall, onIncomingCall);\r\n        BRA.rtcClient.on(BRA.RTCEvent.CallOpened,   onCallOpened);\r\n        BRA.rtcClient.on(BRA.RTCEvent.CallClosed,   onCallClosed);\r\n        BRA.rtcClient.on(BRA.RTCEvent.UserHangup,   onUserHangup);\r\n    return ()=>{\r\n        BRA.rtcClient.off(BRA.RTCEvent.IncomingCall, onIncomingCall);\r\n        BRA.rtcClient.off(BRA.RTCEvent.CallOpened,   onCallOpened);\r\n        BRA.rtcClient.off(BRA.RTCEvent.CallClosed,   onCallClosed);\r\n        BRA.rtcClient.off(BRA.RTCEvent.UserHangup,   onUserHangup);\r\n    }}, []);\r\n\r\n    useEffect( ()=>{\r\n        for( const callId in BRA.rtcClient.getCalls() )\r\n        {\r\n            let call = BRA.rtcClient.getCall(callId);\r\n            let stream = media.localStream;\r\n            {\r\n                let track = stream.getVideoTracks()[0];\r\n                call.replaceLocalVideoTrack(track);\r\n            }\r\n            {\r\n                let track = stream.getAudioTracks()[0];\r\n                call.replaceLocalAudioTrack(track);\r\n            }\r\n        }\r\n        setLocalStream(media.localStream);\r\n    }, [media.localStream]);\r\n\r\n    function callUser(user){\r\n        return BRA.rtcClient.call(user, ({callId, status, description}) => {\r\n            if(status === 'error')\r\n                toast.error(`Call error: ${description}`);\r\n        });\r\n    }\r\n\r\n    function callAllUsers(roomInfo){\r\n        const users = [...roomInfo?.guests??[], roomInfo?.master].filter((v, k, a) => { return v && v !== auth.user });\r\n        for (let user of users){\r\n            if(!callUser(user))\r\n                toast.error(`call missed to ${user}`);\r\n        }\r\n    }\r\n\r\n    function callHangup(callId){\r\n        BRA.rtcClient.hangup(callId);\r\n    }\r\n\r\n    function callHangupAll(){\r\n        const calls = Object.keys(BRA.rtcClient.getCalls())\r\n        for (let callId of calls){\r\n            callHangup(callId);\r\n        }\r\n    }\r\n\r\n    function onIncomingCall({ callId, callerId }){\r\n        BRA.rtcClient.acceptCall(callId);\r\n    }\r\n\r\n    function onCallOpened({ call, stream }) {\r\n        const callId = call.callId;\r\n        setStreams({...streams, [callId]: stream});\r\n        const forwardingCallId = liveCalls[callId];   //Live call\r\n\r\n        if (forwardingCallId) {\r\n            const forward_stream = streams[forwardingCallId];\r\n            if (!forward_stream) {\r\n                callHangup(callId);\r\n                return toast.error(`Live Call Error: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);;\r\n            }\r\n            toast.success(`Live Call: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);\r\n            const videotrack = forward_stream.getVideoTracks()[0];\r\n            const audiotrack = forward_stream.getAudioTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n        }\r\n\r\n        //Regular call\r\n        else {\r\n            toast.success(`Incoming Call: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);\r\n            const videotrack = media.localStream.getVideoTracks()[0];\r\n            const audiotrack = media.localStream.getAudioTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n            //if(!selected)setSelected(callId);\r\n        }\r\n    }\r\n\r\n    function onCallClosed({ call }){\r\n        if (!call)\r\n            return console.error(\"No call\");\r\n\r\n        const callId = call.callId;\r\n        manageLiveCallClosed(callId);\r\n\r\n        delete streams[callId];\r\n        setStreams({...streams});\r\n        toast(`Call ${callId} closed`,{icon:\"\"});\r\n    }\r\n\r\n    function onUserHangup({ callId }){\r\n        if (!callId)\r\n            return console.error(\"No call\");\r\n\r\n        manageLiveCallClosed(callId);\r\n        delete streams[callId];\r\n        setStreams({...streams});\r\n\r\n        toast(`Call ${callId} hangup`,{icon:\"\"});\r\n    }\r\n\r\n    function manageLiveCallClosed(callId) {\r\n        let result = null;\r\n        for (const [mId, fId] of Object.entries(liveCalls)) {\r\n            if (callId !== mId && fId !== callId)\r\n                continue;\r\n\r\n            result = [mId, fId];\r\n            break;\r\n        }\r\n\r\n        if (result) {\r\n            const [mediaHubCallId, forwardedCallId] = result;\r\n            delete liveCalls[mediaHubCallId];\r\n            setLiveCalls(liveCalls);\r\n        }\r\n    }\r\n\r\n    function getUserId(callId){\r\n        let id = auth.user;\r\n        let call = BRA.rtcClient.getCalls()[callId];\r\n        if (callId !== \"local\" && call) {\r\n            let { calleeId, callerId } = call;\r\n            id = (calleeId === auth.user) ? callerId : calleeId;\r\n        }\r\n        return id;\r\n    }\r\n\r\n    //TODO:check this\r\n    function forwardCall(source, target) {\r\n        if (!target || !source)\r\n            return console.error(`source or target callId's are undefined`);\r\n        liveCalls[target] = source;\r\n        setLiveCalls({...liveCalls});\r\n    }\r\n\r\n    function getLiveCall(callId)\r\n    {\r\n        return Object.entries(liveCalls).find( v => v[1] === callId ) ?? [null,null];\r\n    }\r\n\r\n    const store = window.wrtc = {\r\n        callUser,\r\n        callAllUsers,\r\n        callHangup,\r\n        callHangupAll,\r\n        forwardCall,\r\n        getUserId,\r\n        getLiveCall,\r\n        streams: {...streams, local:localStream},\r\n    }\r\n\r\n    return <StreamContext.Provider value={store} children={children}/>\r\n}","export const RTCEvent =\r\n{\r\n\tClientConnected:        \"client_connected\",\r\n\tClientDisconnected:     \"client_disconnected\",\r\n    IncomingCall:           \"incoming_call\",\r\n    CallAccepted:           \"call_accepted\",\r\n    CallCanceled:           \"call_canceled\",\r\n    CallOpened:             \"call_opened\",\r\n    CallClosed:             \"call_closed\",\r\n    UserHangup:             \"user_hangup\"\r\n};\r\n\r\nexport function RTCClient( settings )\r\n{\r\n//#region Variables\r\n    let defaultSettings =\r\n    {\r\n        debug: false,\r\n        debugStyle: \"background: hsla(0, 0%, 13%, 1); color: hsla(74, 64%, 60%, 1)\",\r\n        pingPeriod: 5 * 1000,\r\n        defaultStream: new MediaStream()\r\n    };\r\n\r\n    settings = (typeof settings !== \"object\") ? { } : settings;\r\n    settings = Object.assign({ }, defaultSettings, settings);\r\n\r\n    let console = (settings.debug) ? window.console : null;\r\n\r\n    let responses = { };\r\n    let events = { };\r\n\r\n    let calls = { };\r\n    let socket = null;\r\n    let keepAliveTimeout = null;\r\n\r\n    let userId = null;\r\n    let rtcConfiguration = { iceServers: null };\r\n//#endregion\r\n\r\n//#region Methods\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Get the call identified by the specified ID.\r\n     */\r\n    let getCall = function( callId )\r\n    {\r\n        return (callId in calls) ? calls[callId] : null;\r\n    };\r\n \r\n    /**\r\n     * Get all the calls.\r\n     */\r\n    let getCalls = function()\r\n    {\r\n        return calls;\r\n    };\r\n\r\n    /**\r\n     * Connect to the server.\r\n     */\r\n    let connect = function( url )\r\n    {\r\n        if( socket && socket.readyState != WebSocket.CLOSED )\r\n        {\r\n            console?.error(\"WebSocket not closed\");\r\n            return;\r\n        }\r\n\r\n        socket = new WebSocket(url);\r\n\r\n        socket.onopen = onOpen;\r\n        socket.onmessage = onMessage;\r\n        socket.onclose = onClose;\r\n    };\r\n\r\n    /**\r\n     * Disconnect from the server.\r\n     */\r\n    let disconnect = function()\r\n    {\r\n        if( !socket || socket.readyState == WebSocket.OPEN )\r\n        {\r\n            console?.error(\"WebSocket not opened\");\r\n            return;\r\n        }\r\n\r\n        socket?.close();\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is opened.\r\n     */\r\n    let onOpen = function( event )\r\n    {\r\n        startKeepAlive();\r\n\r\n        console?.log(\"%c\" + RTCEvent.ClientConnected + \"%o\", settings.debugStyle, socket.url);\r\n\r\n        emit(RTCEvent.ClientConnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is closed.\r\n     */\r\n    let onClose = function( event )\r\n    {\r\n        userId = null;\r\n        rtcConfiguration.iceServers = null;\r\n\r\n        stopKeepAlive();\r\n\r\n        console?.log(\"%c\" + RTCEvent.ClientDisconnected + \"%o\", settings.debugStyle, socket.url);\r\n        emit(RTCEvent.ClientDisconnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when a message is received from the server.\r\n     */\r\n    let onMessage = function( msg )\r\n    {\r\n        let message = JSON.parse(msg.data);\r\n        if( message.id === \"pong\" )\r\n        {\r\n            return;\r\n        }\r\n\r\n        console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.id, msg.data);\r\n\r\n        // Check whether the message needs internal handling.\r\n        switch( message.id )\r\n        {\r\n            case \"register_response\":       handleRegisterResponse(message);        break;\r\n            case \"unregister_response\":     handleUnregisterResponse(message);      break;\r\n            case \"call_response\":           handleCallResponse(message);            break;\r\n            case \"incoming_call\":           handleIncomingCall(message);            break;\r\n            case \"call_accepted\":           handleCallAccepted(message);            break;\r\n            case \"call_canceled\":           handleCallCanceled(message);            break;\r\n            case \"remote_offer\":            handleRemoteOffer(message);             break;\r\n            case \"remote_answer\":           handleRemoteAnswer(message);            break;\r\n            case \"remote_candidate\":        handleRemoteCandidate(message);         break;\r\n            case \"user_hangup\":             handleUserHangup(message);              break;\r\n        }\r\n\r\n        // Check whether the message has a response listener.\r\n        if( message.uuid in responses )\r\n        {\r\n            let response = responses[message.uuid];\r\n            delete responses[message.uuid];\r\n            delete message.uuid;\r\n            response(message);\r\n        }\r\n\r\n        // Check whether the message has an event.\r\n        emit(message.id, message);\r\n    };\r\n\r\n    /**\r\n     * Send a message to the server.\r\n     */\r\n    let sendMessage = function( message, response )\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Generate a UUID.\r\n        message.uuid = uuid();\r\n\r\n        // Add the response listener.\r\n        if( response instanceof Function )\r\n        {\r\n            responses[message.uuid] = response;\r\n        }\r\n\r\n        // Send the message.\r\n        let msg = JSON.stringify(message);\r\n        socket.send(msg);\r\n        if( message.id !== \"ping\" )\r\n        {\r\n            console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.id, msg);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start a keep alive timeout.\r\n     */\r\n    let startKeepAlive = function()\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            console?.error(\"WebSocket not opened\");\r\n            return false;\r\n        }\r\n\r\n        ping();\r\n\r\n        keepAliveTimeout = window.setTimeout(startKeepAlive, settings.pingPeriod);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Stop the keep alive timeout.\r\n     */\r\n    let stopKeepAlive = function()\r\n    {\r\n        window.clearTimeout(keepAliveTimeout);\r\n    };\r\n \r\n    /**\r\n     * Send a ping to the server.\r\n     */\r\n    let ping = function()\r\n    {\r\n        let message =\r\n        {\r\n            id: \"ping\"\r\n        };\r\n        return sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Register to the server.\r\n     */\r\n    let register = function( username, response )\r\n    {\r\n        if( userId )\r\n        {\r\n            console?.error(\"Client already registered\");\r\n            return false;\r\n        }\r\n\r\n        let message =\r\n        {\r\n            id: \"register\",\r\n            userId: username\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Unregister from the server.\r\n     */\r\n    let unregister = function( response )\r\n    {\r\n        if( !userId )\r\n        {\r\n            console?.error(\"Client not registered\");\r\n            return false;\r\n        }\r\n\r\n        hangup();\r\n\r\n        let message =\r\n        {\r\n            id: \"unregister\",\r\n            userId: userId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Call a user.\r\n     */\r\n    let call = function( calleeId, response )\r\n    {\r\n        if( userId === calleeId )\r\n        {\r\n            console?.error(\"Invalid user id \" + calleeId);\r\n            return false;\r\n        }\r\n\r\n        let message =\r\n        {\r\n            id: \"call\",\r\n            callerId: userId,\r\n            calleeId: calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Close a call.\r\n     */\r\n    let closeCall = function( callId )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let call = calls[callId];\r\n        call.close();\r\n        delete(calls[callId]);\r\n\r\n        emit(RTCEvent.CallClosed, { call: call });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Accept a call.\r\n     */\r\n    let acceptCall = function( callId, response )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            console?.error(\"Call \" + callId + \" not found\");\r\n            return false;\r\n        }\r\n\r\n        let call = calls[callId];\r\n\r\n        let message =\r\n        {\r\n            id: \"accept_call\",\r\n            callId: call.callId,\r\n            callerId: call.callerId,\r\n            calleeId: call.calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Cancel a call.\r\n     */\r\n    let cancelCall = function( callId, response )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            console?.error(\"Call \" + callId + \" not found\");\r\n            return false;\r\n        }\r\n\r\n        // Delete the call.\r\n        let call = calls[callId];\r\n        delete calls[callId];\r\n\r\n        let message =\r\n        {\r\n            id: \"cancel_call\",\r\n            callId: call.callId,\r\n            callerId: call.callerId,\r\n            calleeId: call.calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Hang up a call. If call ID is undefined then all calls are hang up.\r\n     */\r\n    let hangup = function( callId, response )\r\n    {\r\n        if( callId ) // Close the call.\r\n        {\r\n            if( !closeCall(callId) )\r\n            {\r\n                return false;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"hangup\",\r\n                callId: callId\r\n            };\r\n            return sendMessage(message, response);\r\n        }\r\n        else // Close all the calls.\r\n        {\r\n            for( let callId in calls )\r\n            {\r\n                if( !closeCall(callId) )\r\n                {\r\n                    continue;\r\n                }\r\n\r\n                let message =\r\n                {\r\n                    id: \"hangup\",\r\n                    callId: callId\r\n                };\r\n                sendMessage(message);\r\n            }\r\n\r\n            calls = { };\r\n\r\n            return true;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier.\r\n     * Reference: RFC 4122 https://www.ietf.org/rfc/rfc4122.txt\r\n     */\r\n    let uuid = function()\r\n    {\r\n        return uuidv4();\r\n    };\r\n \r\n    /**\r\n     * Generate a universally unique identifier v4.\r\n     * Reference: https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\r\n     */\r\n    let uuidv4 = function()\r\n    {\r\n        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\r\n        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\r\n        );\r\n    };\r\n//#endregion\r\n\r\n//#region EventHandlers\r\n    /**\r\n     * Register response event handler.\r\n     */\r\n    let handleRegisterResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            userId = event.userId;\r\n            rtcConfiguration.iceServers = JSON.parse(event.iceServers);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Unregister response event handler.\r\n     */\r\n    let handleUnregisterResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            userId = null;\r\n            rtcConfiguration.iceServers = null;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Call response event handler.\r\n     */\r\n    let handleCallResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            // Create the call.\r\n            let call = new RTCCall(event.callId, event.callerId, event.calleeId);\r\n            calls[call.callId] = call;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Incoming call event handler.\r\n     */\r\n    let handleIncomingCall = function( event )\r\n    {\r\n        // Create the call.\r\n        let call = new RTCCall(event.callId, event.callerId, event.calleeId);\r\n        calls[event.callId] = call;\r\n    };\r\n\r\n    /**\r\n     * Call accepted event handler.\r\n     */\r\n    let handleCallAccepted = function( event )\r\n    {\r\n        // Create the peer connection.\r\n        let peerConnection = new RTCPeerConnection(rtcConfiguration);\r\n        let call = calls[event.callId];\r\n        call.bind(peerConnection, true);\r\n\r\n        // Handle the peer connection lifecycle.\r\n        peerConnection.oniceconnectionstatechange = function( other )\r\n        {\r\n            handleIceConnectionStateChange(call);\r\n        }\r\n\r\n        // Generate candidates.\r\n        peerConnection.onicecandidate = function( other )\r\n        {\r\n            if( !other.candidate || other.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n            {\r\n                return;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"candidate\",\r\n                callId: event.callId,\r\n                callerId: event.callerId,\r\n                calleeId: event.calleeId,\r\n                candidate: JSON.stringify(other.candidate)\r\n            };\r\n            sendMessage(message);\r\n        };\r\n\r\n        peerConnection.onnegotiationneeded = function( other )\r\n        {\r\n            // Generate offer.\r\n            peerConnection.createOffer().then(function( sdp )\r\n            {\r\n                // Set caller local description.\r\n                peerConnection.setLocalDescription(sdp);\r\n\r\n                let message =\r\n                {\r\n                    id: \"offer\",\r\n                    callId: event.callId,\r\n                    callerId: event.callerId,\r\n                    calleeId: event.calleeId,\r\n                    offer: JSON.stringify(sdp)\r\n                };\r\n                sendMessage(message);\r\n            });\r\n        };\r\n\r\n        // Add the tracks. This action triggers the ICE negotiation process.\r\n        let tracks = settings.defaultStream.getTracks();\r\n        tracks.forEach(track => peerConnection.addTrack(track));\r\n\r\n        // Create a default data channel to avoid renegotiation.\r\n        peerConnection.createDataChannel(\"default\");\r\n    };\r\n\r\n    /**\r\n     * Call canceled event handler.\r\n     */\r\n    let handleCallCanceled = function( event )\r\n    {\r\n        closeCall(event.callId);\r\n    };\r\n\r\n    /**\r\n     * Remote offer event handler.\r\n     */\r\n    let handleRemoteOffer = function( event )\r\n    {\r\n        // Create the peer connection.\r\n        let peerConnection = new RTCPeerConnection(rtcConfiguration);\r\n        let call = calls[event.callId];\r\n        call.bind(peerConnection, false);\r\n\r\n        // Handle the peer connection lifecycle.\r\n        peerConnection.oniceconnectionstatechange = function( other )\r\n        {\r\n            handleIceConnectionStateChange(call);\r\n        }\r\n\r\n        // Set the callee remote description.\r\n        peerConnection.setRemoteDescription(JSON.parse(event.offer));\r\n\r\n        // Gather the pending candidates.\r\n        call.gatherPendingCandidates();\r\n\r\n        // Generate the candidates.\r\n        peerConnection.onicecandidate = function( other )\r\n        {\r\n            if( !other.candidate || other.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n            {\r\n                return;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"candidate\",\r\n                callId: event.callId,\r\n                callerId: event.callerId,\r\n                calleeId: event.calleeId,\r\n                candidate: JSON.stringify(other.candidate)\r\n            };\r\n            sendMessage(message);\r\n        };\r\n\r\n        // Add the tracks.\r\n        let tracks = settings.defaultStream.getTracks();\r\n        tracks.forEach(track => peerConnection.addTrack(track));\r\n\r\n        // Create the answer.\r\n        window.setTimeout(function()\r\n        {\r\n            peerConnection.createAnswer().then(function( sdp )\r\n            {\r\n                // Set the callee local description.\r\n                peerConnection.setLocalDescription(sdp);\r\n\r\n                let message =\r\n                {\r\n                    id: \"answer\",\r\n                    callId: event.callId,\r\n                    callerId: event.callerId,\r\n                    calleeId: event.calleeId,\r\n                    answer: JSON.stringify(sdp)\r\n                };\r\n                sendMessage(message);\r\n            });\r\n        }, 500);\r\n    };\r\n\r\n    /**\r\n     * Remote answer event handler.\r\n     */\r\n    let handleRemoteAnswer = function( event )\r\n    {\r\n        if( event.callId in calls )\r\n        {\r\n            let answer = JSON.parse(event.answer);\r\n\r\n            // Set the caller remote description.\r\n            calls[event.callId].setRemoteDescription(answer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Remote candidate event handler.\r\n     */\r\n    let handleRemoteCandidate = function( event )\r\n    {\r\n        let candidate = JSON.parse(event.candidate);\r\n        if( !candidate || !candidate.candidate || candidate.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n        {\r\n            return;\r\n        }\r\n\r\n        if( event.callId in calls )\r\n        {\r\n            let call = calls[event.callId];\r\n            call.addCandidate(candidate);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * User hangup event handler.\r\n     */\r\n    let handleUserHangup = function( event )\r\n    {\r\n        closeCall(event.callId);\r\n    };\r\n\r\n    /**\r\n     * ICE connection state change event handler.\r\n     */\r\n    let handleIceConnectionStateChange = async function( call )\r\n    {\r\n        let state = call.getState();\r\n        console?.log(\"%c\" + \"Connection State\" + \"%o%o\", settings.debugStyle, call.callId, state);\r\n\r\n        switch( state )\r\n        {\r\n            case \"failed\":\r\n            case \"disconnected\":\r\n            case \"closed\":\r\n            {\r\n                hangup(call.callId);\r\n                break;\r\n            }\r\n            case \"new\":\r\n            case \"checking\":\r\n            case \"completed\":\r\n            {\r\n                break;\r\n            }\r\n            case \"connected\":\r\n            {\r\n                let stream = call.getRemoteStream();\r\n                console?.log(\"%c\" + RTCEvent.CallOpened + \"%o%o\", settings.debugStyle, call.callId, stream);\r\n                emit(RTCEvent.CallOpened, { call: call, stream: stream });\r\n                break;\r\n            }\r\n        }\r\n    };\r\n//#endregion\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        getCall,\r\n        getCalls,\r\n        connect,\r\n        disconnect,\r\n        register,\r\n        unregister,\r\n        call,\r\n        acceptCall,\r\n        cancelCall,\r\n        hangup\r\n    };\r\n}\r\n\r\nexport function RTCCall( callId, callerId, calleeId )\r\n{\r\n//#region Variables\r\n    let connection = null;\r\n    let candidates = [];\r\n    let channels = { };\r\n    let initiator = false;\r\n//#endregion\r\n\r\n//#region Methods\r\n    /**\r\n     * Bind the call to a peer connection.\r\n     */\r\n    let bind = function( peerConnection, isInitiator )\r\n    {\r\n        if( !(peerConnection instanceof RTCPeerConnection) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection = peerConnection;\r\n        initiator = isInitiator;\r\n\r\n        // Handle the data channel event internally to track the data channels lifecycle.\r\n        connection.addEventListener(\"datachannel\", function( event )\r\n        {\r\n            channels[event.channel.label] = event.channel;\r\n\r\n            // Handle the close event.\r\n            event.channel.addEventListener(\"onclose\", function( event )\r\n            {\r\n                delete channels[event.channel.label];\r\n            });\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Close the call.\r\n     */\r\n    let close = function()\r\n    {\r\n        connection?.close();\r\n    };\r\n\r\n    /**\r\n     * Return whether the user is the initiator.\r\n     */\r\n    let isInitiator = function()\r\n    {\r\n        return initiator;\r\n    };\r\n\r\n    /**\r\n     * Get the call state.\r\n     */\r\n    let getState = function()\r\n    {\r\n        return (connection) ? connection.iceConnectionState : \"closed\";\r\n    };\r\n\r\n    /**\r\n     * Get the call stats.\r\n     */\r\n    let getStats = async function()\r\n    {\r\n        if( !connection )\r\n        {\r\n            return;\r\n        }\r\n\r\n        let callStats = { callId: callId, callerId: callerId, calleeId: calleeId };\r\n\r\n        return await connection.getStats(null).then(function( stats )\r\n        {\r\n            // Get the stats of the succeeded candidate pair.\r\n            let pairStats = null;\r\n            stats.forEach(report =>\r\n            {\r\n                //console.log(report);\r\n                if( report.type === \"candidate-pair\" && (report.selected === true || report.state === \"succeeded\") )\r\n                {\r\n                    pairStats = report;\r\n                }\r\n            });\r\n\r\n            // Get the stats of the local and remote candidates.\r\n            if( pairStats )\r\n            {\r\n                stats.forEach(report =>\r\n                {\r\n                    if( report.id === pairStats.localCandidateId )\r\n                    {\r\n                        callStats.localType = report.candidateType;\r\n                        callStats.localAddress = report.address ?? report.ip;\r\n                        callStats.localPort = report.port;\r\n                        callStats.localProtocol = report.protocol;\r\n                    }\r\n                    if( report.id === pairStats.remoteCandidateId )\r\n                    {\r\n                        callStats.remoteType = report.candidateType;\r\n                        callStats.remoteAddress = report.address ?? report.ip;\r\n                        callStats.remotePort = report.port;\r\n                        callStats.remoteProtocol = report.protocol;\r\n                    }\r\n                });\r\n            }\r\n\r\n            return Promise.resolve(callStats);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Add a candidate or save it for gathering.\r\n     */\r\n    let addCandidate = function( candidate )\r\n    {\r\n        if( !connection )\r\n        {\r\n            candidates.push(candidate);\r\n        }\r\n        else\r\n        {\r\n            connection.addIceCandidate(candidate);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Gather the pending candidates.\r\n     */\r\n    let gatherPendingCandidates = function()\r\n    {\r\n        if( candidates.length > 0 )\r\n        {\r\n            candidates.forEach(candidate => connection.addIceCandidate(candidate));\r\n            candidates = [];\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set the remote session description.\r\n     */\r\n    let setRemoteDescription = function( description )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection.setRemoteDescription(description);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * [NYI] Set the stream's bandwidth.\r\n     * References:\r\n     * https://webrtchacks.com/limit-webrtc-bandwidth-sdp/\r\n     * https://stackoverflow.com/questions/57653899/how-to-increase-the-bitrate-of-webrtc\r\n     */\r\n    let setBandwidth = function( bandwidth )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let senders = connection.getSenders();\r\n        if( !senders )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            let parameters = sender.getParameters();\r\n            if( !parameters.encodings )\r\n            {\r\n                parameters.encodings = [{ }];\r\n            }\r\n\r\n            parameters.encodings[0].maxBitrate = bandwidth * 1000;\r\n\r\n            sender.setParameters(parameters);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Get the remote audio track specified by index.\r\n     */\r\n    let getRemoteAudioTrack = function ( index = 0 )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track.kind === \"audio\" )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < tracks.length )\r\n        {\r\n            return tracks[index];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Get the remote video track specified by index.\r\n     */\r\n    let getRemoteVideoTrack = function ( index = 0 )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track.kind === \"video\" )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < tracks.length )\r\n        {\r\n            return tracks[index];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Get the remote stream of the peer connection composed by all the audio and video tracks.\r\n     */\r\n    let getRemoteStream = function()\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( tracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let stream = new MediaStream();\r\n        for( let i = 0; i < tracks.length; i++ )\r\n        {\r\n            let track = tracks[i];\r\n            stream.addTrack(track);\r\n        }\r\n\r\n        return stream;\r\n    };\r\n\r\n    /**\r\n     * Replace the local audio track specified by index.\r\n     */\r\n    let replaceLocalAudioTrack = function( track, index = 0 )\r\n    {\r\n        if( !connection || !track )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let audioSenders = [];\r\n        let senders = connection.getSenders();\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            if( sender.track && sender.track.kind === \"audio\" )\r\n            {\r\n                audioSenders.push(sender);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < audioSenders.length )\r\n        {\r\n            audioSenders[index].replaceTrack(track);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Replace the local video track specified by index.\r\n     */\r\n    let replaceLocalVideoTrack = function( track, index = 0 )\r\n    {\r\n        if( !connection || !track )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let videoSenders = [];\r\n        let senders = connection.getSenders();\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            if( sender.track && sender.track.kind === \"video\" )\r\n            {\r\n                videoSenders.push(sender);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < videoSenders.length )\r\n        {\r\n            videoSenders[index].replaceTrack(track);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n//#endregion\r\n\r\n//#region DataChannel\r\n    /**\r\n     * Open a data channel.\r\n     */\r\n    let openChannel = function( label )\r\n    {\r\n        if( !connection || label in channels )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = connection.createDataChannel(label);\r\n        channels[label] = channel;\r\n\r\n        // Handle the close event.\r\n        channel.addEventListener(\"onclose\", function( event )\r\n        {\r\n            delete channels[channel.label];\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Close a data channel.\r\n     */\r\n    let closeChannel = function( label )\r\n    {\r\n        if( !connection || !(label in channels) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.close();\r\n        delete channels[label];\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback for the data channel event.\r\n     */\r\n    let onDataChannel = function( callback )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection.addEventListener(\"datachannel\", callback);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel open event.\r\n     */\r\n    let onChannelOpen = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onopen = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel close event.\r\n     */\r\n    let onChannelClose = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.addEventListener(\"onclose\", callback);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel error event.\r\n     */\r\n    let onChannelError = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onerror = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel message event.\r\n     */\r\n    let onChannelMessage = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onmessage = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Send data through an opened channel.\r\n     */\r\n    let sendData = function( label, data )\r\n    {\r\n        if( !connection || !(label in channels) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        if( channel.readyState !== \"open\" )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        channel.send(data);\r\n\r\n        return true;\r\n    };\r\n//#endregion\r\n\r\n    return {\r\n        get callId() { return callId; },\r\n        get callerId() { return callerId; },\r\n        get calleeId() { return calleeId; },\r\n        bind,\r\n        close,\r\n        isInitiator,\r\n        getState,\r\n        getStats,\r\n        addCandidate,\r\n        gatherPendingCandidates,\r\n        setRemoteDescription,\r\n        setBandwidth,\r\n        getRemoteAudioTrack,\r\n        getRemoteVideoTrack,\r\n        getRemoteStream,\r\n        replaceLocalAudioTrack,\r\n        replaceLocalVideoTrack,\r\n        openChannel,\r\n        closeChannel,\r\n        onDataChannel,\r\n        onChannelOpen,\r\n        onChannelClose,\r\n        onChannelError,\r\n        onChannelMessage,\r\n        sendData\r\n    };\r\n}","// eslint-disable\r\n\r\n//import AdapterJS from 'adapterjs';\r\nimport { RTCEvent, RTCClient }    from \"./rtcClient.js\";      // eslint-disable-line\r\nimport { LobbyClient }  from './lobbyClient.js';      // eslint-disable-line\r\nimport { MediaAdapter } from \"./mediaAdapter.js\";   // eslint-disable-line\r\nimport { DummyStream }  from \"./dummyStream.js\";\r\n\r\nlet appClient    = window.appClient    = new LobbyClient(),\r\n    mediaAdapter = window.mediaAdapter = new MediaAdapter(),\r\n    dummyStream  = window.dummyStream  = new DummyStream(),\r\n    rtcClient    = window.rtcClient    = new RTCClient({ debug: true, defaultStream: dummyStream.getStream() });\r\n\r\n    appClient.DEBUG = false;\r\n    rtcClient.DEBUG = false;\r\n    mediaAdapter.DEBUG = false;\r\n\r\nexport {\r\n   RTCEvent,\r\n   rtcClient, \r\n   appClient,\r\n   mediaAdapter,\r\n   dummyStream\r\n}","export function LobbyClient( settings )\r\n{\r\n//#region PRIVATE\r\n\r\n    let _defaultSettings =\r\n    {\r\n        // Debug messages to console?\r\n        debug: false,\r\n\r\n        // Style used to debug messages.\r\n        debugStyle: \"background: hsla(0, 0%, 13%, 1); color: hsla(180, 89%, 45%, 1)\",\r\n\r\n        // Period to send ping messages in ms.\r\n        pingPeriod: 5 * 1000\r\n    };\r\n\r\n    settings = (typeof settings !== \"object\") ? { } : settings;\r\n    settings = Object.assign(_defaultSettings, settings);\r\n\r\n    let console = (settings.debug) ? window.console : null;\r\n\r\n    let _events = { };\r\n    let _token = null;\r\n    let _socket = null;\r\n    let _keepAliveTimeout = null;\r\n\r\n    let _userId = null;\r\n    let _roomId = null;\r\n    let _channels = { };\r\n\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     * @param {String} event - The event name.\r\n     * @param {Function} listener - The function to add.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( typeof _events[event] !== \"object\" )\r\n        {\r\n            _events[event] = [];\r\n        }\r\n\r\n        _events[event].push(listener);\r\n    };\r\n\r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     * @param {String} event - The event name.\r\n     * @param {Function} listener - The previously added function.\r\n     */\r\n    let off = function( event, listener )\r\n    {   \r\n        if( typeof _events[event] === \"object\" )\r\n        {\r\n            let index = _events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                _events[event].splice(index, 1);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Emit the specified event.\r\n     * @param {String} event - The event name.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof _events[event] === \"object\" )\r\n        {\r\n            let listeners = _events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Connect to the server.\r\n     * @param {String} url - The URL of the server.\r\n     */\r\n    let connect = function( url )\r\n    {\r\n        _socket = new WebSocket(url);\r\n\r\n        _socket.onopen = onOpen;\r\n        _socket.onmessage = onMessage;\r\n        _socket.onclose = onClose;\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is opened.\r\n     * @param {EventListener} event - The dispatched event.\r\n     */\r\n    let onOpen = function( event )\r\n    {\r\n        // Start the keep alive routine.\r\n        keepAlive();\r\n\r\n        console?.log(\"%cclient_connected%o\", settings.debugStyle, _socket.url);\r\n\r\n        emit(\"client_connected\", { url: _socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when a message is received from the server.\r\n     * @param {EventListener} msg - The message received.\r\n     */\r\n    let onMessage = function( msg )\r\n    {\r\n        let message = JSON.parse(msg.data);\r\n\r\n        // Check the message.\r\n        if( message.id in HANDLERS )\r\n        {\r\n            if( HANDLERS[message.id] === false )\r\n            {\r\n                return;\r\n            }\r\n\r\n            console?.log(\"%c%s%o\", settings.debugStyle, message.id, msg.data);\r\n\r\n            if( HANDLERS[message.id] instanceof Function )\r\n            {\r\n                HANDLERS[message.id](message);\r\n            }\r\n\r\n            emit(message.id, message);\r\n        }\r\n        else\r\n        {\r\n            console?.log(\"%cunknown_message%o\", settings.debugStyle, msg.data);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Send a message to the server.\r\n     * @param {Object} message - The message to send.\r\n     */\r\n    let sendMessage = function( message )\r\n    {\r\n        let msg = JSON.stringify(message);\r\n\r\n        // Log all messages except pings.\r\n        if( message.id !== \"ping\" )\r\n        {\r\n            console?.log(\" %c%s%o\", settings.debugStyle, message.id, msg);\r\n        }\r\n\r\n        _socket.send(msg);\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is closed.\r\n     * @param {EventListener} event - The dispatched event.\r\n     */\r\n    let onClose = function( event )\r\n    {\r\n        // Stop the keep alive routine.\r\n        window.clearTimeout(_keepAliveTimeout);\r\n\r\n        console?.log(\"%cclient_disconnected%o\", settings.debugStyle, _socket.url);\r\n\r\n        emit(\"client_disconnected\", { url: _socket.url });\r\n    };\r\n \r\n    /**\r\n     * Disconnect from the server.\r\n     */\r\n    let disconnect = function()\r\n    {\r\n        _socket?.close();\r\n    };\r\n\r\n    /**\r\n     * Start a keep alive routine.\r\n     */\r\n    let keepAlive = function()\r\n    {\r\n        if( !_socket )\r\n        {\r\n            console?.error(\"Websocket is null\");\r\n            return;\r\n        }\r\n\r\n        // Check whether the connection is open and ready to communicate.\r\n        if( _socket.readyState !== 1 )\r\n        {\r\n            console?.error(\"Connection not open, ready state \" + _socket.readyState);\r\n            return;\r\n        }\r\n\r\n        ping();\r\n\r\n        _keepAliveTimeout = window.setTimeout(keepAlive, settings.pingPeriod);\r\n    };\r\n\r\n    /**\r\n     * Send a ping to the server.\r\n     */\r\n    let ping = function()\r\n    {\r\n        let message = { id: \"ping\" };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Login to the server.\r\n     * @param {String} token - The authentication token.\r\n     */\r\n    let login = function( token )\r\n    {\r\n        _token = token;\r\n\r\n        let message = { id: \"login\", token: _token };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Logout from the server.\r\n     */\r\n    let logout = function()\r\n    {\r\n        let message = { id: \"logout\", token: _token };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Get the current room information.\r\n     */\r\n    let getRoom = function()\r\n    {\r\n        let message = { id: \"get_room\", token: _token };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Get the list of room informations.\r\n     */\r\n    let getRooms = function()\r\n    {\r\n        let message = { id: \"get_rooms\", token: _token };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Create a room.\r\n     * @param {String} roomId - The room ID.\r\n     */\r\n    let createRoom = function( roomId )\r\n    {\r\n        if( !validateId(roomId) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let message = { id: \"create_room\", token: _token, roomId: roomId };\r\n        sendMessage(message);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Join a room.\r\n     * @param {String} roomId - The room ID.\r\n     */\r\n    let joinRoom = function( roomId )\r\n    {\r\n        let message = { id: \"join_room\", token: _token, roomId: roomId };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Leave the room.\r\n     */\r\n    let leaveRoom = function()\r\n    {\r\n        let message = { id: \"leave_room\", token: _token };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Enable a user to the channel.\r\n     * @param {String} channelId - The channel ID.\r\n     */\r\n    let enableChannel = function( userId, channelId )\r\n    {\r\n        let message = { id: \"enable_channel\", token: _token, userId: userId, channelId: channelId };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Disable a user from the channel.\r\n     * @param {String} channelId - The channel ID.\r\n     */\r\n    let disableChannel = function( userId, channelId )\r\n    {\r\n        let message = { id: \"disable_channel\", token: _token, userId: userId, channelId: channelId };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Join a channel.\r\n     * @param {String} channelId - The channel ID.\r\n     */\r\n    let joinChannel = function( channelId )\r\n    {\r\n        let message = { id: \"join_channel\", token: _token, channelId: channelId };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Leave a channel.\r\n     * @param {String} channelId - The channel ID.\r\n     */\r\n    let leaveChannel = function( channelId )\r\n    {\r\n        let message = { id: \"leave_channel\", token: _token, channelId: channelId };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Forward a message to other user.\r\n     * @param {String} userId - The user ID.\r\n     * @param {Object} msg - The message to forward.\r\n     */\r\n    let forwardMessage = function( userId, msg )\r\n    {\r\n        if( _userId === userId )\r\n        {\r\n            return;\r\n        }\r\n\r\n        let message = { id: \"forward_message\", token: _token, userId: userId, msg: msg };\r\n        sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Returns whether or not the client is disconnected.\r\n     * @returns Whether or not the client is disconnected.\r\n     */\r\n    let isDisconnected = function()\r\n    {\r\n        return !_socket || _socket.readyState === \"3\"; // Closed.\r\n    };\r\n\r\n    /**\r\n     * Returns whether or not the user is logged in this client.\r\n     * @param {String} userId - The user ID.\r\n     * @return Whether or not the user is logged in this client.\r\n     */\r\n    let isLogged = function( userId )\r\n    {\r\n        if( _userId )\r\n        {\r\n            return _userId === userId;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Returns whether or not the user is joined to the channel.\r\n     * @param {String} channelId - The channel ID.\r\n     * @return Whether or not the user is joined to the channel.\r\n     */\r\n    let isInChannel = function( channelId )\r\n    {\r\n        return channelId in _channels;\r\n    };\r\n\r\n    /**\r\n     * Validates the specified ID following a regular expression.\r\n     * @param {String} str - The ID to validate.\r\n     * @return Whether or not the ID is valid.\r\n     */\r\n    let validateId = function( id )\r\n    {\r\n        if( !id || id === \"\" )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let regex = new RegExp(\"^([a-zA-Z])(([a-zA-Z0-9]+)([.\\-_]?))*([a-zA-Z0-9])$\");\r\n        return regex.test(id);\r\n    };\r\n\r\n    /**\r\n     * Login response event handler.\r\n     * @param {Object} event - The event object.\r\n     */\r\n    let onLoginResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            _userId = event.userId;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Logout response event handler.\r\n     * @param {Object} event - The event object.\r\n     */\r\n    let onLogoutResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            _token = null;\r\n            _userId = null;\r\n            _roomId = null;\r\n            _channels = { };\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Create room response event handler.\r\n     * @param {Object} event - The event object.\r\n     */\r\n    let onCreateRoomResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            _roomId = event.roomId;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Join room response event handler.\r\n     * @param {Object} event - The event object.\r\n     */\r\n    let onJoinRoomResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            _roomId = event.roomId;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Leave room response event handler.\r\n     * @param {Object} event - The event object.\r\n     */\r\n    let onLeaveRoomResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            _roomId = null;\r\n            _channels = { };\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Channel disabled event handler.\r\n     * @param {Object} event - The event object.\r\n     */\r\n    let onChannelDisabled = function( event )\r\n    {\r\n        if( event.userId !== _userId )\r\n        {\r\n            return;\r\n        }\r\n\r\n        if( event.channelId in _channels )\r\n        {\r\n            delete _channels[event.channelId];\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Join channel response event handler.\r\n     * @param {Object} event - The event object.\r\n     */\r\n    let onJoinChannelResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            _channels[event.channelId] = true;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Leave channel response event handler.\r\n     * @param {Object} event - The event object.\r\n     */\r\n    let onLeaveChannelResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            delete _channels[event.channelId];\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Handlers used to listen messages from the server.\r\n     *      function - The message is valid, emitted and handled.\r\n     *      true - The message is valid, emitted and not handled.\r\n     *      false - The message is valid, not emitted and not handled.\r\n     *      undefined - The message is not valid.\r\n     */\r\n    const HANDLERS =\r\n    {\r\n        \"pong\":                         false,\r\n        \"login_response\":               onLoginResponse,\r\n        \"logout_response\":              onLogoutResponse,\r\n        \"get_room_response\":            true,\r\n        \"get_rooms_response\":           true,\r\n        \"create_room_response\":         onCreateRoomResponse,\r\n        \"room_created\":                 true,\r\n        \"join_room_response\":           onJoinRoomResponse,\r\n        \"guest_joined_room\":            true,\r\n        \"user_joined_room\":             true,\r\n        \"leave_room_response\":          onLeaveRoomResponse,\r\n        \"master_left_room\":             true,\r\n        \"guest_left_room\":              true,\r\n        \"user_left_room\":               true,\r\n        \"room_deleted\":                 true,\r\n        \"enable_channel_response\":      true,\r\n        \"channel_enabled\":              true,\r\n        \"disable_channel_response\":     true,\r\n        \"channel_disabled\":             onChannelDisabled,\r\n        \"join_channel_response\":        onJoinChannelResponse,\r\n        \"user_joined_channel\":          true,\r\n        \"leave_channel_response\":       onLeaveChannelResponse,\r\n        \"user_left_channel\":            true,\r\n        \"forward_message_response\":     true,\r\n        \"remote_message\":               true\r\n    };\r\n\r\n//#endregion\r\n\r\n//#region PUBLIC\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        connect,\r\n        disconnect,\r\n        login,\r\n        logout,\r\n        getRoom,\r\n        getRooms,\r\n        createRoom,\r\n        joinRoom,\r\n        leaveRoom,\r\n        enableChannel,\r\n        disableChannel,\r\n        joinChannel,\r\n        leaveChannel,\r\n        forwardMessage,\r\n        isDisconnected,\r\n        isLogged,\r\n        isInChannel\r\n    };\r\n\r\n//#endregion\r\n}\r\n","export function MediaAdapter( settings )\r\n{\r\n    let defaultSettings =\r\n    {\r\n        debug: false,\r\n        debugStyle: \"background: hsla(0, 0%, 13%, 1); color: hsla(13, 89%, 45%, 1)\",\r\n    };\r\n\r\n    settings = (typeof settings !== \"object\") ? { } : settings;\r\n    settings = Object.assign({ }, defaultSettings, settings);\r\n\r\n    let console = (settings.debug) ? window.console : null;\r\n\r\n    let events = { };\r\n    let blackCanvas = null;\r\n    let audioStream = null;\r\n    let videoStream = null;\r\n    let mediaStream = null;\r\n\r\n    let audioDevices = { }; // audioDevices[label] = deviceId\r\n    let videoDevices = { }; // videoDevices[label] = deviceId\r\n\r\n    let resolutions =\r\n    {\r\n        \"Undefined\":    { width: undefined,\theight: undefined },\r\n        \"320x240\":      { width: 320,\theight: 240 },\t// QVGA 4:3\r\n        \"640x360\":      { width: 640,\theight: 360 },\t// nHD 16:9\r\n        \"640x480\":      { width: 640,\theight: 480 },\t// VGA 4:3\r\n        \"1280x720\":     { width: 1280,\theight: 720 },\t// HD 16:9\r\n        \"1920x1080\":    { width: 1920,\theight: 1080 },\t// FullHD 16:9\r\n        \"3840x2160\":    { width: 3840,\theight: 2160 },\t// 4k 16:9\r\n        \"7680x4320\":    { width: 7680,\theight: 4320 }\t// 8k 16:9\r\n    };\r\n\r\n    let audioConstraints =\r\n    {\r\n        audio:\r\n        {\r\n            deviceId: { exact: undefined }\r\n        }\r\n    };\r\n\r\n    let videoConstraints =\r\n    {\r\n        video:\r\n        {\r\n            deviceId: { exact: undefined },\r\n            width: { exact: undefined },\r\n            height: { exact: undefined },\r\n            frameRate: { ideal: 60 }\r\n        }\r\n    };\r\n\r\n    let streamSettings =\r\n    {\r\n        audio: null, // label\r\n        video: null, // label\r\n        resolution: null, // resolutions key\r\n    };\r\n\r\n    let previousAudioConstraints = null;\r\n    let previousVideoConstraints = null;\r\n\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     * @param {String} event - The event name.\r\n     * @param {Function} listener - The function to add.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n    };\r\n\r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     * @param {String} event - The event name.\r\n     * @param {Function} listener - The previously added function.\r\n     */\r\n    let off = function( event, listener )\r\n    {   \r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Emit the specified event.\r\n     * @param {String} event - The event name.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Start the media adapter.\r\n     */\r\n    let start = function()\r\n    {\r\n        if( !navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices )\r\n        {\r\n            console?.log(\"%c\" + \"Media Devices Error\" + \"%o\", settings.debugStyle, \"Media devices are not available\");\r\n            return false;\r\n        }\r\n\r\n        // Create a dummy stream.\r\n        audioStream = getSilenceStream();\r\n        videoStream = getBlackStream();\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        let initialize = async function()\r\n        {\r\n            const catchCallback = error => console?.trace(\"%c\" + \"Media Devices Error\" + \"%o\", settings.debugStyle, error);\r\n\r\n            await window.navigator.mediaDevices.getUserMedia({ audio: true }).catch(catchCallback);\r\n            await window.navigator.mediaDevices.getUserMedia({ video: true }).catch(catchCallback);\r\n            await findDevices().catch(catchCallback);\r\n            await setDefaultDevices().catch(catchCallback);\r\n        };\r\n\r\n        initialize();\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Find the available media input and output devices.\r\n     */\r\n    let findDevices = async function()\r\n    {\r\n        return getDevices().then(gotDevices).catch(errorDevices);\r\n    };\r\n\r\n    /**\r\n     * Set the default devices.\r\n     */\r\n    let setDefaultDevices = async function()\r\n    {\r\n        // Try to get the media configuration from the local storage\r\n        // or use the default values.\r\n\r\n        let audio = window.localStorage.getItem(\"audio\") || \"None\";\r\n        if( !(audio in audioDevices) )\r\n        {\r\n            audio = \"None\";\r\n            window.localStorage.removeItem(\"audio\");\r\n        }\r\n\r\n        let video = window.localStorage.getItem(\"video\") || \"None\";\r\n        if( !(video in videoDevices) )\r\n        {\r\n            video = \"None\";\r\n            window.localStorage.removeItem(\"video\");\r\n        }\r\n\r\n        try\r\n        {\r\n            await setAudio(audio);\r\n            try\r\n            {\r\n                await setVideo(video);\r\n            }\r\n            catch( error )\r\n            {\r\n                setVideo(\"None\");\r\n            }\r\n        }\r\n        catch( error )\r\n        {\r\n            await setAudio(\"None\");\r\n            try\r\n            {\r\n                await setVideo(video);\r\n            }\r\n            catch( error )\r\n            {\r\n                setVideo(\"None\");\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Request a list of the available media input and output devices.\r\n     */\r\n    let getDevices = function()\r\n    {\r\n        return window.navigator.mediaDevices.enumerateDevices();\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get devices function.\r\n     * @param {MediaDeviceInfo[]} deviceInfos - The collection of device infos.\r\n     */\r\n    let gotDevices = function( deviceInfos )\r\n    {\r\n        audioDevices = { };\r\n        videoDevices = { };\r\n\r\n        // Add inputs for silence and black streams.\r\n        audioDevices[\"None\"] = \"\";\r\n        videoDevices[\"None\"] = \"\";\r\n\r\n        let a = 0, v = 0;\r\n        for( let deviceInfo of deviceInfos )\r\n        {\r\n            if( deviceInfo.kind === \"audioinput\" )\r\n            {\r\n                let label = (deviceInfo.label === \"\" ) ? (\"Audio input \" + a) : deviceInfo.label;\r\n                audioDevices[label] = deviceInfo.deviceId;\r\n                a++;\r\n            }\r\n\r\n            if( deviceInfo.kind === \"videoinput\" )\r\n            {\r\n                let label = (deviceInfo.label === \"\" ) ? (\"Video input \" + v) : deviceInfo.label;\r\n                videoDevices[label] = deviceInfo.deviceId;\r\n                v++;\r\n            }\r\n        }\r\n\r\n        console?.log(\"%c\" + \"Device Infos\" + \"%o\", settings.debugStyle, JSON.stringify(deviceInfos));\r\n        console?.log(\"%c\" + \"got_devices\" + \"%o%o%o\", settings.debugStyle, JSON.stringify(audioDevices), JSON.stringify(videoDevices), JSON.stringify(streamSettings));\r\n        console?.log(\"%c\" + \"got_resolutions\" + \"%o%o\", settings.debugStyle, JSON.stringify(resolutions), JSON.stringify(streamSettings));\r\n\r\n        emit(\"got_devices\",     { audioDevices: audioDevices, videoDevices: videoDevices, settings: streamSettings });\r\n        emit(\"got_resolutions\", { resolutions: resolutions, settings: streamSettings });\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get devices function.\r\n     * @param {Error} error - The catched error.\r\n     */\r\n    let errorDevices = function( error )\r\n    {\r\n        let description = \"Device request not allowed in the browser context.\";\r\n\r\n        console?.log(\"%c\" + \"error_devices\" + \"%o%o\", settings.debugStyle, error, description);\r\n\r\n        emit(\"error_devices\", { error: error, description: description });\r\n    };\r\n\r\n    /**\r\n     * Set the audio device.\r\n     * @param {String} device - The audio device.\r\n     */\r\n    let setAudio = function( device )\r\n    {\r\n        // Check whether the device exists.\r\n        if( !(device in audioDevices) )\r\n        {\r\n            return Promise.resolve(new Error(\"Device \" + device + \" doesn't exist\"));\r\n        }\r\n\r\n        // Check whether the device is not already selected.\r\n        if( device === streamSettings.audio )\r\n        {\r\n            return Promise.resolve(new Error(\"Device \" + device + \" already selected\"));\r\n        }\r\n\r\n        if( device === \"None\" )\r\n        {\r\n            // Update settings.\r\n            streamSettings.audio = device;\r\n\r\n            // Save settings.\r\n            window.localStorage.setItem(\"audio\", streamSettings.audio);\r\n\r\n            // Get dummy stream.\r\n            audioStream = getSilenceStream();\r\n            mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n            console?.log(\"%c\" + \"got_stream\" + \"%o%o\", settings.debugStyle, mediaStream, JSON.stringify(streamSettings));\r\n\r\n            emit(\"got_stream\", { stream: mediaStream, settings: streamSettings });\r\n\r\n            return Promise.resolve(mediaStream);\r\n        }\r\n        else\r\n        {\r\n            // Save previous audio constraints.\r\n            previousAudioConstraints = clone(audioConstraints);\r\n\r\n            // Update audio device constraints.\r\n            let deviceId = audioDevices[device];\r\n            audioConstraints.audio.deviceId.exact = deviceId;\r\n\r\n            return getAudioStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set the video device and resolution.\r\n     * @param {String} device - The video device.\r\n     * @param {String} resolution - The video resolution.\r\n     */\r\n    let setVideo = function( device, resolution = \"640x480\" )\r\n    {\r\n        // Check whether the device exists.\r\n        if( !(device in videoDevices) )\r\n        {\r\n            return Promise.resolve(new Error(\"Device \" + device + \" doesn't exist\"));\r\n        }\r\n\r\n        // Check whether the resolution exists.\r\n        if( !(resolution in resolutions) )\r\n        {\r\n            return Promise.resolve(new Error(\"Resolution \" + resolution + \" doesn't exist\"));\r\n        }\r\n\r\n        // Check whether the device and resolution is not already selected.\r\n        if( device === streamSettings.video && resolution === streamSettings.resolution )\r\n        {\r\n            return Promise.resolve(new Error(\"Device \" + device + \" and resolution \" + resolution + \" already selected\"));\r\n        }\r\n\r\n        if( device === \"None\" )\r\n        {\r\n            // Update settings.\r\n            streamSettings.video = device;\r\n            streamSettings.resolution = resolution;\r\n\r\n            // Save settings.\r\n            window.localStorage.setItem(\"video\", streamSettings.video);\r\n\r\n            // Get dummy stream.\r\n            let width = resolutions[resolution].width;\r\n            let height = resolutions[resolution].height;\r\n            videoStream = getBlackStream(width, height);\r\n            mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n            console?.log(\"%c\" + \"got_stream\" + \"%o%o\", settings.debugStyle, mediaStream, JSON.stringify(streamSettings));\r\n\r\n            emit(\"got_stream\", { stream: mediaStream, settings: streamSettings });\r\n\r\n            return Promise.resolve(mediaStream);\r\n        }\r\n        else\r\n        {\r\n            // Save previous video constraints.\r\n            previousVideoConstraints = clone(videoConstraints);\r\n\r\n            // Update video device constraints.\r\n            let deviceId = videoDevices[device];\r\n            videoConstraints.video.deviceId.exact = deviceId;\r\n\r\n            // Update video resolution constraints.\r\n            let width = resolutions[resolution].width;\r\n            let height = resolutions[resolution].height;\r\n            videoConstraints.video.width.exact = width;\r\n            videoConstraints.video.height.exact = height;\r\n\r\n            return getVideoStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Return a silence audio track.\r\n     * @return {MediaStreamTrack} The silence audio track.\r\n     */\r\n    let getSilenceTrack = function()\r\n    {\r\n        let audioContext = new AudioContext();\r\n\r\n        let gainNode = audioContext.createGain();\r\n        let oscillatorNode = audioContext.createOscillator();\r\n        oscillatorNode.connect(gainNode);\r\n        let destination = gainNode.connect(audioContext.createMediaStreamDestination());\r\n\r\n        gainNode.gain.setValueAtTime(0, audioContext.currentTime);\r\n        oscillatorNode.start();\r\n\r\n        let stream = destination.stream;\r\n        let audioTrack = stream.getAudioTracks()[0];\r\n\r\n        return audioTrack;\r\n    };\r\n\r\n    /**\r\n     * Return a black video track.\r\n     * @param {Number} width - The video track width.\r\n     * @param {Number} height - The video track height.\r\n     * @return {MediaStreamTrack} The black video track.\r\n     */\r\n    let getBlackTrack = function( width = 320, height = 240 )\r\n    {\r\n        if( !blackCanvas )\r\n        {\r\n            blackCanvas = window.document.createElement(\"canvas\");\r\n        }\r\n\r\n        blackCanvas.width = width;\r\n        blackCanvas.height = height;\r\n        let context = blackCanvas.getContext(\"2d\");\r\n        context.fillRect(0, 0, width, height);\r\n\r\n        let stream = blackCanvas.captureStream();\r\n        let videoTrack = stream.getVideoTracks()[0];\r\n\r\n        return videoTrack;\r\n    };\r\n\r\n    /**\r\n     * Return a silenced audio stream.\r\n     */\r\n    let getSilenceStream = function()\r\n    {\r\n        return new MediaStream([getSilenceTrack()]);\r\n    };\r\n\r\n    /**\r\n     * Return a black video stream.\r\n     * @param {Number} width - The video stream width.\r\n     * @param {Number} height - The video stream height.\r\n     */\r\n    let getBlackStream = function( width = 320, height = 240 )\r\n    {\r\n        return new MediaStream([getBlackTrack(width, height)]);\r\n    };\r\n\r\n    /**\r\n     * Request an audio stream.\r\n     */\r\n    let getAudioStream = function()\r\n    {\r\n        console?.log(\"%c\" + \"Get Audio Stream\" + \"%o\", settings.debugStyle, JSON.stringify(audioConstraints));\r\n\r\n        mediaStream = null;\r\n        stopStream(audioStream);\r\n\r\n        return window.navigator.mediaDevices.getUserMedia(audioConstraints).then(gotAudioStream).catch(function( error )\r\n        {\r\n            errorAudioStream(error);\r\n            throw error;\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Request a video stream.\r\n     */\r\n    let getVideoStream = function()\r\n    {\r\n        console?.log(\"%c\" + \"Get Video Stream\" + \"%o\", settings.debugStyle, JSON.stringify(videoConstraints));\r\n\r\n        mediaStream = null;\r\n        stopStream(videoStream);\r\n\r\n        return window.navigator.mediaDevices.getUserMedia(videoConstraints).then(gotVideoStream).catch(function( error )\r\n        {\r\n            errorVideoStream(error);\r\n            throw error;\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get audio stream function.\r\n     * @param {MediaStream} stream - The audio stream.\r\n     */\r\n    let gotAudioStream = async function( stream )\r\n    {\r\n        // Audio track.\r\n        let audioTrack = stream.getAudioTracks()[0];\r\n        let audioTrackSettings = audioTrack.getSettings();\r\n        console?.log(\"%c\" + \"Audio Track\" + \"%o%o\", settings.debugStyle, JSON.stringify(audioTrack.label), JSON.stringify(audioTrackSettings));\r\n\r\n        // Check whether the label is listed, enumerateDevices returns an empty label if the permission for accessing the mediadevice is not given.\r\n        if( !(audioTrack.label in audioDevices) )\r\n        {\r\n            await findDevices();\r\n        }\r\n\r\n        // Update settings.\r\n        streamSettings.audio = audioTrack.label;\r\n\r\n        // Save settings.\r\n        window.localStorage.setItem(\"audio\", streamSettings.audio);\r\n\r\n        audioStream = stream;\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        console?.log(\"%c\" + \"Audio Constraints\" + \"%o\", settings.debugStyle, JSON.stringify(audioConstraints));\r\n        console?.log(\"%c\" + \"got_stream\" + \"%o%o\", settings.debugStyle, mediaStream, JSON.stringify(streamSettings));\r\n\r\n        emit(\"got_stream\", { stream: mediaStream, settings: streamSettings });\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get video stream function.\r\n     * @param {MediaStream} stream - The video stream.\r\n     */\r\n    let gotVideoStream = async function( stream )\r\n    {\r\n        // Video track.\r\n        let videoTrack = stream.getVideoTracks()[0];\r\n        let videoTrackSettings = videoTrack.getSettings();\r\n        console?.log(\"%c\" + \"Video Track\" + \"%o%o\", settings.debugStyle, JSON.stringify(videoTrack.label), JSON.stringify(videoTrackSettings));\r\n\r\n        // Check whether the label is listed, enumerateDevices returns an empty label if the permission for accessing the mediadevice is not given.\r\n        if( !(videoTrack.label in videoDevices) )\r\n        {\r\n            await findDevices();\r\n        }\r\n\r\n        // Check whether the resolution is already listed.\r\n        let width = videoTrackSettings.width;\r\n        let height = videoTrackSettings.height;\r\n        let resolution = width + \"x\" + height;\r\n        if( !resolutions[resolution] )\r\n        {\r\n            // Add the resolution.\r\n            resolutions[resolution] = { width: width, height: height };\r\n\r\n            // Sort resolutions.\r\n            resolutions = Object.entries(resolutions).sort((a, b) => (a[1].width || Number.NEGATIVE_INFINITY) > (b[1].width || Number.NEGATIVE_INFINITY)).reduce((r, [k, v]) => ({ ...r, [k]: v }), {});\r\n\r\n            emit(\"got_resolutions\", { resolutions: resolutions, settings: streamSettings });\r\n        }\r\n\r\n        // Update video constraints.\r\n        videoConstraints.video.width.exact = width;\r\n        videoConstraints.video.height.exact = height;\r\n\r\n        // Update settings.\r\n        streamSettings.video = videoTrack.label;\r\n        streamSettings.resolution = resolution;\r\n\r\n        // Save settings.\r\n        window.localStorage.setItem(\"video\", streamSettings.video);\r\n\r\n        videoStream = stream;\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        console?.log(\"%c\" + \"Video Constraints\" + \"%o\", settings.debugStyle, JSON.stringify(videoConstraints));\r\n        console?.log(\"%c\" + \"got_stream\" + \"%o%o\", settings.debugStyle, mediaStream, JSON.stringify(streamSettings));\r\n\r\n        emit(\"got_stream\", { stream: mediaStream, settings: streamSettings });\r\n    };\r\n\r\n    /**\r\n     * Return a semantic error string from the specified error.\r\n     * @param {Error} error - The catched error.\r\n     */\r\n    let errorStream = function( error )\r\n    {\r\n        let description = \"\";\r\n        if( error.name === \"NotFoundError\" || error.name === \"DevicesNotFoundError\" )\r\n        {\r\n            description = \"Required track is missing.\";\r\n        }\r\n        else if( error.name === \"NotReadableError\" || error.name === \"TrackStartError\" )\r\n        {\r\n            description = \"Microphone or Webcam are already in use.\";\r\n        }\r\n        else if( error.name === \"OverconstrainedError\" || error.name === \"ConstraintNotSatisfiedError\" )\r\n        {\r\n            description = \"Constraints cannot be satisfied.\";\r\n        }\r\n        else if( error.name === \"NotAllowedError\" || error.name === \"PermissionDeniedError\" )\r\n        {\r\n            description = \"Permission denied in browser.\";\r\n        }\r\n        else if( error.name === \"TypeError\" || error.name === \"TypeError\" )\r\n        {\r\n            description = \"Empty constraints object.\";\r\n        }\r\n        else\r\n        {\r\n            description = \"Unknown error.\";\r\n        }\r\n\r\n        return description + \" \" + error.message;\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get audio stream function.\r\n     * @param {Error} error - The catched error.\r\n     */\r\n    let errorAudioStream = function( error )\r\n    {\r\n        let description = errorStream(error);\r\n\r\n        console?.log(\"%c\" + \"Error Constraints\" + \"%o\", settings.debugStyle, JSON.stringify(audioConstraints));\r\n        console?.log(\"%c\" + \"error_stream\" + \"%o%o%o\", settings.debugStyle, error.name, description, JSON.stringify(streamSettings));\r\n\r\n        emit(\"error_stream\", { error: error.name, description: description, settings: streamSettings });\r\n\r\n        if( previousAudioConstraints )\r\n        {\r\n            audioConstraints = clone(previousAudioConstraints);\r\n            previousAudioConstraints = null;\r\n            getAudioStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get video stream function.\r\n     * @param {Error} error - The catched error.\r\n     */\r\n    let errorVideoStream = function( error )\r\n    {\r\n        let description = errorStream(error);\r\n\r\n        console?.log(\"%c\" + \"Error Constraints\" + \"%o\", settings.debugStyle, JSON.stringify(videoConstraints));\r\n        console?.log(\"%c\" + \"error_stream\" + \"%o%o%o\", settings.debugStyle, error.name, description, JSON.stringify(streamSettings));\r\n\r\n        emit(\"error_stream\", { error: error.name, description: description, settings: streamSettings });\r\n\r\n        if( previousVideoConstraints )\r\n        {\r\n            videoConstraints = clone(previousVideoConstraints);\r\n            previousVideoConstraints = null;\r\n            getVideoStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Mix two streams with 1 audio and 1 video tracks into one.\r\n     * @param {MediaStream} audioStream - The stream with the audio track.\r\n     * @param {MediaStream} videoStream - The stream with the video track.\r\n     * @return {MediaStream} The mixed stream.\r\n     */\r\n    let mixStreams = function( audioStream, videoStream )\r\n    {\r\n        if( !audioStream || !(audioStream instanceof MediaStream) )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        if( !videoStream || !(videoStream instanceof MediaStream) )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let audioTracks = audioStream.getAudioTracks();\r\n        if( !audioTracks || audioTracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let videoTracks = videoStream.getVideoTracks();\r\n        if( !videoTracks || videoTracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let stream = new MediaStream();\r\n        stream.addTrack(audioTracks[0]);\r\n        stream.addTrack(videoTracks[0]);\r\n\r\n        return stream;\r\n    };\r\n\r\n    /**\r\n     * Stop a stream, stopping its tracks.\r\n     * @param {MediaStream} stream - The stream to stop.\r\n     */\r\n    let stopStream = function( stream )\r\n    {\r\n        if( !stream || !(stream instanceof MediaStream) )\r\n        {\r\n            return;\r\n        }\r\n\r\n        stream.getTracks().forEach(track => track.stop());\r\n    };\r\n\r\n    /**\r\n     * Return a clone of the object.\r\n     * @param {Object} object - The object to clone.\r\n     * @return {Object} The clone of the object.\r\n     */\r\n    let clone = function( object )\r\n    {\r\n        return JSON.parse(JSON.stringify(object));\r\n    };\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        start,\r\n        findDevices,\r\n        getDevices,\r\n        setAudio,\r\n        setVideo\r\n    };\r\n}","export function DummyStream()\r\n{\r\n//#region PRIVATE\r\n\r\n    let _blackCanvas = null;\r\n    let _silenceStream = null;\r\n    let _blackStream = null;\r\n    let _silenceTrack = null\r\n    let _blackTrack = null;\r\n\r\n    /**\r\n     * Create a silence audio track.\r\n     */\r\n    let createSilenceTrack = function()\r\n    {\r\n        let audioContext = new AudioContext();\r\n\r\n        let gainNode = audioContext.createGain();\r\n        let oscillatorNode = audioContext.createOscillator();\r\n        oscillatorNode.connect(gainNode);\r\n        let destination = gainNode.connect(audioContext.createMediaStreamDestination());\r\n\r\n        _silenceStream = destination.stream;\r\n        _silenceTrack = _silenceStream.getAudioTracks()[0];\r\n    };\r\n\r\n    /**\r\n     * Create a black video track.\r\n     * @param {Number} width - The video width.\r\n     * @param {Number} height - The video height.\r\n     */\r\n    let createBlackTrack = function( width = 320, height = 240 )\r\n    {\r\n        if( !_blackCanvas )\r\n        {\r\n            _blackCanvas = window.document.createElement(\"canvas\");\r\n        }\r\n\r\n        _blackCanvas.width = width;\r\n        _blackCanvas.height = height;\r\n        let context = _blackCanvas.getContext(\"2d\");\r\n        context.fillRect(0, 0, width, height);\r\n\r\n        _blackStream = _blackCanvas.captureStream();\r\n        _blackTrack = _blackStream.getVideoTracks()[0];\r\n    };\r\n\r\n    createSilenceTrack();\r\n    createBlackTrack();\r\n    let _stream = new MediaStream([_silenceTrack, _blackTrack]);\r\n\r\n    /**\r\n     * Return the audio track.\r\n     * @returns {MediaStreamTrack} The audio track.\r\n     */\r\n    let getAudioTrack = function()\r\n    {\r\n        return _silenceTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the video track.\r\n     * @returns {MediaStreamTrack} The video track.\r\n     */\r\n    let getVideoTrack = function()\r\n    {\r\n        return _blackTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the stream.\r\n     * @returns {MediaStream} The stream.\r\n     */\r\n    let getStream = function()\r\n    {\r\n        return _stream;\r\n    };\r\n\r\n//#endregion\r\n\r\n//#region PUBLIC\r\n\r\n    return {\r\n        getAudioTrack,\r\n        getVideoTrack,\r\n        getStream\r\n    };\r\n\r\n//#endregion\r\n}"],"sourceRoot":""}