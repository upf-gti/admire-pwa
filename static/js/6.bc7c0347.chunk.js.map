{"version":3,"sources":["assets/img/selfie.png","pages/Selfie.jsx"],"names":["console","warn","images","Array","fill","style","width","src","selfie","alt","Pose","videoRef","useRef","media","useContext","MediaContext","useState","setState","makeSelfie","event","current","canvas","document","createElement","videoWidth","height","videoHeight","getContext","drawImage","img","Image","toDataURL","target","id","score","Math","random","toFixed","transform","s","str","body","actor","studio","log","constructor","String","JSON","stringify","Blob","size","useEffect","ready","srcObject","localStream","play","map","v","parseFloat","props","sort","max","Row","Col","md","muted","ref","className","k","position","onClick","Badge","bg"],"mappings":"4OAAe,MAA0B,mC,OCQzCA,QAAQC,KAAO,aACf,IAAIC,EAAS,IAAIC,MAAM,GAAGC,KAAK,qBAAKC,MAAO,CAACC,MAAM,QAAQC,IAAKC,EAAQC,IAAI,OAE5D,SAASC,IACpB,IAAMC,EAAWC,iBAAO,MAClBC,EAAQC,qBAAWC,KACzB,EAA0BC,mBAAS,GAAnC,mBAAcC,GAAd,WAoBA,SAASC,EAAWC,GAChB,GAAIR,EAASS,QAAb,CACA,IAAMC,EAASC,SAASC,cAAc,UACtCF,EAAOf,MAAQK,EAASS,QAAQI,WAChCH,EAAOI,OAASd,EAASS,QAAQM,YACrBL,EAAOM,WAAW,MAC1BC,UAAUjB,EAASS,QAAS,EAAG,EAAGC,EAAOf,MAAOe,EAAOI,QAC3D,IAAMI,EAAM,IAAIC,MAChBD,EAAItB,IAAMc,EAAOU,UAAU,aAC3BZ,EAAMa,OAAOzB,IAAMsB,EAAItB,IACvBY,EAAMa,OAAOvB,IAAM,IACnBP,EAAOiB,EAAMa,OAAOC,IAAM,qBAAK1B,IAAKsB,EAAItB,IAAK2B,MAAOC,KAAKC,SAASC,QAAQ,GAAIhC,MAAO,CAACiC,UAAU,gBAChGrB,GAAS,SAAAsB,GAAC,OAAIA,EAAE,KAEhB,IApBcC,EAoBVC,EAAO,CACPC,MAAOb,EAAItB,IACXoC,OAAQd,EAAItB,KAGhBP,QAAQ4C,IAAK,gBAzBCJ,EAyBwBC,GAxB/BI,cAAgBC,SACnBN,EAAMO,KAAKC,UAAWR,IACnB,IAAIS,KAAK,CAACT,IAAMU,QA6B3BC,qBAAU,WACFtC,EAAMuC,QACVzC,EAASS,QAAQiC,UAAYxC,EAAMyC,YACnC3C,EAASS,QAAQmC,UAClB,CAAC1C,EAAMuC,MAAOvC,EAAMyC,cAGvB,IAKA,EAAsBpD,EAAOsD,KAAK,SAAAC,GAAC,aAAIC,WAAU,UAACD,EAAEE,MAAMzB,aAAT,QAAkB,MAAI0B,OAAvE,mBAAeC,GAAf,gBAEA,OAAO,qCACP,sBAAK5B,GAAG,SAAR,qCACI,6DAAqB,sFACrB,eAAC6B,EAAA,EAAD,WACA,cAACC,EAAA,EAAD,CAAKC,GAAI,EAAT,SACI,uBAAOC,OAAK,EAAC5D,MAAO,CAAEiC,UAAW,kBAAmBhC,MAAM,QAAU4D,IAAKvD,EAAzE,+BAGJ,eAACoD,EAAA,EAAD,CAAKC,GAAI,EAAT,UACI,cAAC,IAAD,CAAIG,UAAU,mBAAd,SAhBG,sQAiBH,qBAAKlC,GAAG,WAAR,2DACE/B,EAAOsD,KAAK,SAACC,EAAEW,GAAH,iBAAS,sBAAK/D,MAAO,CAACgE,SAAS,WAAY/D,MAAO,mBAA4BgE,QAASpD,EAA9E,qCACnB,qBAAiDX,IAAG,UAAEkD,EAAElD,WAAJ,QAAWkD,EAAEE,MAAMpD,IAAKE,IAAG,iBAAY2D,GAAK/D,MAAOoD,EAAEpD,MAAO4B,GAAImC,EAApH,8BAAgBX,EAAEE,MAAMzB,MAAQ,WAAa,KAA7C,MACA,cAACqC,EAAA,EAAD,CAAOC,GAAId,WAAU,UAACD,EAAEE,MAAMzB,aAAT,QAAkB,KAAO2B,EAAI,UAAU,YAA5D,mBAA0EJ,EAAEvB,aAA5E,QAAqFuB,EAAEE,MAAMzB,UAFRkC,iBAX1F","file":"static/js/6.bc7c0347.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/selfie.7ba22bd2.png\";","//https://github.com/google/mediapipe/issues/2346#issuecomment-888062233\r\n\r\nimport { useState, useRef, useEffect, useContext  } from 'react'\r\nimport { Row, Col, Image as ReactImage, Badge } from 'react-bootstrap'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport MD from 'utils/md'\r\nimport selfie from 'assets/img/selfie.png'\r\n\r\nconsole.warn = ()=>{}\r\nlet images = new Array(3).fill(<img style={{width:\"100%\"}}src={selfie} alt=\"0\"/>);\r\n\r\nexport default function Pose() {\r\n    const videoRef = useRef(null);\r\n    const media = useContext(MediaContext);\r\n    const [state, setState] = useState(0);\r\n\r\n    function DataURIToBlob(dataURI) {\r\n        const splitDataURI = dataURI.split(',')\r\n        const byteString = splitDataURI[0].indexOf('base64') >= 0 ? atob(splitDataURI[1]) : decodeURI(splitDataURI[1])\r\n        const mimeString = splitDataURI[0].split(':')[1].split(';')[0]\r\n\r\n        const ia = new Uint8Array(byteString.length)\r\n        for (let i = 0; i < byteString.length; i++)\r\n            ia[i] = byteString.charCodeAt(i)\r\n\r\n        return new Blob([ia], { type: mimeString })\r\n    }\r\n\r\n    function byteSize(str) {\r\n        if(str.constructor !== String)\r\n            str = JSON.stringify( str );\r\n        return new Blob([str]).size;\r\n    }\r\n\r\n    function makeSelfie(event) {\r\n        if(!videoRef.current) return;\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = videoRef.current.videoWidth;\r\n        canvas.height = videoRef.current.videoHeight;\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\r\n        const img = new Image();\r\n        img.src = canvas.toDataURL('image/png');\r\n        event.target.src = img.src;\r\n        event.target.alt = '1';\r\n        images[event.target.id] = <img src={img.src} score={Math.random().toFixed(2)} style={{transform:'scaleX(-1)'}}/>\r\n        setState(s => s+1);\r\n\r\n        let body = { \r\n            actor: img.src, \r\n            studio: img.src \r\n        };\r\n\r\n        console.log( \"Byte size: \" + byteSize(body) );\r\n\r\n        // http.post(\"https://admire-dev-iq.brainstorm3d.com/image/analyze\", {data: body})\r\n        // .then(response =>  {debugger})\r\n        // .catch(error => {debugger})\r\n    }\r\n\r\n    useEffect(() => {\r\n        if(!media.ready) return;\r\n        videoRef.current.srcObject = media.localStream;\r\n        videoRef.current.play();\r\n    }, [media.ready, media.localStream]);\r\n\r\n    //intro message for the selfie for image quality assesment step\r\n    let message = `\r\n    The image quality assessment step will score if the image <b>has enough light</b> and <b>enough contrast</b>.\r\n    Take <b>3 selfies</b> with your face facing towards the camera. \r\n    The highlighted number shows the <b>best scored</b> capture.\r\n    `;\r\n    const [min,med,max] = images.map( v => parseFloat(v.props.score ?? 0)).sort()\r\n\r\n    return <>\r\n    <div id='selfie'>\r\n        <h3 className=\"pt-2\"><b>Step 4: Lighting Quality</b></h3>\r\n        <Row>\r\n        <Col md={6}>\r\n            <video muted style={{ transform: \"rotateY(180deg)\", width:\"100%\" }} ref={videoRef}></video>\r\n\r\n        </Col>\r\n        <Col md={6}>\r\n            <MD className=\"user-select-none\">{message}</MD>\r\n            <div id=\"carousel\" className=\"d-flex flex-horizontal\">\r\n            { images.map( (v,k) => <div style={{position:'relative', width: \"calc( 100% / 3)\"}} key={k} onClick={makeSelfie}>\r\n                <img className={v.props.score ? \"mirrored\" : \"\"} src={v.src ?? v.props.src} alt={`Selfie ${k}`} style={v.style} id={k}/>\r\n                <Badge bg={parseFloat(v.props.score ?? 0) === max?\"success\":\"secondary\"}>{v.score ?? v.props.score}</Badge>\r\n            </div> )}\r\n            </div>\r\n        </Col>\r\n        </Row>\r\n    </div>\r\n\r\n    <style global jsx>{`\r\n        @import \"src/variables.scss\";\r\n        #selfie {\r\n            #carousel{\r\n                height: 100px; \r\n                &:nth-child(1) \r\n                {\r\n                    margin-left: 0px;\r\n                }\r\n\r\n                img.mirrored {\r\n                    transform: rotateY(180deg);\r\n                    -webkit-transform:rotateY(180deg); /* Safari and Chrome */\r\n                    -moz-transform:rotateY(180deg); /* Firefox */\r\n                }\r\n\r\n                img {\r\n                    width: 100%;\r\n                    height: 100%;\r\n                    object-fit: cover;\r\n                    border: 1px solid rgba(0,0,0,0.1);\r\n                    margin-left: 1px;\r\n                    filter: opacity(80%);\r\n                    transition: all .25s ease-in-out;\r\n                    &:hover {\r\n                        filter: opacity(100%);\r\n                    }\r\n                }\r\n\r\n                .badge{\r\n                    position: absolute;\r\n                    top: .24rem;\r\n                    margin-left: .25rem;\r\n                }\r\n            }\r\n            \r\n        }\r\n\r\n        @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n   \r\n            #selfie {\r\n\r\n\r\n                .row{\r\n                    flex-direction: row !important;\r\n                    .col{\r\n                        align-self: start;\r\n                    }\r\n                }\r\n            }\r\n        }  \r\n    `}</style>\r\n    </>\r\n}"],"sourceRoot":""}