{"version":3,"sources":["assets/img/logo.png","partials/video.jsx","partials/layout.jsx","views/verified.jsx","views/resetpassword.jsx","partials/modal.jsx","components/modal_about.jsx","components/btn_fullscreen.jsx","partials/title.jsx","partials/nav.jsx","components/badge_forward.jsx","views/room.jsx","components/modal_recovery.jsx","components/modal_register.jsx","views/login.jsx","components/modal_create_room.jsx","views/lobby.jsx","views/wizard.jsx","components/modal_leave_room.jsx","components/modal_wizard.jsx","components/modal_users.jsx","components/modal_chat.jsx","components/btngrp_stream.jsx","views/App.jsx","utils/forms.js","components/modal_profile.jsx","utils/ctx_rooms.jsx","utils/md.jsx","utils/ctx_authentication.jsx","pages lazy /^/.*/.jsx$/ groupOptions: {} namespace object","reportWebVitals.js","serviceWorkerRegistration.js","index.js","utils/http.js","../lib/bra/rtcClient.js","../lib/bra/lobbyClient.js","../lib/bra/mediaAdapter.js","../lib/bra/index.js","../lib/bra/dummyStream.js","utils/ctx_mediadevices.jsx","utils/ctx_streaming.jsx","assets/img/profile_light.png"],"names":["id","stream","onClick","isLocal","props","ref","useRef","useState","audio","status","setStatus","useEffect","current","srcObject","className","variant","disabled","autoPlay","playsInline","muted","window","toast","error","message","options","console","trace","success","log","loading","custom","children","position","reverseOrder","toastOptions","duration","style","background","color","basename","process","title","property","content","REACT_APP_OG_TYPE","envREACT_APP_OG_IMAGE","component","App","exact","path","Verified","ResetPass","to","history","useHistory","onHide","push","size","show","closeButton","backdrop","buttons","token","useParams","formRef","undefined","validated","setValidated","formErrors","formvalues","setFormValues","e","a","preventDefault","toastId","password","http","post","data","then","description","setTimeout","warn","catch","err","isValid","key","indexOf","validateForm","onSubmit","placement","overlay","type","controlId","label","Control","required","name","placeholder","onChange","value","check","test","length","v","validateField","target","defaultValue","setShow","callback","centered","keyboard","dialogClassName","Header","Title","Body","Footer","map","k","useReducer","o","n","proposalEvent","proposal","dispatch","onBeforeInstallPrompt","state","prompt","userChoice","outcome","addEventListener","removeEventListener","setState","f","s","screenfull","on","off","isEnabled","toggle","document","fullscreen","rooms","useContext","RoomsContext","width","height","src","logo","Nav","zIndex","Item","icon","appendclass","Button","button","callId","isForwardCall","wrtc","StreamContext","fetching","setFetching","getLiveCall","mediaHubCallId","submit","forwardingCallId","mediaHubtarget","callUser","response","calleeId","callerId","forwardCall","Spinner","as","animation","role","Badge","padding","pill","bg","callHangup","onKeyDown","keyCode","FloatingLabel","Form","Room","roomId","carouselRef","auth","AuthContext","media","MediaContext","selected","setSelected","useLayoutEffect","imInRoom","ready","callAllUsers","callHangupAll","replaceStream","localStream","Row","Col","xs","Object","entries","local","streams","getUserId","imMaster","user","username","master","isSelected","handleSubmit","email","toLowerCase","OverlayTrigger","Tooltip","isConnected","handleUserInput","values","testImage","url","timeoutT","Promise","resolve","reject","timer","timeout","img","Image","onerror","onabort","clearTimeout","onload","Gravatar","r","d","gravatar","checked","avatar","surname","birthdate","profile_img","hasError","Card","roundedCircle","Group","htmlFor","cookies","get","remember","login","app_token","set","Img","Text","Switch","defaultChecked","Array","from","elements","roomname","hidden","createRoom","room","tabIndex","RoomTile","onKeyPress","list","sm","span","offset","lg","xl","joinRoom","pages","page","setPage","views","setViews","onKeyPressed","vs","p","default","onSwipeLeft","onSwipeRight","leaveRoom","_title","users","canvasRef","isAudioEnabled","setAudioEnabled","audiotracks","getAudioTracks","every","enabled","settings","ctx","getContext","globalAlpha","requestAnimationFrame","draw","clearRect","canvas","x0","y0","x1","y1","r1","gradient","createRadialGradient","addColorStop","fillStyle","fillRect","cancelAnimationFrame","marginTop","marginBottom","track","view","location","pathname","container","isLogged","Container","fluid","logout","align","ButtonGroup","createContext","setRooms","setReady","setCurrent","isUserInRoom","roomName","onRoomCreated","onRoomDeleted","BRA","getRoom","onGetRoom","onGuestLeft","filter","u","onGuestJoin","GuestLeftRoom","GuestJoinedRoom","RoomCreated","RoomDeleted","getRooms","m1","rs","onGetRooms","m2","store","event","Provider","replaceAll","remarkPlugins","remarkGfm","remarkBreaks","rehypePlugins","rehypeRaw","setUser","setToken","setLogged","app","rtc","setConnected","toast_app","toast_rtc","toast_usr","retries","setRetries","access_token","unregister","disconnect","headers","Authorization","onUnload","onAppConnect","onRtcConnect","onAppDisconnect","onRtcDisconnect","ClientConnected","ClientDisconnected","connect","Infinity","getUserInfo","t","setTimer","interval_id","setInterval","Math","max","clearInterval","register","webpackAsyncContext","req","__webpack_require__","Error","code","ids","keys","module","exports","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","render","StrictMode","Suspense","fallback","ProgressBar","animated","now","getElementById","URL","href","origin","fetch","contentType","reload","checkValidServiceWorker","serviceWorkerRegistration","assign","method","json","body","JSON","stringify","RTCEvent","IncomingCall","CallAccepted","CallCanceled","CallOpened","CallClosed","UserHangup","RTCCall","connection","candidates","channels","initiator","getStats","callStats","stats","pairStats","forEach","report","localCandidateId","localType","candidateType","localAddress","address","ip","localPort","port","localProtocol","protocol","remoteCandidateId","remoteType","remoteAddress","remotePort","remoteProtocol","bind","peerConnection","isInitiator","RTCPeerConnection","channel","close","getState","iceConnectionState","addCandidate","candidate","addIceCandidate","gatherPendingCandidates","setRemoteDescription","setBandwidth","bandwidth","senders","getSenders","i","sender","parameters","getParameters","encodings","maxBitrate","setParameters","getRemoteAudioTrack","index","receivers","getReceivers","tracks","receiver","kind","getRemoteVideoTrack","getRemoteStream","MediaStream","addTrack","replaceLocalAudioTrack","audioSenders","replaceTrack","replaceLocalVideoTrack","videoSenders","openChannel","createDataChannel","closeChannel","onDataChannel","onChannelOpen","onopen","onChannelClose","onChannelError","onChannelMessage","onmessage","sendData","readyState","send","LobbyEvent","UserOnline","UserOffline","UserRejoined","MediaEvent","GotDevices","ErrorDevices","GotResolutions","GotStream","ErrorStream","SilenceStream","audioContext","AudioContext","gainNode","createGain","oscillatorNode","createOscillator","destination","createMediaStreamDestination","gain","setValueAtTime","currentTime","start","BlackStream","createElement","context","interval","captureStream","DEBUG","appClient","debug","debugStyle","pingPeriod","responses","events","socket","keepAliveTimeout","emit","args","slice","call","arguments","listeners","apply","this","onOpen","startKeepAlive","onClose","stopKeepAlive","onMessage","msg","parse","uuid","sendMessage","WebSocket","OPEN","ping","uuidv4","replace","c","crypto","getRandomValues","Uint8Array","toString","listener","splice","accessToken","onclose","mediaAdapter","audioStream","videoStream","mediaStream","audioDevices","videoDevices","resolutions","audioConstraints","deviceId","videoConstraints","video","frameRate","ideal","resolution","previousAudioConstraints","previousVideoConstraints","mediaDevices","enumerateDevices","mixStreams","getUserMedia","findDevices","getDevices","gotDevices","errorDevices","deviceInfos","deviceInfo","getAudioStream","stopStream","gotAudioStream","errorAudioStream","getVideoStream","gotVideoStream","errorVideoStream","audioTrack","videoTrack","getVideoTracks","videoTrackSettings","getSettings","sort","b","Number","NEGATIVE_INFINITY","reduce","errorStream","clone","audioTracks","videoTracks","getTracks","stop","object","setAudio","device","setVideo","dummyStream","_blackCanvas","_silenceStream","_blackStream","_silenceTrack","_blackTrack","createSilenceTrack","createBlackTrack","_stream","getAudioTrack","getVideoTrack","getStream","rtcClient","defaultSettings","defaultStream","calls","userId","rtcConfiguration","iceServers","handleRegisterResponse","handleUnregisterResponse","handleCallResponse","handleIncomingCall","handleCallAccepted","handleCallCanceled","handleRemoteOffer","handleRemoteAnswer","handleRemoteCandidate","handleUserHangup","closeCall","hangup","oniceconnectionstatechange","other","handleIceConnectionStateChange","onicecandidate","onnegotiationneeded","createOffer","sdp","setLocalDescription","offer","createAnswer","answer","getCall","getCalls","CLOSED","acceptCall","cancelCall","APPEvent","init_evts","videoRef","devices","setDevices","setSettings","setResolutions","newvalue","setLocalStream","onGotResolutions","onGotDevices","onGotStream","localStorage","setItem","onError","getItem","onStream","init","setStreams","liveCalls","setLiveCalls","onIncomingCall","onCallOpened","forward_stream","videotrack","audiotrack","onCallClosed","manageLiveCallClosed","onUserHangup","result","mId","fId","forwardedCallId","find"],"mappings":"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","file":"static/js/main.7574a721.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.f23962e9.png\";","import {Button} from 'react-bootstrap'\r\nimport { useEffect, useState, useRef } from 'react'\r\n\r\nexport default ({id, stream, onClick, isLocal = false, ...props})=>{\r\n    let ref = useRef(null);\r\n    const [status, setStatus] = useState({audio:true});\r\n\r\n    useEffect(()=>{\r\n        if(stream && ref.current){\r\n            ref.current.srcObject = stream;\r\n            //ref.current.play();\r\n        }\r\n    },[stream]);\r\n\r\n    function handleClick(){\r\n        setStatus({...status, audio:!status.audio});\r\n    }\r\n    \r\n    return <>\r\n    <div className={`Video ${props.className??\"\"}`} >\r\n        <div className=\"stream-status position-absolute bottom-0 start-0\">\r\n            <span   className=\"status-user\"> {id} </span>\r\n            <Button className=\"status-audio\" variant=\"link\" disabled={isLocal} onClick={handleClick}>\r\n                {isLocal? <i className={`bi bi-mic${!(isLocal||!status?.audio) ? \"\" : \"-mute\"}`} />\r\n                :<i className={`fs-4 bi bi-volume${!(isLocal||!status?.audio) ? \"-down\" : \"-mute\"}`} />}\r\n            </Button>\r\n        </div>\r\n        <video autoPlay playsInline muted={isLocal || !status?.audio} ref={ref} {...{onClick}}/>\r\n    </div>\r\n    <style global jsx>{`\r\n        @import 'src/variables.scss';\r\n\r\n        .Video{\r\n            position: relative;\r\n            margin:1px;\r\n            padding:0;\r\n            border:1px solid $secondary;\r\n            transition:all .2s ease-in-out;\r\n\r\n            &:hover, .selected{\r\n                border:1px solid $primary;\r\n            }\r\n\r\n            .stream-status{ \r\n                color:white !important;\r\n                z-index:1000;\r\n                .status-user{\r\n                    padding: 0rem 0.5rem;\r\n                    padding-right:0;\r\n                }\r\n                .status-audio{\r\n                    color:white !important;\r\n                    cursor:pointer;\r\n                    padding:0;\r\n                    margin-bottom: -1.2rem;\r\n                    margin-top: -1.4rem;\r\n                    margin-left: -0.2rem;                    \r\n                }\r\n            }\r\n\r\n            video{\r\n                width:100%;\r\n                height:100%;\r\n                object-fit: cover;\r\n                margin-bottom: -4px;\r\n            }\r\n        }\r\n\r\n    `}</style>\r\n    </>;\r\n}","import { Helmet } from \"react-helmet\"\r\nimport toast, { Toaster } from 'react-hot-toast'\r\nimport { BrowserRouter as Router, Switch, Route, Redirect } from \"react-router-dom\"\r\n\r\nimport App from 'views/App'\r\nimport Verified from 'views/verified'\r\nimport ResetPass from 'views/resetpassword'\r\nimport AboutModal from 'components/modal_about'\r\nimport ProfileModal from 'components/modal_profile'\r\nimport FullScreenBTN from 'components/btn_fullscreen'\r\nimport Title from 'partials/title'\r\n\r\nimport 'bootstrap/dist/js/bootstrap.bundle.min.js';\r\nimport 'style.scss'\r\n\r\nimport RoomsContext  from 'utils/ctx_rooms'\r\nimport StreamContext from 'utils/ctx_streaming'\r\nimport MediaContext from 'utils/ctx_mediadevices'\r\nimport AuthContext  from 'utils/ctx_authentication'\r\n\r\nwindow.toast  = toast;\r\nconst error   = toast.error;   toast.error   = (message, options) => { console.trace(message); return   error(message, options); }\r\nconst success = toast.success; toast.success = (message, options) => { console.log(message);   return success(message, options); }\r\nconst loading = toast.loading; toast.loading = (message, options) => { console.log(message);   return loading(message, options); }\r\nconst custom  = toast.custom;  toast.custom  = (message, options) => { console.log(message);   return  custom(message, options); }\r\n\r\nexport default ({ children, ...props }) => {\r\n  return <div id=\"layout\" className=\"\" {...props}>\r\n    <Toaster\r\n      id=\"toaster\"\r\n      position=\"bottom-right\"\r\n      reverseOrder={true}\r\n      toastOptions={{\r\n        duration: 2000,\r\n        style: {\r\n          background: '#333',\r\n          color: '#fff',\r\n        },\r\n      }}\r\n    />\r\n    <Router basename={process.env.REACT_APP_BASE}>\r\n    <AuthContext>\r\n    <RoomsContext>\r\n    <MediaContext>\r\n    <StreamContext>\r\n    \r\n    <Helmet>\r\n      <title>{process.env.REACT_APP_NAME}</title>\r\n      <title>{props.title}</title>\r\n      <meta property=\"og:url\" content={process.env.REACT_APP_OG_URL} />\r\n      <meta property=\"og:type\" content={process.env.REACT_APP_OG_TYPE} />\r\n      <meta property=\"og:title\" content={process.env.REACT_APP_OG_TITLE} />\r\n      <meta property=\"og:description\" content={process.env.REACT_APP_OG_DESC} />\r\n      <meta property=\"og:image\" content={process.envREACT_APP_OG_IMAGE} />\r\n    </Helmet>\r\n\r\n    <Title/>\r\n\r\n    <div className=\"z-top d-flex m-2 position-absolute top-0 end-0\">\r\n      <ProfileModal />\r\n      <AboutModal />\r\n      <FullScreenBTN />\r\n    </div>\r\n\r\n    <Switch>\r\n        <Route component={App}       exact path={[\"/\", \"/settings\", \"/about\", \"/users\", \"/chat\", \"/profile\", \"/room/:roomId\", \"/room/:roomId/chat\", \"/room/:roomId/guests\"]} />\r\n        <Route component={Verified}  exact path=\"/verify/:token\"/>\r\n        <Route component={ResetPass} exact path=\"/reset-password/:token\"/>\r\n        <Route> <Redirect to='/'/> </Route>\r\n    </Switch>\r\n    \r\n    </StreamContext>\r\n    </MediaContext>\r\n    </RoomsContext>\r\n    </AuthContext>\r\n    </Router>\r\n\r\n    <style global jsx>{`\r\n      @import \"src/variables.scss\";\r\n\r\n      #layout {\r\n        text-align:center;\r\n        background:$background;\r\n      }  \r\n\r\n      #title {\r\n        color:$text;\r\n        filter: invert(.5) brightness(0.5);\r\n        mix-blend-mode: luminosity;\r\n      }\r\n\r\n      .z-top{\r\n        z-index:1000;\r\n      }\r\n      \r\n    `}</style>\r\n  </div>\r\n}","import {Button} from 'react-bootstrap'\r\nimport { useHistory } from 'react-router-dom'\r\n\r\nimport MD from 'utils/md';\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default ()=>{\r\n    const history = useHistory();\r\n    function onHide(){\r\n        history.push('/') \r\n    }\r\n    return <>\r\n        <Modal size=\"md\" show={true} \r\n            title={<h2 className=\"user-select-none\">User verified!</h2>}\r\n            closeButton\r\n            backdrop=\"static\"\r\n            onHide={ onHide }\r\n            buttons={[<Button onClick={onHide} >Return to Loggin</Button>]}\r\n        >\r\n            <MD className=\"user-select-none\">{`Account verified successfully in the system. You can now login on the application.`}</MD>\r\n        </Modal> \r\n    </>\r\n}","import toast from 'react-hot-toast'\r\nimport { useState, useEffect, useRef } from 'react'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport { Form, FloatingLabel, OverlayTrigger, Tooltip, Button} from 'react-bootstrap'\r\n\r\nimport http from 'utils/http'\r\nimport MD from 'utils/md'\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default ()=>{\r\n    let { token } = useParams();\r\n    const history = useHistory();\r\n\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated] = useState(undefined);\r\n    const [formvalues, setFormValues] = useState({formErrors:{}});\r\n\r\n    function handleUserInput (e) {\r\n        const name = e.target.name;\r\n        const value = e.target.value;\r\n        validateField(name, value);\r\n    }\r\n\r\n    function validateField(name, value){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(name){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default: console.warn(\"Invalid field name: \", name);\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n    \r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error?.length? '' : 'has-error');\r\n    }\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        const toastId = toast.loading('Resetting password...');\r\n        const password = formvalues.password;\r\n        await http.post(`${process.env.REACT_APP_API_URL}/reset-password/${token}`, {data:{password}})\r\n        .then( ({status, description, message }) => {\r\n            switch (status) {\r\n                case 'ok':\r\n                    toast.success('Success', {id: toastId});\r\n                    setTimeout( ()=>history.push(`/`), 1000);\r\n                    break;\r\n                case 400: toast.error(message, {id: toastId}); break;\r\n                case 'error': toast.error(description, {id: toastId}); break;\r\n                default: toast.warn(description, {id: toastId});\r\n            }\r\n        })\r\n        .catch(err => {\r\n            toast.error(`Error: ${err}`, {id: toastId});\r\n        });\r\n    }\r\n\r\n    return <>\r\n        <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n        <Modal closeButton show={true} \r\n            onHide={() => history.push(\"/\")} \r\n            title={<h2 className=\"user-select-none\">Reset password</h2>}\r\n            buttons={[\r\n                <OverlayTrigger placement=\"bottom\"\r\n                overlay={\r\n                    <Tooltip className={`${validated?\"d-none\":\"\"} mt-2`}  id={`tooltip-bottom`}>\r\n                        Check form errors\r\n                    </Tooltip>\r\n                }\r\n                >\r\n                    <Button type=\"submit\" disabled={!validated} > Proceed </Button>\r\n                </OverlayTrigger>\r\n            ]}\r\n        >\r\n            <MD className=\"user-select-none\">{ \"Please enter your new password.\"}</MD>\r\n            \r\n            <FloatingLabel controlId=\"floatingPassword\" label=\"New Password\">\r\n                <Form.Control required name=\"password\" type=\"password\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.password??\"\"}/>\r\n            </FloatingLabel>\r\n\r\n        </Modal> \r\n        </Form>\r\n    </>\r\n}","import React from 'react';\r\nimport { Modal, Button } from 'react-bootstrap';\r\n\r\nexport default ({title, children, show, setShow = ()=>{}, callback, buttons, closeButton, ...props}) => {\r\n    return <>\r\n        <Modal\r\n            centered\r\n            show={show}\r\n            keyboard={true}\r\n            //backdrop={closeButton?\"\":\"static\"}\r\n            onHide={() => setShow(false)}\r\n            dialogClassName=\"modal-partial modal-shadow-lg\"\r\n            {...props}\r\n        >\r\n            {(closeButton && title) && <Modal.Header closeButton={closeButton} >\r\n                <Modal.Title className=\"user-select-none\">{title}</Modal.Title>\r\n            </Modal.Header>}\r\n            \r\n            <Modal.Body>\r\n                {children}\r\n            </Modal.Body>\r\n\r\n            { (buttons || closeButton) && <Modal.Footer>\r\n                {buttons && buttons.map( (v,k,a) => <div key={k}>{v}</div> )}\r\n                {closeButton && <Button variant=\"outline-secondary\" onClick={() => setShow(false)}> Close</Button>}\r\n            </Modal.Footer>} \r\n        </Modal>\r\n\r\n        <style global jsx>{`\r\n            @import 'src/variables.scss';\r\n\r\n            .modal-partial.modal-shadow-lg.modal-md.modal-dialog-centered:focus-visible {\r\n                outline: none;\r\n            }\r\n\r\n            .modal-partial {\r\n                .modal-title {\r\n                    font-weight: lighter;\r\n                    font-family: $header-font;\r\n\r\n                    h1,h2,h3,h4,h5,h6 {padding:0; margin:0}\r\n                }\r\n\r\n                .modal-header{\r\n                    padding-bottom: .2em;\r\n                }\r\n\r\n                .modal-footer{\r\n                    padding: 0 0.75rem;\r\n                }\r\n            }\r\n            \r\n\r\n            /* -----------------------------------------\r\n                Wearables\r\n            ----------------------------------------- */\r\n\r\n            /* ----------- Moto 360 Watch ----------- */\r\n            @media (max-device-width: 218px)and (max-device-height: 281px) { \r\n\r\n            }\r\n\r\n            /* ----------- Non-Retina Screens ----------- */\r\n            @media screen \r\n            and (min-device-width: 1200px) \r\n            and (max-device-width: 1600px) \r\n            and (-webkit-min-device-pixel-ratio: 1) { \r\n            }\r\n\r\n            /* ----------- Retina Screens ----------- */\r\n            @media screen \r\n            and (min-device-width: 1200px) \r\n            and (max-device-width: 1600px) \r\n            and (-webkit-min-device-pixel-ratio: 2)\r\n            and (min-resolution: 192dpi) { \r\n            }\r\n\r\n            /* Smartphones (landscape)  */\r\n            @media only screen\r\n            and (min-width : 321px) {\r\n            /* Styles */\r\n            }\r\n\r\n            /* Large Desktop and Laptop Screens (devices and browsers) */\r\n            @media only screen and (min-width: 1824px) {}\r\n\r\n            /* Tablet Devices, Desktop and Laptop Screens */\r\n            @media only screen and (max-width: 768px) {}\r\n\r\n            /* iPads (portrait and landscape) */\r\n            @media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {}\r\n\r\n            /* Smartphones (portrait and landscape) */\r\n            @media only screen and (min-device-width: 320px) and (max-device-width: 480px) {}\r\n\r\n            /* iPhone 4 */\r\n            @media only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen and (min-device-pixel-ratio: 1.5) {}\r\n\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {\r\n                .modal-dialog{\r\n                    max-width: 38rem !important;\r\n                }\r\n            }\r\n            @media only screen and (orientation: portrait){\r\n\r\n            }      \r\n        `}</style>\r\n    </>;\r\n}","import React, {useEffect, useState, useReducer} from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\n\r\nexport default () => {\r\n    const [show, setShow] = useState(false);\r\n    const [proposal, dispatch] = useReducer((o,n)=>n, {proposalEvent : undefined});\r\n    useEffect(() => { \r\n            window.addEventListener('beforeinstallprompt',onBeforeInstallPrompt, 0);\r\n        return () => { \r\n            window.removeEventListener('beforeinstallprompt',onBeforeInstallPrompt, 0);\r\n        }\r\n    },[]);\r\n\r\n    function onBeforeInstallPrompt(e) \r\n    {\r\n        debugger;\r\n        e.preventDefault();\r\n        dispatch(state => ({...state, e}));\r\n    }\r\n\r\n    async function promptInstall()\r\n    {\r\n        if(!proposal?.proposalEvent) \r\n            return;\r\n\r\n        proposal.proposalEvent.prompt();\r\n        const { outcome } = await proposal.proposalEvent.userChoice;\r\n        if (outcome === 'accepted') {\r\n            dispatch(state => ({ ...state, proposalEvent: undefined }));\r\n        }\r\n    }\r\n\r\n    return <>\r\n        <Button variant=\"link\" onClick={ ()=>setShow(1) }>About</Button>\r\n        <Modal closeButton size=\"md\" {...{show, setShow}} title={<span>{process.env.REACT_APP_NAME} - Offline capable <Button variant={`${proposal.proposalEvent?\"outline-primary\":\"outline-secondary\"}`}size=\"sm\" onClick={promptInstall} disabled={!proposal.proposalEvent}> {`${proposal.proposalEvent? \"Install PWA\" : \"Not available\"}`}</Button></span>}>\r\n        <MD>{`\r\n        An offline-capable AdMiRe version is available, wich is a [Progressive Web App](https://docs.microsoft.com/en-us/microsoft-edge/progressive-web-apps-chromium/).\r\n\r\n        The app serves the following features:\r\n        - Offline-capable (with [Service Workers](https://developers.google.com/web/fundamentals/primers/service-workers/))\r\n        - \"Add to Home Screen\" feature on Android and iOS supported devices to launch the app from the home screen.\r\n        - Dark Mode.\r\n        - Privacy-focused - We don't collect any personal data.\r\n        - Lightweight - The app is only ~5MB.\r\n\r\n        Hope you liked using this app \r\n\r\n        <div align=\"center\" className=\"fw-bolder\">Made with  by <a href=\"https://www.upf.edu/web/gti\"> UPF-GTI</a> </div>\r\n        `}</MD>\r\n        </Modal>\r\n    </>;\r\n}\r\n//<Button onClick={handleClick}>Install {import.meta.env.NAME}</Button>","import screenfull from 'screenfull'\r\nimport { Button } from 'react-bootstrap'\r\nimport { useState, useEffect } from 'react'\r\n\r\n\r\nexport default () => {  \r\n    let [state, setState] = useState(0);//eslint-disable-line\r\n\r\n    useEffect(()=>{\r\n        const f = () => setState(s => ++s);\r\n        screenfull.on('change', f);\r\n    return ()=>{\r\n        screenfull.off('change', f);\r\n    }},[])\r\n    \r\n    return <div id=\"btn_fullscreen\">\r\n        { screenfull.isEnabled && \r\n            <Button \r\n            onClick={screenfull.toggle} variant=\"link\"> \r\n                {  document.fullscreen && <i className=\"bi bi-fullscreen-exit\"/> }\r\n                { !document.fullscreen && <i className=\"bi bi-fullscreen\"/> }\r\n            </Button>    \r\n        }\r\n    </div>;\r\n}","import {useContext} from 'react'\r\nimport {Image} from 'react-bootstrap'\r\nimport logo from \"assets/img/logo.png\"\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\nexport default () => {\r\n    const rooms    = useContext(RoomsContext);\r\n\r\n    return <>\r\n        <div id=\"title\" variant=\"none\" className=\"d-flex m-3 position-absolute top-0 start-0 user-select-none\">\r\n            <Image className=\"me-2\" width={32} height={32} src={logo} />\r\n            <h1 className=\"fs-3\">{process.env.REACT_APP_NAME}</h1>\r\n            {rooms?.current && <h1 className=\"fs-3\">: #{rooms?.current?.name}</h1>}\r\n        </div>\r\n    </>\r\n}","function Nav({children}){\r\n\r\n    return <>\r\n\r\n        <div className=\"nav-partial px-3 mb-1 d-flex justify-content-evenly align-items-center position-absolute bottom-0 start-50 translate-middle-x shadow rounded-5 bg-light\" style={{ zIndex: 1100}}>\r\n            { children.map( (v,k) => v && <div key={'nav-i-'+k}>{v}</div>) }\r\n        </div>\r\n\r\n        <style global jsx>{`\r\n            @import \"node_modules/bootstrap/scss/_functions.scss\";\r\n            @import \"node_modules/bootstrap/scss/_variables.scss\";\r\n            @import \"src/variables.scss\";\r\n\r\n            .rounded-5{\r\n                border-radius: .5em;\r\n            }\r\n            .nav-partial{\r\n                min-width: 1rem;\r\n                min-height: 1rem;\r\n                transition: all .2s ease-in-out;\r\n            }\r\n            .nav-button, .nav-item{\r\n                color: $secondary;\r\n                cursor: pointer;\r\n                height: 100%;\r\n                width: auto;\r\n                user-select: none;\r\n                transition: all .2s ease-in-out;\r\n\r\n                & i{\r\n                    transform: scale(1.5);\r\n                    width: 50px;\r\n                    overflow: hidden;\r\n                    padding:0;\r\n                    margin:0;\r\n                    user-select: none;\r\n                    text-transform: capitalize;\r\n\r\n                }\r\n                &:hover{\r\n                    color:  lighten($danger,15%);\r\n                }\r\n            }\r\n\r\n            .nav-item{\r\n                height: 44px;\r\n            }\r\n\r\n            .nav-item-active{\r\n                color: red !important;\r\n            }\r\n\r\n            .nav-item-disabled{\r\n                opacity: .35;\r\n                user-select: none !important;\r\n                pointer-events:none;\r\n                cursor: not-allowed;\r\n                &:hover{\r\n                    opacity: .35;\r\n                }\r\n            }\r\n\r\n\r\n            .nav-button{\r\n                color: black !important;\r\n                height: 3.5rem;\r\n                width: 3.5rem;\r\n                line-height: 3rem;\r\n                margin-top: -1.5rem;\r\n                margin-bottom: 1.5rem;\r\n\r\n                &:hover{\r\n                    color:  lighten($danger,50%) !important;\r\n                }\r\n            }\r\n\r\n            .dark-mode{\r\n                &.navpartial, .nav-partial{\r\n                    background-color: transparent !important;\r\n                    border: 1px solid rgba(255,255,255, .25);\r\n\r\n                    .nav-item{\r\n                        color: invert($secondary,50%);\r\n                        &:hover{\r\n                            color:  lighten($danger,15%);\r\n                            filter: saturate(120%) drop-shadow(0 0 .1rem $danger);\r\n                        }\r\n                    }\r\n\r\n                    .nav-button{\r\n                        filter: saturate(80%);\r\n                        background: $color1 !important;\r\n                        line-height: 2.8rem;\r\n                        border: 2px solid $danger;\r\n                        color: $danger !important;\r\n\r\n                        &:hover{\r\n                            filter: saturate(120%) drop-shadow(0 0 .1rem $danger);\r\n                            color:  $danger !important;\r\n                            border: 2px solid $danger;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n                .nav-partial{\r\n                    flex-direction: column;\r\n                    //top: 50%;\r\n                    left: 100% !important;\r\n                    transform: translate(-100%, 0%) !important;\r\n                    margin-left: -1.1rem;\r\n                    padding:1.251rem 0 !important;\r\n\r\n                    .nav-button{\r\n                        margin:0;\r\n                        margin-left: -1.5rem;\r\n                        margin-right: 1.5rem;\r\n                    }\r\n                }\r\n            }\r\n            @media only screen and (orientation: portrait){\r\n\r\n            } \r\n        `}</style>\r\n    </>\r\n}\r\n\r\n\r\nNav.Item = function({children, icon, disabled, to, ...props}){\r\n    return <div to={to??\"/\"} className={`nav-item ${disabled?\"nav-item-disabled\":\"\"} ${props.appendclass??\"\"}`} {...props}>\r\n        <div className={`d-flex flex-column fs-6 fw-lighter`} >{children}</div>\r\n    </div>\r\n}\r\n\r\nNav.Button = function({children,...props}){\r\n    return <div className={`nav-button ${props.appendclass??\"\"}`} {...props}>\r\n        <div className=\" pt-1 fs-1 fw-lighter\">{children}</div>\r\n    </div>\r\n}\r\n\r\nexport default Nav;","import toast from 'react-hot-toast';\r\nimport {useState, useContext, useRef} from 'react'\r\nimport {Badge, Button, Form, FloatingLabel, Spinner} from 'react-bootstrap'\r\n\r\nimport Modal from 'partials/modal'\r\nimport { StreamContext } from 'utils/ctx_streaming'\r\n\r\n\r\nexport default ({callId, isForwardCall})=>{\r\n    const wrtc     = useContext(StreamContext);\r\n    const ref = useRef(null);\r\n    const [show, setShow] = useState(null);\r\n    const [fetching, setFetching] = useState(0);//0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n\r\n    let [mediaHubCallId, forwardedCallId] = wrtc.getLiveCall(callId); //eslint-disable-line\r\n    \r\nfunction submit() {\r\n\r\n        if ( !ref?.current || !show )\r\n            return setShow(false);\r\n\r\n        setFetching(true);            \r\n\r\n        const [forwardingCallId, mediaHubtarget] = [callId, ref.current.value];\r\n\r\n        function callback(response) {\r\n            const {callId, calleeId, callerId, status, description}=response;\r\n            if(status === \"error\")\r\n            {                \r\n                setFetching(3);           \r\n                setTimeout( () => { setFetching(0); } , 2000);\r\n                toast.error(`Mediahub Call response error: ${description}`, {duration: 5000});\r\n            }\r\n            else {\r\n                setFetching(2);   \r\n                setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n                //callback(callId, forwardingCallId);\r\n                wrtc.forwardCall(callId, forwardingCallId);\r\n            }\r\n        }\r\n\r\n        if(!wrtc.callUser(mediaHubtarget, callback))\r\n        {\r\n            setFetching(3);   \r\n            toast.error(`call missed to backend`);\r\n            setTimeout( () => { setFetching(0); } , 2000);\r\n        }\r\n    }\r\n\r\n    function onKeyDown(e){\r\n        if(e.keyCode === 13)\r\n        submit()\r\n    }\r\n\r\n    let button;\r\n    switch(fetching){\r\n        case 1:  button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2:  button = <Button variant=\"outline-success\" >  Succeed! </Button>; break;\r\n        case 3:  button = <Button variant=\"outline-danger\"  >  Error </Button>; break;\r\n        default: button = <Button variant=\"outline-primary\" onClick={submit} >Proceed!</Button>;\r\n    }\r\n\r\n    return <>\r\n        {isForwardCall ? <Badge style={{padding:\".44em .45em\"}} pill bg=\"danger\" onClick={() => wrtc.callHangup( mediaHubCallId )}><i className=\"bi bi-x\"></i></Badge>\r\n        :                <Badge style={{padding:\".44em .45em\"}} pill bg=\"danger\" onClick={() => setShow( callId )} className=\"cursor-pointer\"><i className=\"bi bi-cast\"></i></Badge>}\r\n        <Modal {...{show,setShow}}  buttons={[button]}  closeButton title=\"Ready to forward?\" onKeyDown={onKeyDown}>\r\n            Enter the destination ID you want to forward to\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"targetId\" className=\"mb-3\">\r\n                <Form.Control ref={ref} name=\"targetId\" type=\"text\" placeholder=\"mediahub target id\"/>\r\n            </FloatingLabel>\r\n        </Modal>\r\n    </>;\r\n}\r\n\r\n//{ imMaster && (!isForwardCall && id !== roomInfo?.master && id !== user.id) && <Badge pill bg=\"danger\" onClick={() => setShowModal( callId )}><i class=\"bi bi-cast\"></i></Badge> }","//import { useEffect } from 'react';\r\nimport { useParams } from \"react-router-dom\"\r\nimport { Row, Col, Badge } from 'react-bootstrap'\r\nimport { useContext, useLayoutEffect, useEffect, useState, useRef } from 'react'\r\nimport * as BRA from 'lib_bra'\r\n\r\nimport Video from 'partials/video'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport { StreamContext } from 'utils/ctx_streaming'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport BadgeForwardCall from 'components/badge_forward'\r\n\r\n\r\nexport default function Room({ ...props }){\r\n    const {roomId}    = useParams();\r\n    const carouselRef = useRef();\r\n    const auth        = useContext(AuthContext);\r\n    const rooms       = useContext(RoomsContext);\r\n    const media       = useContext(MediaContext);\r\n    const wrtc        = useContext(StreamContext);\r\n    const [selected, setSelected] = useState(null);\r\n\r\n    useLayoutEffect(()=>{//Constructor\r\n        if(!rooms.imInRoom(roomId) || !rooms.ready || !media.ready) \r\n            return;\r\n\r\n        wrtc.callAllUsers();\r\n    return ()=>{//Destructor\r\n        wrtc.callHangupAll();\r\n    }},[rooms.ready, media.ready]);\r\n\r\n    useEffect( ()=>{\r\n        wrtc.replaceStream(media.localStream);\r\n    },[media.localStream]);\r\n\r\n    return <div id=\"room\" className=\"overflow-hidden m-auto\" style={{zIndex:1000}}>\r\n        <Row  id=\"content-row\" className=\"g-2\" style={{ height:\"100%\" }}>\r\n            <Col xs=\"auto\" id=\"carousel-col\" ref={carouselRef}>\r\n                <div id=\"carousel\" className=\"d-flex flex-column\" >\r\n                {  Object.entries({local:media.localStream, ...wrtc.streams}).map(([callId, stream], k)=>{\r\n\r\n                    let id = wrtc.getUserId(callId);\r\n                    let imMaster = auth.user.username === rooms.current?.master.username;\r\n                    let [mediaHubCallId, forwardedCallId] = wrtc.getLiveCall(callId); //eslint-disable-line\r\n                    let isForwardCall = !!forwardedCallId;\r\n                    let isSelected = selected === callId || (!selected && k === 0);\r\n\r\n                    return <div key={k}>\r\n                        <div className=\"stream-forward\">\r\n                            { imMaster && <BadgeForwardCall callId={callId} isForwardCall={isForwardCall}/> }\r\n                            { isSelected && <Badge pill bg=\"primary\"><i className=\"bi bi-eye active\"/></Badge> }\r\n                        </div>\r\n                        <Video isLocal={id === auth.user.username} key={callId} id={id} stream={stream} className={!isSelected?\"cursor-pointer\":\"\"} onClick={()=>{setSelected(callId)}}/>\r\n                    </div>\r\n                })}\r\n                </div>\r\n            </Col>\r\n            <Col id=\"main-col\">\r\n                <Video isLocal={wrtc.getUserId(selected) === auth.user.username} className=\"main-video\" id={wrtc.getUserId(selected)} stream={wrtc.streams[selected]??media.localStream} />\r\n            </Col>\r\n        </Row>\r\n\r\n        <style global jsx>{`\r\n            @import \"src/variables.scss\";\r\n\r\n            #room{\r\n                height:calc(100vh - 3rem - 4.5rem);\r\n\r\n                #main-col {\r\n                    height: 100%;\r\n                    overflow: hidden;\r\n\r\n                    .Video\r\n                    {\r\n                        width:100%;\r\n                        height:100%;\r\n                        object-fit: cover;\r\n                    }\r\n                }\r\n\r\n                #carousel-col {\r\n                    height: 100%;\r\n                    width:166px;\r\n                    overflow-x: hidden;\r\n                    overflow-y: scroll;\r\n\r\n                    #carousel{\r\n                        height:100%;\r\n                        .Video{\r\n                            padding-right: 1px;\r\n                            padding-bottom: 2px;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                .stream-forward{\r\n                    height:1.9rem;\r\n                    position:relative;\r\n                    margin-bottom:-1.9rem;\r\n                    text-align:left;\r\n                    padding:3px 6px;\r\n                    z-index:1000;\r\n                }\r\n\r\n                .stream-controls{\r\n                    margin-bottom: 5.5rem;\r\n                }\r\n            }\r\n\r\n            @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n                #room{\r\n                    height:calc(100vh - 2rem);\r\n                }\r\n                \r\n                .stream-controls{\r\n                    margin-bottom: .5rem !important;\r\n                }\r\n        \r\n            }\r\n\r\n            @media only screen and (orientation: portrait){\r\n                .stream-controls{\r\n                    margin-bottom: 5.5rem !important;\r\n                }\r\n\r\n                #content-row{ flex-direction: column; }\r\n                #carousel-col{\r\n                    overflow-x: scroll;\r\n                    overflow-y: hidden;\r\n                    height: 126px !important;\r\n                    width: 100% !important;\r\n                    #carousel{\r\n                        flex-direction: row !important;\r\n                        border:none;\r\n                        .Video, .Video video{ \r\n                            width: 166px; \r\n                            height:124px; \r\n                            object-fit: cover;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </div>;\r\n}\r\n\r\n","import React, {useState, useContext, useEffect, useRef  } from 'react';\r\nimport { Button, Form, FloatingLabel, OverlayTrigger, Tooltip } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport toast from 'react-hot-toast';\r\nimport http from 'utils/http'\r\n\r\nexport default () => {\r\n    const formRef = useRef(null);\r\n    const [show, setShow] = useState(false);\r\n    const auth = useContext(AuthContext);\r\n\r\n    const [formvalues, setFormValues] = useState({formErrors:{}});\r\n    const [validated, setValidated] = useState(undefined);\r\n   \r\n    function handleUserInput (e) {\r\n        const name = e.target.name;\r\n        const value = e.target.value;\r\n        validateField(name, value);\r\n    }\r\n\r\n    function validateField(name, value){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(name){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default: console.warn(\"Invalid field name: \", name);\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n\r\n\r\n    useEffect(()=>{\r\n        function validateForm(){\r\n            let isValid = true;\r\n            for( let key in formvalues ){\r\n                if( key.indexOf('_check') !== -1 )\r\n                    isValid &= formvalues[key];\r\n            }\r\n            setValidated( isValid?true:false );\r\n        }\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        const email = formvalues.email.toLowerCase();\r\n        const toastId = toast.loading('Resetting password...');\r\n        debugger;\r\n        await http.post(`${process.env.REACT_APP_API_URL}/forgot-password`, { data: {email} })\r\n        .then(({error, message, status}) => {\r\n            if (error) {\r\n                return toast.error(`onSubmitRecovery: ${message}`, { id: toastId });\r\n            }\r\n            setShow(false);\r\n            toast.success('Success', { id: toastId });\r\n        })\r\n        .catch(err => {\r\n            toast.error(`onSubmitRecovery: ${err}`, { id: toastId });\r\n        });\r\n    }\r\n\r\n    function hasError(error){\r\n        if(!error) return \"\";\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n    const button =  <OverlayTrigger placement=\"bottom\"\r\n    overlay={\r\n        <Tooltip className={`${validated?\"d-none\":\"\"}`}  id={`tooltip-bottom`}>\r\n            {Object.entries(formvalues.formErrors).map(([key, value]) => { return <span>{key}: {value}</span> }) }\r\n        </Tooltip>\r\n    }\r\n    >\r\n        <span style={{padding:\"10px 0\"}}>\r\n            <Button type=\"submit\" onClick={handleSubmit} disabled={!validated && auth.isConnected} > Send password reset email </Button>\r\n        </span>\r\n    </OverlayTrigger>\r\n\r\n    return <>\r\n        <Button size=\"sm\" className=\"mt-4\" variant=\"link\" onClick={ ()=>setShow(1) }><i className=\"bi bi-lock\"></i>Forgot password?</Button>\r\n        <Modal size=\"md\" closeButton {...{show, setShow}} \r\n        buttons={[button]} \r\n        title={<h2 className=\"user-select-none\">Forgot Password</h2>} \r\n        >\r\n            <MD className=\"user-select-none\">{`Enter your email adress, on a couple of minutes you will receive an email with a link to reset your password.`}</MD>\r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingInput\" label=\"Email address\" className=\"mb-3\">\r\n                    <Form.Control required className={ hasError(formvalues.formErrors?.email)} name=\"email\" type=\"email\" placeholder=\" \" onChange={handleUserInput} />\r\n                </FloatingLabel>\r\n            </Form>\r\n        </Modal>\r\n    </>;\r\n}","import Gravatar from 'gravatar'\r\nimport toast from 'react-hot-toast'\r\nimport React, {useState, useEffect, useRef  } from 'react'\r\nimport { Spinner, Button, Form, FloatingLabel, OverlayTrigger, Tooltip, Card, Image as ReactImage } from 'react-bootstrap'\r\n\r\nimport MD from 'utils/md';\r\nimport http from 'utils/http'\r\nimport Modal from 'partials/modal'\r\nimport profile_img from 'assets/img/profile_light.png'\r\n\r\n\r\nexport default () => {\r\n    const formRef = useRef(null);\r\n    const [show, setShow] = useState(false);\r\n\r\n    const [fetching, setFetching]       = useState(false);\r\n    const [validated, setValidated]     = useState(undefined);\r\n    const [formvalues, setFormValues]   = useState({formErrors:{}});\r\n   \r\n    function handleUserInput (e) {\r\n        const name  = e.target.name;\r\n        const type  = e.target.type;\r\n        const value = type===\"checkbox\"?e.target.checked:e.target.value;\r\n        validateField(name, value, type);\r\n    }\r\n\r\n    function validateField(name, value, type = \"any\"){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n        let values = {...formvalues};\r\n\r\n        function testImage(url, timeoutT) {\r\n            return new Promise(function (resolve, reject) {\r\n                var timeout = timeoutT || 5000;\r\n                var timer, img = new Image();\r\n                img.onerror = img.onabort = function () {\r\n                    clearTimeout(timer);\r\n                    reject(\"Error: the url provided is not an image\");\r\n                };\r\n                img.onload = function () {\r\n                    clearTimeout(timer);\r\n                    resolve(\"success\");\r\n                };\r\n                timer = setTimeout(function () {\r\n                    // reset .src to invalid URL so it stops previous\r\n                    // loading, but doesn't trigger new load\r\n                    img.src = \"//!!!!/test.jpg\";\r\n                    reject(\"timeout\");\r\n                }, timeout);\r\n                img.src = url;\r\n            });\r\n        }\r\n\r\n        switch(type){\r\n            case 'email':\r\n                const email_re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = email_re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                values = { ...values, [name]:value, [`${name}_check`]:check, formErrors };\r\n                if(check){\r\n                    const url = \"https:\"+Gravatar.url(value, { s: '256', r: 'pg', d: '404' });\r\n                    testImage(url, 2000)\r\n                    .then( (v) => { \r\n                        setFormValues( { ...values, gravatar:url,  [`gravatar_check`]:check, formErrors } );\r\n                    })\r\n                    .catch((err) => {\r\n                        setFormValues( { ...values, gravatar:null,  [`gravatar_check`]:check, formErrors } );\r\n                    });\r\n                }else{\r\n                    values = { ...values, gravatar:null,  [`gravatar_check`]:check, formErrors };\r\n                }\r\n\r\n                break;\r\n\r\n            case 'password':\r\n                const pass_re = /^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z]{8,30}$/;\r\n                check = pass_re.test(value);\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default:\r\n                check = true;\r\n                formErrors[name] = '';\r\n                break;\r\n        }\r\n        setFormValues( { ...values, [name]:value, [`${name}_check`]:check, formErrors } );\r\n    }\r\n\r\n\r\n\r\n\r\n    useEffect(()=>{\r\n        function validateForm(){\r\n            let isValid = true;\r\n            for( let key in formvalues ){\r\n                if( key.indexOf('_check') !== -1 )\r\n                    isValid &= formvalues[key];\r\n            }\r\n            setValidated( isValid?true:false );\r\n        }\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        let {username, email, password, avatar, gravatar, name, surname, birthdate, role} = formvalues;\r\n        avatar = avatar?.length? avatar : gravatar??profile_img;\r\n        const toastId = toast.loading('Registering...');\r\n        \r\n        await http.post(`${process.env.REACT_APP_API_URL}/register`, {data:{ username, email, password, avatar, name, surname, birthdate, role }})\r\n        .then(({ error, message, status }) => {\r\n            if(error){\r\n                return toast.error(`onRegister: ${message}`, { id: toastId });\r\n            }\r\n            toast.success('Success', { id: toastId });\r\n            setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n        })\r\n        .catch(err => {\r\n            toast.error(`Error: ${err}`, { id: toastId });\r\n        });\r\n    }\r\n\r\n    function hasError(error){\r\n        return(error?.length ? '' : 'has-error');\r\n    }\r\n\r\n    //onClick={submit}\r\n\r\n    let button = <Button onClick={handleSubmit} type=\"submit\" disabled={!validated} variant={validated?\"outline-primary\":\"outline-secondary\"}  >CREATE ACCOUNT!</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" >  Succeed! </Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\"  >  Error </Button>; break;\r\n        default: break;\r\n    }\r\n\r\n    return <>\r\n        <Card.Footer className=\"text-center user-select-none\" onClick={ ()=>setShow(1) }> Create an account </Card.Footer>\r\n        <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n        <Modal className=\"py-4\" closeButton {...{show, setShow}} \r\n        title={<h2 className=\"user-select-none\">Let's create your account</h2>}\r\n        backdrop=\"static\"\r\n        buttons={[\r\n            <OverlayTrigger placement=\"bottom\"\r\n            overlay={\r\n                <Tooltip className={`${validated?\"d-none\":\"\"}`}  id={`tooltip-bottom`}>\r\n                    {Object.entries(formvalues.formErrors).map(([key, value], k) => { return <span key={k}>{key}: {value}</span> }) }\r\n                </Tooltip>\r\n            }>\r\n            {button}\r\n            </OverlayTrigger>\r\n        ]}\r\n        >\r\n            <ReactImage\r\n                id=\"avatar-img\"\r\n                src={formvalues.avatar ?? formvalues.gravatar ?? profile_img}\r\n                roundedCircle\r\n                className='position-absolute top-0 start-50 bg-danger shadow'\r\n                width=\"128\" height=\"128\"\r\n            />\r\n\r\n            <MD className=\"user-select-none\">{`Create your account. It's free and only takes a minute.`}</MD>\r\n\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"username\">     <Form.Control name='username'   className={ hasError(formvalues.formErrors?.username)}  placeholder='username'   onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['username'  ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"email\">        <Form.Control name='email'      className={ hasError(formvalues.formErrors?.email)}     placeholder='email'      onChange={handleUserInput} type=\"email\"     defaultValue={formvalues['email'     ]}     />      </FloatingLabel>} />{/*value={userEmail} onChange={event => setEmail(event.target.value)} isInvalid={!isEmailValid} /> */}\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"password\">     <Form.Control name='password'   className={ hasError(formvalues.formErrors?.password)}  placeholder='password'   onChange={handleUserInput} type=\"password\"  defaultValue={formvalues['password'  ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"avatar URL\">   <Form.Control name='avatar'     className={ hasError(formvalues.formErrors?.avatar)}    placeholder='avatar URL' onChange={handleUserInput} type=\"avatar\"    defaultValue={formvalues['avatar URL']}     />      </FloatingLabel>} />{/*value={image_url !== '' ? image_url : userEmail !== '' ? gravatar_url : ''} onChange={event => setImageURL(event.target.value)} */}\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"name\">         <Form.Control name='name'       className={ hasError(formvalues.formErrors?.name)}      placeholder='name'       onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['name'      ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"surname\">      <Form.Control name='surname'    className={ hasError(formvalues.formErrors?.surname)}   placeholder='surname'    onChange={handleUserInput} type=\"text\"      defaultValue={formvalues['surname'   ]}     />      </FloatingLabel>} />\r\n            <Form.Group className = \"mb-1\" children = {<FloatingLabel label=\"birthddate\">   <Form.Control name='birthdate'  className={ hasError(formvalues.formErrors?.birthdate)} placeholder='birthdate'  onChange={handleUserInput} type=\"date\"      defaultValue={formvalues['birthdate' ]}     />      </FloatingLabel>} />\r\n            \r\n            <div className=\"form-floating\">\r\n                <select className=\"form-select\" id=\"floatingSelect\" aria-label=\"Floating label select example\">\r\n                    <option value=\"0\">User</option>\r\n                    <option value=\"1\">Admin</option>\r\n                </select>\r\n                <label htmlFor=\"floatingSelect\"> User role</label>\r\n            </div>\r\n        </Modal>\r\n        </Form>\r\n        <style global jsx>{`\r\n            #avatar-img{\r\n                transform: translate(-50%,-125%) !important;\r\n            }\r\n        `}</style>\r\n    </>;\r\n}","//https://learnetto.com/blog/react-form-validation\r\n\r\nimport { useContext, useRef, useState, useEffect } from 'react';\r\nimport { Row, Col, Card,Form, FloatingLabel, Button, Spinner, OverlayTrigger, Tooltip } from \"react-bootstrap\"\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport RecoveryModal from 'components/modal_recovery'\r\nimport RegisterModal from 'components/modal_register'\r\nimport logo from 'assets/img/logo.png';\r\nimport toast from 'react-hot-toast';\r\nimport cookies from '@h3r/cookies'\r\nimport * as BRA from 'lib_bra'\r\n\r\nexport default () => {\r\n    const auth = useContext(AuthContext);\r\n\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated] = useState(undefined);\r\n    const [formvalues, setFormValues] = useState({formErrors:{}, email: cookies.get(\"admire_app_email\"), remember: !!cookies.get(\"admire_app_email\")});\r\n    const [fetching, setFetching] = useState(false);\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        setFetching(true);\r\n        auth.login(formvalues.email, formvalues.password)\r\n        .then(  app_token => {\r\n            setFetching(false);\r\n            if(formvalues.remember){\r\n                cookies.set('admire_app_token', app_token, process.env.REACT_APP_COOKIES_EXPIRE_TIME);\r\n                cookies.set(\"admire_app_email\", formvalues.email, process.env.REACT_APP_COOKIES_EXPIRE_TIME);\r\n            }\r\n        })\r\n        .catch( err => {\r\n            setFetching(false);\r\n        })\r\n        ;\r\n    }\r\n\r\n    function handleUserInput (e) {\r\n        const name  = e.target.name;\r\n        const type  = e.target.type;\r\n        const value = type===\"checkbox\"?e.target.checked:e.target.value;\r\n\r\n        validateField(name, value, type);\r\n    }\r\n\r\n    function validateField(name, value, type = \"any\"){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n\r\n        switch(type){\r\n            case 'email':\r\n                const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                check = re.test(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default:\r\n                check = true;\r\n                formErrors[name] = '';\r\n                break;\r\n        }\r\n\r\n        setFormValues( v => ({ ...v, [name]:value, [`${name}_check`]:check, formErrors }) );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n    \r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n\r\n    return <>\r\n    <Card id=\"login\" bg=\"light\" className=\"flex-column text-center position-absolute start-50 top-50 translate-middle\" style={{ width: '24rem' }}>\r\n\r\n        <Col>\r\n            <Card.Img variant=\"top\" className=\"mt-4 user-select-none\" src={logo}/>\r\n            <h1 className=\"text-start ps-4 mb-0 mt-3 user-select-none\">{process.env.REACT_APP_NAME}</h1>\r\n            <div className=\"divider\"><span/></div>\r\n        </Col>\r\n\r\n        <Col>\r\n            <Card.Body as={Col} className=\"text-start px-4 pb-4\">\r\n\r\n            <Card.Text className=\"user-select-none\">Enter your e-mail adress and your password.</Card.Text>\r\n            \r\n            <Form validated={validated} onSubmit={handleSubmit} ref={formRef}>\r\n                <FloatingLabel controlId=\"floatingInput\" label=\"Email address\" className=\"mb-3\">\r\n                    <Form.Control required name=\"email\" type=\"email\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.email??\" \"}/>\r\n                </FloatingLabel>\r\n                <FloatingLabel controlId=\"floatingPassword\" label=\"Password\">\r\n                    <Form.Control required name=\"password\" type=\"password\" placeholder=\" \" onChange={handleUserInput} defaultValue={formvalues.password??\"\"}/>\r\n                </FloatingLabel>\r\n\r\n                <Form.Switch id=\"remember-switch\" label=\"Remember me\" className=\"user-select-none\" name=\"remember\" onChange={handleUserInput} defaultChecked={formvalues.remember??false}/>\r\n\r\n\r\n                <OverlayTrigger placement=\"bottom\"\r\n                    overlay={\r\n                        <Tooltip className={`${validated?\"d-none\":\"\"} mt-2`}  id={`tooltip-bottom`}>\r\n                            Check form errors\r\n                        </Tooltip>\r\n                    }\r\n                    >\r\n                        <span style={{padding:\"10px 0\"}}>\r\n                            <Button size=\"sm\" className=\"mt-4\" type=\"submit\" disabled={!(validated && !fetching)} > \r\n                                {!fetching?\r\n                                <><i className=\"bi bi-box-arrow-in-left\"/> Log me in </>\r\n                                : <><Spinner as=\"span\"animation=\"grow\" size=\"sm\" role=\"status\" aria-hidden=\"true\"/> Logging in... </>\r\n                            }</Button>\r\n                        </span>\r\n                    </OverlayTrigger>\r\n                    \r\n                <RecoveryModal/>\r\n            </Form>\r\n\r\n\r\n            </Card.Body>\r\n            <RegisterModal/>\r\n        </Col>\r\n    </Card>\r\n\r\n    <style global jsx>{`\r\n        @import \"src/variables.scss\";\r\n        .divider {\r\n                border-bottom: 1px solid #FFF;\r\n                background-color: #DADADA;\r\n                height: 2px;\r\n                margin: 0.5em 0px 1.5em;\r\n\r\n                & span{\r\n                    position:relative;\r\n                    display: block;\r\n                    width: 75px;\r\n                    height: 3px;\r\n                    background-color: $color4;\r\n                    transform:translatey(-25%);\r\n                    left: 6%;\r\n                }\r\n        }\r\n\r\n        #login{\r\n            border:none;\r\n            img {\r\n                width: 192px;\r\n                filter: \r\n                    hue-rotate(260deg)\r\n                ;\r\n            }\r\n\r\n            .card-footer{\r\n                color:$text;\r\n                background:$color4;\r\n                transition: all 0.1s ease-in-out; \r\n                &:hover{\r\n                    background:darken($color4, 10%);\r\n                    font-weight:bold;\r\n                    cursor:pointer;\r\n                }\r\n            }\r\n        } \r\n\r\n        @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n            #login{\r\n                width: 40rem !important;\r\n                flex-direction: row !important;\r\n                .col{\r\n                    align-self: end;\r\n                }\r\n            }\r\n        }\r\n        @media only screen and (orientation: portrait){\r\n\r\n        }    \r\n    `}</style>\r\n    </>;\r\n}\r\n","import toast from 'react-hot-toast'\r\nimport React, {useContext, useRef, useEffect, useState} from 'react'\r\nimport { Button, Form, FloatingLabel, Spinner } from 'react-bootstrap'\r\n\r\nimport MD from 'utils/md'\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const ref                     = useRef(null);\r\n    const [show, setShow]         = useState(false);\r\n    const [isValid, setValid]     = useState(true);//eslint-disable-line\r\n    const [fetching, setFetching] = useState(0);               //0: not fetching, 1: fetching, 2: sucess, 3: failed\r\n\r\n    useEffect(()=>{\r\n        function onKeyDown(e) {\r\n            if (e.keyCode === 13) {\r\n                setShow(true);\r\n            }\r\n        }\r\n            window.addEventListener('keydown', onKeyDown);\r\n        return ()=>{\r\n            window.removeEventListener('keydown', onKeyDown);\r\n        }\r\n    },[])\r\n\r\n    function submit() {\r\n        if ( !ref?.current || !show ) return;\r\n            \r\n        let [roomname, password, icon, hidden] = Array.from(ref.current.elements).map(v => v.value);\r\n        \r\n        rooms.createRoom(roomname.toLowerCase(), {password, icon, hidden})\r\n        .then( room =>{\r\n            toast.success(`Created room ${room.name}`); \r\n            setTimeout( () => { setFetching(0); setShow(false); } , 1000);\r\n            setFetching(2);   \r\n        }) \r\n        .catch( err =>{\r\n            toast.error(`onCreateRoom: ${err}`); \r\n            setFetching(3);   \r\n            setTimeout( () => { setFetching(0); } , 1000);\r\n        }) \r\n    }\r\n\r\n    function handleUserInput(e){\r\n        //setValid(ref?.current?.value.length > 3);\r\n    }\r\n\r\n    let button = <Button disabled={!isValid} variant={isValid?\"outline-primary\":\"outline-secondary\"} onClick={submit} >Proceed!</Button>;\r\n    switch(fetching){\r\n        case 1: button = <Button variant=\"outline-primary\"> <Spinner as=\"span\"      animation=\"border\"      size=\"sm\"      role=\"status\"      aria-hidden=\"true\"/></Button>; break;\r\n        case 2: button = <Button variant=\"outline-success\" >  Succeed! </Button>; break;\r\n        case 3: button = <Button variant=\"outline-danger\"  >  Error </Button>; break;\r\n        default: break;\r\n    }\r\n\r\n\r\n    return <>\r\n        <Nav.Button onClick={()=>setShow(1)} label=\"Create room\" appendclass=\"shadow rounded-circle bg-danger\" >\r\n            <i className=\"bi bi-plus-lg\"></i> \r\n        </Nav.Button>\r\n        \r\n        <Modal size=\"sm\" onKeyDown={ (e)=> (e.keyCode === 13) && submit() } tabIndex=\"0\" buttons={[button]} closeButton {...{show, setShow}} title={<span>Let's create a room</span>}>\r\n        <MD>{``}</MD>\r\n        <Form ref={ref}>\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"roomId\" className=\"mb-3\">\r\n                <Form.Control onChange={handleUserInput} required name=\"roomId\" type=\"text\" placeholder=\"roomId\"/>\r\n            </FloatingLabel>\r\n\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"password\" className=\"mb-3\">\r\n                <Form.Control name=\"password\" type=\"password\" placeholder=\"password\"/>\r\n            </FloatingLabel>\r\n\r\n            <FloatingLabel controlId=\"floatingInput\" label=\"icon\" className=\"mb-3\">\r\n                <Form.Control name=\"icon\" type=\"text\" placeholder=\"icon URL\"/>\r\n            </FloatingLabel>\r\n\r\n            <Form.Switch id=\"hidden-switch\" label=\"Hidden\" name=\"hidden\" defaultValue={false}/>\r\n        </Form>\r\n        </Modal>\r\n        <style global jsx>{`\r\n            #new-room-card {\r\n                cursor: pointer;\r\n                opacity: .5;\r\n                border: 2px dashed white;\r\n\r\n                .card-img-top{\r\n                    display: none;\r\n                }\r\n                .card-body{\r\n                    height: 155px;\r\n                }\r\n            }\r\n\r\n        `}</style>\r\n    </>;\r\n}","import { useContext, useEffect } from 'react'\r\nimport {useHistory} from 'react-router-dom'\r\nimport {Row, Col, Card} from 'react-bootstrap'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\nimport CreateRoomModal from 'components/modal_create_room'\r\n\r\n\r\nfunction RoomTile({id, name, ...props}){\r\n    return <div>\r\n    \r\n        <Card className=\"bg-dark text-light\" {...props}>\r\n            <Card.Img variant=\"top\" src={`https://unsplash.it/seed/tesst-${name}/160/100`} />\r\n            <Card.Body>\r\n            <Card.Title>#{name}</Card.Title>\r\n            {/*<Card.Text></Card.Text>*/}\r\n            </Card.Body>\r\n        </Card>\r\n\r\n        <style global jsx>{`\r\n            @import 'src/variables.scss';\r\n\r\n            .card {\r\n                cursor: pointer;\r\n                user-select: none;\r\n                transition: all 0.075s ease-in-out;\r\n\r\n                &:hover {\r\n                    .card-body{\r\n                        background: lighten($dark,25%);\r\n                    }\r\n                        \r\n                    box-shadow: 0 0 0px 2px rgba(255, 255, 255, .5) !important;\r\n                }\r\n\r\n                .card-body{\r\n                    transition: all 0.075s ease-in-out;\r\n                    .card-title{\r\n                        margin:0;\r\n                        font-size: 1rem;\r\n                        white-space: nowrap;\r\n                    }\r\n                }\r\n            }\r\n        `}</style>\r\n    </div>\r\n}\r\n\r\nfunction onKeyPress(){\r\n}\r\n\r\nexport default ()=>{\r\n    const history = useHistory();\r\n    const rooms = useContext(RoomsContext);\r\n\r\n    useEffect( ()=>{\r\n\r\n    }, [rooms.list])\r\n\r\n\r\n    return <>\r\n        <Row onKeyPress={onKeyPress} id=\"lobby\" className=\"h-100 m-auto\">\r\n            <Col xs={12} sm={{span:10, offset:1}} >\r\n        \r\n            <h1 className=\"text-light\">Lobby</h1>    \r\n            <Row xs={2} sm={4} lg={4} xl={5} className=\"g-4\">\r\n            { [...Object.values(rooms.list)].map((v,k) => <Col key={k}>\r\n                    <RoomTile name={` ${v?.name || 'Room '+k}`} onClick={()=>rooms.joinRoom(v?.name)}/>\r\n                </Col>\r\n            )}\r\n            </Row>\r\n\r\n            </Col>\r\n        </Row>\r\n        <style global jsx>{`\r\n            #lobby{\r\n                min-height: 19rem;\r\n            }    \r\n        `}</style>\r\n    </>\r\n}\r\n//{name:'room test'},{name:'low coverage'},{name:'volcano'},{name:'ecogreen'},{name:'weathercast'},...","import { useState, useEffect } from 'react'\r\nimport { Row, Col } from 'react-bootstrap'\r\nimport MD from 'utils/md'\r\nimport Gesture from 'rc-gesture'\r\nimport { findByDisplayValue } from '.pnpm/@testing-library+dom@8.10.1/node_modules/@testing-library/dom'\r\nimport Modal from 'partials/modal'\r\n\r\nexport default ({show, setShow, ...props}) => {\r\n    const pages = [\"Devices\",\"p1\", \"p2\", \"p3\"];\r\n    const [selected, setSelected] = useState(0);\r\n    const [page, setPage] = useState(null);\r\n    const [views, setViews] = useState([]);\r\n\r\n    //use useEffect to fetch page views dynamically\r\n    useEffect(() => {\r\n        (async () => {\r\n            let vs = [];\r\n            for (let p of pages)\r\n                await import(`pages/${p}.jsx`).then(v => vs.push(<v.default />))\r\n            setViews([...vs]);\r\n            setPage(vs[selected]);\r\n        })();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        setPage(views[selected]);\r\n    }, [selected]);\r\n\r\n    function onKeyPressed(e)\r\n    {\r\n        switch(e?.keyCode)\r\n        {\r\n            case 37: return setSelected( s => (s-1 < 0)? pages.length-1 : s-1 );\r\n            case 39: return setSelected( s => (s+1)%pages.length );\r\n        }\r\n    }\r\n\r\n    useEffect(()=>{\r\n            document.addEventListener(\"keydown\", onKeyPressed)\r\n        return ()=>{\r\n            document.removeEventListener(\"keydown\", onKeyPressed)\r\n        }\r\n    }, [])\r\n\r\n    return <div>\r\n        <Gesture\r\n            onSwipeLeft={ () => setSelected( s => (s+1)%pages.length ) } \r\n            onSwipeRight={() => setSelected( s => (s-1 < 0)? pages.length-1 : s-1 ) }\r\n            \r\n        >\r\n            {/*\r\n            <Row id=\"wizard\" className=\"pt-5 h-100 m-auto\">\r\n                <Col sm={12} md={{ span: 10, offset: 1 }} lg={{ span: 8, offset: 2 }} xl={{ span: 6, offset: 3 }} className=\"pt-3 bg-light shadow-lg rounded-bottom\" style={{zIndex:1000}}>\r\n            */}\r\n                <div>\r\n                    <ul className=\"nav nav-tabs justify-content-start mb-2\">\r\n                    { pages.map( (v,k) => <li key={k} className=\"nav-item\">\r\n                            <div className={`nav-link ${selected === k?\"active\":\"\"}`} onClick={()=>setSelected(k)}>{v}</div>  \r\n                    </li>)}\r\n                </ul>\r\n\r\n                {page}\r\n                </div>\r\n            {/*\r\n                </Col>\r\n            </Row>\r\n            */}\r\n        </Gesture>\r\n        <style global jsx>{`\r\n            #wizard{\r\n                .nav-tabs{\r\n                    width: calc(100% + 24px);\r\n                    margin-left: -12px;\r\n                    margin-top: -3.6rem;\r\n                    //margin-top: -1rem;\r\n                }\r\n\r\n                .modal-content{\r\n                    margin-top: 1.5rem;\r\n                    min-height: 555px;                \r\n                }\r\n            }    \r\n        `}</style>\r\n    </div>;\r\n}\r\n\r\n//xs={12} md={{span:6, offset:3}} lg={{span:8, offset:2}}","import React, {useContext, useState} from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport Nav from 'partials/nav'\r\nimport MD from 'utils/md';\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms = useContext(RoomsContext);\r\n    const [show, setShow] = useState(false);\r\n\r\n    \r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(1)} label=\"Leave room\" >\r\n            <i className=\"bi bi-telephone-x\"></i>Leave\r\n        </Nav.Item>\r\n        <Modal buttons={[<Button size=\"lg\" onClick={()=>rooms.leaveRoom()}>Yes, leave</Button>]} closeButton size=\"md\" {...{show, setShow}} title={<span>Hey! Are you sure?</span>}>\r\n            \r\n            <MD>{`\r\n            Are you sure you want to leave this room? Any call in progress will be lost and any active stream will be stopped.\r\n            `}</MD>\r\n            \r\n        </Modal>\r\n    </>;\r\n}","import { useState } from 'react'\r\n\r\nimport Nav from 'partials/nav'\r\nimport Wizard from 'views/wizard'\r\nimport Modal from 'partials/modal'\r\n\r\n\r\nexport default () => {\r\n    const [show, setShow]         = useState(false);\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} ><i className=\"bi bi-magic\"/>Settings</Nav.Item>\r\n        <Modal id='wizard' tabIndex=\"0\"  closeButton size=\"md\" {...{show, setShow}} _title={<span>Settings: Wizard</span>}>\r\n            <Wizard/>\r\n        </Modal>\r\n    </>;\r\n}","import React, {useContext, useEffect, useState} from 'react'\r\n\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const [show, setShow]         = useState(false);\r\n\r\n    //useEffect(() => {},[rooms.current]);// eslint-disable-line\r\n    \r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} disabled={!rooms.current} ><i className=\"bi bi-people\"/>Users</Nav.Item>\r\n        <Modal tabIndex=\"0\" closeButton size=\"md\" {...{show, setShow}} title={<span><i className=\"bi bi-people\"/> Users</span>}>\r\n            <ul>\r\n                {rooms.current?.users?.map( (v,k,a) => v && <li key={k}>{v?.username}</li> )}\r\n            </ul>            \r\n        </Modal>\r\n    </>;\r\n}","import React, {useContext, useEffect, useState} from 'react'\r\n\r\nimport Nav from 'partials/nav'\r\nimport Modal from 'partials/modal'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport default () => {\r\n    const rooms                   = useContext(RoomsContext);\r\n    const [show, setShow]         = useState(false);\r\n\r\n    //useEffect(() => {},[rooms.current]);//eslint-disable-line\r\n\r\n    return <>\r\n        <Nav.Item onClick={()=>setShow(s => !s)} disabled={!rooms.current}><i className=\"bi bi-chat-dots\"/>Chat</Nav.Item>\r\n        <Modal tabIndex=\"0\" closeButton size=\"md\" {...{show, setShow}} title={<span><i className=\"bi bi-chat-dots\"/> Chat</span>}>\r\n            <ul>\r\n                {rooms.current?.users?.map( (v,k,a) => v && <li key={k}>{v?.username}</li> )}\r\n            </ul>            \r\n        </Modal>\r\n    </>;\r\n}","import { useEffect, useState, useContext, useRef } from 'react'\r\n\r\nimport Nav from \"partials/nav\"\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\n\r\n\r\nexport default () => {\r\n    const canvasRef = useRef(null);\r\n    const media    = useContext(MediaContext);\r\n    const [isAudioEnabled, setAudioEnabled] = useState(false);\r\n    //const videotracks = media.localStream.getVideoTracks()??[];\r\n    //const [isVideoEnabled, setVideoEnabled] = useState(videotracks.every( v => v.enabled ));\r\n\r\n    function handleClick()\r\n    {\r\n        const audiotracks = media.localStream.getAudioTracks()??[];\r\n        const enabled = audiotracks.every(track => { track.enabled = !isAudioEnabled; return !!track.enabled;});\r\n        setAudioEnabled(enabled); \r\n    }\r\n\r\n    useEffect(() => {\r\n        const audiotracks = media.localStream.getAudioTracks()??[];\r\n        setAudioEnabled(audiotracks.every( v => v.enabled ))\r\n    } , [media.localStream, media.settings?.audio]);\r\n\r\n    useEffect(()=>{\r\n        const ctx = canvasRef?.current?.getContext('2d');\r\n        ctx.globalAlpha   = 0.5;\r\n        function draw()\r\n        {\r\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n            \r\n            const [x0, y0, r0, x1, y1, r1] = [ctx.canvas.width*.5, ctx.canvas.height * .5, 135, ctx.canvas.width*.5,ctx.canvas.height * .5,ctx.canvas.height * .5];\r\n            let gradient = ctx.createRadialGradient(x0, y0, r0, x1, y1, r1);\r\n            gradient.addColorStop(0, \"rgba(255, 255, 255, 0.0)\");\r\n            gradient.addColorStop(0.1, \"rgba(255, 255, 255, 0.5)\");\r\n            gradient.addColorStop(.5, \"rgba(255, 255, 255, 0.1)\");\r\n            gradient.addColorStop(1, \"rgba(255, 255, 255, 0.0)\");\r\n\r\n            ctx.fillStyle = gradient;\r\n            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n            requestAnimationFrame(draw)\r\n        }\r\n        const id = requestAnimationFrame(draw);\r\n        \r\n    return ()=>{\r\n        cancelAnimationFrame(id);\r\n    }\r\n    },[])\r\n\r\n    return <>\r\n    <div id='pulse-wrapper'className=\"p-4 rounded-circle\" style={{marginTop: '-4rem', marginBottom: '-4rem'}}>\r\n        <canvas width='512' height='512' ref={canvasRef} className='position-absolute top-0 rounded-circle'/>\r\n        <Nav.Button onClick={handleClick} label=\"Create room\" appendclass=\"shadow rounded-circle bg-danger\" >\r\n            <i className={isAudioEnabled?\"bi bi-mic\":\"bi bi-mic-mute\"}></i>\r\n        </Nav.Button>\r\n    </div>\r\n    \r\n    <style global jsx>{`\r\n        #pulse-wrapper {\r\n            //border: 1px dashed #ccc;\r\n            margin: -3rem -1.5rem 0rem -1.5rem !important;\r\n            overflow:hidden !important;\r\n\r\n            .nav-button{\r\n                margin-top: 0;\r\n                margin-bottom: 0;\r\n            }\r\n\r\n            canvas {\r\n                pointer-events: none;\r\n                margin-top: .35rem;\r\n                width: 5rem;\r\n                height:5rem;\r\n                transform:translate(-50%,-50%) scale(1.3) !important;\r\n            }\r\n    \r\n        }\r\n        @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n            #pulse-wrapper {\r\n                margin: -1.5rem 1rem -1.5rem -4rem !important;\r\n                .nav-button{\r\n                    margin-left: 0;\r\n                    margin-right: 0;\r\n                }\r\n                canvas {\r\n                    top: 50% !important;\r\n                    margin-top: 0rem;\r\n                }\r\n            }\r\n        }\r\n        @media only screen and (orientation: portrait){\r\n\r\n        } \r\n    \r\n    `}</style>\r\n    {/*\r\n    <Nav.Button>\r\n        <ButtonToolbar>\r\n            \r\n            <Button onClick={()=>{ \r\n                const enabled = audiotracks.every(track => { track.enabled = !isAudioEnabled; return !!track.enabled;});\r\n                setAudioEnabled(enabled); \r\n            }}><i className={isAudioEnabled?\"bi bi-mic-mute\":\"bi bi-mic-mute\"}></i></Button>\r\n            \r\n            <Button onClick={()=>{ \r\n                const enabled = videotracks.every(track => { track.enabled = !isVideoEnabled; return !!track.enabled;});\r\n                setVideoEnabled(enabled); \r\n            }}><i className={isVideoEnabled?\"bi bi-camera-video\":\"bi bi-camera-video-off\"}></i></Button>\r\n        \r\n        </ButtonToolbar>\r\n    </Nav.Button>\r\n    */}\r\n    </>\r\n}\r\n","import { useContext, useRef, useEffect } from 'react'\r\nimport { Container } from \"react-bootstrap\"\r\nimport { useHistory, Redirect } from \"react-router-dom\"\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nimport Nav from \"partials/nav\"\r\nimport Room  from 'views/room'\r\nimport Login  from 'views/login'\r\nimport Lobby  from 'views/lobby'\r\nimport Wizard from 'views/wizard'\r\nimport CreateRoomModal from 'components/modal_create_room'\r\nimport LeaveRoomModal from 'components/modal_leave_room'\r\nimport WizardModal from 'components/modal_wizard'\r\nimport UsersModal from 'components/modal_users'\r\nimport ChatModal from 'components/modal_chat'\r\nimport StreamButtons from 'components/btngrp_stream';\r\n\r\n\r\nfunction App({...props}) {\r\n  const history = useHistory();\r\n  const auth = useContext(AuthContext);\r\n  const rooms = useContext(RoomsContext);\r\n  let {current: view} = useRef();\r\n\r\n  if((/^\\/room\\/[a-zA-Z0-9]+/).test(history.location.pathname)) view = <Room container/>\r\n  if(history.location.pathname === '/'        ) view = <Lobby container/> \r\n  if(history.location.pathname === '/settings') view = <Wizard show={true} container/>\r\n  if((/^\\/room\\/[a-zA-Z0-9]+\\/chat$/).test(history.location.pathname)  ) view = <Redirect to=\"/\"/>\r\n  if((/^\\/room\\/[a-zA-Z0-9]+\\/users$/).test(history.location.pathname) ) view = <Redirect to=\"/\"/>\r\n\r\n  if(!(auth.isLogged && auth.isConnected))\r\n    return <div className=\"App\" children={<Login />}/>\r\n  else\r\n    return <>\r\n    <div className=\"App\">\r\n        \r\n      <Container fluid={view?.props?.container} id=\"content-wrapper\" > \r\n      {view}\r\n      </Container>\r\n\r\n      <Nav>\r\n          {rooms.current? <LeaveRoomModal/> : <Nav.Item><i className=\"bi bi-house\"/>Lobby</Nav.Item>}\r\n          <WizardModal/>\r\n          {rooms.current?<StreamButtons/>:<CreateRoomModal/>}\r\n          <UsersModal/>\r\n          <ChatModal/>\r\n      </Nav>\r\n \r\n \r\n    </div>\r\n    <style global jsx>{`\r\n      \r\n      html, body, .App{\r\n        overflow: hidden;\r\n        min-height:330px;\r\n      }\r\n\r\n      #content-wrapper{\r\n        height: 100%;\r\n        margin-bottom: 6rem;\r\n        margin-top: 3.5rem;\r\n        overflow-y: scroll;\r\n        overflow-x: hidden;\r\n        & .container-fluid{\r\n          margin:0 !important;\r\n        }\r\n      }\r\n\r\n      @media only screen and (orientation: landscape) and (max-height: 671px) {           \r\n          #content-wrapper{\r\n            margin-bottom: 1rem;\r\n            margin-top: 1rem;\r\n            margin-right:3rem;\r\n          }\r\n      }\r\n      @media only screen and (orientation: portrait){\r\n\r\n      }    \r\n    `}</style>\r\n  </>\r\n}\r\n\r\nexport default App;\r\n","import Gravatar from 'gravatar'\r\nimport {Form} from 'react-bootstrap'\r\nimport {useRef, useState, useEffect} from 'react'\r\n\r\nfunction testImageURL(url) {\r\n    return (url.match(/\\.(jpeg|jpg|gif|png)$/) != null);\r\n}\r\n\r\nfunction testImage(url, timeoutT) {\r\n    return new Promise(function (resolve, reject) {\r\n        var timeout = timeoutT || 5000;\r\n        var timer, img = new Image();\r\n        img.onerror = img.onabort = function () {\r\n            clearTimeout(timer);\r\n            reject(\"Error: the url provided is not an image\");\r\n        };\r\n        img.onload = function () {\r\n            clearTimeout(timer);\r\n            resolve(\"success\");\r\n        };\r\n        timer = setTimeout(function () {\r\n            // reset .src to invalid URL so it stops previous\r\n            // loading, but doesn't trigger new load\r\n            img.src = \"//!!!!/test.jpg\";\r\n            reject(\"timeout\");\r\n        }, timeout);\r\n        img.src = url;\r\n    });\r\n}\r\n\r\nfunction testEmail(email){\r\n    const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n    return re.test(email);\r\n}\r\n\r\nexport default function ({children, onSubmit, ...props}){\r\n    const formRef = useRef(null);\r\n    const [validated, setValidated]     = useState(undefined);\r\n    const [formvalues, setFormValues]   = useState({formErrors:{}});\r\n\r\n    function validateField(name, value, type = \"any\"){\r\n        let check = false;\r\n        let {formErrors} = formvalues;\r\n        let values = {...formvalues};\r\n\r\n        switch(type){\r\n            case 'email':\r\n                check = testEmail(value);\r\n                formErrors[name] = check ? '' : ' is invalid';\r\n\r\n                if(check){\r\n                    const url = \"https:\"+Gravatar.url(value, { s: '256', r: 'pg', d: '404' });\r\n                    testImage(url, 2000)\r\n                    .then( (v) =>   { setFormValues( { ...values, gravatar:url,   [`gravatar_check`]:check, formErrors } ); })\r\n                    .catch((err) => { setFormValues( { ...values, gravatar:null,  [`gravatar_check`]:check, formErrors } ); });\r\n                }else{\r\n                    values = { ...values, gravatar:null,  [`gravatar_check`]:check, formErrors };\r\n                }\r\n\r\n                break;\r\n\r\n            case 'password':\r\n                check = value.length >= 6;\r\n                formErrors[name] = check ? '': ' is too short';\r\n                break;\r\n\r\n            default:\r\n                check = true;\r\n                formErrors[name] = '';\r\n                break;\r\n        }\r\n        setFormValues( { ...values, [name]:value, [`${name}_check`]:check, formErrors } );\r\n    }\r\n\r\n    function validateForm(){\r\n        let isValid = true;\r\n        for( let key in formvalues ){\r\n            if( key.indexOf('_check') !== -1 )\r\n                isValid &= formvalues[key];\r\n        }\r\n        setValidated( isValid?true:false );\r\n    }\r\n\r\n    async function handleSubmit(e){\r\n        e.preventDefault();\r\n        if(onSubmit) \r\n            onSubmit();\r\n    }\r\n\r\n    useEffect(()=>{\r\n        validateForm();\r\n    },[formvalues]);\r\n\r\n    useEffect(()=>{\r\n        setValidated( false );\r\n    },[]);\r\n\r\n    function hasError(error){\r\n        return(error.length === 0 ? '' : 'has-error');\r\n    }\r\n\r\n    return <Form validated={validated} ref={formRef} {...props}>\r\n        {children}\r\n    </Form>\r\n}","import React, {useState, useContext } from 'react';\r\nimport { Form, FloatingLabel, ButtonGroup, Button, Image } from 'react-bootstrap';\r\nimport Modal from 'partials/modal'\r\nimport MD from 'utils/md';\r\nimport { AuthContext } from 'utils/ctx_authentication';\r\n\r\nimport profile_img from 'assets/img/profile_light.png'\r\nimport HForm from 'utils/forms'\r\n\r\nexport default () => {\r\n    const [show, setShow] = useState(false);\r\n    const auth = useContext(AuthContext);\r\n    \r\n    //introduction message to user settings panel\r\n    \r\n    function onSubmit(){\r\n        \r\n    }\r\n\r\n\r\n    if(!auth.isLogged) return <></>;\r\n    return <>\r\n        <Button variant=\"link\" onClick={ ()=>setShow(1) }>Profile</Button>\r\n        <HForm onSubmit={onSubmit}>\r\n\r\n        <Modal closeButton size=\"lg\" {...{show, setShow}} \r\n        title={<h2 className=\"user-select-none\">Profile: {auth.user.username}</h2>}\r\n        buttons={[<Button onClick={auth.logout}><i className=\"bi bi-power\"></i> Log me out</Button>]}\r\n        >\r\n        <Image\r\n            id=\"avatar-img\"\r\n            src={ auth.user?.avatar.length? auth.user?.avatar : profile_img }\r\n            roundedCircle\r\n            className='position-absolute top-0 start-50 bg-danger shadow'\r\n            width=\"128\" height=\"128\"\r\n        />\r\n\r\n        <MD className=\"user-select-none\">{`\r\n            # Welcome to your settings\r\n            Welcome to your settings.\r\n            This panel is where you can change your profile information.\r\n            You can also change your password.\r\n            If you have any questions, please contact us.\r\n        `}</MD>\r\n\r\n        <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"username\">     <Form.Control name='username'   placeholder='username'   /*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['username'  ]}*/     />      </FloatingLabel>} />\r\n        <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"email\">        <Form.Control name='email'      placeholder='email'      /*onChange={handleUserInput}*/ type=\"email\"     /*defaultValue={formvalues['email'     ]}*/     />      </FloatingLabel>} />{/*value={userEmail} onChange={event => setEmail(event.target.value)} isInvalid={!isEmailValid} /> */}\r\n        <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"password\">     <Form.Control name='password'   placeholder='password'   /*onChange={handleUserInput}*/ type=\"password\"  /*defaultValue={formvalues['password'  ]}*/     />      </FloatingLabel>} />\r\n        <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"avatar URL\">   <Form.Control name='avatar'     placeholder='avatar URL' /*onChange={handleUserInput}*/ type=\"avatar\"    /*defaultValue={formvalues['avatar URL']}*/     />      </FloatingLabel>} />{/*value={image_url !== '' ? image_url : userEmail !== '' ? gravatar_url : ''} onChange={event => setImageURL(event.target.value)} */}\r\n        <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"name\">         <Form.Control name='name'       placeholder='name'       /*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['name'      ]}*/     />      </FloatingLabel>} />\r\n        <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"surname\">      <Form.Control name='surname'    placeholder='surname'    /*onChange={handleUserInput}*/ type=\"text\"      /*defaultValue={formvalues['surname'   ]}*/     />      </FloatingLabel>} />\r\n        <Form.Group className=\"mb-1\" children={<FloatingLabel label=\"birthddate\">   <Form.Control name='birthdate'  placeholder='birthdate'  /*onChange={handleUserInput}*/ type=\"date\"      /*defaultValue={formvalues['birthdate' ]}*/     />      </FloatingLabel>} />\r\n        \r\n\r\n        <div align=\"center\" className=\"fw-bolder\">\r\n        <ButtonGroup>\r\n            <Button variant = \"outline-primary\">Save</Button>\r\n            <Button variant = \"outline-secondary\">Discard</Button>\r\n        </ButtonGroup>\r\n\r\n        </div>\r\n        </Modal>\r\n        </HForm>\r\n        <style global jsx>{`\r\n            #avatar-img{\r\n                transform: translate(-50%,-125%) !important;\r\n            }\r\n        `}</style>\r\n    </>;\r\n}","import * as BRA from 'lib_bra'\r\nimport toast from  'react-hot-toast'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport React, { createContext, useContext, useEffect, useState } from 'react'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\n\r\n\r\nexport const RoomsContext = createContext(); \r\n\r\nexport default ({children, ...props}) => {\r\n    const auth    = useContext(AuthContext);\r\n    const history = useHistory();\r\n    \r\n    let   [rooms, setRooms]     = useState({});\r\n    const [ready, setReady]     = useState(false);\r\n    let   [current, setCurrent] = useState(null);\r\n    \r\n    useEffect( ()=>{ \r\n        if(!auth.isLogged) return;\r\n        \r\n        BRA.appClient.on(BRA.APPEvent.GuestLeftRoom,     onGuestLeft);\r\n        BRA.appClient.on(BRA.APPEvent.GuestJoinedRoom,   onGuestJoin);\r\n        BRA.appClient.on(BRA.APPEvent.RoomCreated,       onRoomCreated);\r\n        BRA.appClient.on(BRA.APPEvent.RoomDeleted,       onRoomDeleted);\r\n\r\n        //Initial fetch of rooms\r\n        BRA.appClient.getRooms( (m1) => { onGetRooms(m1)\r\n            BRA.appClient.getRoom(  (m2) => { onGetRoom(m2); \r\n            setReady(true);\r\n        });});\r\n\r\n    return ()=>{\r\n        BRA.appClient.off(BRA.APPEvent.GuestLeftRoom,    onGuestLeft);\r\n        BRA.appClient.off(BRA.APPEvent.GuestJoinedRoom,  onGuestJoin);\r\n        BRA.appClient.off(BRA.APPEvent.RoomCreated,      onRoomCreated);\r\n        BRA.appClient.off(BRA.APPEvent.RoomDeleted,      onRoomDeleted);\r\n    }}, [auth.isLogged]);\r\n\r\n    function isUserInRoom(username, roomName)\r\n    {\r\n        const room = {...rooms,[current?.name]:current}[roomName];\r\n        for(let user of room?.users??[]){\r\n            if(user?.username === username) \r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function imInRoom(roomName)\r\n    {\r\n        return isUserInRoom(auth.user?.username, roomName);\r\n    }\r\n\r\n    function onRoomCreated({data:{room}}){\r\n        setRooms({...rooms, [room.name]:room});\r\n    }\r\n\r\n    function onRoomDeleted({data:{room}}){\r\n        delete rooms[room.name];\r\n        setRooms({...rooms});\r\n        BRA.appClient.getRoom(onGetRoom)\r\n    }\r\n\r\n    function onGuestLeft({data:{user,room}})\r\n    {\r\n        BRA.appClient.getRoom(onGetRoom);\r\n        toast(`User '${user.username}' left`);\r\n        if(current)\r\n            setCurrent( {...current, users: current?.users??[].filter(u=>u.username!==user.username)} );\r\n    }    \r\n    \r\n    function onGuestJoin({data:{user,room}})\r\n    {\r\n        BRA.appClient.getRoom(onGetRoom);\r\n        toast(`User '${user.username}' joined`);\r\n        if(current)\r\n            setCurrent( {...current, users: current?.users??[].push(user)} );\r\n    }\r\n    \r\n    function onGetRoom({ data: {room} }){\r\n        setCurrent(room?.name?{...room}:null);\r\n\r\n        if(room?.name)\r\n        {\r\n            if(history.location.pathname !== `/room/${room?.name}`){\r\n                history.push(`/room/${room?.name}`);\r\n            }\r\n        }\r\n        else{\r\n            history.push(`/`);\r\n        }\r\n    }\r\n\r\n    function onGetRooms({data:{rooms}}){\r\n        let rs = {};\r\n        for(let room of rooms??[])\r\n            rs[room.name] = room;\r\n        setRooms(rs);\r\n    }\r\n\r\n    function createRoom(roomName, {password, hidden, icon}){\r\n        return new Promise((resolve, reject)=>{\r\n            BRA.appClient.createRoom(roomName, password??\"\", hidden??false, icon??\"\", ({event, data}) => {\r\n                if(data.error) reject(data.message);\r\n                else resolve(data.room);\r\n            });\r\n        })\r\n        .then(  (room)=>{ BRA.appClient.getRoom(onGetRoom); return room; } )\r\n        //.catch( (e) => toast.error(e) );\r\n    }\r\n\r\n    function joinRoom(roomName){\r\n        return new Promise((resolve, reject) => {\r\n            BRA.appClient.joinRoom(roomName,\"\",({event, data}) => {\r\n                if(data.error) reject(data.message);\r\n                else resolve(data.room);\r\n            });\r\n        })    \r\n        .then(  (room)=>{ BRA.appClient.getRoom(onGetRoom); return room; } )\r\n        //.catch( (e) => toast.error(e) );\r\n    }\r\n\r\n    function leaveRoom(){\r\n        return new Promise((resolve, reject)=>{\r\n            BRA.appClient.leaveRoom(({event, data}) => {\r\n                if(data.error) reject(data.message);\r\n                else resolve(data.room);\r\n            });\r\n        })\r\n        .then(  (room)=>{ BRA.appClient.getRoom(onGetRoom); return room; } )\r\n        //.catch( (e)=> toast.error(e) );\r\n    }\r\n\r\n\r\n    const store = window.rooms = {\r\n        joinRoom,\r\n        leaveRoom,\r\n        createRoom,\r\n        setCurrent,\r\n        imInRoom,\r\n        isUserInRoom,\r\n        ready,\r\n        current,\r\n        list: rooms,\r\n    }\r\n\r\n    return <RoomsContext.Provider value={store} children={children}/>\r\n}","import rehypeRaw from 'rehype-raw'\r\nimport remarkGfm from 'remark-gfm'\r\nimport remarkBreaks from 'remark-breaks'\r\nimport ReactMarkdown from 'react-markdown'\r\n\r\nexport default ({children,...props}) => {\r\n    return <ReactMarkdown children={children.replaceAll(\"  \",\"\")} remarkPlugins={[remarkGfm, remarkBreaks]} rehypePlugins={[rehypeRaw]} {...props}/>\r\n}","import http from \"utils/http\"\r\nimport * as BRA from \"lib_bra\";\r\nimport cookies from '@h3r/cookies'\r\nimport toast from 'react-hot-toast'\r\nimport { createContext, useEffect, useState, useRef, } from 'react'\r\n\r\nexport const AuthContext = createContext()\r\n\r\nexport default ({children, ...props}) => {\r\n    const [ user,        setUser      ] = useState(null);\r\n    const [ token,       setToken     ] = useState(cookies.get(\"admire_app_token\"));\r\n    const [ isLogged,    setLogged    ] = useState(false);\r\n    const [ isConnected, setConnected ] = useState({app:false, rtc:false});\r\n    let   { current: toast_app }        = useRef(null);\r\n    let   { current: toast_rtc }        = useRef(null);\r\n    let   { current: toast_usr }        = useRef(null);\r\n    const [ retries, setRetries ]       = useState(0);        \r\n\r\n\r\n    useEffect( ()=>{ //Constructor\r\n        function onUnload(){\r\n            BRA.rtcClient.unregister();\r\n            BRA.rtcClient.disconnect();\r\n            BRA.appClient.disconnect(); \r\n            window.removeEventListener('unload', onUnload);\r\n        }\r\n        window.addEventListener('unload', onUnload);\r\n\r\n        function onAppConnect    (){ toast(\"App Connected\",    {id:toast_app, icon:'', duration:2000}); setConnected( v => ({...v, app:true })); }\r\n        function onRtcConnect    (){ toast(\"RTC Connected\",    {id:toast_rtc, icon:'', duration:2000}); setConnected( v => ({...v, rtc:true })); }\r\n        function onAppDisconnect (){ toast(\"App Disconnected\", {id:toast_app, icon:'', duration:2000}); setConnected( v => ({...v, app:false})); }\r\n        function onRtcDisconnect (){ toast(\"RTC Disconnected\", {id:toast_rtc, icon:'', duration:2000}); setConnected( v => ({...v, rtc:false})); }\r\n\r\n        BRA.appClient.on(BRA.APPEvent.ClientConnected,      onAppConnect   );\r\n        BRA.rtcClient.on(BRA.RTCEvent.ClientConnected,      onRtcConnect   );\r\n        BRA.appClient.on(BRA.APPEvent.ClientDisconnected,   onAppDisconnect);\r\n        BRA.rtcClient.on(BRA.RTCEvent.ClientDisconnected,   onRtcDisconnect);\r\n\r\n    return ()=>{ //Destructor\r\n        BRA.appClient.off(BRA.APPEvent.ClientConnected,     onAppConnect        );\r\n        BRA.appClient.off(BRA.RTCEvent.ClientConnected,     onAppDisconnect     );\r\n        BRA.rtcClient.off(BRA.APPEvent.ClientDisconnected,  onRtcConnect        );\r\n        BRA.rtcClient.off(BRA.RTCEvent.ClientDisconnected,  onRtcDisconnect     );\r\n\r\n        onUnload();\r\n    }\r\n    }, []);\r\n\r\n\r\n    useEffect( ()=>{\r\n        if(!isConnected.app && token){\r\n            BRA.appClient.connect(process.env.REACT_APP_APP_URL, token);\r\n        }\r\n    }, [isConnected.app, token]);\r\n\r\n    useEffect( ()=>{\r\n        if(!isConnected.rtc && token){\r\n            BRA.rtcClient.connect(process.env.REACT_APP_RTC_URL, token);\r\n        }\r\n    }, [isConnected.rtc, token]);\r\n\r\n    useEffect( ()=>{\r\n        if(isConnected.rtc && isConnected.app && token && !isLogged) //Im properly connected\r\n        {\r\n            toast_usr = toast.loading(`Fetching user info...`, {duration:Infinity});\r\n            getUserInfo()\r\n            .then( (response) => {\r\n                toast.success(`Success`, {id:toast_usr, icon:'', duration:2000});\r\n                setUser(response);\r\n                setLogged(true);\r\n            })\r\n            .catch( ({error, message}) => {\r\n                toast.error(`onGetUserInfo(e:${error}): ${message}`, {id:toast_usr, icon:'', duration:4000});\r\n                if(retries >= 3) logout();\r\n                else \r\n                {\r\n                    toast((t) => {\r\n                        const [timer, setTimer] = useState(t.duration * .001);\r\n                        useEffect( ()=>{ const interval_id = setInterval(()=>setTimer(s=>Math.max(0,s-1)), 1000);   //Toast Constructor\r\n                            return ()=>{ clearInterval(interval_id);    setRetries(v => v+1);                       //Toast Destructor\r\n                        }}, []);\r\n                        return <span>{timer === 0 ? `Retrying`:`Retrying in ${timer}s...`}</span>\r\n                    },{duration:5000});\r\n                }\r\n            });\r\n        }\r\n        if(isConnected.rtc && isConnected.app && isLogged){\r\n            BRA.rtcClient.register(user.username);\r\n        }\r\n    },[isConnected.rtc && isConnected.app, token, isLogged, retries]);\r\n\r\n    async function login(email, password){\r\n        const toastId = toast.loading('Logging in...');\r\n        email = email.toLowerCase();\r\n        setToken(null);\r\n        return http.post(`${process.env.REACT_APP_API_URL}/auth/basic`, {data:{ email, password }})\r\n        .then(response => {\r\n            if(response?.access_token){\r\n                toast.success('Success login', { id: toastId });\r\n                setToken(response.access_token);\r\n                return response.access_token;\r\n            }\r\n            else {\r\n                toast.error(`Error ${response.error}: ${response.message}`, { id: toastId });\r\n                setTimeout(logout,2000)\r\n            }\r\n        })\r\n        .catch(err => toast.error(`Error catch: ${err}`, { id: toastId }));\r\n    }\r\n\r\n    async function logout(){\r\n        cookies.set(\"admire_app_email\",null,-1);\r\n        cookies.set(\"admire_app_token\",null,-1);\r\n        setToken(null);\r\n        setLogged(false);\r\n        toast('Logged out');\r\n        \r\n        BRA.rtcClient.unregister();\r\n        BRA.rtcClient.disconnect();\r\n        BRA.appClient.disconnect(); \r\n        setRetries(0);\r\n    }\r\n\r\n    async function getUserInfo(){\r\n        return new Promise((resolve, reject) => {\r\n            http.get(`${process.env.REACT_APP_API_URL}/users/me`, {headers:{Authorization:`Bearer ${token}`}})\r\n            .then( response => {\r\n                if(response?.error) reject(response);\r\n                else resolve(response);\r\n            })\r\n            .catch(err => reject(err));\r\n        });\r\n    }\r\n    \r\n    const store = window.auth = {\r\n        user       \r\n        ,isLogged\r\n       ,isConnected: isConnected.app && isConnected.rtc\r\n       ,login\r\n       ,logout\r\n   }\r\n \r\n    return <AuthContext.Provider value={store}> \r\n        {children}\r\n    </AuthContext.Provider>\r\n}","var map = {\n\t\"./Devices.jsx\": [\n\t\t468,\n\t\t3\n\t],\n\t\"./p1.jsx\": [\n\t\t465,\n\t\t4\n\t],\n\t\"./p2.jsx\": [\n\t\t466,\n\t\t5\n\t],\n\t\"./p3.jsx\": [\n\t\t467,\n\t\t6\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 457;\nmodule.exports = webpackAsyncContext;","const reportWebVitals = (onPerfEntry) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\n\r\nimport Layout from 'partials/layout'\r\nimport {ProgressBar} from 'react-bootstrap';\r\n\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n      <React.Suspense children={<Layout/>} fallback={<ProgressBar className=\"start-50\" animated now={100} />}/>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://cra.link/PWA\r\nserviceWorkerRegistration.register();\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","\r\nlet http = {\r\n    get: async function(url, options = {}) {\r\n        const headers = Object.assign({\r\n            'Content-Type': 'application/json'\r\n        }, options.headers ?? {});\r\n\r\n        return fetch(url, {method: 'GET',headers})\r\n        .then(response => response.json())\r\n        .catch(error => console.trace(error));\r\n    },\r\n\r\n    post: async function(url, options = {}) {\r\n        const headers = Object.assign({\r\n            'Content-Type': 'application/json'\r\n        }, options.headers ?? {});\r\n\r\n        const body = JSON.stringify(options.data ?? {});\r\n\r\n        return fetch(url, {method: 'POST',headers,body})\r\n        .then(response =>  response.json())\r\n        .catch(error => console.trace(error));\r\n    },\r\n}\r\n\r\nexport default http;","export const RTCEvent =\r\n{\r\n\tClientConnected:        \"client_connected\",\r\n\tClientDisconnected:     \"client_disconnected\",\r\n    IncomingCall:           \"incoming_call\",\r\n    CallAccepted:           \"call_accepted\",\r\n    CallCanceled:           \"call_canceled\",\r\n    CallOpened:             \"call_opened\",\r\n    CallClosed:             \"call_closed\",\r\n    UserHangup:             \"user_hangup\"\r\n};\r\n\r\nexport function RTCClient( settings )\r\n{\r\n//#region Variables\r\n    let defaultSettings =\r\n    {\r\n        debug: false,\r\n        debugStyle: \"background: hsla(0, 0%, 13%, 1); color: hsla(74, 64%, 60%, 1)\",\r\n        pingPeriod: 5 * 1000,\r\n        defaultStream: new MediaStream()\r\n    };\r\n\r\n    settings = (typeof settings !== \"object\") ? { } : settings;\r\n    settings = Object.assign({ }, defaultSettings, settings);\r\n\r\n    let console = (settings.debug) ? window.console : null;\r\n\r\n    let responses = { };\r\n    let events = { };\r\n\r\n    let calls = { };\r\n    let socket = null;\r\n    let keepAliveTimeout = null;\r\n\r\n    let userId = null;\r\n    let rtcConfiguration = { iceServers: null };\r\n//#endregion\r\n\r\n//#region Methods\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(RTCEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Get the call identified by the specified ID.\r\n     */\r\n    let getCall = function( callId )\r\n    {\r\n        return (callId in calls) ? calls[callId] : null;\r\n    };\r\n \r\n    /**\r\n     * Get all the calls.\r\n     */\r\n    let getCalls = function()\r\n    {\r\n        return calls;\r\n    };\r\n\r\n    /**\r\n     * Connect to the server.\r\n     */\r\n    let connect = function( url )\r\n    {\r\n        if( socket && socket.readyState != WebSocket.CLOSED )\r\n        {\r\n            console?.error(\"WebSocket not closed\");\r\n            return;\r\n        }\r\n\r\n        socket = new WebSocket(url);\r\n\r\n        socket.onopen = onOpen;\r\n        socket.onmessage = onMessage;\r\n        socket.onclose = onClose;\r\n    };\r\n\r\n    /**\r\n     * Disconnect from the server.\r\n     */\r\n    let disconnect = function()\r\n    {\r\n        if( !socket )\r\n        {\r\n            console?.error(\"WebSocket not opened\");\r\n            return;\r\n        }\r\n        socket?.close();\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is opened.\r\n     */\r\n    let onOpen = function( event )\r\n    {\r\n        startKeepAlive();\r\n\r\n        console?.log(\"%c\" + RTCEvent.ClientConnected + \"%o\", settings.debugStyle, socket.url);\r\n\r\n        emit(RTCEvent.ClientConnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is closed.\r\n     */\r\n    let onClose = function( event )\r\n    {\r\n        userId = null;\r\n        rtcConfiguration.iceServers = null;\r\n\r\n        stopKeepAlive();\r\n\r\n        console?.log(\"%c\" + RTCEvent.ClientDisconnected + \"%o\", settings.debugStyle, socket.url);\r\n        emit(RTCEvent.ClientDisconnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when a message is received from the server.\r\n     */\r\n    let onMessage = function( msg )\r\n    {\r\n        let message = JSON.parse(msg.data);\r\n        if( message.id === \"pong\" )\r\n        {\r\n            return;\r\n        }\r\n\r\n        console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.id, msg.data);\r\n\r\n        // Check whether the message needs internal handling.\r\n        switch( message.id )\r\n        {\r\n            case \"register_response\":       handleRegisterResponse(message);        break;\r\n            case \"unregister_response\":     handleUnregisterResponse(message);      break;\r\n            case \"call_response\":           handleCallResponse(message);            break;\r\n            case \"incoming_call\":           handleIncomingCall(message);            break;\r\n            case \"call_accepted\":           handleCallAccepted(message);            break;\r\n            case \"call_canceled\":           handleCallCanceled(message);            break;\r\n            case \"remote_offer\":            handleRemoteOffer(message);             break;\r\n            case \"remote_answer\":           handleRemoteAnswer(message);            break;\r\n            case \"remote_candidate\":        handleRemoteCandidate(message);         break;\r\n            case \"user_hangup\":             handleUserHangup(message);              break;\r\n        }\r\n\r\n        // Check whether the message has a response listener.\r\n        if( message.uuid in responses )\r\n        {\r\n            let response = responses[message.uuid];\r\n            delete responses[message.uuid];\r\n            delete message.uuid;\r\n            response(message);\r\n        }\r\n\r\n        // Check whether the message has an event.\r\n        emit(message.id, message);\r\n    };\r\n\r\n    /**\r\n     * Send a message to the server.\r\n     */\r\n    let sendMessage = function( message, response )\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Generate a UUID.\r\n        message.uuid = uuid();\r\n\r\n        // Add the response listener.\r\n        if( response instanceof Function )\r\n        {\r\n            responses[message.uuid] = response;\r\n        }\r\n\r\n        // Send the message.\r\n        let msg = JSON.stringify(message);\r\n        socket.send(msg);\r\n        if( message.id !== \"ping\" )\r\n        {\r\n            console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.id, msg);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start a keep alive timeout.\r\n     */\r\n    let startKeepAlive = function()\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            console?.error(\"WebSocket not opened\");\r\n            return false;\r\n        }\r\n\r\n        ping();\r\n\r\n        keepAliveTimeout = window.setTimeout(startKeepAlive, settings.pingPeriod);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Stop the keep alive timeout.\r\n     */\r\n    let stopKeepAlive = function()\r\n    {\r\n        window.clearTimeout(keepAliveTimeout);\r\n    };\r\n \r\n    /**\r\n     * Send a ping to the server.\r\n     */\r\n    let ping = function()\r\n    {\r\n        let message =\r\n        {\r\n            id: \"ping\"\r\n        };\r\n        return sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Register to the server.\r\n     */\r\n    let register = function( username, response )\r\n    {\r\n        if( userId )\r\n        {\r\n            console?.error(\"Client already registered\");\r\n            return false;\r\n        }\r\n\r\n        let message =\r\n        {\r\n            id: \"register\",\r\n            userId: username\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Unregister from the server.\r\n     */\r\n    let unregister = function( response )\r\n    {\r\n        if( !userId )\r\n        {\r\n            console?.error(\"Client not registered\");\r\n            return false;\r\n        }\r\n\r\n        hangup();\r\n\r\n        let message =\r\n        {\r\n            id: \"unregister\",\r\n            userId: userId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Call a user.\r\n     */\r\n    let call = function( calleeId, response )\r\n    {\r\n        if( userId === calleeId )\r\n        {\r\n            console?.error(\"Invalid user id \" + calleeId);\r\n            return false;\r\n        }\r\n\r\n        let message =\r\n        {\r\n            id: \"call\",\r\n            callerId: userId,\r\n            calleeId: calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Close a call.\r\n     */\r\n    let closeCall = function( callId )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let call = calls[callId];\r\n        call.close();\r\n        delete(calls[callId]);\r\n\r\n        emit(RTCEvent.CallClosed, { call: call });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Accept a call.\r\n     */\r\n    let acceptCall = function( callId, response )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            console?.error(\"Call \" + callId + \" not found\");\r\n            return false;\r\n        }\r\n\r\n        let call = calls[callId];\r\n\r\n        let message =\r\n        {\r\n            id: \"accept_call\",\r\n            callId: call.callId,\r\n            callerId: call.callerId,\r\n            calleeId: call.calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Cancel a call.\r\n     */\r\n    let cancelCall = function( callId, response )\r\n    {\r\n        if( !(callId in calls) )\r\n        {\r\n            console?.error(\"Call \" + callId + \" not found\");\r\n            return false;\r\n        }\r\n\r\n        // Delete the call.\r\n        let call = calls[callId];\r\n        delete calls[callId];\r\n\r\n        let message =\r\n        {\r\n            id: \"cancel_call\",\r\n            callId: call.callId,\r\n            callerId: call.callerId,\r\n            calleeId: call.calleeId\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Hang up a call. If call ID is undefined then all calls are hang up.\r\n     */\r\n    let hangup = function( callId, response )\r\n    {\r\n        if( callId ) // Close the call.\r\n        {\r\n            if( !closeCall(callId) )\r\n            {\r\n                return false;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"hangup\",\r\n                callId: callId\r\n            };\r\n            return sendMessage(message, response);\r\n        }\r\n        else // Close all the calls.\r\n        {\r\n            for( let callId in calls )\r\n            {\r\n                if( !closeCall(callId) )\r\n                {\r\n                    continue;\r\n                }\r\n\r\n                let message =\r\n                {\r\n                    id: \"hangup\",\r\n                    callId: callId\r\n                };\r\n                sendMessage(message);\r\n            }\r\n\r\n            calls = { };\r\n\r\n            return true;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier.\r\n     * Reference: RFC 4122 https://www.ietf.org/rfc/rfc4122.txt\r\n     */\r\n    let uuid = function()\r\n    {\r\n        return uuidv4();\r\n    };\r\n \r\n    /**\r\n     * Generate a universally unique identifier v4.\r\n     * Reference: https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\r\n     */\r\n    let uuidv4 = function()\r\n    {\r\n        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\r\n        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\r\n        );\r\n    };\r\n//#endregion\r\n\r\n//#region EventHandlers\r\n    /**\r\n     * Register response event handler.\r\n     */\r\n    let handleRegisterResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            userId = event.userId;\r\n            rtcConfiguration.iceServers = JSON.parse(event.iceServers);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Unregister response event handler.\r\n     */\r\n    let handleUnregisterResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            userId = null;\r\n            rtcConfiguration.iceServers = null;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Call response event handler.\r\n     */\r\n    let handleCallResponse = function( event )\r\n    {\r\n        if( event.status === \"ok\" )\r\n        {\r\n            // Create the call.\r\n            let call = new RTCCall(event.callId, event.callerId, event.calleeId);\r\n            calls[call.callId] = call;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Incoming call event handler.\r\n     */\r\n    let handleIncomingCall = function( event )\r\n    {\r\n        // Create the call.\r\n        let call = new RTCCall(event.callId, event.callerId, event.calleeId);\r\n        calls[event.callId] = call;\r\n    };\r\n\r\n    /**\r\n     * Call accepted event handler.\r\n     */\r\n    let handleCallAccepted = function( event )\r\n    {\r\n        // Create the peer connection.\r\n        let peerConnection = new RTCPeerConnection(rtcConfiguration);\r\n        let call = calls[event.callId];\r\n        call.bind(peerConnection, true);\r\n\r\n        // Handle the peer connection lifecycle.\r\n        peerConnection.oniceconnectionstatechange = function( other )\r\n        {\r\n            handleIceConnectionStateChange(call);\r\n        }\r\n\r\n        // Generate candidates.\r\n        peerConnection.onicecandidate = function( other )\r\n        {\r\n            if( !other.candidate || other.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n            {\r\n                return;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"candidate\",\r\n                callId: event.callId,\r\n                callerId: event.callerId,\r\n                calleeId: event.calleeId,\r\n                candidate: JSON.stringify(other.candidate)\r\n            };\r\n            sendMessage(message);\r\n        };\r\n\r\n        peerConnection.onnegotiationneeded = function( other )\r\n        {\r\n            // Generate offer.\r\n            peerConnection.createOffer().then(function( sdp )\r\n            {\r\n                // Set caller local description.\r\n                peerConnection.setLocalDescription(sdp);\r\n\r\n                let message =\r\n                {\r\n                    id: \"offer\",\r\n                    callId: event.callId,\r\n                    callerId: event.callerId,\r\n                    calleeId: event.calleeId,\r\n                    offer: JSON.stringify(sdp)\r\n                };\r\n                sendMessage(message);\r\n            });\r\n        };\r\n\r\n        // Add the tracks. This action triggers the ICE negotiation process.\r\n        let tracks = settings.defaultStream.getTracks();\r\n        tracks.forEach(track => peerConnection.addTrack(track));\r\n\r\n        // Create a default data channel to avoid renegotiation.\r\n        peerConnection.createDataChannel(\"default\");\r\n    };\r\n\r\n    /**\r\n     * Call canceled event handler.\r\n     */\r\n    let handleCallCanceled = function( event )\r\n    {\r\n        closeCall(event.callId);\r\n    };\r\n\r\n    /**\r\n     * Remote offer event handler.\r\n     */\r\n    let handleRemoteOffer = function( event )\r\n    {\r\n        // Create the peer connection.\r\n        let peerConnection = new RTCPeerConnection(rtcConfiguration);\r\n        let call = calls[event.callId];\r\n        call.bind(peerConnection, false);\r\n\r\n        // Handle the peer connection lifecycle.\r\n        peerConnection.oniceconnectionstatechange = function( other )\r\n        {\r\n            handleIceConnectionStateChange(call);\r\n        }\r\n\r\n        // Set the callee remote description.\r\n        peerConnection.setRemoteDescription(JSON.parse(event.offer));\r\n\r\n        // Gather the pending candidates.\r\n        call.gatherPendingCandidates();\r\n\r\n        // Generate the candidates.\r\n        peerConnection.onicecandidate = function( other )\r\n        {\r\n            if( !other.candidate || other.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n            {\r\n                return;\r\n            }\r\n\r\n            let message =\r\n            {\r\n                id: \"candidate\",\r\n                callId: event.callId,\r\n                callerId: event.callerId,\r\n                calleeId: event.calleeId,\r\n                candidate: JSON.stringify(other.candidate)\r\n            };\r\n            sendMessage(message);\r\n        };\r\n\r\n        // Add the tracks.\r\n        let tracks = settings.defaultStream.getTracks();\r\n        tracks.forEach(track => peerConnection.addTrack(track));\r\n\r\n        // Create the answer.\r\n        window.setTimeout(function()\r\n        {\r\n            peerConnection.createAnswer().then(function( sdp )\r\n            {\r\n                // Set the callee local description.\r\n                peerConnection.setLocalDescription(sdp);\r\n\r\n                let message =\r\n                {\r\n                    id: \"answer\",\r\n                    callId: event.callId,\r\n                    callerId: event.callerId,\r\n                    calleeId: event.calleeId,\r\n                    answer: JSON.stringify(sdp)\r\n                };\r\n                sendMessage(message);\r\n            });\r\n        }, 500);\r\n    };\r\n\r\n    /**\r\n     * Remote answer event handler.\r\n     */\r\n    let handleRemoteAnswer = function( event )\r\n    {\r\n        if( event.callId in calls )\r\n        {\r\n            let answer = JSON.parse(event.answer);\r\n\r\n            // Set the caller remote description.\r\n            calls[event.callId].setRemoteDescription(answer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Remote candidate event handler.\r\n     */\r\n    let handleRemoteCandidate = function( event )\r\n    {\r\n        let candidate = JSON.parse(event.candidate);\r\n        if( !candidate || !candidate.candidate || candidate.candidate === \"\" ) // Empty if the RTCIceCandidate is an \"end of candidates\" indicator.\r\n        {\r\n            return;\r\n        }\r\n\r\n        if( event.callId in calls )\r\n        {\r\n            let call = calls[event.callId];\r\n            call.addCandidate(candidate);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * User hangup event handler.\r\n     */\r\n    let handleUserHangup = function( event )\r\n    {\r\n        closeCall(event.callId);\r\n    };\r\n\r\n    /**\r\n     * ICE connection state change event handler.\r\n     */\r\n    let handleIceConnectionStateChange = async function( call )\r\n    {\r\n        let state = call.getState();\r\n        console?.log(\"%c\" + \"Connection State\" + \"%o%o\", settings.debugStyle, call.callId, state);\r\n\r\n        switch( state )\r\n        {\r\n            case \"failed\":\r\n            case \"disconnected\":\r\n            case \"closed\":\r\n            {\r\n                hangup(call.callId);\r\n                break;\r\n            }\r\n            case \"new\":\r\n            case \"checking\":\r\n            case \"completed\":\r\n            {\r\n                break;\r\n            }\r\n            case \"connected\":\r\n            {\r\n                let stream = call.getRemoteStream();\r\n                console?.log(\"%c\" + RTCEvent.CallOpened + \"%o%o\", settings.debugStyle, call.callId, stream);\r\n                emit(RTCEvent.CallOpened, { call: call, stream: stream });\r\n                break;\r\n            }\r\n        }\r\n    };\r\n//#endregion\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        getCall,\r\n        getCalls,\r\n        connect,\r\n        disconnect,\r\n        register,\r\n        unregister,\r\n        call,\r\n        acceptCall,\r\n        cancelCall,\r\n        hangup\r\n    };\r\n}\r\n\r\nexport function RTCCall( callId, callerId, calleeId )\r\n{\r\n//#region Variables\r\n    let connection = null;\r\n    let candidates = [];\r\n    let channels = { };\r\n    let initiator = false;\r\n//#endregion\r\n\r\n//#region Methods\r\n    /**\r\n     * Bind the call to a peer connection.\r\n     */\r\n    let bind = function( peerConnection, isInitiator )\r\n    {\r\n        if( !(peerConnection instanceof RTCPeerConnection) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection = peerConnection;\r\n        initiator = isInitiator;\r\n\r\n        // Handle the data channel event internally to track the data channels lifecycle.\r\n        connection.addEventListener(\"datachannel\", function( event )\r\n        {\r\n            channels[event.channel.label] = event.channel;\r\n\r\n            // Handle the close event.\r\n            event.channel.addEventListener(\"onclose\", function( event )\r\n            {\r\n                delete channels[event.channel.label];\r\n            });\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Close the call.\r\n     */\r\n    let close = function()\r\n    {\r\n        connection?.close();\r\n    };\r\n\r\n    /**\r\n     * Return whether the user is the initiator.\r\n     */\r\n    let isInitiator = function()\r\n    {\r\n        return initiator;\r\n    };\r\n\r\n    /**\r\n     * Get the call state.\r\n     */\r\n    let getState = function()\r\n    {\r\n        return (connection) ? connection.iceConnectionState : \"closed\";\r\n    };\r\n\r\n    /**\r\n     * Get the call stats.\r\n     */\r\n    let getStats = async function()\r\n    {\r\n        if( !connection )\r\n        {\r\n            return;\r\n        }\r\n\r\n        let callStats = { callId: callId, callerId: callerId, calleeId: calleeId };\r\n\r\n        return await connection.getStats(null).then(function( stats )\r\n        {\r\n            // Get the stats of the succeeded candidate pair.\r\n            let pairStats = null;\r\n            stats.forEach(report =>\r\n            {\r\n                //console.log(report);\r\n                if( report.type === \"candidate-pair\" && (report.selected === true || report.state === \"succeeded\") )\r\n                {\r\n                    pairStats = report;\r\n                }\r\n            });\r\n\r\n            // Get the stats of the local and remote candidates.\r\n            if( pairStats )\r\n            {\r\n                stats.forEach(report =>\r\n                {\r\n                    if( report.id === pairStats.localCandidateId )\r\n                    {\r\n                        callStats.localType = report.candidateType;\r\n                        callStats.localAddress = report.address ?? report.ip;\r\n                        callStats.localPort = report.port;\r\n                        callStats.localProtocol = report.protocol;\r\n                    }\r\n                    if( report.id === pairStats.remoteCandidateId )\r\n                    {\r\n                        callStats.remoteType = report.candidateType;\r\n                        callStats.remoteAddress = report.address ?? report.ip;\r\n                        callStats.remotePort = report.port;\r\n                        callStats.remoteProtocol = report.protocol;\r\n                    }\r\n                });\r\n            }\r\n\r\n            return Promise.resolve(callStats);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Add a candidate or save it for gathering.\r\n     */\r\n    let addCandidate = function( candidate )\r\n    {\r\n        if( !connection )\r\n        {\r\n            candidates.push(candidate);\r\n        }\r\n        else\r\n        {\r\n            connection.addIceCandidate(candidate);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Gather the pending candidates.\r\n     */\r\n    let gatherPendingCandidates = function()\r\n    {\r\n        if( candidates.length > 0 )\r\n        {\r\n            candidates.forEach(candidate => connection.addIceCandidate(candidate));\r\n            candidates = [];\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set the remote session description.\r\n     */\r\n    let setRemoteDescription = function( description )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection.setRemoteDescription(description);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * [NYI] Set the stream's bandwidth.\r\n     * References:\r\n     * https://webrtchacks.com/limit-webrtc-bandwidth-sdp/\r\n     * https://stackoverflow.com/questions/57653899/how-to-increase-the-bitrate-of-webrtc\r\n     */\r\n    let setBandwidth = function( bandwidth )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let senders = connection.getSenders();\r\n        if( !senders )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            let parameters = sender.getParameters();\r\n            if( !parameters.encodings )\r\n            {\r\n                parameters.encodings = [{ }];\r\n            }\r\n\r\n            parameters.encodings[0].maxBitrate = bandwidth * 1000;\r\n\r\n            sender.setParameters(parameters);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Get the remote audio track specified by index.\r\n     */\r\n    let getRemoteAudioTrack = function ( index = 0 )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track.kind === \"audio\" )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < tracks.length )\r\n        {\r\n            return tracks[index];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Get the remote video track specified by index.\r\n     */\r\n    let getRemoteVideoTrack = function ( index = 0 )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track.kind === \"video\" )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < tracks.length )\r\n        {\r\n            return tracks[index];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Get the remote stream of the peer connection composed by all the audio and video tracks.\r\n     */\r\n    let getRemoteStream = function()\r\n    {\r\n        if( !connection )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let receivers = connection.getReceivers();\r\n        if( !receivers )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let tracks = [];\r\n        for( let i = 0; i < receivers.length; i++ )\r\n        {\r\n            let receiver = receivers[i];\r\n            if( receiver.track )\r\n            {\r\n                tracks.push(receiver.track);\r\n            }\r\n        }\r\n\r\n        if( tracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let stream = new MediaStream();\r\n        for( let i = 0; i < tracks.length; i++ )\r\n        {\r\n            let track = tracks[i];\r\n            stream.addTrack(track);\r\n        }\r\n\r\n        return stream;\r\n    };\r\n\r\n    /**\r\n     * Replace the local audio track specified by index.\r\n     */\r\n    let replaceLocalAudioTrack = function( track, index = 0 )\r\n    {\r\n        if( !connection || !track )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let audioSenders = [];\r\n        let senders = connection.getSenders();\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            if( sender.track && sender.track.kind === \"audio\" )\r\n            {\r\n                audioSenders.push(sender);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < audioSenders.length )\r\n        {\r\n            audioSenders[index].replaceTrack(track);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Replace the local video track specified by index.\r\n     */\r\n    let replaceLocalVideoTrack = function( track, index = 0 )\r\n    {\r\n        if( !connection || !track )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let videoSenders = [];\r\n        let senders = connection.getSenders();\r\n        for( let i = 0; i < senders.length; i++ )\r\n        {\r\n            let sender = senders[i];\r\n            if( sender.track && sender.track.kind === \"video\" )\r\n            {\r\n                videoSenders.push(sender);\r\n            }\r\n        }\r\n\r\n        if( index >= 0 && index < videoSenders.length )\r\n        {\r\n            videoSenders[index].replaceTrack(track);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n//#endregion\r\n\r\n//#region DataChannel\r\n    /**\r\n     * Open a data channel.\r\n     */\r\n    let openChannel = function( label )\r\n    {\r\n        if( !connection || label in channels )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = connection.createDataChannel(label);\r\n        channels[label] = channel;\r\n\r\n        // Handle the close event.\r\n        channel.addEventListener(\"onclose\", function( event )\r\n        {\r\n            delete channels[channel.label];\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Close a data channel.\r\n     */\r\n    let closeChannel = function( label )\r\n    {\r\n        if( !connection || !(label in channels) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.close();\r\n        delete channels[label];\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback for the data channel event.\r\n     */\r\n    let onDataChannel = function( callback )\r\n    {\r\n        if( !connection )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        connection.addEventListener(\"datachannel\", callback);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel open event.\r\n     */\r\n    let onChannelOpen = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onopen = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel close event.\r\n     */\r\n    let onChannelClose = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.addEventListener(\"onclose\", callback);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel error event.\r\n     */\r\n    let onChannelError = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onerror = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set a callback to a data channel message event.\r\n     */\r\n    let onChannelMessage = function( label, callback )\r\n    {\r\n        if( !connection || !(label in channels) || !(callback instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        channel.onmessage = callback;\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Send data through an opened channel.\r\n     */\r\n    let sendData = function( label, data )\r\n    {\r\n        if( !connection || !(label in channels) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let channel = channels[label];\r\n        if( channel.readyState !== \"open\" )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        channel.send(data);\r\n\r\n        return true;\r\n    };\r\n//#endregion\r\n\r\n    return {\r\n        get callId() { return callId; },\r\n        get callerId() { return callerId; },\r\n        get calleeId() { return calleeId; },\r\n        bind,\r\n        close,\r\n        isInitiator,\r\n        getState,\r\n        getStats,\r\n        addCandidate,\r\n        gatherPendingCandidates,\r\n        setRemoteDescription,\r\n        setBandwidth,\r\n        getRemoteAudioTrack,\r\n        getRemoteVideoTrack,\r\n        getRemoteStream,\r\n        replaceLocalAudioTrack,\r\n        replaceLocalVideoTrack,\r\n        openChannel,\r\n        closeChannel,\r\n        onDataChannel,\r\n        onChannelOpen,\r\n        onChannelClose,\r\n        onChannelError,\r\n        onChannelMessage,\r\n        sendData\r\n    };\r\n}","\"use strict\";\r\n\r\nexport const LobbyEvent =\r\n{\r\n\tClientConnected:        \"client_connected\",\r\n\tClientDisconnected:     \"client_disconnected\",\r\n    Error:                  \"error\",\r\n    UserOnline:             \"user_online\",\r\n    UserOffline:            \"user_offline\",\r\n    RoomCreated:            \"room_created\",\r\n    RoomDeleted:            \"room_deleted\",\r\n    GuestJoinedRoom:        \"guest_joined_room\",\r\n    GuestLeftRoom:          \"guest_left_room\",\r\n    UserRejoined:           \"user_rejoined\"\r\n};\r\n\r\nexport function LobbyClient( settings )\r\n{\r\n    let defaultSettings =\r\n    {\r\n        debug: false,\r\n        debugStyle: \"background: hsla(0, 0%, 13%, 1); color: hsla(180, 89%, 45%, 1)\",\r\n        pingPeriod: 5 * 1000\r\n    };\r\n\r\n    settings = (typeof settings !== \"object\") ? { } : settings;\r\n    settings = Object.assign({ }, defaultSettings, settings);\r\n\r\n    let console = (settings.debug) ? window.console : null;\r\n\r\n    let responses = { };\r\n    let events = { };\r\n\r\n    let token = null;\r\n    let socket = null;\r\n    let keepAliveTimeout = null;\r\n\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n \r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n \r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(LobbyEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Connect to the server.\r\n     */\r\n    let connect = function( url, accessToken )\r\n    {\r\n        token = accessToken;\r\n        socket = new WebSocket(url + \"?token=\" + token);\r\n\r\n        socket.onopen = onOpen;\r\n        socket.onmessage = onMessage;\r\n        socket.onclose = onClose;\r\n    };\r\n\r\n    /**\r\n     * Disconnect from the server.\r\n     */\r\n    let disconnect = function()\r\n    {\r\n        socket?.close();\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is opened.\r\n     */\r\n    let onOpen = function( event )\r\n    {\r\n        console?.log(\"%c\" + \"connected\" + \"%o\", settings.debugStyle, socket.url);\r\n\r\n        startKeepAlive();\r\n\r\n        emit(LobbyEvent.ClientConnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when the connection is closed.\r\n     */\r\n    let onClose = function( event )\r\n    {\r\n        console?.log(\"%c\" + \"disconnected\" + \"%o\", settings.debugStyle, socket.url);\r\n\r\n        stopKeepAlive();\r\n\r\n        emit(LobbyEvent.ClientDisconnected, { url: socket.url });\r\n    };\r\n\r\n    /**\r\n     * Event handler called when a message is received from the server.\r\n     */\r\n    let onMessage = function( msg )\r\n    {\r\n        let message = JSON.parse(msg.data);\r\n        if( message.event === \"pong\" )\r\n        {\r\n            return;\r\n        }\r\n\r\n        console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.event, message.data);\r\n\r\n        // Check whether the message has a response listener.\r\n        if( message.data.uuid in responses )\r\n        {\r\n            let response = responses[message.data.uuid];\r\n            delete responses[message.data.uuid];\r\n            delete message.data.uuid;\r\n            response(message);\r\n            return;\r\n        }\r\n\r\n        // Check whether the message has an event.\r\n        emit(message.event, message);\r\n    };\r\n\r\n    /**\r\n     * Send a message to the server.\r\n     */\r\n    let sendMessage = function( message, response )\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Set the token.\r\n        message.data.token = token;\r\n\r\n        // Generate a UUID.\r\n        message.data.uuid = uuid();\r\n\r\n        // Add the response listener.\r\n        if( response instanceof Function )\r\n        {\r\n            responses[message.data.uuid] = response;\r\n        }\r\n\r\n        // Send the message.\r\n        let msg = JSON.stringify(message);\r\n        socket.send(msg);\r\n        if( message.event !== \"ping\" )\r\n        {\r\n            console?.log(\" %c%s\" + \"%o\", settings.debugStyle, message.event, msg);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start a keep alive timeout.\r\n     */\r\n    let startKeepAlive = function()\r\n    {\r\n        if( !socket || socket.readyState !== WebSocket.OPEN )\r\n        {\r\n            return;\r\n        }\r\n\r\n        ping();\r\n\r\n        keepAliveTimeout = window.setTimeout(startKeepAlive, settings.pingPeriod);\r\n    };\r\n\r\n    /**\r\n     * Stop the keep alive timeout.\r\n     */\r\n    let stopKeepAlive = function()\r\n    {\r\n        window.clearTimeout(keepAliveTimeout);\r\n    };\r\n\r\n    /**\r\n     * Send a ping to the server.\r\n     */\r\n    let ping = function()\r\n    {\r\n        let message =\r\n        {\r\n            event: \"ping\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message);\r\n    };\r\n\r\n    /**\r\n     * Get the user's room.\r\n     */\r\n    let getRoom = function( response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"get_room\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Get the lobby rooms.\r\n     */\r\n    let getRooms = function( response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"get_rooms\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Create a room.\r\n     */\r\n    let createRoom = function( name, password, hidden, icon, response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"create_room\",\r\n            data:\r\n            {\r\n                name: name,\r\n                password: password,\r\n                hidden: hidden,\r\n                icon: icon\r\n            }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Join a room.\r\n     */\r\n    let joinRoom = function( name, password, response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"join_room\",\r\n            data:\r\n            {\r\n                name: name,\r\n                password: password\r\n            }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Leave a room.\r\n     */\r\n    let leaveRoom = function( response )\r\n    {\r\n        let message =\r\n        {\r\n            event: \"leave_room\",\r\n            data: { }\r\n        };\r\n        return sendMessage(message, response);\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier.\r\n     * Reference: RFC 4122 https://www.ietf.org/rfc/rfc4122.txt\r\n     */\r\n    let uuid = function()\r\n    {\r\n        return uuidv4();\r\n    };\r\n\r\n    /**\r\n     * Generate a universally unique identifier v4.\r\n     * Reference: https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\r\n     */\r\n    let uuidv4 = function()\r\n    {\r\n        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\r\n          (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\r\n        );\r\n    };\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        connect,\r\n        disconnect,\r\n        getRoom,\r\n        getRooms,\r\n        createRoom,\r\n        joinRoom,\r\n        leaveRoom\r\n    };\r\n}","\"use strict\";\r\n\r\nexport const MediaEvent =\r\n{\r\n\tGotDevices:         \"got_devices\",\r\n\tErrorDevices:       \"error_devices\",\r\n    GotResolutions:     \"got_resolutions\",\r\n    GotStream:          \"got_stream\",\r\n    ErrorStream:        \"error_stream\"\r\n};\r\n\r\nexport function MediaAdapter()\r\n{\r\n    let events = { };\r\n\r\n    let audioStream = null;\r\n    let videoStream = null;\r\n    let mediaStream = null;\r\n\r\n    let audioDevices = { }; // audioDevices[label] = deviceId\r\n    let videoDevices = { }; // videoDevices[label] = deviceId\r\n\r\n    let resolutions =\r\n    {\r\n        \"Undefined\":    { },\r\n        \"320x240\":      { width: 320,\theight: 240 },\t// QVGA 4:3\r\n        \"640x360\":      { width: 640,\theight: 360 },\t// nHD 16:9\r\n        \"640x480\":      { width: 640,\theight: 480 },\t// VGA 4:3\r\n        \"1280x720\":     { width: 1280,\theight: 720 },\t// HD 16:9\r\n        \"1920x1080\":    { width: 1920,\theight: 1080 },\t// FullHD 16:9\r\n        \"3840x2160\":    { width: 3840,\theight: 2160 },\t// 4k 16:9\r\n        //\"7680x4320\":    { width: 7680,\theight: 4320 }\t// 8k 16:9\r\n    };\r\n\r\n    let audioConstraints =\r\n    {\r\n        audio:\r\n        {\r\n            deviceId: { exact: undefined }\r\n        }\r\n    };\r\n\r\n    let videoConstraints =\r\n    {\r\n        video:\r\n        {\r\n            deviceId: { exact: undefined },\r\n            width: { exact: undefined },\r\n            height: { exact: undefined },\r\n            frameRate: { ideal: 60 }\r\n        }\r\n    };\r\n\r\n    let settings =\r\n    {\r\n        audio: \"None\", // label\r\n        video: \"None\", // label\r\n        resolution: \"Undefined\", // resolutions key\r\n    };\r\n\r\n    let previousAudioConstraints = null;\r\n    let previousVideoConstraints = null;\r\n\r\n    /**\r\n     * Add a function that will be called whenever the specified event is emitted.\r\n     */\r\n    let on = function( event, listener )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] !== \"object\" )\r\n        {\r\n            events[event] = [];\r\n        }\r\n\r\n        events[event].push(listener);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Remove the function previously added to be called whenever the specified event is emitted.\r\n     */\r\n    let off = function( event, listener )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( !(listener instanceof Function) )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let index = events[event].indexOf(listener);\r\n            if( index > -1 )\r\n            {\r\n                events[event].splice(index, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Emit the specified event.\r\n     */\r\n    let emit = function( event )\r\n    {\r\n        if( Object.values(MediaEvent).indexOf(event) == -1 )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        let args = [].slice.call(arguments, 1);\r\n\r\n        if( typeof events[event] === \"object\" )\r\n        {\r\n            let listeners = events[event].slice();\r\n            for( let i = 0; i < listeners.length; i++ )\r\n            {\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Start the media adapter.\r\n     */\r\n    let start = async function()\r\n    {\r\n        if( !navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices )\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // Create a dummy stream.\r\n        audioStream = new SilenceStream();\r\n        videoStream = new BlackStream();\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        await window.navigator.mediaDevices.getUserMedia({ audio: true }).catch(e => console.error(e));\r\n        await window.navigator.mediaDevices.getUserMedia({ video: true }).catch(e => console.error(e));\r\n        await findDevices();\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Find the available input and output devices.\r\n     */\r\n    let findDevices = async function()\r\n    {\r\n        return getDevices().then(gotDevices).catch(errorDevices);\r\n    };\r\n\r\n    /**\r\n     * Request a list of the available input and output devices.\r\n     */\r\n    let getDevices = function()\r\n    {\r\n        return window.navigator.mediaDevices.enumerateDevices();\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get devices function.\r\n     */\r\n    let gotDevices = function( deviceInfos )\r\n    {\r\n        audioDevices = { };\r\n        videoDevices = { };\r\n\r\n        // Add inputs for silence and black streams.\r\n        audioDevices[\"None\"] = \"\";\r\n        videoDevices[\"None\"] = \"\";\r\n\r\n        let a = 0, v = 0;\r\n        for( let deviceInfo of deviceInfos )\r\n        {\r\n            if( deviceInfo.kind === \"audioinput\" )\r\n            {\r\n                let label = (deviceInfo.label === \"\" ) ? (\"Audio input \" + a) : deviceInfo.label;\r\n                audioDevices[label] = deviceInfo.deviceId;\r\n                a++;\r\n            }\r\n\r\n            if( deviceInfo.kind === \"videoinput\" )\r\n            {\r\n                let label = (deviceInfo.label === \"\" ) ? (\"Video input \" + v) : deviceInfo.label;\r\n                videoDevices[label] = deviceInfo.deviceId;\r\n                v++;\r\n            }\r\n        }\r\n\r\n        emit(MediaEvent.GotDevices, { audioDevices: audioDevices, videoDevices: videoDevices, settings: settings });\r\n        emit(MediaEvent.GotResolutions, { resolutions: resolutions, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get devices function.\r\n     */\r\n    let errorDevices = function( error )\r\n    {\r\n        let message = \"Device request not allowed in the browser\";\r\n        emit(MediaEvent.ErrorDevices, { error: error, message: message });\r\n    };\r\n\r\n    /**\r\n     * Set the audio device.\r\n     */\r\n    let setAudio = function( device )\r\n    {\r\n        if( !device )\r\n        {\r\n            device = \"None\";\r\n        }\r\n\r\n        if( !(device in audioDevices) )\r\n        {\r\n            let error = \"DeviceNotFound\";\r\n            let message = \"Audio device \" + device + \" not found\";\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            device = \"None\";\r\n        }\r\n\r\n        if( device === \"None\" )\r\n        {\r\n            // Update settings.\r\n            settings.audio = device;\r\n\r\n            // Get dummy stream.\r\n            audioStream = new SilenceStream();\r\n            mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n            emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n        }\r\n        else\r\n        {\r\n            // Save previous constraints.\r\n            previousAudioConstraints = clone(audioConstraints);\r\n\r\n            // Update constraints.\r\n            let deviceId = audioDevices[device];\r\n            audioConstraints.audio.deviceId.exact = deviceId;\r\n\r\n            getAudioStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set the video device and resolution.\r\n     */\r\n    let setVideo = function( device, resolution = \"Undefined\" )\r\n    {\r\n        if( !device )\r\n        {\r\n            device = \"None\";\r\n            resolution = \"Undefined\";\r\n        }\r\n\r\n        if( !resolution )\r\n        {\r\n            resolution = \"Undefined\";\r\n        }\r\n\r\n        if( !(device in videoDevices) )\r\n        {\r\n            let error = \"DeviceNotFound\";\r\n            let message = \"Video device \" + device + \" not found\";\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            device = \"None\";\r\n        }\r\n\r\n        if( !(resolution in resolutions) )\r\n        {\r\n            let error = \"ResolutionNotFound\";\r\n            let message = \"Resolution \" + resolution + \" not found\";\r\n            emit(MediaEvent.ErrorStream, { error: error, message: message, settings: settings });\r\n            resolution = \"Undefined\";\r\n        }\r\n\r\n        if( device === \"None\" )\r\n        {\r\n            // Update settings.\r\n            settings.video = device;\r\n            settings.resolution = resolution;\r\n\r\n            // Get dummy stream.\r\n            let width = resolutions[resolution].width;\r\n            let height = resolutions[resolution].height;\r\n            videoStream = new BlackStream(width, height);\r\n            mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n            emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n        }\r\n        else\r\n        {\r\n            // Save previous constraints.\r\n            previousVideoConstraints = clone(videoConstraints);\r\n\r\n            // Update constraints.\r\n            let deviceId = videoDevices[device];\r\n            videoConstraints.video.deviceId.exact = deviceId;\r\n            let width = resolutions[resolution].width;\r\n            let height = resolutions[resolution].height;\r\n            videoConstraints.video.width.exact = width;\r\n            videoConstraints.video.height.exact = height;\r\n\r\n            getVideoStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Request an audio stream.\r\n     */\r\n    let getAudioStream = function()\r\n    {\r\n        mediaStream = null;\r\n        stopStream(audioStream);\r\n        return window.navigator.mediaDevices.getUserMedia(audioConstraints).then(gotAudioStream).catch(errorAudioStream);\r\n    };\r\n\r\n    /**\r\n     * Request a video stream.\r\n     */\r\n    let getVideoStream = function()\r\n    {\r\n        mediaStream = null;\r\n        stopStream(videoStream);\r\n        return window.navigator.mediaDevices.getUserMedia(videoConstraints).then(gotVideoStream).catch(errorVideoStream);\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get audio stream function.\r\n     */\r\n    let gotAudioStream = async function( stream )\r\n    {\r\n        let audioTrack = stream.getAudioTracks()[0];\r\n\r\n        // Check whether the label is listed, enumerateDevices returns an empty label if the permission for accessing the mediadevice is not given.\r\n        if( !(audioTrack.label in audioDevices) )\r\n        {\r\n            await findDevices();\r\n        }\r\n\r\n        // Update settings.\r\n        settings.audio = audioTrack.label;\r\n\r\n        audioStream = stream;\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Success handler of the get video stream function.\r\n     */\r\n    let gotVideoStream = async function( stream )\r\n    {\r\n        // Video track.\r\n        let videoTrack = stream.getVideoTracks()[0];\r\n        let videoTrackSettings = videoTrack.getSettings();\r\n\r\n        // Check whether the label is listed, enumerateDevices returns an empty label if the permission for accessing the mediadevice is not given.\r\n        if( !(videoTrack.label in videoDevices) )\r\n        {\r\n            await findDevices();\r\n        }\r\n\r\n        // Check whether the resolution is already listed.\r\n        let width = videoTrackSettings.width;\r\n        let height = videoTrackSettings.height;\r\n        let resolution = width + \"x\" + height;\r\n        if( !resolutions[resolution] )\r\n        {\r\n            // Add the resolution.\r\n            resolutions[resolution] = { width: width, height: height };\r\n\r\n            // Sort resolutions.\r\n            resolutions = Object.entries(resolutions).sort((a, b) => (a[1].width || Number.NEGATIVE_INFINITY) > (b[1].width || Number.NEGATIVE_INFINITY)).reduce((r, [k, v]) => ({ ...r, [k]: v }), {});\r\n\r\n            emit(MediaEvent.GotResolutions, { resolutions: resolutions, settings: settings });\r\n        }\r\n\r\n        // Update video constraints.\r\n        videoConstraints.video.width.exact = width;\r\n        videoConstraints.video.height.exact = height;\r\n\r\n        // Update settings.\r\n        settings.video = videoTrack.label;\r\n        settings.resolution = resolution;\r\n\r\n        videoStream = stream;\r\n        mediaStream = mixStreams(audioStream, videoStream);\r\n\r\n        emit(MediaEvent.GotStream, { stream: mediaStream, settings: settings });\r\n    };\r\n\r\n    /**\r\n     * Return a semantic error string from the specified error.\r\n     */\r\n    let errorStream = function( error )\r\n    {\r\n        let message = \"\";\r\n        if( error.name === \"NotFoundError\" || error.name === \"DevicesNotFoundError\" )\r\n        {\r\n            message = \"Required track is missing\";\r\n        }\r\n        else if( error.name === \"NotReadableError\" || error.name === \"TrackStartError\" )\r\n        {\r\n            message = \"Microphone or Webcam are already in use\";\r\n        }\r\n        else if( error.name === \"OverconstrainedError\" || error.name === \"ConstraintNotSatisfiedError\" )\r\n        {\r\n            //message = \"Constraints cannot be satisfied\";\r\n            message = \"Invalid device settings\";\r\n        }\r\n        else if( error.name === \"NotAllowedError\" || error.name === \"PermissionDeniedError\" )\r\n        {\r\n            message = \"Permission denied in browser\";\r\n        }\r\n        else if( error.name === \"TypeError\" || error.name === \"TypeError\" )\r\n        {\r\n            message = \"Empty constraints object\";\r\n        }\r\n        else\r\n        {\r\n            message = \"Unknown error\";\r\n        }\r\n\r\n        return message;\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get audio stream function.\r\n     */\r\n    let errorAudioStream = function( error )\r\n    {\r\n        let message = errorStream(error);\r\n        emit(MediaEvent.ErrorStream, { error: error.name, message: message, settings: settings });\r\n\r\n        if( previousAudioConstraints )\r\n        {\r\n            audioConstraints = clone(previousAudioConstraints);\r\n            previousAudioConstraints = null;\r\n            getAudioStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Error handler of the get video stream function.\r\n     */\r\n    let errorVideoStream = function( error )\r\n    {\r\n        let message = errorStream(error);\r\n        emit(MediaEvent.ErrorStream, { error: error.name, message: message, settings: settings });\r\n\r\n        if( previousVideoConstraints )\r\n        {\r\n            videoConstraints = clone(previousVideoConstraints);\r\n            previousVideoConstraints = null;\r\n            getVideoStream();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Mix two streams with 1 audio and 1 video tracks into one.\r\n     */\r\n    let mixStreams = function( audioStream, videoStream )\r\n    {\r\n        let audioTracks = audioStream.getAudioTracks();\r\n        if( !audioTracks || audioTracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let videoTracks = videoStream.getVideoTracks();\r\n        if( !videoTracks || videoTracks.length === 0 )\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let stream = new MediaStream();\r\n        stream.addTrack(audioTracks[0]);\r\n        stream.addTrack(videoTracks[0]);\r\n\r\n        return stream;\r\n    };\r\n\r\n    /**\r\n     * Stop a stream, stopping its tracks.\r\n     */\r\n    let stopStream = function( stream )\r\n    {\r\n        stream.getTracks().forEach(track => track.stop());\r\n    };\r\n\r\n    /**\r\n     * Return a clone of the object.\r\n     */\r\n    let clone = function( object )\r\n    {\r\n        return JSON.parse(JSON.stringify(object));\r\n    };\r\n\r\n    return {\r\n        on,\r\n        off,\r\n        start,\r\n        findDevices,\r\n        getDevices,\r\n        setAudio,\r\n        setVideo\r\n    };\r\n}\r\n\r\nexport function SilenceTrack()\r\n{\r\n    let stream = new SilenceStream();\r\n    let track = stream.getAudioTracks()[0];\r\n    return track;\r\n}\r\n\r\nexport function BlackTrack( width = 320, height = 240 )\r\n{\r\n    let stream = new BlackStream(width, height);\r\n    let track = stream.getVideoTracks()[0];\r\n    return track;\r\n}\r\n\r\nexport function SilenceStream()\r\n{\r\n    let audioContext = new AudioContext();\r\n\r\n    let gainNode = audioContext.createGain();\r\n    let oscillatorNode = audioContext.createOscillator();\r\n    oscillatorNode.connect(gainNode);\r\n    let destination = gainNode.connect(audioContext.createMediaStreamDestination());\r\n\r\n    gainNode.gain.setValueAtTime(0, audioContext.currentTime);\r\n    oscillatorNode.start();\r\n\r\n    let stream = destination.stream;\r\n    return stream;\r\n}\r\n\r\nexport function BlackStream( width = 320, height = 240 )\r\n{\r\n    let canvas = window.document.createElement(\"canvas\");\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    let context = canvas.getContext(\"2d\");\r\n    let interval = null;\r\n    function render()\r\n    {\r\n        if( !context )\r\n        {\r\n            window.clearInterval(interval);\r\n            return;\r\n        }\r\n\r\n        context.fillRect(0, 0, width, height);\r\n        // context.beginPath();\r\n        // context.rect(0, 0, width, height);\r\n        // context.fillStyle = \"blue\";\r\n        // context.fill();\r\n    }\r\n    interval = window.setInterval(render, 1000);\r\n\r\n    let stream = canvas.captureStream();\r\n    return stream;\r\n}\r\n\r\nexport function DummyStream()\r\n{\r\n    let silenceStream = new SilenceStream();\r\n    let blackStream = new BlackStream();\r\n    let silenceTrack = silenceStream.getAudioTracks()[0];\r\n    let blackTrack = blackStream.getVideoTracks()[0];\r\n    let stream = new MediaStream([silenceTrack, blackTrack]);\r\n\r\n    /**\r\n     * Return the audio track.\r\n     */\r\n    let getAudioTrack = function()\r\n    {\r\n        return silenceTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the video track.\r\n     */\r\n    let getVideoTrack = function()\r\n    {\r\n        return blackTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the stream.\r\n     */\r\n    let getStream = function()\r\n    {\r\n        return stream;\r\n    };\r\n\r\n    return {\r\n        getAudioTrack,\r\n        getVideoTrack,\r\n        getStream\r\n    };\r\n}","// eslint-disable\r\n\r\n//import AdapterJS from 'adapterjs';\r\nimport { RTCEvent,   RTCClient }    from \"./rtcClient.js\";  // eslint-disable-line\r\nimport { LobbyEvent, LobbyClient }  from './lobbyClient.js';      // eslint-disable-line\r\nimport { MediaEvent, MediaAdapter } from \"./mediaAdapter.js\";   // eslint-disable-line\r\nimport { DummyStream }  from \"./dummyStream.js\";\r\n\r\nconst DEBUG = process.env.REACT_APP_DEBUG ?? false;\r\n\r\nlet appClient    = window.appClient    = new LobbyClient({ debug: false }),\r\n    mediaAdapter = window.mediaAdapter = new MediaAdapter({ debug: DEBUG }),\r\n    dummyStream  = window.dummyStream  = new DummyStream({ debug: DEBUG }),\r\n    rtcClient    = window.rtcClient    = new RTCClient({ debug: DEBUG, defaultStream: dummyStream.getStream() });\r\n\r\nlet APPEvent = LobbyEvent;\r\n\r\nexport {\r\n   APPEvent,\r\n   RTCEvent,\r\n   MediaEvent,\r\n   rtcClient, \r\n   appClient,\r\n   mediaAdapter,\r\n   dummyStream\r\n}","export function DummyStream()\r\n{\r\n//#region PRIVATE\r\n\r\n    let _blackCanvas = null;\r\n    let _silenceStream = null;\r\n    let _blackStream = null;\r\n    let _silenceTrack = null\r\n    let _blackTrack = null;\r\n\r\n    /**\r\n     * Create a silence audio track.\r\n     */\r\n    let createSilenceTrack = function()\r\n    {\r\n        let audioContext = new AudioContext();\r\n\r\n        let gainNode = audioContext.createGain();\r\n        let oscillatorNode = audioContext.createOscillator();\r\n        oscillatorNode.connect(gainNode);\r\n        let destination = gainNode.connect(audioContext.createMediaStreamDestination());\r\n\r\n        _silenceStream = destination.stream;\r\n        _silenceTrack = _silenceStream.getAudioTracks()[0];\r\n    };\r\n\r\n    /**\r\n     * Create a black video track.\r\n     * @param {Number} width - The video width.\r\n     * @param {Number} height - The video height.\r\n     */\r\n    let createBlackTrack = function( width = 320, height = 240 )\r\n    {\r\n        if( !_blackCanvas )\r\n        {\r\n            _blackCanvas = window.document.createElement(\"canvas\");\r\n        }\r\n\r\n        _blackCanvas.width = width;\r\n        _blackCanvas.height = height;\r\n        let context = _blackCanvas.getContext(\"2d\");\r\n        context.fillRect(0, 0, width, height);\r\n\r\n        _blackStream = _blackCanvas.captureStream();\r\n        _blackTrack = _blackStream.getVideoTracks()[0];\r\n    };\r\n\r\n    createSilenceTrack();\r\n    createBlackTrack();\r\n    let _stream = new MediaStream([_silenceTrack, _blackTrack]);\r\n\r\n    /**\r\n     * Return the audio track.\r\n     * @returns {MediaStreamTrack} The audio track.\r\n     */\r\n    let getAudioTrack = function()\r\n    {\r\n        return _silenceTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the video track.\r\n     * @returns {MediaStreamTrack} The video track.\r\n     */\r\n    let getVideoTrack = function()\r\n    {\r\n        return _blackTrack;\r\n    };\r\n\r\n    /**\r\n     * Return the stream.\r\n     * @returns {MediaStream} The stream.\r\n     */\r\n    let getStream = function()\r\n    {\r\n        return _stream;\r\n    };\r\n\r\n//#endregion\r\n\r\n//#region PUBLIC\r\n\r\n    return {\r\n        getAudioTrack,\r\n        getVideoTrack,\r\n        getStream\r\n    };\r\n\r\n//#endregion\r\n}","import * as BRA from \"lib_bra\"\r\nimport toast from 'react-hot-toast'\r\nimport { useState, useContext, useReducer, useEffect, createContext, useRef } from 'react'\r\n\r\n\r\nexport const MediaContext = createContext(); \r\nexport default ({children, ...props}) => {\r\n\r\n    let   {current:init_evts}            = useRef(0);\r\n    const videoRef                       = useRef(null);\r\n    const [ready, setReady ]             = useState(false);\r\n    const [devices , setDevices]         = useState(null);\r\n    const [settings, setSettings ]       = useState(null);\r\n    const [resolutions, setResolutions ] = useState(null);\r\n    let [localStream, setLocalStream ] = useReducer( (value, newvalue)=>{\r\n        if( videoRef && videoRef.current )\r\n            videoRef.current.srcObject = newvalue;\r\n        return newvalue;\r\n    }, BRA.dummyStream.getStream() );\r\n    \r\n    useEffect( ()=>{ \r\n      \r\n     \r\n        (async ()=>{\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.GotDevices,          onGotDevices );\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.ErrorStream,         onError);\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.ErrorDevices,        onError);\r\n            BRA.mediaAdapter.on(BRA.MediaEvent.GotResolutions,      onGotResolutions );\r\n  \r\n            let supported = await BRA.mediaAdapter.start();\r\n            if( !supported )\r\n                return toast.error(\"Media devices are not available\");\r\n            \r\n\r\n            let audio = window.localStorage.getItem(\"audio\");\r\n            let video = window.localStorage.getItem(\"video\");               \r\n            \r\n            await new Promise((resolve, reject)=>{\r\n                function onStream(d){\r\n                    BRA.mediaAdapter.off(BRA.MediaEvent.GotStream, onStream );\r\n                    resolve(d);\r\n                }\r\n                BRA.mediaAdapter.on(BRA.MediaEvent.GotStream, onStream );\r\n                BRA.mediaAdapter.setVideo(video);\r\n            })\r\n            .then(onGotStream);\r\n\r\n            await new Promise((resolve, reject)=>{\r\n                function onStream(d){\r\n                    BRA.mediaAdapter.off(BRA.MediaEvent.GotStream, onStream );\r\n                    BRA.mediaAdapter.on(BRA.MediaEvent.GotStream, onGotStream );\r\n                    resolve(d);\r\n                }\r\n                BRA.mediaAdapter.on(BRA.MediaEvent.GotStream, onStream );\r\n                BRA.mediaAdapter.setAudio(audio);\r\n            })\r\n            .then(onGotStream)        \r\n           \r\n            setReady(true);\r\n        })();\r\n            \r\n        function onUnload(){\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.GotStream,      onGotStream );\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.GotDevices,     onGotDevices );\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.ErrorStream,    onError);\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.ErrorDevices,   onError);\r\n            BRA.mediaAdapter.off(BRA.MediaEvent.GotResolutions, onGotResolutions );\r\n            window.removeEventListener('unload ', onUnload);\r\n        }\r\n        window.addEventListener('unload ',    onUnload);\r\n    return ()=>{\r\n        onUnload();\r\n    }}, []);\r\n\r\n    function getDevices(){\r\n        BRA.mediaAdapter.getDevices();\r\n    }\r\n\r\n    function onGotResolutions({resolutions, settings})\r\n    { \r\n        setSettings({...settings});\r\n        setResolutions(resolutions); \r\n    }\r\n    \r\n    function onGotDevices ({ audioDevices: audio, videoDevices: video, settings }) \r\n    { \r\n        setSettings({...settings});\r\n        setDevices({...devices, audio, video});\r\n    }\r\n\r\n    function onGotStream({stream, settings})\r\n    { \r\n        window.localStorage.setItem(\"audio\", settings?.audio);\r\n        window.localStorage.setItem(\"video\", settings?.video);\r\n        window.localStream = localStream = stream;\r\n        setSettings({...settings});\r\n        setLocalStream(localStream);\r\n    }\r\n\r\n    function onError({error, message}){\r\n        toast.error(`${error}: ${message}`);\r\n    }\r\n\r\n    function init(){\r\n        if( init_evts <= 0 ){\r\n            //start the thing\r\n            //BRA.mediaAdapter.start();\r\n            getDevices();\r\n        }\r\n        ++init_evts;\r\n    }\r\n\r\n    function stop(){\r\n        --init_evts;\r\n        if( init_evts <= 0 ){\r\n            //BRA.mediaAdapter.stop();\r\n            //stop the thing\r\n        }\r\n    }\r\n\r\n    function setVideo(device, resolution){\r\n        BRA.mediaAdapter.setVideo(device, resolution);\r\n    }\r\n    function setAudio(device){\r\n        BRA.mediaAdapter.setAudio(device);\r\n    }\r\n\r\n    const store = window.media = {\r\n        devices,\r\n        settings, \r\n        resolutions,\r\n        localStream,\r\n        init,\r\n        stop,\r\n        getDevices,\r\n        setVideo,\r\n        setAudio,\r\n        ready,\r\n    }\r\n\r\n    return <MediaContext.Provider value={store} children={children}/>\r\n}","import * as BRA from \"lib_bra\"\r\nimport toast from 'react-hot-toast'\r\nimport { useState, useContext, useEffect, createContext, useReducer } from 'react'\r\nimport { MediaContext } from 'utils/ctx_mediadevices'\r\nimport { AuthContext } from 'utils/ctx_authentication'\r\nimport { RoomsContext } from 'utils/ctx_rooms'\r\n\r\n\r\nexport const StreamContext = createContext(); \r\nexport default ({children, ...props}) => {\r\n    const auth  = useContext(AuthContext);\r\n    const rooms = useContext(RoomsContext);\r\n    const media = useContext(MediaContext);\r\n\r\n    const [state, setState]             = useState(0);  \r\n    let [streams, setStreams]         = useReducer((o,n)=>{\r\n        window.streams = streams = n;\r\n        setState(s => s+1);\r\n        return n;\r\n    },{});\r\n    let [liveCalls, setLiveCalls]     = useReducer((o,n)=>{\r\n        window.liveCalls = liveCalls =n;\r\n        setState(s => s+1);\r\n        return n;\r\n    },{});\r\n    let [localStream, setLocalStream] = useReducer((o,n)=>{\r\n        window.localStream = localStream = n;\r\n\r\n        setState(s => s+1);\r\n        return n;\r\n    },media.localStream);\r\n    window.localStream = localStream;\r\n    window.liveCalls = liveCalls;\r\n    window.streams = streams;\r\n\r\n\r\n\r\n    useEffect( ()=>{ \r\n        BRA.rtcClient.on(BRA.RTCEvent.IncomingCall, onIncomingCall);\r\n        BRA.rtcClient.on(BRA.RTCEvent.CallOpened,   onCallOpened);\r\n        BRA.rtcClient.on(BRA.RTCEvent.CallClosed,   onCallClosed);\r\n        BRA.rtcClient.on(BRA.RTCEvent.UserHangup,   onUserHangup);\r\n    return ()=>{\r\n        BRA.rtcClient.off(BRA.RTCEvent.IncomingCall, onIncomingCall);\r\n        BRA.rtcClient.off(BRA.RTCEvent.CallOpened,   onCallOpened);\r\n        BRA.rtcClient.off(BRA.RTCEvent.CallClosed,   onCallClosed);\r\n        BRA.rtcClient.off(BRA.RTCEvent.UserHangup,   onUserHangup);\r\n    }}, []);\r\n\r\n    useEffect( ()=>{\r\n        setState(s => s+1);\r\n        window.localStream = media.localStream;\r\n        setLocalStream(window.localStream);\r\n    }, [media.localStream]);\r\n\r\n    function callUser(username, callback){\r\n        return BRA.rtcClient.call(username, callback ?? (({callId, status, description}) => {\r\n            if(status === 'error'){\r\n                toast.error(`Call error: ${description}`,{icon:<i className=\"bi bi-telephone-x\"/>, duration: 5000});\r\n            }\r\n        }));\r\n    }\r\n\r\n    function callAllUsers(){\r\n        const users = rooms.current?.users?.filter((v, k, a) => { return v && v?.username !== auth.user?.username });\r\n        for (let user of users ?? []){\r\n            \r\n            if(!callUser(user?.username)){\r\n                toast.error(`Call missed to ${user?.username}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    function callHangup(callId){\r\n        BRA.rtcClient.hangup(callId);\r\n    }\r\n\r\n    function callHangupAll(){\r\n        const calls = Object.keys(BRA.rtcClient.getCalls())\r\n        for (let callId of calls){\r\n            callHangup(callId);\r\n        }\r\n    }\r\n\r\n    function onIncomingCall({ callId, callerId }){\r\n        BRA.rtcClient.acceptCall(callId);\r\n    }\r\n\r\n    function onCallOpened({ call, stream }) {\r\n        const callId = call.callId;\r\n        \r\n        setStreams({...window.streams, [callId]: stream});\r\n        //TODO: esto no es bonito, pero veo otra forma de hacerlo por ahora\r\n        const forwardingCallId = window.liveCalls[callId];   //Live call\r\n\r\n        if (forwardingCallId) {\r\n            const forward_stream = window.streams[forwardingCallId];\r\n            if (!forward_stream) {\r\n                callHangup(callId);\r\n                return toast.error(`Live Call Error: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);;\r\n            }\r\n            toast.success(`Live Call: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);\r\n            const videotrack = forward_stream.getVideoTracks()[0];\r\n            const audiotrack = forward_stream.getAudioTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n            toast(`Forwarding stream`, {icon:<i className=\"bi bi-cast\"/>});\r\n        }\r\n\r\n        //Regular call\r\n        else {\r\n            toast.success(`Incoming Call: ${callId}, callerId: ${call.callerId}, calleeId: ${call.calleeId} `);\r\n            if(!window.localStream) return;\r\n            const videotrack = window.localStream.getVideoTracks()[0];\r\n            const audiotrack = window.localStream.getAudioTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n            toast(`Call from ${getUserId(callId)}`, {icon:<i className=\"bi bi-telephone-inbound\"/>});\r\n        }\r\n    }\r\n\r\n    function onCallClosed({ call }){\r\n        if (!call)\r\n            return console.error(\"No call\");\r\n\r\n        const callId = call.callId;\r\n        manageLiveCallClosed(callId);\r\n        delete window.streams[callId];\r\n        setStreams({...window.streams});\r\n        toast(`Call from ${getUserId(callId)} closed`, {icon:<i className=\"bi bi-telephone-x\"/>});\r\n    }\r\n\r\n    function onUserHangup({ callId }){\r\n        if (!callId)\r\n            return console.error(\"No call\");\r\n\r\n        manageLiveCallClosed(callId);\r\n        delete window.streams[callId];\r\n        setStreams({...window.streams});\r\n\r\n        toast(`User ${getUserId(callId)} hangup`, {icon:<i className=\"bi bi-telephone-x\"/>});\r\n    }\r\n\r\n    function manageLiveCallClosed(callId) {\r\n        let result = null;\r\n        for (const [mId, fId] of Object.entries(liveCalls)) {\r\n            if (callId !== mId && fId !== callId)\r\n                continue;\r\n\r\n            result = [mId, fId];\r\n            break;\r\n        }\r\n\r\n        if (result) {\r\n            const [mediaHubCallId, forwardedCallId] = result;\r\n            delete window.liveCalls[mediaHubCallId];\r\n            //TODO: esto no es bonito, pero veo otra forma de hacerlo por ahora\r\n            setLiveCalls({...window.liveCalls});\r\n        }\r\n    }\r\n\r\n    function getUserId(callId){\r\n        let id = auth.user?.username;\r\n        let call = BRA.rtcClient.getCalls()[callId];\r\n        if (callId !== \"local\" && call) {\r\n            let { calleeId, callerId } = call;\r\n            id = (calleeId === auth.user?.username) ? callerId : calleeId;\r\n        }\r\n        return id;\r\n    }\r\n\r\n    //TODO:check this\r\n    function forwardCall(mediaHubCallId, forwardedCallId) {\r\n        if (!mediaHubCallId || !forwardedCallId)\r\n            return console.error(`source or target callId's are undefined`);\r\n        window.liveCalls[mediaHubCallId] = forwardedCallId;\r\n        setLiveCalls({...window.liveCalls});\r\n    }\r\n\r\n    function getLiveCall(callId)\r\n    {\r\n        return Object.entries(window.liveCalls).find( v => v[1] === callId ) ?? [null,null];\r\n    }\r\n\r\n    function replaceStream(stream){\r\n        for( const callId in BRA.rtcClient.getCalls() )\r\n        {\r\n            let call = BRA.rtcClient.getCall(callId);\r\n            let audiotrack = stream.getAudioTracks()[0];\r\n            let videotrack = stream.getVideoTracks()[0];\r\n            call.replaceLocalVideoTrack(videotrack);\r\n            call.replaceLocalAudioTrack(audiotrack);\r\n        }\r\n    }\r\n\r\n    const store = window.wrtc = {\r\n        callUser,\r\n        callAllUsers,\r\n        callHangup,\r\n        callHangupAll,\r\n        forwardCall,\r\n        getUserId,\r\n        getLiveCall,\r\n        replaceStream,\r\n        streams: {...streams, local:localStream},\r\n    }\r\n\r\n    return <StreamContext.Provider value={store} children={children}/>\r\n}","export default __webpack_public_path__ + \"static/media/profile_light.7c82d8ab.png\";"],"sourceRoot":""}